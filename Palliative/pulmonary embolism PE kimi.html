<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulmonary Embolism Management Algorithm</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --assessment-color: #3498db;
            --diagnosis-color: #9b59b6;
            --treatment-color: #e67e22;
            --followup-color: #27ae60;
            --urgent-color: #e74c3c;
            --caution-color: #f39c12;
            --stable-color: #2ecc71;
            --bg-light: #f8f9fa;
            --text-dark: #2c3e50;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            gap: 25px;
        }

        /* Sidebar Styles */
        .sidebar {
            position: sticky;
            top: 20px;
            height: fit-content;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            flex: 0 0 280px;
            border-left: 4px solid #3498db;
        }

        .sidebar h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .progress-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .progress-item.active {
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.1) 0%, transparent 100%);
            border-left-color: var(--assessment-color);
            font-weight: 600;
        }

        .progress-item.diagnosis.active {
            border-left-color: var(--diagnosis-color);
        }

        .progress-item.treatment.active {
            border-left-color: var(--treatment-color);
        }

        .progress-item.followup.active {
            border-left-color: var(--followup-color);
        }

        .progress-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            flex-shrink: 0;
        }

        .progress-item.assessment .progress-icon {
            background: var(--assessment-color);
        }

        .progress-item.diagnosis .progress-icon {
            background: var(--diagnosis-color);
        }

        .progress-item.treatment .progress-icon {
            background: var(--treatment-color);
        }

        .progress-item.followup .progress-icon {
            background: var(--followup-color);
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 10px;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            text-align: center;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-top: 4px solid;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.12);
        }

        .card.assessment {
            border-top-color: var(--assessment-color);
        }

        .card.diagnosis {
            border-top-color: var(--diagnosis-color);
        }

        .card.treatment {
            border-top-color: var(--treatment-color);
        }

        .card.followup {
            border-top-color: var(--followup-color);
        }

        .card-header {
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(0,0,0,0.02) 100%);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .card-icon {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .card.assessment .card-icon { background: var(--assessment-color); }
        .card.diagnosis .card-icon { background: var(--diagnosis-color); }
        .card.treatment .card-icon { background: var(--treatment-color); }
        .card.followup .card-icon { background: var(--followup-color); }

        .expand-icon {
            transition: transform 0.3s ease;
            color: #7f8c8d;
            font-size: 18px;
        }

        .card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .card-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .card.expanded .card-body {
            max-height: 2000px;
        }

        .card-content {
            padding: 0 25px 25px;
        }

        /* Badge Styles */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 4px;
        }

        .badge-urgent {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .badge-caution {
            background: linear-gradient(135deg, #f39c12 0%, #d35400 100%);
            color: white;
        }

        .badge-stable {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        /* Content Styles */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid;
        }

        .alert-urgent {
            background: #fef9f9;
            border-left-color: var(--urgent-color);
            color: #c0392b;
        }

        .alert-caution {
            background: #fffef9;
            border-left-color: var(--caution-color);
            color: #d35400;
        }

        .alert-info {
            background: #f9fdff;
            border-left-color: var(--assessment-color);
            color: #2980b9;
        }

        .step-list {
            list-style: none;
            counter-reset: step-counter;
        }

        .step-list li {
            counter-increment: step-counter;
            position: relative;
            padding-left: 40px;
            margin-bottom: 15px;
        }

        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 28px;
            height: 28px;
            background: var(--assessment-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .step-list.diagnosis li::before {
            background: var(--diagnosis-color);
        }

        .step-list.treatment li::before {
            background: var(--treatment-color);
        }

        .step-list.followup li::before {
            background: var(--followup-color);
        }

        .wells-calculator {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid #e9ecef;
        }

        .wells-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .wells-item:last-child {
            border-bottom: none;
            font-weight: 700;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid #dee2e6;
        }

        .wells-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .wells-score {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--diagnosis-color);
        }

        .drug-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .drug-name {
            font-weight: 600;
            color: var(--treatment-color);
            font-size: 1.1rem;
        }

        .drug-dose {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                padding: 15px;
            }

            .sidebar {
                position: relative;
                flex: 1;
                margin-bottom: 20px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .card-content {
                padding: 0 20px 20px;
            }
        }

        /* Smooth Scroll */
        html {
            scroll-behavior: smooth;
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            animation: fadeIn 0.6s ease forwards;
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h3><i class="fas fa-route"></i> Algorithm Progress</h3>
            <div class="progress-item assessment active" data-section="assessment">
                <div class="progress-icon">
                    <i class="fas fa-user-md"></i>
                </div>
                <span>Assessment & Wells Score</span>
            </div>
            <div class="progress-item diagnosis" data-section="diagnosis">
                <div class="progress-icon">
                    <i class="fas fa-search"></i>
                </div>
                <span>Diagnosis Pathway</span>
            </div>
            <div class="progress-item treatment" data-section="treatment">
                <div class="progress-icon">
                    <i class="fas fa-pills"></i>
                </div>
                <span>Initial Treatment</span>
            </div>
            <div class="progress-item followup" data-section="followup">
                <div class="progress-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <span>Follow-up & Monitoring</span>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <h1><i class="fas fa-lungs"></i> Pulmonary Embolism Management</h1>
                <p>Primary Care Algorithm | Based on NICE CKS Guidelines (Sept 2023)</p>
            </div>

            <!-- Assessment Card -->
            <div class="card assessment expanded" id="assessment">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div>
                            <div>Assessment & Clinical Probability</div>
                            <small>Initial evaluation and Wells scoring</small>
                        </div>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="card-body">
                    <div class="card-content">
                        <div class="alert alert-urgent">
                            <strong><i class="fas fa-exclamation-triangle"></i> Immediate Admission Required:</strong> Signs of hemodynamic instability, pregnancy, or postpartum (≤6 weeks)
                        </div>

                        <h4><i class="fas fa-stethoscope"></i> Key Symptoms & Signs</h4>
                        <ul class="step-list">
                            <li><strong>Dyspnea</strong> (50% of cases) - most common feature</li>
                            <li><strong>Pleuritic chest pain</strong> (39%) - localized to one side</li>
                            <li><strong>Tachypnea</strong> (21-39%) - RR > 20/min</li>
                            <li><strong>Hemoptysis</strong> - less common but significant</li>
                            <li><strong>Syncope/pre-syncope</strong> - suggests massive PE</li>
                            <li><strong>Tachycardia</strong> - HR > 100 bpm</li>
                            <li><strong>DVT features</strong> - leg swelling, pain, tenderness</li>
                        </ul>

                        <div class="wells-calculator">
                            <h4><i class="fas fa-calculator"></i> Wells Score Calculator</h4>
                            <p class="text-muted">Check all that apply to calculate clinical probability</p>
                            
                            <div class="wells-item">
                                <label>Clinical features of DVT (leg swelling + pain)</label>
                                <input type="checkbox" onchange="updateWellsScore()" data-points="3">
                            </div>
                            <div class="wells-item">
                                <label>Alternative diagnosis less likely than PE</label>
                                <input type="checkbox" onchange="updateWellsScore()" data-points="3">
                            </div>
                            <div class="wells-item">
                                <label>Heart rate > 100 bpm</label>
                                <input type="checkbox" onchange="updateWellsScore()" data-points="1.5">
                            </div>
                            <div class="wells-item">
                                <label>Immobilization > 3 days or surgery in past 4 weeks</label>
                                <input type="checkbox" onchange="updateWellsScore()" data-points="1.5">
                            </div>
                            <div class="wells-item">
                                <label>Previous DVT/PE</label>
                                <input type="checkbox" onchange="updateWellsScore()" data-points="1.5">
                            </div>
                            <div class="wells-item">
                                <label>Hemoptysis</label>
                                <input type="checkbox" onchange="updateWellsScore()" data-points="1">
                            </div>
                            <div class="wells-item">
                                <label>Cancer (active/tx in last 6 months/palliative)</label>
                                <input type="checkbox" onchange="updateWellsScore()" data-points="1">
                            </div>
                            
                            <div class="wells-item">
                                <span>Total Wells Score:</span>
                                <span class="wells-score" id="wellsScore">0</span>
                            </div>
                            
                            <div id="wellsInterpretation" style="margin-top: 15px;">
                                <span class="badge badge-stable">PE Unlikely (≤4 points) - Consider D-dimer</span>
                            </div>
                        </div>

                        <h4><i class="fas fa-list-ul"></i> PERC Rule (if low suspicion)</h4>
                        <p>PE can be excluded without D-dimer if ALL criteria are negative AND Wells ≤4:</p>
                        <ul>
                            <li>Age < 50 years</li>
                            <li>HR < 100 bpm</li>
                            <li>SaO2 ≥ 95% on room air</li>
                            <li>No hemoptysis</li>
                            <li>No estrogen use</li>
                            <li>No prior DVT/PE</li>
                            <li>No unilateral leg swelling</li>
                            <li>No surgery/trauma requiring hospitalization in past 4 weeks</li>
                        </ul>
                        <p class="alert alert-info">
                            <strong>Note:</strong> PERC not validated in COVID-19 patients
                        </p>
                    </div>
                </div>
            </div>

            <!-- Diagnosis Card -->
            <div class="card diagnosis" id="diagnosis">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div>
                            <div>Diagnostic Pathway</div>
                            <small>Imaging and laboratory investigations</small>
                        </div>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="card-body">
                    <div class="card-content">
                        <div class="alert alert-urgent">
                            <strong><i class="fas fa-ambulance"></i> Immediate CTPA:</strong> For PE likely (Wells >4) or unstable patients
                        </div>

                        <ul class="step-list diagnosis">
                            <li>
                                <strong>If Wells Score > 4 (PE Likely):</strong>
                                <div style="margin-top: 10px;">
                                    <span class="badge badge-urgent">Arrange immediate CTPA</span>
                                    <p style="margin-top: 8px;">If CTPA delayed → Offer <strong>interim therapeutic anticoagulation</strong></p>
                                </div>
                            </li>
                            <li>
                                <strong>If Wells Score ≤ 4 (PE Unlikely):</strong>
                                <div style="margin-top: 10px;">
                                    <span class="badge badge-stable">Offer D-dimer test</span>
                                    <p style="margin-top: 8px;">Result must be available within <strong>4 hours</strong></p>
                                </div>
                            </li>
                            <li>
                                <strong>D-dimer Positive:</strong>
                                <div style="margin-top: 10px;">
                                    <span class="badge badge-caution">Arrange CTPA</span>
                                    <p style="margin-top: 8px;">If delayed → Interim anticoagulation</p>
                                </div>
                            </li>
                            <li>
                                <strong>D-dimer Negative:</strong>
                                <div style="margin-top: 10px;">
                                    <span class="badge badge-stable">PE Excluded</span>
                                    <p style="margin-top: 8px;">Stop interim anticoagulation, consider alternative diagnosis</p>
                                </div>
                            </li>
                        </ul>

                        <div class="alert alert-caution">
                            <strong><i class="fas fa-clock"></i> Time Critical:</strong> If D-dimer results cannot be obtained within 4 hours, start interim anticoagulation while awaiting results
                        </div>

                        <h4><i class="fas fa-tint"></i> Interim Anticoagulation Options</h4>
                        <div class="drug-card">
                            <div class="drug-name">Apixaban or Rivaroxaban</div>
                            <div class="drug-dose">Preferred - can be continued if PE confirmed</div>
                        </div>
                        <div class="drug-card">
                            <div class="drug-name">LMWH (Dalteparin/Enoxaparin/Tinzaparin)</div>
                            <div class="drug-dose">If DOACs unsuitable; bridge to dabigatran/edoxaban or warfarin</div>
                        </div>

                        <p class="alert alert-info">
                            <i class="fas fa-test-tube"></i> Baseline blood tests: FBC, renal & hepatic function, PT/APTT. <strong>Do not delay</strong> anticoagulation for results.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Treatment Card -->
            <div class="card treatment" id="treatment">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div>
                            <div>Initial Treatment</div>
                            <small>Anticoagulation and pharmacological options</small>
                        </div>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="card-body">
                    <div class="card-content">
                        <div class="alert alert-urgent">
                            <strong><i class="fas fa-heartbeat"></i> High-Risk PE:</strong> Consider thrombolysis or embolectomy in secondary care
                        </div>

                        <h4><i class="fas fa-tablets"></i> Oral Anticoagulants (First-Line)</h4>
                        
                        <div class="drug-card">
                            <div class="drug-name">Apixaban</div>
                            <div class="drug-dose">
                                10 mg twice daily for 7 days, then 5 mg twice daily<br>
                                <em>Duration: Minimum 3 months</em>
                            </div>
                        </div>

                        <div class="drug-card">
                            <div class="drug-name">Rivaroxaban <span class="badge badge-caution">Black Triangle</span></div>
                            <div class="drug-dose">
                                15 mg twice daily for 21 days, then 20 mg once daily<br>
                                <em>Take with food</em>
                            </div>
                        </div>

                        <h4><i class="fas fa-syringe"></i> Parenteral + Oral Options</h4>
                        
                        <div class="drug-card">
                            <div class="drug-name">LMWH → Dabigatran</div>
                            <div class="drug-dose">
                                LMWH for ≥5 days, then dabigatran 150 mg BD (age-adjusted)<br>
                                <em>75-79y: 110-150 mg BD | 80y+: 110 mg BD</em>
                            </div>
                        </div>

                        <div class="drug-card">
                            <div class="drug-name">LMWH → Edoxaban</div>
                            <div class="drug-dose">
                                LMWH for ≥5 days, then edoxaban 60 mg OD<br>
                                <em>30 mg if weight ≤60kg, CrCl 15-50, or P-gp inhibitors</em>
                            </div>
                        </div>

                        <div class="drug-card">
                            <div class="drug-name">LMWH → Warfarin</div>
                            <div class="drug-dose">
                                LMWH for ≥5 days + warfarin until INR ≥2 for 2 consecutive days<br>
                                <em>Typical maintenance: 3-9 mg daily</em>
                            </div>
                        </div>

                        <h4><i class="fas fa-syringe"></i> LMWH Dosing (Weight-Based)</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div class="drug-card">
                                <div class="drug-name">Dalteparin (once daily)</div>
                                <div class="drug-dose">
                                    ≤46kg: 7,500 IU | 46-56kg: 10,000 IU<br>
                                    57-68kg: 12,500 IU | 69-82kg: 15,000 IU<br>
                                    ≥83kg: 18,000 IU
                                </div>
                            </div>
                            <div class="drug-card">
                                <div class="drug-name">Enoxaparin</div>
                                <div class="drug-dose">
                                    1.5 mg/kg OD (low risk) or 1 mg/kg BD (high risk)<br>
                                    <em>Contraindicated in AGEP, end-stage renal impairment</em>
                                </div>
                            </div>
                            <div class="drug-card">
                                <div class="drug-name">Tinzaparin</div>
                                <div class="drug-dose">
                                    175 IU/kg once daily<br>
                                    <em>Adjust in severe renal impairment</em>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-caution">
                            <strong><i class="fas fa-exclamation-circle"></i> Contraindications:</strong> Active bleeding, HIT, severe thrombocytopenia, acute bacterial endocarditis
                        </div>

                        <h4><i class="fas fa-cogs"></i> Mechanical Options</h4>
                        <ul>
                            <li><strong>IVC Filters:</strong> Restricted to clinical studies or when anticoagulation contraindicated</li>
                            <li><strong>Thrombolysis:</strong> Systemic or catheter-directed for high-risk PE</li>
                            <li><strong>Surgical Embolectomy:</strong> Alternative for massive PE</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Follow-up Card -->
            <div class="card followup" id="followup">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <div>Follow-up & Monitoring</div>
                            <small>Long-term management and secondary prevention</small>
                        </div>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="card-body">
                    <div class="card-content">
                        <h4><i class="fas fa-user-check"></i> Post-Diagnosis Actions</h4>
                        <ul class="step-list followup">
                            <li>Ensure anticoagulation monitoring is arranged</li>
                            <li>Provide <strong>anticoagulant alert card</strong> (patient must carry at all times)</li>
                            <li>Give verbal & written information on:
                                <ul style="margin-top: 8px;">
                                    <li>Drug usage, duration, and adherence</li>
                                    <li>Adverse effects and when to seek help</li>
                                    <li>Drug/food/alcohol interactions</li>
                                    <li>Dental treatment considerations</li>
                                    <li>Pregnancy planning advice</li>
                                    <li>Sports and travel implications</li>
                                </ul>
                            </li>
                            <li>Provide PE information leaflet (<a href="https://www.blf.org.uk" target="_blank">British Lung Foundation</a>)</li>
                        </ul>

                        <h4><i class="fas fa-question-circle"></i> Unprovoked PE Assessment</h4>
                        <div class="alert alert-info">
                            <strong>Unprovoked PE = No major transient risk factor in past 3 months + no hormonal therapy</strong>
                        </div>
                        
                        <div class="wells-calculator">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <div>
                                    <h5><i class="fas fa-search"></i> Cancer Screening</h5>
                                    <p>Review history, examination, baseline bloods</p>
                                    <p><strong>Only investigate</strong> if symptoms/signs present</p>
                                    <span class="badge badge-caution">Do not routine screen</span>
                                </div>
                                <div>
                                    <h5><i class="fas fa-dna"></i> Thrombophilia Testing</h5>
                                    <p><strong>Consider if stopping anticoagulation:</strong></p>
                                    <ul style="font-size: 0.9rem;">
                                        <li>Antiphospholipid antibodies</li>
                                        <li>Hereditary thrombophilia (if first-degree relative with VTE)</li>
                                        <li><strong>Do not test</strong> if continuing anticoagulation or provoked PE</li>
                                    </ul>
                                    <span class="badge badge-info">Tests affected by anticoagulants</span>
                                </div>
                            </div>
                        </div>

                        <h4><i class="fas fa-calendar-alt"></i> Treatment Duration</h4>
                        <ul>
                            <li><strong>Minimum 3 months</strong> for all patients</li>
                            <li>Provoked PE: Typically 3 months (treat provoking factor)</li>
                            <li>Unprovoked PE: Consider extended therapy if bleeding risk low</li>
                        </ul>

                        <h4><i class="fas fa-redo"></i> Recurrence Risk Stratification</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="drug-card">
                                <div class="drug-name" style="color: var(--stable-color);">Low Risk <span class="badge badge-stable"> &lt;3%/year</span></div>
                                <div class="drug-dose">Surgery, hospitalization 3+ days, trauma with fracture</div>
                            </div>
                            <div class="drug-card">
                                <div class="drug-name" style="color: var(--caution-color);">Intermediate <span class="badge badge-caution">3-8%/year</span></div>
                                <div class="drug-dose">Minor surgery, estrogen therapy, pregnancy, long-haul flight</div>
                            </div>
                            <div class="drug-card">
                                <div class="drug-name" style="color: var(--urgent-color);">High Risk <span class="badge badge-urgent">&gt;8%/year</span></div>
                                <div class="drug-dose">Active cancer, APS, recurrent unprovoked VTE</div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <strong><i class="fas fa-chart-line"></i> Recurrence Rate:</strong> 
                            2.5%/year after provoked PE vs 4.5%/year after unprovoked PE (after stopping treatment)
                        </div>

                        <h4><i class="fas fa-exclamation-triangle"></i> When to Seek Urgent Help</h4>
                        <ul>
                            <li>Signs of bleeding while anticoagulated</li>
                            <li>New/worsening dyspnea or chest pain</li>
                            <li>Syncope or hemodynamic instability</li>
                            <li>Recurrent symptoms suggestive of VTE</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div style="text-align: center; padding: 30px; color: #7f8c8d; font-size: 0.9rem;">
                <i class="fas fa-info-circle"></i> 
                This algorithm is based on NICE CKS Pulmonary Embolism (Sept 2023). 
                Always refer to full guidelines and local protocols.
            </div>
        </main>
    </div>

    <script>
        // Toggle card expansion
        function toggleCard(header) {
            const card = header.parentElement;
            card.classList.toggle('expanded');
        }

        // Wells Score Calculator
        function updateWellsScore() {
            const checkboxes = document.querySelectorAll('.wells-item input[type="checkbox"]');
            let totalScore = 0;
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    totalScore += parseFloat(checkbox.dataset.points);
                }
            });
            
            const scoreElement = document.getElementById('wellsScore');
            const interpretationElement = document.getElementById('wellsInterpretation');
            
            scoreElement.textContent = totalScore.toFixed(1);
            
            if (totalScore > 4) {
                interpretationElement.innerHTML = '<span class="badge badge-urgent">PE Likely (>4 points) - Immediate CTPA</span>';
            } else {
                interpretationElement.innerHTML = '<span class="badge badge-stable">PE Unlikely (≤4 points) - Consider D-dimer</span>';
            }
            
            // Update progress indicator
            updateProgressIndicator('assessment', totalScore > 4 ? 'urgent' : 'stable');
        }

        // Update progress indicator based on score
        function updateProgressIndicator(section, status) {
            const indicator = document.querySelector(`.progress-item[data-section="${section}"]`);
            const existingBadge = indicator.querySelector('.status-badge');
            
            if (existingBadge) {
                existingBadge.remove();
            }
            
            if (status === 'urgent') {
                indicator.innerHTML += ' <span class="status-badge badge badge-urgent" style="margin-left: auto;">High Risk</span>';
            } else if (status === 'caution') {
                indicator.innerHTML += ' <span class="status-badge badge badge-caution" style="margin-left: auto;">Caution</span>';
            }
        }

        // Smooth scroll and active state management
        const progressItems = document.querySelectorAll('.progress-item');
        const cards = document.querySelectorAll('.card');

        // Scroll spy functionality
        function handleScroll() {
            const scrollPosition = window.scrollY + 150;
            
            cards.forEach(card => {
                const cardTop = card.offsetTop;
                const cardHeight = card.offsetHeight;
                const cardId = card.id;
                
                if (scrollPosition >= cardTop && scrollPosition < cardTop + cardHeight) {
                    // Remove active class from all progress items
                    progressItems.forEach(item => item.classList.remove('active'));
                    
                    // Add active class to current section
                    const activeItem = document.querySelector(`.progress-item[data-section="${cardId}"]`);
                    if (activeItem) {
                        activeItem.classList.add('active');
                    }
                }
            });
        }

        // Progress item click handler
        progressItems.forEach(item => {
            item.addEventListener('click', () => {
                const section = item.dataset.section;
                const targetCard = document.getElementById(section);
                
                if (targetCard) {
                    targetCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
                
                // Expand the target card
                setTimeout(() => {
                    targetCard.classList.add('expanded');
                }, 300);
            });
        });

        // Initialize
        window.addEventListener('scroll', handleScroll);
        window.addEventListener('load', handleScroll);

        // Auto-expand first card on load
        window.addEventListener('load', () => {
            const firstCard = document.querySelector('.card');
            if (firstCard) {
                firstCard.classList.add('expanded');
            }
        });

        // Add subtle animation to badges
        document.querySelectorAll('.badge').forEach(badge => {
            badge.style.animation = 'fadeIn 0.5s ease forwards';
        });
    </script>
</body>
</html>