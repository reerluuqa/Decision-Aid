<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Clinical Algorithm</title>
  <style>
    :root{
      --bg: #0b1220;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --line: rgba(255,255,255,.12);
      --shadow: 0 14px 40px rgba(0,0,0,.35);

      --assess: #3b82f6;   /* blue */
      --dx:     #a855f7;   /* purple */
      --tx:     #22c55e;   /* green */
      --fu:     #f59e0b;   /* amber */

      --urgent: #ef4444;   /* red */
      --caution:#f59e0b;   /* amber */
      --stable: #22c55e;   /* green */
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(59,130,246,.25), transparent 60%),
        radial-gradient(900px 500px at 85% 30%, rgba(168,85,247,.22), transparent 60%),
        radial-gradient(800px 450px at 60% 90%, rgba(34,197,94,.18), transparent 55%),
        var(--bg);
      color: var(--text);
      line-height: 1.45;
    }

    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 28px 18px 60px;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      margin-bottom: 18px;
    }

    .title{
      display:flex; flex-direction:column; gap:8px;
    }
    h1{
      margin:0;
      font-size: clamp(20px, 2.2vw, 30px);
      letter-spacing:.2px;
    }
    .subtitle{
      color: var(--muted);
      font-size: 14px;
      max-width: 70ch;
    }

    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
    }

    .pill{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.05);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      display:flex;
      align-items:center;
      gap:10px;
      box-shadow: 0 10px 26px rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .pill input{
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      width: min(320px, 52vw);
      font-size: 14px;
    }

    .btn{
      cursor:pointer;
      user-select:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.20); }
    .btn:active{ transform: translateY(0px) scale(.99); }

    .grid{
      display:grid;
      grid-template-columns: 300px 1fr;
      gap: 18px;
      align-items:start;
      margin-top: 14px;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .sidebar{ position: relative !important; top: 0 !important; }
      .pill input{ width: 48vw; }
    }

    /* Sidebar */
    .sidebar{
      position: sticky;
      top: 16px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow: hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .sidebar .head{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .sidebar .head .label{
      font-weight: 650;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .sidebar .head .pct{
      font-size: 12px;
      color: var(--muted);
    }

    .progressbar{
      height: 8px;
      background: rgba(255,255,255,.07);
      border-top: 1px solid rgba(255,255,255,.06);
      border-bottom: 1px solid rgba(255,255,255,.06);
      position: relative;
    }
    .progressbar > span{
      position:absolute;
      inset:0 auto 0 0;
      width: 0%;
      background: linear-gradient(90deg, rgba(59,130,246,.95), rgba(168,85,247,.95), rgba(34,197,94,.95), rgba(245,158,11,.95));
      transition: width .35s ease;
    }

    .nav{
      padding: 10px;
      display:flex;
      flex-direction:column;
      gap: 8px;
    }

    .nav a{
      text-decoration:none;
      color: var(--text);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding: 10px 10px;
      display:flex;
      align-items:center;
      gap:10px;
      transition: transform .15s ease, background .15s ease, border-color .15s ease, box-shadow .15s ease;
      position: relative;
      overflow:hidden;
    }
    .nav a:hover{ transform: translateY(-1px); background: rgba(255,255,255,.07); border-color: rgba(255,255,255,.18); }
    .nav a.active{
      background: rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.25);
      box-shadow: 0 10px 24px rgba(0,0,0,.28);
    }
    .nav a .dot{
      width: 10px; height: 10px;
      border-radius: 999px;
      flex: 0 0 auto;
      box-shadow: 0 0 0 4px rgba(255,255,255,.06);
    }
    .nav a .meta{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    .nav a .meta .t{
      font-weight: 650;
      font-size: 13px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .nav a .meta .s{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Main cards */
    .cards{ display:flex; flex-direction:column; gap: 14px; }

    .card{
      border: 1px solid var(--line);
      background: var(--panel);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateZ(0);
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      background: var(--panel2);
      border-color: rgba(255,255,255,.18);
    }

    .card .top{
      padding: 14px 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      position: relative;
    }

    .stripe{
      position:absolute;
      inset:0 0 auto 0;
      height: 4px;
      background: linear-gradient(90deg, rgba(255,255,255,.2), rgba(255,255,255,0));
      opacity:.85;
    }

    .step{
      display:flex;
      align-items:flex-start;
      gap:12px;
      min-width:0;
    }

    .icon{
      width: 38px; height: 38px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      flex: 0 0 auto;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
    }
    .icon svg{ width: 20px; height: 20px; fill: none; stroke: rgba(255,255,255,.88); stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    .step h2{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .step .desc{
      margin-top: 4px;
      color: var(--muted);
      font-size: 13px;
      max-width: 72ch;
    }

    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex: 0 0 auto;
    }

    .chip{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }

    .toggle{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .toggle:hover{ transform: translateY(-1px); background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.22); }
    .toggle svg{ width: 16px; height: 16px; fill:none; stroke: rgba(255,255,255,.9); stroke-width:2; }

    .body{
      padding: 12px 14px 14px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .panel{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      border-radius: 16px;
      overflow:hidden;
    }

    details{
      border-radius: 16px;
      overflow:hidden;
    }
    details + details{ margin-top: 10px; }

    summary{
      list-style:none;
      cursor:pointer;
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
      user-select:none;
    }
    summary::-webkit-details-marker{ display:none; }

    .sumL{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .sumT{
      font-weight: 650;
      font-size: 13px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sumR{
      display:flex;
      align-items:center;
      gap:10px;
      flex: 0 0 auto;
    }

    .chev{
      width: 18px; height: 18px;
      transition: transform .20s ease;
      opacity:.9;
    }
    details[open] .chev{ transform: rotate(180deg); }

    .content{
      padding: 12px 12px 12px;
      color: var(--text);
      font-size: 13.5px;
    }
    .content p{ margin: 0 0 10px; color: var(--muted); }
    .content ul{ margin: 0; padding-left: 18px; color: rgba(255,255,255,.86); }
    .content li{ margin: 6px 0; }

    .badges{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .badge{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .badge i{
      width: 8px; height: 8px;
      border-radius: 999px;
      display:inline-block;
    }
    .urgent { border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.10); }
    .urgent i{ background: var(--urgent); box-shadow: 0 0 0 4px rgba(239,68,68,.15); }

    .caution { border-color: rgba(245,158,11,.35); background: rgba(245,158,11,.10); }
    .caution i{ background: var(--caution); box-shadow: 0 0 0 4px rgba(245,158,11,.15); }

    .stable { border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.10); }
    .stable i{ background: var(--stable); box-shadow: 0 0 0 4px rgba(34,197,94,.14); }

    /* Step coloring */
    .card[data-step="assessment"] .stripe{ background: linear-gradient(90deg, rgba(59,130,246,.95), rgba(59,130,246,0)); }
    .card[data-step="diagnosis"]   .stripe{ background: linear-gradient(90deg, rgba(168,85,247,.95), rgba(168,85,247,0)); }
    .card[data-step="treatment"]   .stripe{ background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(34,197,94,0)); }
    .card[data-step="followup"]    .stripe{ background: linear-gradient(90deg, rgba(245,158,11,.95), rgba(245,158,11,0)); }

    .nav a[data-step="assessment"] .dot{ background: var(--assess); }
    .nav a[data-step="diagnosis"]  .dot{ background: var(--dx); }
    .nav a[data-step="treatment"]  .dot{ background: var(--tx); }
    .nav a[data-step="followup"]   .dot{ background: var(--fu); }

    /* Filter */
    .hidden{ display:none !important; }

    /* Small footer */
    footer{
      margin-top: 18px;
      color: rgba(255,255,255,.55);
      font-size: 12px;
    }

    /* Subtle section enter animation */
    .reveal{
      opacity: 0;
      transform: translateY(6px);
      transition: opacity .45s ease, transform .45s ease;
    }
    .reveal.in{
      opacity: 1;
      transform: translateY(0px);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Interactive Clinical Algorithm</h1>
        <div class="subtitle">
          Card-based workflow with expandable subsections, severity badges, smooth transitions, and a sticky progress sidebar.
          Replace the placeholder clinical content with your local guideline text.
        </div>
      </div>

      <div class="toolbar">
        <div class="pill" title="Filter sections and bullets">
          <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" style="opacity:.9">
            <path d="M21 21l-4.3-4.3m1.8-5.2a7 7 0 11-14 0 7 7 0 0114 0z"
                  fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <input id="search" placeholder="Search within the algorithm…" />
        </div>
        <button class="btn" id="expandAll">Expand all</button>
        <button class="btn" id="collapseAll">Collapse all</button>
      </div>
    </header>

    <div class="grid">
      <!-- Sticky Progress Sidebar -->
      <aside class="sidebar" aria-label="Progress">
        <div class="head">
          <div class="label">Progress</div>
          <div class="pct" id="pct">0%</div>
        </div>
        <div class="progressbar" aria-hidden="true"><span id="bar"></span></div>
        <nav class="nav" id="nav">
          <a href="#assessment" data-step="assessment" class="active">
            <span class="dot"></span>
            <span class="meta">
              <span class="t">Assessment</span>
              <span class="s">Red flags • Severity • Risk</span>
            </span>
          </a>
          <a href="#diagnosis" data-step="diagnosis">
            <span class="dot"></span>
            <span class="meta">
              <span class="t">Diagnosis</span>
              <span class="s">Differentiate • Confirm</span>
            </span>
          </a>
          <a href="#treatment" data-step="treatment">
            <span class="dot"></span>
            <span class="meta">
              <span class="t">Treatment</span>
              <span class="s">Conservative • Escalation</span>
            </span>
          </a>
          <a href="#followup" data-step="followup">
            <span class="dot"></span>
            <span class="meta">
              <span class="t">Follow-up</span>
              <span class="s">Reassess • Outcomes</span>
            </span>
          </a>
        </nav>
      </aside>

      <!-- Main Cards -->
      <main class="cards" id="cards">
        <!-- Assessment -->
        <section class="card reveal" id="assessment" data-step="assessment" data-title="Assessment">
          <div class="top">
            <div class="stripe"></div>
            <div class="step">
              <div class="icon" aria-hidden="true">
                <!-- stethoscope-ish icon -->
                <svg viewBox="0 0 24 24">
                  <path d="M6 3v6a4 4 0 0 0 8 0V3"/>
                  <path d="M14 11v2a6 6 0 0 1-12 0v-2"/>
                  <path d="M18 11a3 3 0 1 0 0 6h1a3 3 0 1 0 0-6h-1z"/>
                </svg>
              </div>
              <div>
                <h2>Assessment</h2>
                <div class="desc">Characterise symptoms, screen for red flags, evaluate severity, and identify contributory conditions.</div>
              </div>
            </div>
            <div class="actions">
              <span class="chip" title="Step focus">Step 1 / 4</span>
              <button class="toggle" data-toggle="assessment" aria-controls="assessment-body" aria-expanded="true">
                <span>Sections</span>
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 9l6 6 6-6"/></svg>
              </button>
            </div>
          </div>

          <div class="body" id="assessment-body">
            <div class="panel">
              <details open>
                <summary>
                  <span class="sumL">
                    <span class="sumT">Immediate risk screen</span>
                  </span>
                  <span class="sumR">
                    <span class="badge urgent"><i></i>Urgent referral</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Escalate immediately if the presentation suggests severe neurological compromise, rapidly progressive deficit, or an alternative high-risk diagnosis.</p>
                  <ul>
                    <li>Rapidly progressive motor deficit (e.g., new thenar weakness/wasting).</li>
                    <li>Persistent sensory loss with functional compromise.</li>
                    <li>Concerning alternative pathology (trauma, space-occupying lesion, systemic neurological signs).</li>
                  </ul>
                  <div class="badges">
                    <span class="badge urgent"><i></i>Red: urgent referral</span>
                    <span class="badge caution"><i></i>Amber: caution</span>
                    <span class="badge stable"><i></i>Green: stable</span>
                  </div>
                </div>
              </details>

              <details>
                <summary>
                  <span class="sumL"><span class="sumT">Symptom profile & triggers</span></span>
                  <span class="sumR">
                    <span class="badge stable"><i></i>Typical pattern</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Document onset, distribution, nocturnal symptoms, exacerbating activities, and relieving manoeuvres.</p>
                  <ul>
                    <li>Distribution consistent with median nerve territory; nocturnal symptoms.</li>
                    <li>Functional impairment: grip, dexterity, work limitations, sleep disruption.</li>
                    <li>Aggravators: repetitive wrist flexion/extension, vibration exposure.</li>
                  </ul>
                </div>
              </details>

              <details>
                <summary>
                  <span class="sumL"><span class="sumT">Examination & provocative tests</span></span>
                  <span class="sumR">
                    <span class="badge caution"><i></i>Interpret in context</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Examine the entire upper limb to avoid anchoring bias; use provocative tests as supportive rather than definitive findings.</p>
                  <ul>
                    <li>Thenar bulk, thumb abduction/opposition, pinch/grip strength.</li>
                    <li>Sensory testing in median distribution; compare bilaterally.</li>
                    <li>Provocation: Phalen / Tinel / carpal compression (Durkan).</li>
                  </ul>
                </div>
              </details>
            </div>
          </div>
        </section>

        <!-- Diagnosis -->
        <section class="card reveal" id="diagnosis" data-step="diagnosis" data-title="Diagnosis">
          <div class="top">
            <div class="stripe"></div>
            <div class="step">
              <div class="icon" aria-hidden="true">
                <!-- spark/target icon -->
                <svg viewBox="0 0 24 24">
                  <path d="M12 2v3m0 14v3M2 12h3m14 0h3"/>
                  <path d="M7 12a5 5 0 1 0 10 0 5 5 0 1 0-10 0z"/>
                  <path d="M12 9v3l2 2"/>
                </svg>
              </div>
              <div>
                <h2>Diagnosis</h2>
                <div class="desc">Confirm a working diagnosis clinically; consider differentials and selective investigations when indicated.</div>
              </div>
            </div>
            <div class="actions">
              <span class="chip">Step 2 / 4</span>
              <button class="toggle" data-toggle="diagnosis" aria-controls="diagnosis-body" aria-expanded="true">
                <span>Sections</span>
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 9l6 6 6-6"/></svg>
              </button>
            </div>
          </div>

          <div class="body" id="diagnosis-body">
            <div class="panel">
              <details open>
                <summary>
                  <span class="sumL"><span class="sumT">Clinical diagnosis vs tests</span></span>
                  <span class="sumR">
                    <span class="badge stable"><i></i>Clinical-first</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Typical presentations can often be managed without confirmatory testing; investigations add value when the diagnosis is uncertain or when planning definitive interventions.</p>
                  <ul>
                    <li>Use electrodiagnostics selectively (uncertain diagnosis; pre-procedure planning; atypical features).</li>
                    <li>Consider targeted labs if secondary causes suspected (e.g., endocrine/metabolic/inflammatory).</li>
                  </ul>
                </div>
              </details>

              <details>
                <summary>
                  <span class="sumL"><span class="sumT">Differential diagnosis</span></span>
                  <span class="sumR">
                    <span class="badge caution"><i></i>Anchor-check</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Reassess if symptom distribution or associated signs suggest alternative pathology.</p>
                  <ul>
                    <li>Ulnar neuropathy (cubital tunnel), cervical radiculopathy, peripheral neuropathy.</li>
                    <li>Tendinopathies/tenosynovitis (e.g., De Quervain), inflammatory arthropathy, OA.</li>
                    <li>Thoracic outlet pattern, central neurological disease if multifocal signs.</li>
                  </ul>
                </div>
              </details>

              <details>
                <summary>
                  <span class="sumL"><span class="sumT">Severity stratification</span></span>
                  <span class="sumR">
                    <span class="badge urgent"><i></i>Severe = escalate</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Stratify to guide urgency and treatment intensity.</p>
                  <ul>
                    <li><strong>Stable (green):</strong> intermittent symptoms; no objective motor deficit.</li>
                    <li><strong>Caution (amber):</strong> frequent symptoms; functional impact; early objective signs.</li>
                    <li><strong>Urgent (red):</strong> progressive weakness/wasting, persistent sensory deficit, marked functional loss.</li>
                  </ul>
                  <div class="badges">
                    <span class="badge urgent"><i></i>Red: urgent referral</span>
                    <span class="badge caution"><i></i>Amber: caution</span>
                    <span class="badge stable"><i></i>Green: stable</span>
                  </div>
                </div>
              </details>
            </div>
          </div>
        </section>

        <!-- Treatment -->
        <section class="card reveal" id="treatment" data-step="treatment" data-title="Treatment">
          <div class="top">
            <div class="stripe"></div>
            <div class="step">
              <div class="icon" aria-hidden="true">
                <!-- treatment/hand icon -->
                <svg viewBox="0 0 24 24">
                  <path d="M7 11V6a2 2 0 0 1 4 0v5"/>
                  <path d="M11 11V5a2 2 0 0 1 4 0v7"/>
                  <path d="M15 12V7a2 2 0 0 1 4 0v9a6 6 0 0 1-6 6H9a6 6 0 0 1-6-6v-3a2 2 0 0 1 4 0v1"/>
                </svg>
              </div>
              <div>
                <h2>Treatment</h2>
                <div class="desc">Conservative first-line options, symptom control, and escalation pathways based on severity and response.</div>
              </div>
            </div>
            <div class="actions">
              <span class="chip">Step 3 / 4</span>
              <button class="toggle" data-toggle="treatment" aria-controls="treatment-body" aria-expanded="true">
                <span>Sections</span>
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 9l6 6 6-6"/></svg>
              </button>
            </div>
          </div>

          <div class="body" id="treatment-body">
            <div class="panel">
              <details open>
                <summary>
                  <span class="sumL"><span class="sumT">Conservative management bundle</span></span>
                  <span class="sumR">
                    <span class="badge stable"><i></i>First-line</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Start with interventions that reduce mechanical stress and inflammation and improve function.</p>
                  <ul>
                    <li>Night splinting in neutral wrist position.</li>
                    <li>Activity modification: reduce repetitive flexion/extension; microbreaks; ergonomics.</li>
                    <li>Hand therapy / nerve mobilisation exercises where available.</li>
                    <li>Target modifiable contributors (e.g., metabolic/endocrine control) when relevant.</li>
                  </ul>
                </div>
              </details>

              <details>
                <summary>
                  <span class="sumL"><span class="sumT">Procedural / escalation options</span></span>
                  <span class="sumR">
                    <span class="badge caution"><i></i>Escalate if persistent</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Escalate based on symptom persistence, functional limitation, or objective deficit.</p>
                  <ul>
                    <li>Local corticosteroid injection (single injection pathway where appropriate).</li>
                    <li>Specialist referral for definitive interventions (e.g., decompression) when indicated.</li>
                    <li>Consider electrodiagnostics when planning intervention or when diagnosis is uncertain.</li>
                  </ul>
                </div>
              </details>

              <details>
                <summary>
                  <span class="sumL"><span class="sumT">Urgent pathway (severe disease)</span></span>
                  <span class="sumR">
                    <span class="badge urgent"><i></i>Time-critical</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Severe or progressive neurological deficit typically warrants expedited specialist assessment.</p>
                  <ul>
                    <li>Progressive motor weakness / thenar wasting.</li>
                    <li>Persistent sensory deficit with functional compromise.</li>
                    <li>Rapidly worsening symptoms or significant impact on daily function.</li>
                  </ul>
                  <div class="badges">
                    <span class="badge urgent"><i></i>Red: urgent referral</span>
                  </div>
                </div>
              </details>
            </div>
          </div>
        </section>

        <!-- Follow-up -->
        <section class="card reveal" id="followup" data-step="followup" data-title="Follow-up">
          <div class="top">
            <div class="stripe"></div>
            <div class="step">
              <div class="icon" aria-hidden="true">
                <!-- calendar/clock icon -->
                <svg viewBox="0 0 24 24">
                  <path d="M8 2v3M16 2v3"/>
                  <path d="M3 9h18"/>
                  <path d="M5 5h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2z"/>
                  <path d="M12 13v4l3 1"/>
                </svg>
              </div>
              <div>
                <h2>Follow-up</h2>
                <div class="desc">Planned reassessment, response-based iteration, and triggers for earlier review or escalation.</div>
              </div>
            </div>
            <div class="actions">
              <span class="chip">Step 4 / 4</span>
              <button class="toggle" data-toggle="followup" aria-controls="followup-body" aria-expanded="true">
                <span>Sections</span>
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 9l6 6 6-6"/></svg>
              </button>
            </div>
          </div>

          <div class="body" id="followup-body">
            <div class="panel">
              <details open>
                <summary>
                  <span class="sumL"><span class="sumT">Timing & outcome tracking</span></span>
                  <span class="sumR">
                    <span class="badge stable"><i></i>Structured review</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Reassess symptoms, function, and objective signs; document a baseline and compare longitudinally.</p>
                  <ul>
                    <li>Symptom severity (night waking, paraesthesia intensity, functional tasks).</li>
                    <li>Motor/sensory exam if previously abnormal.</li>
                    <li>Adherence and tolerance to conservative measures.</li>
                  </ul>
                </div>
              </details>

              <details>
                <summary>
                  <span class="sumL"><span class="sumT">Earlier review triggers</span></span>
                  <span class="sumR">
                    <span class="badge urgent"><i></i>Escalate</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>Bring forward reassessment or escalate if deterioration occurs.</p>
                  <ul>
                    <li>Worsening symptoms despite adherence to conservative therapy.</li>
                    <li>New objective weakness, thenar wasting, or persistent sensory deficit.</li>
                    <li>Emerging features suggesting alternative diagnosis.</li>
                  </ul>
                </div>
              </details>

              <details>
                <summary>
                  <span class="sumL"><span class="sumT">Step-down / maintenance</span></span>
                  <span class="sumR">
                    <span class="badge stable"><i></i>Stable</span>
                    <svg class="chev" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/></svg>
                  </span>
                </summary>
                <div class="content">
                  <p>For symptom control, continue a maintenance plan and reinforce risk modification.</p>
                  <ul>
                    <li>Graduated return to provoking tasks with ergonomic adjustments.</li>
                    <li>Ongoing night splinting if relapse occurs.</li>
                    <li>Periodic function checks for recurrence.</li>
                  </ul>
                  <div class="badges">
                    <span class="badge stable"><i></i>Green: stable</span>
                    <span class="badge caution"><i></i>Amber: caution</span>
                  </div>
                </div>
              </details>
            </div>
          </div>
        </section>

        <footer>
          Tip: Replace placeholder content with your condition-specific criteria and local pathway. Severity badges are designed for rapid visual triage.
        </footer>
      </main>
    </div>
  </div>

  <script>
    (function(){
      const nav = document.getElementById('nav');
      const links = Array.from(nav.querySelectorAll('a'));
      const cards = Array.from(document.querySelectorAll('.card'));
      const bar = document.getElementById('bar');
      const pct = document.getElementById('pct');

      // Smooth highlight of current step in sidebar
      const byId = (id) => document.getElementById(id);

      function setActive(stepId){
        links.forEach(a => a.classList.toggle('active', a.getAttribute('href') === '#'+stepId));
        const idx = Math.max(0, cards.findIndex(c => c.id === stepId));
        const progress = Math.round(((idx+1)/cards.length)*100);
        bar.style.width = progress + '%';
        pct.textContent = progress + '%';
      }

      // Intersection observer: which card is most "current"
      const io = new IntersectionObserver((entries)=>{
        const visible = entries
          .filter(e => e.isIntersecting)
          .sort((a,b)=> b.intersectionRatio - a.intersectionRatio)[0];
        if(visible && visible.target && visible.target.id){
          setActive(visible.target.id);
        }
      }, { threshold: [0.22, 0.35, 0.5, 0.65, 0.8] });

      cards.forEach(c => io.observe(c));

      // Reveal animation
      const rio = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting) e.target.classList.add('in');
        });
      }, { threshold: 0.15 });
      cards.forEach(c => rio.observe(c));

      // Sidebar clicks: keep active on click immediately (before observer fires)
      links.forEach(a => {
        a.addEventListener('click', () => {
          const id = a.getAttribute('href').slice(1);
          setActive(id);
        });
      });

      // Expand/collapse per card (button in header)
      function setCardOpen(cardId, open){
        const body = document.getElementById(cardId + '-body');
        if(!body) return;
        body.style.display = open ? '' : 'none';
        const btn = document.querySelector(`.toggle[data-toggle="${cardId}"]`);
        if(btn){
          btn.setAttribute('aria-expanded', String(open));
        }
      }

      document.querySelectorAll('.toggle[data-toggle]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('data-toggle');
          const body = document.getElementById(id + '-body');
          const open = !(body && body.style.display === 'none');
          setCardOpen(id, !open);
        });
      });

      // Expand/collapse all details
      const expandAllBtn = document.getElementById('expandAll');
      const collapseAllBtn = document.getElementById('collapseAll');

      expandAllBtn.addEventListener('click', ()=>{
        document.querySelectorAll('details').forEach(d => d.open = true);
        cards.forEach(c => setCardOpen(c.id, true));
      });
      collapseAllBtn.addEventListener('click', ()=>{
        document.querySelectorAll('details').forEach(d => d.open = false);
        // Keep bodies visible so headers are still informative; collapse only inner details
      });

      // Search filter across summaries + content
      const search = document.getElementById('search');
      function normalize(s){ return (s||'').toLowerCase().trim(); }

      search.addEventListener('input', ()=>{
        const q = normalize(search.value);
        if(!q){
          // reset
          cards.forEach(card=>{
            card.classList.remove('hidden');
            card.querySelectorAll('details').forEach(d => d.classList.remove('hidden'));
            card.querySelectorAll('.content li, .content p').forEach(el => el.classList.remove('hidden'));
          });
          return;
        }

        cards.forEach(card=>{
          let cardHit = false;

          // Check details blocks
          const details = Array.from(card.querySelectorAll('details'));
          details.forEach(d=>{
            const sumText = normalize(d.querySelector('summary')?.innerText);
            const contentText = normalize(d.querySelector('.content')?.innerText);
            const hit = sumText.includes(q) || contentText.includes(q);

            d.classList.toggle('hidden', !hit);

            if(hit){
              cardHit = true;
              d.open = true;
            }
          });

          // If no details match, hide card
          card.classList.toggle('hidden', !cardHit);
          if(cardHit){
            // Ensure section body visible when filtering
            setCardOpen(card.id, true);
          }
        });
      });

      // Initialize
      setActive(cards[0].id);
    })();
  </script>
</body>
</html>
