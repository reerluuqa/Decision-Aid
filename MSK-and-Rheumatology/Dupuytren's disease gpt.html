<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dupuytren‚Äôs Disease ‚Äî Clinical Decision Support (Primary Care)</title>
  <meta name="description" content="Fast-scanning clinical decision support for Dupuytren‚Äôs disease: triage, assessment, management, referral pathways." />
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.085);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --subtle: rgba(255,255,255,.55);

      --good: #43f0c6;
      --info: #7cc8ff;
      --warn: #ffd36e;
      --danger:#ff5b7a;
      --violet:#b8a3ff;
      --lime: #baff7a;

      --shadow: 0 12px 28px rgba(0,0,0,.35);
      --shadow2: 0 10px 24px rgba(0,0,0,.22);

      --radius-xl: 22px;
      --radius-lg: 16px;
      --radius-md: 12px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(124,200,255,.22), transparent 55%),
        radial-gradient(900px 600px at 78% 14%, rgba(184,163,255,.20), transparent 55%),
        radial-gradient(1000px 700px at 60% 80%, rgba(67,240,198,.12), transparent 55%),
        radial-gradient(900px 700px at 20% 85%, rgba(255,91,122,.12), transparent 55%),
        linear-gradient(180deg, #080b16, #0b1020 40%, #070a14);
      overflow-x:hidden;
    }

    a{ color: inherit; text-decoration: none; }
    a:hover{ text-decoration: underline; }

    /* Layout */
    .topbar{
      position: sticky; top:0; z-index: 50;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(11,16,32,.92), rgba(11,16,32,.70));
      border-bottom: 1px solid var(--stroke);
    }
    .topbar-inner{
      max-width: 1200px;
      margin: 0 auto;
      padding: 14px 18px;
      display:flex; align-items:center; gap:14px;
    }

    .brand{
      display:flex; align-items:center; gap:10px;
      min-width: 320px;
    }
    .logo{
      width:38px; height:38px; border-radius: 12px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.18), transparent 60%),
        linear-gradient(135deg, rgba(124,200,255,.35), rgba(184,163,255,.26), rgba(67,240,198,.20));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow2);
      display:grid; place-items:center;
    }
    .brand h1{
      margin:0;
      font-size: 14px;
      letter-spacing:.3px;
      line-height: 1.2;
    }
    .brand .subtitle{
      display:block;
      font-size: 12px;
      color: var(--subtle);
      margin-top: 2px;
    }

    .navchips{
      display:flex; flex-wrap:wrap; gap:8px;
      align-items:center;
      margin-left: auto;
    }
    .chip{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size: 12px;
      display:inline-flex; gap:8px; align-items:center;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      cursor:pointer;
    }
    .chip:hover{ transform: translateY(-1px); background: rgba(255,255,255,.085); border-color: rgba(255,255,255,.16); }
    .chip[aria-current="true"]{
      background: rgba(124,200,255,.14);
      border-color: rgba(124,200,255,.28);
      color: rgba(255,255,255,.92);
    }

    .container{
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 18px 72px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 18px;
    }

    @media (max-width: 980px){
      .container{ grid-template-columns: 1fr; }
      .brand{ min-width: unset; }
    }

    /* Left rail */
    .rail{
      position: sticky;
      top: 78px;
      align-self:start;
      height: calc(100dvh - 92px);
      overflow:auto;
      padding-right: 4px;
    }
    @media (max-width: 980px){
      .rail{ position: relative; top:0; height:auto; overflow: visible; }
    }

    .card{
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.05));
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
    }
    .card + .card{ margin-top: 12px; }

    .card-hd{
      padding: 14px 14px 10px;
      display:flex; align-items:center; justify-content: space-between; gap:12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .card-hd h2{
      margin:0;
      font-size: 13px;
      letter-spacing:.35px;
      text-transform: uppercase;
      color: rgba(255,255,255,.78);
    }
    .card-bd{ padding: 14px; }

    .kpi{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .kpi .box{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      border-radius: 14px;
      padding: 10px 10px;
    }
    .kpi .label{
      font-size: 11px;
      color: var(--subtle);
      margin-bottom: 4px;
      display:flex; align-items:center; gap:6px;
    }
    .kpi .value{
      font-size: 13px;
      color: rgba(255,255,255,.90);
      line-height: 1.25;
    }

    .search{
      display:flex; gap:10px; align-items:center;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      border-radius: 16px;
      padding: 10px 12px;
    }
    .search input{
      width:100%;
      background: transparent;
      border:0;
      outline:none;
      color: rgba(255,255,255,.92);
      font-size: 13px;
    }
    .search input::placeholder{ color: rgba(255,255,255,.45); }

    .filters{
      display:flex; flex-wrap:wrap; gap:8px;
      margin-top: 10px;
    }
    .toggle{
      border-radius: 999px;
      padding: 8px 10px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.78);
      font-size: 12px;
      cursor:pointer;
      user-select:none;
      display:inline-flex; gap:8px; align-items:center;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .toggle:hover{ transform: translateY(-1px); background: rgba(255,255,255,.085); border-color: rgba(255,255,255,.18); }
    .toggle[aria-pressed="true"]{
      border-color: rgba(67,240,198,.35);
      background: rgba(67,240,198,.12);
      color: rgba(255,255,255,.92);
    }

    .mini{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,.68);
      line-height:1.35;
      white-space: pre-wrap;
    }

    /* Main content */
    main{ min-width:0; }

    .hero{
      padding: 18px 18px 16px;
      border-radius: var(--radius-xl);
      border: 1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(400px 260px at 20% 25%, rgba(124,200,255,.18), transparent 60%),
        radial-gradient(480px 260px at 75% 10%, rgba(184,163,255,.16), transparent 60%),
        radial-gradient(520px 320px at 70% 75%, rgba(67,240,198,.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      box-shadow: var(--shadow);
    }
    .hero-top{
      display:flex; gap:14px; align-items:flex-start; justify-content: space-between;
      flex-wrap:wrap;
    }
    .hero h2{
      margin:0 0 6px 0;
      font-size: 22px;
      letter-spacing: .2px;
    }
    .hero p{
      margin:0;
      color: rgba(255,255,255,.76);
      line-height:1.45;
      max-width: 70ch;
      font-size: 13.5px;
    }
    .badges{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
      margin-left:auto;
    }
    .badge{
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      font-size: 12px;
      color: rgba(255,255,255,.78);
      display:inline-flex; align-items:center; gap:8px;
    }
    .badge strong{ color: rgba(255,255,255,.92); font-weight: 650; }

    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .panel{
      border-radius: var(--radius-xl);
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.045));
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .panel .hd{
      padding: 14px 14px 10px;
      display:flex; gap:10px; align-items:center; justify-content: space-between;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .panel .hd .t{
      display:flex; gap:10px; align-items:center;
      min-width:0;
    }
    .panel .hd h3{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .panel .hd .meta{
      font-size: 12px;
      color: rgba(255,255,255,.60);
      margin-left:auto;
      white-space: nowrap;
    }
    .panel .bd{ padding: 14px; }

    .icon{
      width: 34px; height:34px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      display:grid; place-items:center;
      flex: 0 0 auto;
      box-shadow: 0 10px 20px rgba(0,0,0,.18);
    }
    .icon svg{ width: 18px; height: 18px; opacity: .92; }

    /* Urgency blocks */
    .action{
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      padding: 12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
    }
    .action + .action{ margin-top: 10px; }
    .action .left{
      width: 40px; height:40px;
      border-radius: 14px;
      display:grid; place-items:center;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .action .left svg{ width: 18px; height:18px; }
    .action .title{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      margin-bottom: 4px;
    }
    .action .title b{
      font-size: 13.5px;
      letter-spacing:.15px;
    }
    .pill{
      font-size: 11px;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.78);
    }

    .urgent{
      border-color: rgba(255,91,122,.28);
      background: linear-gradient(180deg, rgba(255,91,122,.14), rgba(0,0,0,.12));
    }
    .urgent .left{
      border-color: rgba(255,91,122,.32);
      background: rgba(255,91,122,.12);
    }
    .routine{
      border-color: rgba(67,240,198,.22);
      background: linear-gradient(180deg, rgba(67,240,198,.10), rgba(0,0,0,.12));
    }
    .routine .left{
      border-color: rgba(67,240,198,.28);
      background: rgba(67,240,198,.10);
    }

    .list{
      margin: 8px 0 0 0;
      padding-left: 18px;
      color: rgba(255,255,255,.78);
      line-height: 1.45;
      font-size: 13px;
    }
    .list li{ margin: 4px 0; }

    .steps{
      display:grid;
      gap: 10px;
    }
    .step{
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      padding: 12px;
      display:flex; gap: 12px;
    }
    .n{
      width: 34px; height: 34px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      display:grid; place-items:center;
      font-family: var(--mono);
      font-weight: 700;
      font-size: 12px;
      color: rgba(255,255,255,.88);
      flex: 0 0 auto;
    }
    .step h4{
      margin: 0 0 4px 0;
      font-size: 13.5px;
      letter-spacing: .15px;
    }
    .step p{
      margin:0;
      color: rgba(255,255,255,.72);
      font-size: 13px;
      line-height:1.45;
    }
    .kbd{
      font-family: var(--mono);
      font-size: 11px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding: 2px 6px;
      border-radius: 8px;
      color: rgba(255,255,255,.84);
    }

    /* Accordions */
    details{
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.11);
      padding: 10px 12px;
    }
    details + details{ margin-top: 10px; }
    summary{
      cursor:pointer;
      list-style:none;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      font-size: 13.5px;
    }
    summary::-webkit-details-marker{ display:none; }
    .chev{
      width: 28px; height:28px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:grid; place-items:center;
      flex: 0 0 auto;
      transition: transform .15s ease;
    }
    details[open] .chev{ transform: rotate(90deg); }
    .details-body{
      margin-top: 10px;
      color: rgba(255,255,255,.74);
      font-size: 13px;
      line-height:1.5;
    }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 980px){
      .grid2{ grid-template-columns: 1fr; }
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.75);
      margin: 6px 6px 0 0;
    }

    /* Floating quick actions */
    .float{
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 60;
      display:flex;
      flex-direction: column;
      gap:10px;
    }
    .fab{
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.30);
      backdrop-filter: blur(12px);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      font-size: 12px;
      display:flex; align-items:center; gap:10px;
      box-shadow: var(--shadow);
      cursor:pointer;
      user-select:none;
    }
    .fab:hover{ background: rgba(0,0,0,.36); }
    .dot{
      width:10px; height:10px; border-radius: 99px;
      background: var(--info);
      box-shadow: 0 0 0 6px rgba(124,200,255,.10);
    }
    .dot.danger{ background: var(--danger); box-shadow: 0 0 0 6px rgba(255,91,122,.10); }
    .dot.good{ background: var(--good); box-shadow: 0 0 0 6px rgba(67,240,198,.10); }

    /* Highlights / search filtering */
    mark{
      background: rgba(255,211,110,.22);
      color: rgba(255,255,255,.95);
      padding: 0 .12em;
      border-radius: 6px;
    }
    .hidden{ display:none !important; }

    /* Section anchors */
    section{ scroll-margin-top: 96px; }
    .section-title{
      margin: 16px 0 10px;
      display:flex; align-items:baseline; justify-content: space-between; gap: 10px;
    }
    .section-title h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.35px;
      text-transform: uppercase;
      color: rgba(255,255,255,.78);
    }
    .section-title .hint{
      font-size: 12px;
      color: rgba(255,255,255,.55);
    }

    /* Print */
    @media print{
      .topbar, .rail, .float{ display:none !important; }
      body{ background:#fff; color:#111; }
      .hero, .panel, .card{ box-shadow:none; background:#fff; border-color:#ddd; }
      .panel .hd, .card-hd{ border-bottom-color:#eee; }
      .muted, .subtle{ color:#333; }
      a{ text-decoration: none; }
    }
  </style>
</head>

<body>
  <!-- Sticky top navigation -->
  <div class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M7 13c2.4-2.8 6.2-6 10.8-6 1.6 0 3 .3 4.2.9" stroke="rgba(255,255,255,.85)" stroke-width="1.7" stroke-linecap="round"/>
            <path d="M7 13c2.6 2.7 6.5 5.6 10.8 5.6 1.6 0 3-.3 4.2-.9" stroke="rgba(255,255,255,.85)" stroke-width="1.7" stroke-linecap="round"/>
            <path d="M3 12h4" stroke="rgba(255,255,255,.85)" stroke-width="1.7" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1>Dupuytren‚Äôs Disease <span class="subtitle">Primary-care decision support ‚Ä¢ fast scanning</span></h1>
        </div>
      </div>

      <nav class="navchips" aria-label="Quick navigation">
        <span class="chip" data-jump="#triage" aria-current="true">‚ö° Triage</span>
        <span class="chip" data-jump="#assessment">üß≠ Assessment</span>
        <span class="chip" data-jump="#pathway">üß© Pathway</span>
        <span class="chip" data-jump="#differentials">üîé Differentials</span>
        <span class="chip" data-jump="#secondary">üõ† Secondary care</span>
        <span class="chip" data-jump="#patient">üßæ Patient info</span>
      </nav>
    </div>
  </div>

  <div class="container">
    <!-- Left rail -->
    <aside class="rail" aria-label="Tools and snapshot">
      <div class="card">
        <div class="card-hd">
          <h2>Find + filter</h2>
          <span class="pill" title="Search across visible content">Live</span>
        </div>
        <div class="card-bd">
          <div class="search" role="search">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="rgba(255,255,255,.75)" stroke-width="1.7"/>
              <path d="M16.2 16.2 21 21" stroke="rgba(255,255,255,.75)" stroke-width="1.7" stroke-linecap="round"/>
            </svg>
            <input id="q" type="text" placeholder="Search e.g. tabletop test, contracture, painful nodules‚Ä¶" />
          </div>

          <div class="filters" aria-label="Content filters">
            <button class="toggle" type="button" data-filter="urgent" aria-pressed="false">
              <span style="width:10px;height:10px;border-radius:99px;background:var(--danger);box-shadow:0 0 0 6px rgba(255,91,122,.10)"></span>
              Urgent / expedite
            </button>
            <button class="toggle" type="button" data-filter="routine" aria-pressed="false">
              <span style="width:10px;height:10px;border-radius:99px;background:var(--good);box-shadow:0 0 0 6px rgba(67,240,198,.10)"></span>
              Routine primary care
            </button>
            <button class="toggle" type="button" data-filter="diagnosis" aria-pressed="false">üß† Diagnosis</button>
            <button class="toggle" type="button" data-filter="management" aria-pressed="false">üß∞ Management</button>
            <button class="toggle" type="button" data-filter="referral" aria-pressed="false"‚û°Ô∏è Referral</button>
          </div>

          <div style="margin-top:12px" class="mini" id="activeState" aria-live="polite">
Active filters: none
Search: ‚Äî
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-hd">
          <h2>Snapshot</h2>
          <span class="pill">At a glance</span>
        </div>
        <div class="card-bd">
          <div class="kpi">
            <div class="box">
              <div class="label">
                <span style="width:8px;height:8px;border-radius:99px;background:var(--info)"></span>
                Typical features
              </div>
              <div class="value">Palmar nodules ‚Üí cords ‚Üí flexion contracture (MCP/PIP)</div>
            </div>
            <div class="box">
              <div class="label">
                <span style="width:8px;height:8px;border-radius:99px;background:var(--danger)"></span>
                Refer when
              </div>
              <div class="value">Contracture and/or significant loss of hand function</div>
            </div>
            <div class="box">
              <div class="label">
                <span style="width:8px;height:8px;border-radius:99px;background:var(--good)"></span>
                If no contracture
              </div>
              <div class="value">No treatment; explain, reassure; review if contracture develops</div>
            </div>
            <div class="box">
              <div class="label">
                <span style="width:8px;height:8px;border-radius:99px;background:var(--warn)"></span>
                Bedside test
              </div>
              <div class="value"><span class="kbd">Tabletop test</span> positive = cannot lay hand flat</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-hd">
          <h2>Jump to</h2>
          <span class="pill">Keyboard friendly</span>
        </div>
        <div class="card-bd">
          <div class="filters" style="margin-top:0">
            <span class="chip" data-jump="#triage">‚ö° Triage & actions</span>
            <span class="chip" data-jump="#assessment">üß≠ Assessment</span>
            <span class="chip" data-jump="#pathway">üß© Stepwise pathway</span>
            <span class="chip" data-jump="#differentials">üîé Differentials</span>
            <span class="chip" data-jump="#secondary">üõ† Secondary-care options</span>
            <span class="chip" data-jump="#patient">üßæ Patient-facing script</span>
          </div>
          <div style="margin-top:12px" class="mini">
Tip: press <span class="kbd">/</span> to focus search.
          </div>
        </div>
      </div>
    </aside>

    <!-- Main content -->
    <main role="main">
      <div class="hero" id="top">
        <div class="hero-top">
          <div>
            <h2>Dupuytren‚Äôs disease ‚Äî rapid primary-care pathway</h2>
            <p>
              Pattern-recognition and management framework for palmar nodules/cords and digital flexion deformity.
              Built for speed: triage separation, stepwise panels, and collapsible deep-dives.
            </p>
          </div>
          <div class="badges" aria-label="Context badges">
            <span class="badge">üìå Scope: <strong>Adults ‚â•18</strong></span>
            <span class="badge">üß∑ Focus: <strong>Primary care</strong></span>
            <span class="badge">üß≠ Key decision: <strong>contracture/function</strong></span>
          </div>
        </div>
      </div>

      <div class="section-title" id="triage">
        <h2>Triage & immediate actions</h2>
        <div class="hint">Use colour-coded action boxes + jump chips</div>
      </div>

      <div class="grid">
        <div class="panel" data-tags="urgent referral">
          <div class="hd">
            <div class="t">
              <div class="icon" aria-hidden="true" style="border-color: rgba(255,91,122,.22); background: rgba(255,91,122,.10);">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 9v4" stroke="rgba(255,255,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                  <path d="M12 17h.01" stroke="rgba(255,255,255,.9)" stroke-width="2.5" stroke-linecap="round"/>
                  <path d="M10.3 3.6h3.4c.6 0 1.2.3 1.5.9l7 12.1c.6 1.1-.2 2.5-1.5 2.5H3c-1.3 0-2.1-1.4-1.5-2.5l7-12.1c.3-.6.9-.9 1.8-.9Z" stroke="rgba(255,255,255,.85)" stroke-width="1.4"/>
                </svg>
              </div>
              <div>
                <h3>Expedite / refer for surgical opinion</h3>
                <div class="meta">Referral trigger</div>
              </div>
            </div>
          </div>
          <div class="bd">
            <div class="action urgent">
              <div class="left" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M8.5 13.5 11 16l5.5-7" stroke="rgba(255,255,255,.95)" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div>
                <div class="title">
                  <b>Refer if contracture and/or significant loss of hand function</b>
                  <span class="pill">hand surgeon / plastics / ortho</span>
                </div>
                <ul class="list">
                  <li>Functional limitations impacting work/ADLs (e.g., gloves/pockets/grasping, grooming).</li>
                  <li>Flexion deformity at MCP and/or PIP joints; distal interphalangeal involvement is rare.</li>
                </ul>
              </div>
            </div>

            <details>
              <summary>
                What counts as ‚Äúcontracture‚Äù quickly?
                <span class="chev" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </summary>
              <div class="details-body">
                <b>Tabletop test:</b> ask the patient to place palm + fingers flat on a table. If they cannot, <b>contracture is present</b>.
                Use as a rapid binary screen before detailed goniometry.
              </div>
            </details>
          </div>
        </div>

        <div class="panel" data-tags="routine management diagnosis">
          <div class="hd">
            <div class="t">
              <div class="icon" aria-hidden="true" style="border-color: rgba(67,240,198,.22); background: rgba(67,240,198,.09);">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M7 12.5 10.2 15.6 17 8.6" stroke="rgba(255,255,255,.9)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M12 22c5.5 0 10-4.5 10-10S17.5 2 12 2 2 6.5 2 12s4.5 10 10 10Z" stroke="rgba(255,255,255,.7)" stroke-width="1.2"/>
                </svg>
              </div>
              <div>
                <h3>Routine primary-care management (no contracture)</h3>
                <div class="meta">Conservative + safety-net</div>
              </div>
            </div>
          </div>
          <div class="bd">
            <div class="action routine">
              <div class="left" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 7v10" stroke="rgba(255,255,255,.95)" stroke-width="1.8" stroke-linecap="round"/>
                  <path d="M7 12h10" stroke="rgba(255,255,255,.95)" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
              </div>
              <div>
                <div class="title">
                  <b>No treatment required at this stage</b>
                  <span class="pill">explain + reassure</span>
                </div>
                <ul class="list">
                  <li>Explain progressive nature; reassure <b>benign / not cancer</b>.</li>
                  <li>Advise return for review if a contracture develops (then refer).</li>
                  <li>Nodules may be tender early; consider simple analgesia if needed.</li>
                </ul>
              </div>
            </div>

            <details>
              <summary>
                Painful nodules but no contracture?
                <span class="chev" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </summary>
              <div class="details-body">
                Consider referral for painful nodules <b>without</b> contracture or significant loss of function, based on clinical judgement.
                In secondary care, corticosteroid injections may be considered for painful nodules.
              </div>
            </details>
          </div>
        </div>
      </div>

      <div class="section-title" id="assessment">
        <h2>Assessment</h2>
        <div class="hint">History ‚Üí exam ‚Üí targeted tests only if indicated</div>
      </div>

      <div class="panel" data-tags="diagnosis management">
        <div class="hd">
          <div class="t">
            <div class="icon" aria-hidden="true" style="border-color: rgba(124,200,255,.22); background: rgba(124,200,255,.10);">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M4 20c2-5.2 5.5-8 8-8s6 2.8 8 8" stroke="rgba(255,255,255,.85)" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z" stroke="rgba(255,255,255,.85)" stroke-width="1.4"/>
              </svg>
            </div>
            <div>
              <h3>Structured assessment (fast + complete)</h3>
              <div class="meta">Scan-friendly checklist</div>
            </div>
          </div>
        </div>
        <div class="bd">
          <div class="steps">
            <div class="step" data-tags="diagnosis">
              <div class="n">1</div>
              <div>
                <h4>History (function + symptom pattern)</h4>
                <p>
                  Elicit functional limitations (work/leisure/ADLs). Pain is not typical, but tenderness/discomfort may occur early.
                  Ask about ectopic lesions (knuckle pads, plantar nodules; Peyronie‚Äôs where appropriate).
                </p>
              </div>
            </div>
            <div class="step" data-tags="diagnosis">
              <div class="n">2</div>
              <div>
                <h4>Examination (both hands)</h4>
                <p>
                  Look for palmar skin thickening/pitting; firm (often painless) nodules fixed to skin/palmar fascia; longitudinal cords;
                  flexion deformity at MCP/PIP (DIP rarely).
                </p>
              </div>
            </div>
            <div class="step" data-tags="diagnosis urgent referral">
              <div class="n">3</div>
              <div>
                <h4>Rapid contracture screen</h4>
                <p>
                  Perform <span class="kbd">tabletop test</span>: inability to lay palm + fingers flat implies contracture ‚Üí consider referral pathway.
                </p>
              </div>
            </div>
            <div class="step" data-tags="diagnosis management">
              <div class="n">4</div>
              <div>
                <h4>Investigations (selective)</h4>
                <p>
                  Usually not required for diagnosis. If history suggests diabetes or alcohol-related liver disease, or an alternative diagnosis is suspected,
                  arrange appropriate investigations.
                </p>
              </div>
            </div>
          </div>

          <div style="margin-top:10px">
            <span class="tag">Common digits: 4th/5th</span>
            <span class="tag">Often bilateral</span>
            <span class="tag">Nodules ‚Üí cords ‚Üí contracture</span>
            <span class="tag">MCP & PIP joints</span>
          </div>
        </div>
      </div>

      <div class="section-title" id="pathway">
        <h2>Stepwise pathway</h2>
        <div class="hint">Choose branch by ‚Äúcontracture/function‚Äù</div>
      </div>

      <div class="grid">
        <div class="panel" data-tags="management routine">
          <div class="hd">
            <div class="t">
              <div class="icon" aria-hidden="true" style="border-color: rgba(67,240,198,.22); background: rgba(67,240,198,.09);">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M6 12h12" stroke="rgba(255,255,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                  <path d="M12 6v12" stroke="rgba(255,255,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
              </div>
              <div>
                <h3>Branch A ‚Äî no contracture / no significant functional loss</h3>
                <div class="meta">Conservative + safety-net</div>
              </div>
            </div>
          </div>
          <div class="bd">
            <div class="steps">
              <div class="step">
                <div class="n">A1</div>
                <div>
                  <h4>Explain + set expectations</h4>
                  <p>Benign, progressive fibroproliferative condition; progression varies; surgery may be needed later if contracture develops.</p>
                </div>
              </div>
              <div class="step">
                <div class="n">A2</div>
                <div>
                  <h4>Symptom control (if tender nodules)</h4>
                  <p>Simple analgesia may be appropriate; pain associated with nodules often resolves gradually.</p>
                </div>
              </div>
              <div class="step">
                <div class="n">A3</div>
                <div>
                  <h4>Safety-net</h4>
                  <p>Return if contracture develops (tabletop test turns positive) or function meaningfully declines.</p>
                </div>
              </div>
              <div class="step">
                <div class="n">A4</div>
                <div>
                  <h4>Optional referral</h4>
                  <p>Consider referral for painful nodules even without contracture, depending on clinical judgement.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="panel" data-tags="urgent referral management">
          <div class="hd">
            <div class="t">
              <div class="icon" aria-hidden="true" style="border-color: rgba(255,91,122,.22); background: rgba(255,91,122,.10);">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M4 12h10" stroke="rgba(255,255,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                  <path d="M12 6 18 12l-6 6" stroke="rgba(255,255,255,.9)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div>
                <h3>Branch B ‚Äî contracture and/or significant functional loss</h3>
                <div class="meta">Refer for surgical management</div>
              </div>
            </div>
          </div>
          <div class="bd">
            <div class="steps">
              <div class="step">
                <div class="n">B1</div>
                <div>
                  <h4>Confirm contracture (fast)</h4>
                  <p><span class="kbd">Tabletop test</span>; document affected joints (MCP vs PIP) and digits (often ring/little).</p>
                </div>
              </div>
              <div class="step">
                <div class="n">B2</div>
                <div>
                  <h4>Quantify functional impact</h4>
                  <p>Work/ADLs; inability to place hand in pocket, wear gloves, grasp objects, grooming tasks, etc.</p>
                </div>
              </div>
              <div class="step">
                <div class="n">B3</div>
                <div>
                  <h4>Refer</h4>
                  <p>Hand surgeon or plastics/orthopaedics for operative/minimally invasive management options.</p>
                </div>
              </div>
              <div class="step">
                <div class="n">B4</div>
                <div>
                  <h4>Set expectations</h4>
                  <p>Surgery can improve function but does not eradicate disease; recurrence can occur.</p>
                </div>
              </div>
            </div>

            <details style="margin-top:10px">
              <summary>
                What‚Äôs commonly involved (secondary care overview)?
                <span class="chev" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </summary>
              <div class="details-body">
                Surgical management is generally reserved for contractures impairing function/quality of life. Minimally invasive treatments are often prioritised for faster recovery, but may be less effective in severe contractures.
                See ‚ÄúSecondary-care options‚Äù for a structured list.
              </div>
            </details>
          </div>
        </div>
      </div>

      <div class="section-title" id="differentials">
        <h2>Differential diagnosis</h2>
        <div class="hint">Use these when exam pattern deviates</div>
      </div>

      <div class="panel" data-tags="diagnosis">
        <div class="hd">
          <div class="t">
            <div class="icon" aria-hidden="true" style="border-color: rgba(255,211,110,.22); background: rgba(255,211,110,.10);">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="rgba(255,255,255,.85)" stroke-width="1.6"/>
                <path d="M16.2 16.2 21 21" stroke="rgba(255,255,255,.85)" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <h3>Quick discriminator set</h3>
              <div class="meta">Expand for details</div>
            </div>
          </div>
        </div>
        <div class="bd">
          <details>
            <summary>
              Common benign mimics
              <span class="chev" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </summary>
            <div class="details-body">
              <ul class="list">
                <li><b>Callus:</b> thickened skin due to friction/pressure.</li>
                <li><b>Ganglion:</b> fluid-filled mass attached to tendon sheath/joint; often wrist/base of fingers.</li>
                <li><b>Inclusion cyst:</b> fluid-filled; may appear years after injury.</li>
                <li><b>Giant cell tumour (tendon sheath):</b> painless, slow-growing soft tissue mass.</li>
              </ul>
            </div>
          </details>

          <details>
            <summary>
              Trigger finger vs Dupuytren‚Äôs
              <span class="chev" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </summary>
            <div class="details-body">
              <ul class="list">
                <li><b>Trigger finger:</b> tender nodule near metacarpal head, intermittent locking/catching; extension with a click.</li>
                <li><b>Dupuytren‚Äôs:</b> fixed palmar nodule/cord with progressive flexion contracture (often ring/little fingers).</li>
              </ul>
            </div>
          </details>

          <details>
            <summary>
              Neuro / joint / systemic differentials
              <span class="chev" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </summary>
            <div class="details-body">
              <ul class="list">
                <li><b>Ulnar nerve palsy (clawing):</b> sensory symptoms + weakness (not typical in Dupuytren‚Äôs).</li>
                <li><b>Rheumatoid arthritis:</b> enlarged, painful joints.</li>
                <li><b>MCP osteoarthritis:</b> joint-focused pain/changes.</li>
                <li><b>Diabetic cheiroarthropathy:</b> waxy skin; multiple digits affected (thumb often spared).</li>
                <li><b>Camptodactyly:</b> congenital/childhood onset (often little finger).</li>
                <li><b>Volkmann‚Äôs contracture:</b> post-compartment syndrome claw-like deformity.</li>
              </ul>
            </div>
          </details>

          <details>
            <summary>
              Rare but important
              <span class="chev" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </summary>
            <div class="details-body">
              <ul class="list">
                <li><b>Epithelioid sarcoma:</b> enlarging indurated palmar mass ¬± ulceration; adolescents/young adults.</li>
                <li><b>Post-trauma/infection:</b> clear inciting injury, interphalangeal joint injury/infection history.</li>
              </ul>
            </div>
          </details>
        </div>
      </div>

      <div class="section-title" id="secondary">
        <h2>Secondary-care options</h2>
        <div class="hint">Overview for counselling and expectation-setting</div>
      </div>

      <div class="panel" data-tags="management referral">
        <div class="hd">
          <div class="t">
            <div class="icon" aria-hidden="true" style="border-color: rgba(184,163,255,.22); background: rgba(184,163,255,.10);">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M14.5 3.5 20.5 9.5" stroke="rgba(255,255,255,.85)" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M4 20l4.8-1.2L19.4 8.2a1.6 1.6 0 0 0 0-2.3L18.1 4.6a1.6 1.6 0 0 0-2.3 0L5.2 15.2 4 20Z" stroke="rgba(255,255,255,.85)" stroke-width="1.3" stroke-linejoin="round"/>
              </svg>
            </div>
            <div>
              <h3>Procedures + key counselling points</h3>
              <div class="meta">Collapsible ‚Äújust enough detail‚Äù</div>
            </div>
          </div>
        </div>

        <div class="bd">
          <div class="grid2">
            <details>
              <summary>
                Needle fasciotomy (percutaneous)
                <span class="chev" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </summary>
              <div class="details-body">
                Outpatient, local anaesthetic; needle used to divide cord. Typically faster recovery than open surgery; useful earlier disease.
                Downsides: higher recurrence; skin tears; rare tendon/nerve complications.
              </div>
            </details>

            <details>
              <summary>
                Segmental aponeurotomy
                <span class="chev" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </summary>
              <div class="details-body">
                Multiple small incisions; removes segments of cord without removing all pathological tissue.
              </div>
            </details>

            <details>
              <summary>
                Fasciectomy (usually limited/partial)
                <span class="chev" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </summary>
              <div class="details-body">
                Surgical removal of involved fascia. Longer recovery and higher rate of significant complications than needle fasciotomy, but lower recurrence.
              </div>
            </details>

            <details>
              <summary>
                Dermofasciectomy (with skin graft)
                <span class="chev" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </summary>
              <div class="details-body">
                Removes skin + fascia; requires graft (upper arm/groin). Consider if skin involved, aggressive/rapid recurrence, or extensive disease in younger people.
                Lowest recurrence risk, highest complication rate.
              </div>
            </details>
          </div>

          <details style="margin-top:10px">
            <summary>
              Complications and recurrence (counselling checklist)
              <span class="chev" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </summary>
            <div class="details-body">
              <ul class="list">
                <li>Local: tendon rupture, digital nerve/artery injury, infection/ischaemia/haematoma, stiffness/swelling/pain, wound issues/skin loss.</li>
                <li>Inflammatory ‚Äúflare‚Äù reaction 2‚Äì3 weeks post-op; CRPS more common in women.</li>
                <li>Recurrence occurs; higher after needle fasciotomy than fasciectomy/dermofasciectomy.</li>
                <li>Severe recurrent disease may rarely require digit amputation; recurrence can occur in stump.</li>
              </ul>
            </div>
          </details>

          <details style="margin-top:10px">
            <summary>
              Non-surgical adjuncts (what to say)
              <span class="chev" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M9 6 15 12 9 18" stroke="rgba(255,255,255,.85)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </summary>
            <div class="details-body">
              Corticosteroid injections may help painful nodules (without contracture). Radiation therapy is used only with special arrangements for governance/consent/audit/research.
              Physical therapies may offer temporary ROM improvements (low-quality evidence). Splinting is not effective for established contracture.
            </div>
          </details>
        </div>
      </div>

      <div class="section-title" id="patient">
        <h2>Patient-facing script</h2>
        <div class="hint">Copy/paste-ready counselling blocks</div>
      </div>

      <div class="panel" data-tags="management routine">
        <div class="hd">
          <div class="t">
            <div class="icon" aria-hidden="true" style="border-color: rgba(124,200,255,.22); background: rgba(124,200,255,.10);">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M6 7.5h12" stroke="rgba(255,255,255,.85)" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M6 12h10" stroke="rgba(255,255,255,.85)" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M6 16.5h8" stroke="rgba(255,255,255,.85)" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M19.5 7.5v9a3 3 0 0 1-3 3h-10a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3Z" stroke="rgba(255,255,255,.7)" stroke-width="1.2"/>
              </svg>
            </div>
            <div>
              <h3>Explain ‚Ä¢ reassure ‚Ä¢ safety-net</h3>
              <div class="meta">One-minute counselling</div>
            </div>
          </div>
        </div>
        <div class="bd">
          <div class="action routine">
            <div class="left" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M12 3v18" stroke="rgba(255,255,255,.95)" stroke-width="1.7" stroke-linecap="round"/>
                <path d="M3 12h18" stroke="rgba(255,255,255,.95)" stroke-width="1.7" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <div class="title">
                <b>‚ÄúThis is benign. It can slowly progress.‚Äù</b>
                <span class="pill">expectations</span>
              </div>
              <ul class="list">
                <li>‚ÄúIt‚Äôs not cancer. It‚Äôs thickening in tissue under the skin that can form cords.‚Äù</li>
                <li>‚ÄúMany people never need an operation; if the finger starts to bend and function is affected, treatments exist.‚Äù</li>
              </ul>
            </div>
          </div>

          <div class="action routine">
            <div class="left" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M7 12h10" stroke="rgba(255,255,255,.95)" stroke-width="1.7" stroke-linecap="round"/>
                <path d="M12 7v10" stroke="rgba(255,255,255,.95)" stroke-width="1.7" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <div class="title">
                <b>‚ÄúIf it‚Äôs tender, we can treat symptoms.‚Äù</b>
                <span class="pill">comfort</span>
              </div>
              <ul class="list">
                <li>‚ÄúEarly nodules can be uncomfortable; this often settles gradually.‚Äù</li>
                <li>‚ÄúSimple analgesia can help if needed.‚Äù</li>
              </ul>
            </div>
          </div>

          <div class="action urgent" style="margin-top:10px">
            <div class="left" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M12 9v4" stroke="rgba(255,255,255,.95)" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M12 17h.01" stroke="rgba(255,255,255,.95)" stroke-width="2.6" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <div class="title">
                <b>Safety-net phrasing</b>
                <span class="pill">when to come back</span>
              </div>
              <ul class="list">
                <li>‚ÄúCome back if you can‚Äôt lay your hand flat on a table, or if grip/hand function drops.‚Äù</li>
                <li>‚ÄúThat‚Äôs the point we usually refer for a hand specialist opinion.‚Äù</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Floating quick actions -->
  <div class="float" aria-label="Quick actions">
    <div class="fab" id="toTop" title="Back to top">
      <span class="dot good" aria-hidden="true"></span>
      Back to top
      <span style="margin-left:auto;opacity:.7" class="kbd">T</span>
    </div>
    <div class="fab" id="openUrgent" title="Jump to referral trigger">
      <span class="dot danger" aria-hidden="true"></span>
      Referral trigger
      <span style="margin-left:auto;opacity:.7" class="kbd">R</span>
    </div>
    <div class="fab" id="focusSearch" title="Focus search">
      <span class="dot" aria-hidden="true"></span>
      Search
      <span style="margin-left:auto;opacity:.7" class="kbd">/</span>
    </div>
  </div>

  <script>
    // --------- Helpers
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const state = {
      q: "",
      filters: new Set(), // urgent, routine, diagnosis, management, referral
    };

    const panels = () => $$(".panel, .step, .action, details"); // searchable/filterable units
    const navChips = () => $$(".navchips .chip, .rail .chip");

    function setActiveNav(hash){
      navChips().forEach(c => c.setAttribute("aria-current", "false"));
      const match = navChips().find(c => c.dataset.jump === hash);
      if(match) match.setAttribute("aria-current", "true");
    }

    function scrollToHash(hash){
      const el = document.querySelector(hash);
      if(!el) return;
      el.scrollIntoView({behavior:"smooth", block:"start"});
      setActiveNav(hash);
    }

    function updateStateText(){
      const active = [...state.filters].join(", ") || "none";
      const q = state.q ? `"${state.q}"` : "‚Äî";
      $("#activeState").textContent = `Active filters: ${active}\nSearch: ${q}`;
    }

    // --------- Search highlighting
    function clearMarks(root){
      // Remove <mark> without breaking text order
      const marks = $$("mark", root);
      for (const m of marks){
        const text = document.createTextNode(m.textContent);
        m.replaceWith(text);
      }
    }

    function highlight(root, term){
      if(!term) return;
      const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
        acceptNode(node){
          if(!node.nodeValue) return NodeFilter.FILTER_REJECT;
          const p = node.parentElement;
          if(!p) return NodeFilter.FILTER_REJECT;
          // Avoid marking in inputs, scripts, style, kbd-like elements
          if(["SCRIPT","STYLE","INPUT","TEXTAREA"].includes(p.tagName)) return NodeFilter.FILTER_REJECT;
          if(p.closest(".kbd")) return NodeFilter.FILTER_REJECT;
          if(!node.nodeValue.toLowerCase().includes(term.toLowerCase())) return NodeFilter.FILTER_REJECT;
          return NodeFilter.FILTER_ACCEPT;
        }
      });

      const hits = [];
      while(walker.nextNode()) hits.push(walker.currentNode);

      const esc = term.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      const re = new RegExp(esc, "ig");

      for(const node of hits){
        const frag = document.createDocumentFragment();
        const parts = node.nodeValue.split(re);
        const matches = node.nodeValue.match(re) || [];
        parts.forEach((p, i) => {
          if(p) frag.appendChild(document.createTextNode(p));
          if(matches[i]){
            const mk = document.createElement("mark");
            mk.textContent = matches[i];
            frag.appendChild(mk);
          }
        });
        node.parentNode.replaceChild(frag, node);
      }
    }

    // --------- Filtering logic
    function tagsFor(el){
      const t = (el.getAttribute("data-tags") || "").trim();
      return t ? new Set(t.split(/\s+/)) : new Set();
    }

    function elementText(el){
      return (el.innerText || el.textContent || "").toLowerCase();
    }

    function matchesFilters(el){
      if(state.filters.size === 0) return true;
      const t = tagsFor(el);
      // An element matches if it has ANY active filter tag (OR logic)
      for(const f of state.filters){
        if(t.has(f)) return true;
      }
      return false;
    }

    function matchesQuery(el){
      if(!state.q) return true;
      return elementText(el).includes(state.q.toLowerCase());
    }

    function apply(){
      // Reset highlights
      clearMarks(document.body);

      // Apply visibility
      panels().forEach(el => {
        const ok = matchesFilters(el) && matchesQuery(el);
        el.classList.toggle("hidden", !ok);
      });

      // Highlight query in remaining visible content (main + rail cards only)
      if(state.q){
        highlight($("main"), state.q);
        highlight($(".rail"), state.q);
      }

      updateStateText();
    }

    // --------- Wire UI
    navChips().forEach(chip => {
      chip.addEventListener("click", () => scrollToHash(chip.dataset.jump));
    });

    // Track scroll to update active nav chip
    const sectionIds = ["#triage","#assessment","#pathway","#differentials","#secondary","#patient"];
    const sectionEls = sectionIds.map(id => document.querySelector(id)).filter(Boolean);
    const io = new IntersectionObserver((entries) => {
      const visible = entries.filter(e => e.isIntersecting).sort((a,b)=> b.intersectionRatio - a.intersectionRatio)[0];
      if(visible) setActiveNav("#" + visible.target.id);
    }, { root: null, threshold: [0.25, 0.45, 0.6] });
    sectionEls.forEach(el => io.observe(el));

    // Search box
    const q = $("#q");
    q.addEventListener("input", (e) => {
      state.q = e.target.value.trim();
      apply();
    });

    // Toggles
    $$(".toggle").forEach(btn => {
      btn.addEventListener("click", () => {
        const f = btn.dataset.filter;
        const on = btn.getAttribute("aria-pressed") === "true";
        btn.setAttribute("aria-pressed", String(!on));
        if(on) state.filters.delete(f); else state.filters.add(f);
        apply();
      });
    });

    // Floating buttons + keyboard shortcuts
    $("#toTop").addEventListener("click", () => scrollToHash("#top"));
    $("#openUrgent").addEventListener("click", () => scrollToHash("#triage"));
    $("#focusSearch").addEventListener("click", () => q.focus());

    document.addEventListener("keydown", (e) => {
      if(e.key === "/" && document.activeElement !== q){
        e.preventDefault();
        q.focus();
        return;
      }
      if(e.key.toLowerCase() === "t"){ scrollToHash("#top"); }
      if(e.key.toLowerCase() === "r"){ scrollToHash("#triage"); }
      if(e.key === "Escape"){
        if(document.activeElement === q){
          q.value = "";
          state.q = "";
          apply();
        }
      }
    });

    // Initial render
    updateStateText();
    setActiveNav("#triage");
  </script>
</body>
</html>
