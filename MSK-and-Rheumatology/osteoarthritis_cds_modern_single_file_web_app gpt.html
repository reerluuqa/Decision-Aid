<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Osteoarthritis (OA) ‚Äî Clinical Decision Support</title>
  <meta name="description" content="Fast-scanning, modern OA clinical decision support. Single-file HTML/CSS/JS." />
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --faint: rgba(255,255,255,.55);
      --border: rgba(255,255,255,.12);
      --shadow: 0 14px 40px rgba(0,0,0,.38);
      --shadow2: 0 10px 24px rgba(0,0,0,.30);

      --brand: #7c3aed;     /* violet */
      --brand2:#22c55e;     /* green */
      --brand3:#06b6d4;     /* cyan */
      --warn: #f59e0b;
      --danger:#ef4444;
      --ok: #22c55e;

      --radius-xl: 22px;
      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-sm: 10px;

      --max: 1160px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 12% -10%, rgba(124,58,237,.35), transparent 60%),
        radial-gradient(900px 700px at 88% 0%, rgba(6,182,212,.22), transparent 60%),
        radial-gradient(900px 900px at 90% 90%, rgba(34,197,94,.16), transparent 60%),
        linear-gradient(180deg, #070a14 0%, #0b1020 30%, #070a14 100%);
      overflow-x:hidden;
    }

    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* --- Layout --- */
    .topbar{
      position:sticky; top:0; z-index:50;
      background: rgba(7,10,20,.72);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
    }

    .topbar-inner{
      max-width: var(--max);
      margin:0 auto;
      padding: 14px 18px;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }

    .brand{
      display:flex; align-items:center; gap:12px;
      min-width: 240px;
    }

    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      box-shadow: var(--shadow2);
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }

    .logo{
      width: 36px; height: 36px;
      border-radius: 12px;
      background:
        radial-gradient(16px 16px at 30% 30%, rgba(255,255,255,.55), transparent 60%),
        linear-gradient(135deg, rgba(124,58,237,1), rgba(6,182,212,1));
      box-shadow: 0 10px 24px rgba(124,58,237,.22);
      position:relative;
      overflow:hidden;
      flex: 0 0 auto;
    }

    .logo:after{
      content:"";
      position:absolute; inset:-40px;
      background: radial-gradient(closest-side, rgba(255,255,255,.25), transparent 70%);
      transform: rotate(18deg);
    }

    .brand h1{
      font-size: 14px;
      line-height: 1.1;
      margin:0;
      font-weight: 750;
      letter-spacing:.2px;
    }

    .brand .sub{
      margin:2px 0 0;
      font-size: 12px;
      color: var(--muted);
    }

    .toolbar{
      display:flex; align-items:center; gap:10px;
      flex: 1 1 auto;
      justify-content:flex-end;
      min-width: 300px;
    }

    .input{
      display:flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      min-width: 280px;
      max-width: 520px;
      width: 48vw;
    }

    .input input{
      width:100%;
      border:none; outline:none;
      background:transparent;
      color: var(--text);
      font-size: 13px;
    }

    .chiprow{
      display:flex; align-items:center; gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .chip{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      white-space:nowrap;
    }

    .chip:hover{ transform: translateY(-1px); background: rgba(255,255,255,.08); }
    .chip[aria-pressed="true"]{
      background: rgba(124,58,237,.25);
      border-color: rgba(124,58,237,.55);
      color: rgba(255,255,255,.92);
    }

    .chip.urgent[aria-pressed="true"]{ background: rgba(239,68,68,.22); border-color: rgba(239,68,68,.55); }
    .chip.routine[aria-pressed="true"]{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.5); }

    .wrap{
      max-width: var(--max);
      margin: 18px auto 80px;
      padding: 0 18px;
      display:grid;
      grid-template-columns: 300px 1fr;
      gap: 18px;
    }

    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
      .input{ width: 100%; min-width: 160px; }
      .toolbar{ justify-content:stretch; flex-wrap:wrap; }
      .chiprow{ justify-content:flex-start; }
      .brand{ min-width: unset; }
    }

    /* --- Sidebar --- */
    .sidebar{
      position: sticky;
      top: 84px;
      align-self:start;
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      background: rgba(255,255,255,.05);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }

    .side-head{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }

    .side-title{
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
    }

    .side-title h2{ margin:0; font-size: 13px; letter-spacing:.2px; }
    .pill{
      font-family: var(--mono);
      font-size: 11px;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      white-space:nowrap;
    }

    .nav{
      padding: 10px;
      display:flex;
      flex-direction:column;
      gap: 6px;
    }

    .nav a{
      display:flex; align-items:center; gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      color: var(--muted);
      border: 1px solid transparent;
      transition: background .2s ease, border-color .2s ease, transform .08s ease;
    }

    .nav a:hover{ background: rgba(255,255,255,.06); transform: translateY(-1px); }
    .nav a.active{
      background: rgba(124,58,237,.18);
      border-color: rgba(124,58,237,.45);
      color: rgba(255,255,255,.92);
    }

    .dot{ width:10px; height:10px; border-radius:99px; background: rgba(255,255,255,.22); }
    .dot.urg{ background: rgba(239,68,68,.9); box-shadow: 0 0 0 4px rgba(239,68,68,.18); }
    .dot.rtn{ background: rgba(34,197,94,.9); box-shadow: 0 0 0 4px rgba(34,197,94,.16); }
    .dot.inf{ background: rgba(6,182,212,.95); box-shadow: 0 0 0 4px rgba(6,182,212,.14); }

    .side-foot{
      padding: 12px 14px 14px;
      border-top: 1px solid var(--border);
      color: var(--faint);
      font-size: 12px;
      line-height: 1.45;
    }

    /* --- Content --- */
    .content{
      display:flex;
      flex-direction:column;
      gap: 14px;
    }

    .hero{
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      padding: 16px 16px 14px;
      background:
        radial-gradient(800px 260px at 0% 0%, rgba(124,58,237,.22), transparent 62%),
        radial-gradient(720px 280px at 100% 0%, rgba(6,182,212,.16), transparent 60%),
        rgba(255,255,255,.05);
      box-shadow: var(--shadow);
    }

    .hero h3{ margin:0 0 6px; font-size: 20px; letter-spacing:.2px; }
    .hero p{ margin:0; color: var(--muted); line-height: 1.55; }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 820px){ .grid2{ grid-template-columns: 1fr; } }

    .card{
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      background: rgba(255,255,255,.05);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }

    .card .head{
      padding: 12px 12px 10px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }

    .card .head h4{ margin:0; font-size: 13px; letter-spacing:.2px; }
    .card .head .meta{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }

    .tag{
      font-size: 11px;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.05);
      white-space:nowrap;
    }
    .tag.urgent{ border-color: rgba(239,68,68,.55); background: rgba(239,68,68,.12); color: rgba(255,255,255,.92); }
    .tag.routine{ border-color: rgba(34,197,94,.5); background: rgba(34,197,94,.10); color: rgba(255,255,255,.92); }
    .tag.info{ border-color: rgba(6,182,212,.55); background: rgba(6,182,212,.10); color: rgba(255,255,255,.92); }

    .card .body{ padding: 12px; color: var(--muted); line-height: 1.55; }

    .steps{
      margin: 10px 0 0;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .step{
      display:flex;
      gap: 12px;
      padding: 12px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
    }

    .num{
      width: 28px; height: 28px;
      border-radius: 10px;
      display:grid; place-items:center;
      background: rgba(124,58,237,.25);
      border: 1px solid rgba(124,58,237,.45);
      font-weight: 800;
      font-size: 12px;
      flex: 0 0 auto;
    }

    .step .t{ margin:0; font-weight: 720; color: var(--text); font-size: 13px; }
    .step .d{ margin:4px 0 0; font-size: 13px; }

    .actionbar{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }

    .btn{
      border:none;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border);
      color: rgba(255,255,255,.92);
      display:inline-flex;
      align-items:center;
      gap: 10px;
      font-size: 12px;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.08); }
    .btn.primary{ background: rgba(124,58,237,.22); border-color: rgba(124,58,237,.55); }
    .btn.danger{ background: rgba(239,68,68,.14); border-color: rgba(239,68,68,.55); }

    .divider{
      height: 1px;
      background: var(--border);
      margin: 10px 0;
    }

    /* --- Accordion --- */
    .acc{
      border-top: 1px solid var(--border);
      padding-top: 8px;
      margin-top: 8px;
    }

    details{
      border: 1px solid var(--border);
      border-radius: 16px;
      background: rgba(255,255,255,.04);
      overflow:hidden;
    }

    details + details{ margin-top: 10px; }

    summary{
      list-style:none;
      cursor:pointer;
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      user-select:none;
    }
    summary::-webkit-details-marker{ display:none; }

    .sumL{ display:flex; align-items:center; gap:10px; min-width:0; }
    .sumT{ font-weight: 740; font-size: 13px; color: var(--text); }
    .sumS{ font-size: 12px; color: var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .chev{
      width: 28px; height: 28px;
      border-radius: 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border);
      display:grid; place-items:center;
      flex: 0 0 auto;
      transition: transform .18s ease;
    }

    details[open] .chev{ transform: rotate(180deg); }

    details .detail{
      padding: 0 12px 12px;
      color: var(--muted);
      line-height: 1.55;
    }

    ul{ margin: 10px 0 0; padding-left: 18px; }
    li{ margin: 6px 0; }

    /* --- Visual flags --- */
    .flag{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 9px 10px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      font-size: 12px;
      color: var(--muted);
    }

    .flag strong{ color: var(--text); }

    .flag.urgent{
      border-color: rgba(239,68,68,.6);
      background: rgba(239,68,68,.12);
      color: rgba(255,255,255,.88);
    }

    .flag.routine{
      border-color: rgba(34,197,94,.55);
      background: rgba(34,197,94,.10);
      color: rgba(255,255,255,.88);
    }

    .flag.info{
      border-color: rgba(6,182,212,.55);
      background: rgba(6,182,212,.10);
      color: rgba(255,255,255,.88);
    }

    .note{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.03);
      color: var(--faint);
      font-size: 12px;
      line-height: 1.55;
    }

    /* --- Search hit highlighting --- */
    mark{
      background: rgba(245,158,11,.28);
      color: rgba(255,255,255,.96);
      padding: 0 2px;
      border-radius: 4px;
    }

    /* --- Toast --- */
    .toast{
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(7,10,20,.76);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 10px 12px;
      color: var(--muted);
      display:flex;
      gap: 10px;
      align-items:center;
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      z-index: 100;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease;
    }
    .toast.show{ opacity:1; }

    .kbd{ font-family: var(--mono); font-size: 11px; border: 1px solid var(--border); background: rgba(255,255,255,.05); padding: 3px 6px; border-radius: 8px; }

    .sr{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }
  </style>
</head>
<body>
  <!-- Top bar -->
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="brand" aria-label="App title">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Osteoarthritis ‚Äî clinical decision support</h1>
          <div class="sub">Fast scanning pathways ‚Ä¢ diagnosis ‚Ä¢ management ‚Ä¢ referral</div>
        </div>
      </div>

      <div class="toolbar" role="search">
        <div class="input" title="Search sections (Ctrl/‚åò + K)">
          <span aria-hidden="true">üîé</span>
          <input id="q" type="search" placeholder="Search (e.g., ‚Äòhot swollen‚Äô, ‚ÄòX-ray‚Äô, ‚ÄòNSAID‚Äô, ‚Äòinjection‚Äô, ‚Äòsurgery‚Äô)" autocomplete="off" />
          <span class="kbd" aria-hidden="true">Ctrl K</span>
        </div>

        <div class="chiprow" aria-label="Quick filters">
          <button class="chip urgent" data-filter="urgent" aria-pressed="false" title="Show urgent/alternative diagnosis flags">üö® Urgent flags</button>
          <button class="chip routine" data-filter="routine" aria-pressed="false" title="Show routine OA pathway">‚úÖ Routine pathway</button>
          <button class="chip" data-filter="knee" aria-pressed="false" title="Filter knee">ü¶µ Knee</button>
          <button class="chip" data-filter="hip" aria-pressed="false" title="Filter hip">ü¶¥ Hip</button>
          <button class="chip" data-filter="hand" aria-pressed="false" title="Filter hand">‚úã Hand</button>
          <button class="chip" data-filter="imaging" aria-pressed="false" title="Filter imaging">ü©ª Imaging</button>
          <button class="chip" data-filter="analgesia" aria-pressed="false" title="Filter analgesia">üíä Analgesia</button>
          <button class="chip" data-filter="referral" aria-pressed="false" title="Filter referral">üì® Referral</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap" role="main">
    <!-- Sidebar / sticky navigation -->
    <aside class="sidebar" aria-label="Sticky navigation">
      <div class="side-head">
        <div class="side-title">
          <h2>Jump to</h2>
          <span class="pill" id="hitsPill">0 visible</span>
        </div>
        <div class="note" style="margin-top:10px;">
          <div><strong>Keyboard</strong>: <span class="kbd">Ctrl/‚åò K</span> search ‚Ä¢ <span class="kbd">Esc</span> clear ‚Ä¢ <span class="kbd">G</span> then <span class="kbd">U</span> urgent.</div>
        </div>
      </div>
      <nav class="nav" id="nav">
        <a href="#triage" data-target="triage"><span class="dot urg"></span> Triage & red flags</a>
        <a href="#dx" data-target="dx"><span class="dot inf"></span> Clinical diagnosis</a>
        <a href="#assessment" data-target="assessment"><span class="dot inf"></span> Assessment checklist</a>
        <a href="#imaging" data-target="imaging"><span class="dot inf"></span> Imaging strategy</a>
        <a href="#initial" data-target="initial"><span class="dot rtn"></span> Initial management</a>
        <a href="#analgesia" data-target="analgesia"><span class="dot rtn"></span> Analgesia ladder</a>
        <a href="#followup" data-target="followup"><span class="dot rtn"></span> Follow‚Äëup escalation</a>
        <a href="#referral" data-target="referral"><span class="dot rtn"></span> Referral triggers</a>
        <a href="#notes" data-target="notes"><span class="dot inf"></span> Practical notes</a>
      </nav>
      <div class="side-foot">
        <div class="badge" title="Built for fast scanning">‚ö° Quick-scan layout ‚Ä¢ üß≠ Sticky nav ‚Ä¢ üß© Filters ‚Ä¢ ü™ó Accordions</div>
      </div>
    </aside>

    <!-- Content -->
    <section class="content" id="content">
      <div class="hero" id="top">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;">
          <div>
            <h3>OA pathway: urgent alternatives first ‚Üí then structured OA care</h3>
            <p>Designed for point‚Äëof‚Äëcare scanning: <strong>visual flags</strong>, <strong>step panels</strong>, and <strong>action boxes</strong>. Content mirrors key elements from UK primary care guidance.</p>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
            <span class="flag urgent">üö® <strong>Urgent</strong> = consider alternative diagnosis / same‚Äëday action</span>
            <span class="flag routine">‚úÖ <strong>Routine</strong> = typical OA pathway</span>
            <span class="flag info">‚ÑπÔ∏è <strong>Info</strong> = operational guidance</span>
          </div>
        </div>

        <div class="actionbar">
          <button class="btn danger" id="btnUrgent">üö® Show urgent only</button>
          <button class="btn primary" id="btnRoutine">‚úÖ Show routine pathway</button>
          <button class="btn" id="btnReset">‚Ü∫ Reset filters</button>
          <button class="btn" id="btnPrint">üñ®Ô∏è Print (clean)</button>
        </div>
      </div>

      <!-- TRIAGE -->
      <article class="card" id="triage" data-tags="urgent dx" data-title="Triage & red flags">
        <div class="head">
          <h4>üö® Triage & red flags (consider alternative / additional diagnosis)</h4>
          <div class="meta">
            <span class="tag urgent">urgent</span>
            <span class="tag info">differential</span>
          </div>
        </div>
        <div class="body">
          <div class="flag urgent">üö® <strong>Hot, red, swollen joint + systemic symptoms</strong> ‚Üí treat as septic arthritis until proven otherwise.</div>
          <div class="grid2">
            <div>
              <div class="steps">
                <div class="step">
                  <div class="num" style="background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.55);">1</div>
                  <div>
                    <p class="t">Inflammatory arthropathy pattern?</p>
                    <p class="d">Prolonged morning stiffness &gt;30 min, night pain, stiffness/pain improved by activity, multiple joints, systemic symptoms.</p>
                  </div>
                </div>
                <div class="step">
                  <div class="num" style="background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.55);">2</div>
                  <div>
                    <p class="t">Trauma / fracture adjacent to joint?</p>
                    <p class="d">Recent trauma with acute pain ‚Üí consider fracture and manage accordingly.</p>
                  </div>
                </div>
              </div>
            </div>
            <div>
              <div class="steps">
                <div class="step">
                  <div class="num" style="background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.55);">3</div>
                  <div>
                    <p class="t">Malignancy features?</p>
                    <p class="d">Persistent progressive bone pain unrelated to activity, rapid deterioration, night pain, unexplained mass/swelling.</p>
                  </div>
                </div>
                <div class="step">
                  <div class="num" style="background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.55);">4</div>
                  <div>
                    <p class="t">Widespread pain disorder?</p>
                    <p class="d">Consider fibromyalgia / chronic pain syndrome if widespread symptoms predominate.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="acc">
            <details>
              <summary>
                <div class="sumL">
                  <span class="flag urgent" style="padding:6px 8px;">‚ö†Ô∏è</span>
                  <div style="min-width:0;">
                    <div class="sumT">Joint‚Äëspecific mimics to keep on the radar</div>
                    <div class="sumS">Hand (CMC/wrist), hip (GTPS, sciatica, osteonecrosis‚Ä¶), knee (meniscus, ACL‚Ä¶)</div>
                  </div>
                </div>
                <div class="chev" aria-hidden="true">‚ñæ</div>
              </summary>
              <div class="detail">
                <ul>
                  <li><strong>Hand (thumb base):</strong> wrist OA; scapholunate ligament injury (often post‚Äëtrauma); ganglion; De Quervain‚Äôs tenosynovitis; trigger thumb.</li>
                  <li><strong>Hip:</strong> greater trochanteric pain syndrome; meralgia paraesthetica; sciatica; spinal stenosis; osteonecrosis (consider steroid/alcohol history); iliotibial band syndrome.</li>
                  <li><strong>Knee:</strong> patellofemoral pain (often younger); bursitis; iliotibial band syndrome; meniscal tear (locking/tender joint line); ACL injury (prominent mechanical symptoms).</li>
                </ul>
              </div>
            </details>
          </div>
        </div>
      </article>

      <!-- DX -->
      <article class="card" id="dx" data-tags="routine dx" data-title="Clinical diagnosis">
        <div class="head">
          <h4>‚ÑπÔ∏è Clinical diagnosis (do not default to imaging)</h4>
          <div class="meta">
            <span class="tag routine">routine</span>
            <span class="tag info">diagnosis</span>
          </div>
        </div>
        <div class="body">
          <div class="flag routine">‚úÖ <strong>Suspect OA</strong> in age ‚â•45 with activity‚Äërelated joint pain, <strong>morning stiffness absent or ‚â§30 min</strong>, and functional limitation (after excluding alternatives).</div>

          <div class="grid2">
            <div>
              <div class="steps">
                <div class="step">
                  <div class="num">1</div>
                  <div>
                    <p class="t">Core symptom pattern</p>
                    <p class="d">Activity‚Äërelated pain, gradual onset months‚Äìyears; stiffness minimal; function affected.</p>
                  </div>
                </div>
                <div class="step">
                  <div class="num">2</div>
                  <div>
                    <p class="t">Examination</p>
                    <p class="d">Bony enlargement/deformity; possible small effusion (knee); restricted/painful ROM, crepitus; muscle weakness/wasting; instability/malalignment.</p>
                  </div>
                </div>
              </div>
            </div>
            <div>
              <details open>
                <summary>
                  <div class="sumL">
                    <span class="flag info" style="padding:6px 8px;">üß†</span>
                    <div>
                      <div class="sumT">Joint‚Äëspecific clinical cues</div>
                      <div class="sumS">Hand ‚Ä¢ Hip ‚Ä¢ Knee</div>
                    </div>
                  </div>
                  <div class="chev" aria-hidden="true">‚ñæ</div>
                </summary>
                <div class="detail">
                  <ul>
                    <li><strong>Hand:</strong> first CMC, DIP, PIP commonly; pain with pinch/grip; thenar wasting; CMC deformity/subluxation; Heberden/Bouchard nodes; mucoid cysts possible.</li>
                    <li><strong>Hip:</strong> deep anterior groin pain on walking/stairs (may refer to thigh/knee/ankle); painful restriction of internal rotation (hip flexed); Trendelenburg gait in advanced disease.</li>
                    <li><strong>Knee:</strong> compartment‚Äëlocalised pain; patellofemoral pain worse with stairs/inclines (esp descending) + ‚Äúmovie sign‚Äù (ache after sitting); giving way/locking may occur; varus/valgus deformity in advanced disease.</li>
                  </ul>
                </div>
              </details>
            </div>
          </div>
        </div>
      </article>

      <!-- ASSESSMENT -->
      <article class="card" id="assessment" data-tags="routine dx" data-title="Assessment checklist">
        <div class="head">
          <h4>‚ÑπÔ∏è Assessment checklist (structured history + function + context)</h4>
          <div class="meta">
            <span class="tag routine">routine</span>
            <span class="tag info">assessment</span>
          </div>
        </div>
        <div class="body">
          <div class="grid2">
            <div>
              <div class="steps">
                <div class="step">
                  <div class="num">1</div>
                  <div>
                    <p class="t">History essentials</p>
                    <p class="d">Site/onset/duration/progression, severity, swelling/stiffness, flares; locking/giving way; atypical features (trauma, prolonged stiffness, systemic symptoms, rapid worsening).</p>
                  </div>
                </div>
                <div class="step">
                  <div class="num">2</div>
                  <div>
                    <p class="t">Function and impact</p>
                    <p class="d">Walking/exercise/sleep/work/leisure; hand dominance if relevant; QoL, mood, relationships, beliefs/expectations; supports and home/work adjustments.</p>
                  </div>
                </div>
              </div>
            </div>
            <div>
              <div class="steps">
                <div class="step">
                  <div class="num">3</div>
                  <div>
                    <p class="t">Examination essentials</p>
                    <p class="d">Typical OA features; posture/alignment; gait; hot swollen joint; assess peri‚Äëarticular sources (bursitis, ganglion, trigger finger), neuropathy, and possible crystal arthropathy.</p>
                  </div>
                </div>
                <div class="step">
                  <div class="num">4</div>
                  <div>
                    <p class="t">Comorbidity scan</p>
                    <p class="d">BMI/weight; chronic pain syndrome; falls risk; psychosocial needs (including anxiety/depression) to shape plan.</p>
                  </div>
                </div>
              </div>
              <div class="note"><strong>Tip:</strong> with suspected knee OA, actively exclude referred hip pain (groin tenderness + pain on internal rotation).</div>
            </div>
          </div>
        </div>
      </article>

      <!-- IMAGING -->
      <article class="card" id="imaging" data-tags="routine imaging" data-title="Imaging strategy">
        <div class="head">
          <h4>ü©ª Imaging strategy</h4>
          <div class="meta">
            <span class="tag info">imaging</span>
            <span class="tag routine">routine</span>
          </div>
        </div>
        <div class="body">
          <div class="flag info">‚ÑπÔ∏è <strong>Do not routinely X‚Äëray</strong> to diagnose OA. Image selectively when it changes decisions.</div>

          <div class="steps" style="margin-top:12px;">
            <div class="step">
              <div class="num">1</div>
              <div>
                <p class="t">When to consider X‚Äëray</p>
                <p class="d">Diagnostic uncertainty/atypical features suggesting alternative or additional diagnosis; <strong>sudden or unexpected worsening</strong> of symptoms.</p>
              </div>
            </div>
            <div class="step">
              <div class="num">2</div>
              <div>
                <p class="t">If you do image: what you might see</p>
                <p class="d">Subchondral bone thickening/cysts, osteophytes, and joint space loss/narrowing (cartilage damage proxy).</p>
              </div>
            </div>
          </div>

          <div class="note"><strong>Interpretation:</strong> radiographic change may not correlate with symptom burden or functional impairment‚Äîavoid ‚Äútreating the X‚Äëray.‚Äù</div>
        </div>
      </article>

      <!-- INITIAL MANAGEMENT -->
      <article class="card" id="initial" data-tags="routine initial" data-title="Initial management">
        <div class="head">
          <h4>‚úÖ Initial management (core non‚Äësurgical package)</h4>
          <div class="meta">
            <span class="tag routine">routine</span>
            <span class="tag info">core care</span>
          </div>
        </div>
        <div class="body">
          <div class="flag routine">‚úÖ Offer an <strong>individualised plan</strong> based on symptoms, joints involved, function, and comorbidities.</div>

          <div class="grid2">
            <div>
              <div class="steps">
                <div class="step">
                  <div class="num">1</div>
                  <div>
                    <p class="t">Information + self‚Äëmanagement</p>
                    <p class="d">Provide OA education, flare planning, and signposting to trusted resources; assess psychosocial impact and support needs.</p>
                  </div>
                </div>
                <div class="step" data-tags-inline="knee hip hand">
                  <div class="num">2</div>
                  <div>
                    <p class="t">Therapeutic exercise (tailored)</p>
                    <p class="d">Local strengthening + aerobic fitness. Warn: pain may increase initially, but consistency improves pain and function over time; aim for long‚Äëterm adherence.</p>
                  </div>
                </div>
                <div class="step">
                  <div class="num">3</div>
                  <div>
                    <p class="t">Weight management</p>
                    <p class="d">Offer support to lose weight if overweight/obese.</p>
                  </div>
                </div>
              </div>
            </div>
            <div>
              <details open>
                <summary>
                  <div class="sumL">
                    <span class="flag info" style="padding:6px 8px;">üß©</span>
                    <div>
                      <div class="sumT">Interventions not recommended for symptom relief</div>
                      <div class="sumS">Avoid low‚Äëvalue options to protect attention and budgets</div>
                    </div>
                  </div>
                  <div class="chev" aria-hidden="true">‚ñæ</div>
                </summary>
                <div class="detail">
                  <ul>
                    <li>Do <strong>not</strong> recommend: chondroitin, glucosamine, topical rubefacients or local anaesthetics, acupuncture, or dry needling.</li>
                    <li>Manual therapy <strong>alone</strong> and electrotherapy (TENS/ultrasound/laser) should not be used as sole OA management.</li>
                  </ul>
                </div>
              </details>

              <div class="note"><strong>Footwear:</strong> consider advice on appropriate footwear if needed.</div>
            </div>
          </div>
        </div>
      </article>

      <!-- ANALGESIA -->
      <article class="card" id="analgesia" data-tags="routine analgesia" data-title="Analgesia ladder">
        <div class="head">
          <h4>üíä Analgesia ladder (lowest effective dose, shortest time)</h4>
          <div class="meta">
            <span class="tag routine">routine</span>
            <span class="tag info">analgesia</span>
          </div>
        </div>
        <div class="body">
          <div class="flag info">‚ÑπÔ∏è Pharmacological options are adjuncts to core non‚Äëpharmacological care.</div>

          <div class="steps" style="margin-top:12px;">
            <div class="step" data-tags-inline="knee analgesia">
              <div class="num">1</div>
              <div>
                <p class="t">Topical NSAID first‚Äëline for knee OA (and consider for other joints)</p>
                <p class="d">Example: OTC ibuprofen 5% gel up to 3√ó/day for knee OA if no contraindications; consider topical NSAID for other joint OA.</p>
              </div>
            </div>

            <div class="step" data-tags-inline="analgesia">
              <div class="num">2</div>
              <div>
                <p class="t">If topical ineffective/unsuitable ‚Üí consider oral NSAID</p>
                <p class="d">Example: ibuprofen (or another NSAID) guided by individual contraindications, cautions, adverse effects, and interactions; use <strong>lowest effective dose</strong> for <strong>shortest time</strong>. Consider gastroprotection (e.g., PPI) where appropriate.</p>
              </div>
            </div>

            <div class="step" data-tags-inline="analgesia">
              <div class="num">3</div>
              <div>
                <p class="t">If NSAIDs contraindicated / not tolerated / ineffective ‚Üí short-term options</p>
                <p class="d">Paracetamol or weak opioids (e.g., codeine) for <strong>infrequent, short‚Äëterm</strong> pain management when other options unsuitable.</p>
              </div>
            </div>

            <div class="step" data-tags-inline="analgesia">
              <div class="num" style="background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.55);">!</div>
              <div>
                <p class="t">Avoid strong opioids for OA pain management</p>
                <p class="d">Strong opioids are not recommended for OA pain management.</p>
              </div>
            </div>
          </div>

          <details style="margin-top:12px;">
            <summary>
              <div class="sumL">
                <span class="flag info" style="padding:6px 8px;">üß¥</span>
                <div>
                  <div class="sumT">Topical NSAID practical cautions</div>
                  <div class="sumS">Avoid eyes/broken skin; watch for systemic effects with large quantities</div>
                </div>
              </div>
              <div class="chev" aria-hidden="true">‚ñæ</div>
            </summary>
            <div class="detail">
              <ul>
                <li>Avoid contact with eyes, mucous membranes, inflamed/broken skin; avoid occlusive dressings.</li>
                <li>Large amounts may cause systemic effects (hypersensitivity, asthma, possible renal disease).</li>
                <li>Stop if photosensitivity/rash, angioedema, bronchospasm, renal impairment.</li>
              </ul>
            </div>
          </details>
        </div>
      </article>

      <!-- FOLLOW-UP -->
      <article class="card" id="followup" data-tags="routine followup" data-title="Follow-up escalation">
        <div class="head">
          <h4>‚úÖ Follow‚Äëup escalation (if ongoing symptoms)</h4>
          <div class="meta">
            <span class="tag routine">routine</span>
            <span class="tag info">escalation</span>
          </div>
        </div>
        <div class="body">
          <div class="flag routine">‚úÖ If symptoms persist after initial management, escalate to the local MSK multidisciplinary pathway (service-dependent).</div>

          <div class="grid2">
            <div>
              <details open>
                <summary>
                  <div class="sumL">
                    <span class="flag routine" style="padding:6px 8px;">üßë‚Äç‚öïÔ∏è</span>
                    <div>
                      <div class="sumT">Physio / MSK team can add</div>
                      <div class="sumS">Reinforce exercise; pacing; supports; injections; programmes</div>
                    </div>
                  </div>
                  <div class="chev" aria-hidden="true">‚ñæ</div>
                </summary>
                <div class="detail">
                  <ul>
                    <li>Reinforce therapeutic exercise and pacing.</li>
                    <li>Consider additional manual therapy (hip/knee) as an adjunct.</li>
                    <li>Joint supports/splints/braces/gloves/sleeves to reduce load and improve stability.</li>
                    <li>Intra‚Äëarticular corticosteroid injection when other drug treatments ineffective/unsuitable or to enable exercise (if expertise available).</li>
                    <li>Combined exercise + education / behaviour change programme (pain coping skills, goal setting) where available.</li>
                  </ul>
                  <div class="note"><strong>Injection expectation:</strong> intra‚Äëarticular corticosteroid typically provides short‚Äëterm relief (~2‚Äì10 weeks).</div>
                </div>
              </details>
            </div>
            <div>
              <details open>
                <summary>
                  <div class="sumL">
                    <span class="flag info" style="padding:6px 8px;">üß∞</span>
                    <div>
                      <div class="sumT">OT / podiatry (high yield)</div>
                      <div class="sumS">Aids/adaptations; fall risk; orthotics; footwear</div>
                    </div>
                  </div>
                  <div class="chev" aria-hidden="true">‚ñæ</div>
                </summary>
                <div class="detail">
                  <ul>
                    <li><strong>OT:</strong> assistive devices for flares and daily activities (hip/knee: sticks, reachers, bath aids, raised seats; hand: jar openers, tap turners, gripping tools).</li>
                    <li><strong>Falls:</strong> assess and mitigate if risk present.</li>
                    <li><strong>Podiatry:</strong> biomechanical assessment; advice on orthoses, insoles, and footwear when appropriate.</li>
                  </ul>
                </div>
              </details>
            </div>
          </div>
        </div>
      </article>

      <!-- REFERRAL -->
      <article class="card" id="referral" data-tags="routine referral" data-title="Referral triggers">
        <div class="head">
          <h4>üì® Referral triggers</h4>
          <div class="meta">
            <span class="tag routine">routine</span>
            <span class="tag info">referral</span>
          </div>
        </div>
        <div class="body">
          <div class="grid2">
            <div>
              <div class="flag routine">‚úÖ <strong>Orthopaedics</strong>: consider if non‚Äësurgical management unsuitable/ineffective after ~3 months and quality of life is substantially impacted.</div>
              <div class="steps" style="margin-top:10px;">
                <div class="step">
                  <div class="num">1</div>
                  <div>
                    <p class="t">Orthopaedics ‚Äî typical triggers</p>
                    <p class="d">Pain/stiffness/reduced function or progressive deformity substantially affecting QoL; diagnostic uncertainty/atypical features; failure/intolerance/unsuitability of strategies; sudden worsening.</p>
                  </div>
                </div>
                <div class="step">
                  <div class="num">2</div>
                  <div>
                    <p class="t">Decision‚Äëmaking principles</p>
                    <p class="d">Do not base referral on age, sex/gender, smoking status, comorbidities, or BMI; avoid scoring tools to decide surgical eligibility.</p>
                  </div>
                </div>
              </div>
            </div>

            <div>
              <details open>
                <summary>
                  <div class="sumL">
                    <span class="flag info" style="padding:6px 8px;">üß†</span>
                    <div>
                      <div class="sumT">Other specialist pathways</div>
                      <div class="sumS">Pain service ‚Ä¢ psychology/mental health</div>
                    </div>
                  </div>
                  <div class="chev" aria-hidden="true">‚ñæ</div>
                </summary>
                <div class="detail">
                  <ul>
                    <li><strong>Pain service:</strong> uncontrolled pain despite optimal non‚Äësurgical and/or surgical management, or suspected chronic pain syndrome requiring specialist input.</li>
                    <li><strong>Psychology/mental health:</strong> comorbid anxiety/depression not responding to primary care management.</li>
                  </ul>
                </div>
              </details>

              <div class="note"><strong>Operational:</strong> agree follow‚Äëup plan and timeline based on clinical judgement and response to initial package.</div>
            </div>
          </div>
        </div>
      </article>

      <!-- NOTES -->
      <article class="card" id="notes" data-tags="info" data-title="Practical notes">
        <div class="head">
          <h4>‚ÑπÔ∏è Practical notes (scan‚Äëfriendly)</h4>
          <div class="meta">
            <span class="tag info">workflow</span>
          </div>
        </div>
        <div class="body">
          <div class="grid2">
            <div>
              <details open>
                <summary>
                  <div class="sumL">
                    <span class="flag info" style="padding:6px 8px;">üß≠</span>
                    <div>
                      <div class="sumT">One‚Äëminute consult structure</div>
                      <div class="sumS">Triage ‚Üí confirm OA pattern ‚Üí agree plan ‚Üí safety-net</div>
                    </div>
                  </div>
                  <div class="chev" aria-hidden="true">‚ñæ</div>
                </summary>
                <div class="detail">
                  <ol style="margin:10px 0 0; padding-left:18px;">
                    <li><strong>Rule out urgent alternatives</strong> (hot swollen joint/systemic; trauma; malignancy features; inflammatory pattern).</li>
                    <li><strong>Confirm OA pattern</strong> clinically (age ‚â•45, activity pain, stiffness ‚â§30 min, function affected).</li>
                    <li><strong>Core package</strong>: education + exercise + weight support + footwear; add topical NSAID where appropriate.</li>
                    <li><strong>Agree follow-up</strong> and escalation plan; document function goals and barriers.</li>
                  </ol>
                </div>
              </details>
            </div>
            <div>
              <details>
                <summary>
                  <div class="sumL">
                    <span class="flag info" style="padding:6px 8px;">üß©</span>
                    <div>
                      <div class="sumT">Flares (pragmatic framing)</div>
                      <div class="sumS">Acute-on-chronic symptom surge; plan ahead</div>
                    </div>
                  </div>
                  <div class="chev" aria-hidden="true">‚ñæ</div>
                </summary>
                <div class="detail">
                  <ul>
                    <li>Encourage pacing + graded activity rather than complete rest.</li>
                    <li>Re-check for red flags if flare is atypical, prolonged, or associated with systemic features.</li>
                    <li>Reinforce that consistent exercise improves long-term function even if initial pain increases.</li>
                  </ul>
                </div>
              </details>

              <div class="note"><strong>Print mode:</strong> use ‚ÄúPrint (clean)‚Äù for a simplified handover sheet.</div>
            </div>
          </div>
        </div>
      </article>

    </section>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <span aria-hidden="true">‚ú®</span>
    <span id="toastText">Ready.</span>
  </div>

  <script>
    // ---- Minimal, robust client-side interactivity (no dependencies) ----
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const q = $('#q');
    const chips = $$('.chip');
    const sections = $$('article.card');
    const navLinks = $$('#nav a');
    const hitsPill = $('#hitsPill');
    const toast = $('#toast');
    const toastText = $('#toastText');

    const state = {
      query: '',
      filters: new Set(),
      urgentOnly: false,
      routineOnly: false
    };

    function showToast(msg){
      toastText.textContent = msg;
      toast.classList.add('show');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.classList.remove('show'), 1600);
    }

    // Highlight search terms within visible sections (simple, safe, reversible)
    const originalHTML = new Map();
    sections.forEach(sec => originalHTML.set(sec, sec.innerHTML));

    function escapeRegExp(s){
      return s.replace(/[.*+?^${}()|[\\]\\]/g, '\\$&');
    }

    function applyHighlight(term){
      // Reset first
      sections.forEach(sec => { sec.innerHTML = originalHTML.get(sec); });
      if(!term) return;
      const t = term.trim();
      if(!t) return;
      const parts = t.split(/\s+/).filter(Boolean).slice(0,6);
      const re = new RegExp('(' + parts.map(escapeRegExp).join('|') + ')', 'gi');

      sections.forEach(sec => {
        // Avoid wrecking the DOM by only marking within text-y containers
        $$('.body, .detail, .hero', sec).forEach(node => {
          node.innerHTML = node.innerHTML.replace(re, '<mark>$1</mark>');
        });
      });
    }

    function matchesFilters(sec){
      const tags = (sec.getAttribute('data-tags') || '').split(/\s+/).filter(Boolean);
      const title = (sec.getAttribute('data-title') || '').toLowerCase();

      // Mode buttons
      if(state.urgentOnly && !tags.includes('urgent')) return false;
      if(state.routineOnly && !tags.includes('routine')) return false;

      if(state.filters.size === 0) return true;

      // Support filtering by: joint (hand/hip/knee), imaging, analgesia, referral, urgent, routine
      // Section-level tags cover most. For joint specificity, also inspect inline tags.
      const inline = (sec.textContent || '').toLowerCase();

      for(const f of state.filters){
        if(tags.includes(f)) continue;
        if(title.includes(f)) continue;
        if(['hand','hip','knee'].includes(f)){
          if(inline.includes('hand') && f==='hand') continue;
          if(inline.includes('hip') && f==='hip') continue;
          if(inline.includes('knee') && f==='knee') continue;
          return false;
        }
        // keyword-ish filters
        if(inline.includes(f)) continue;
        return false;
      }
      return true;
    }

    function matchesQuery(sec){
      const t = state.query.trim().toLowerCase();
      if(!t) return true;
      const hay = (sec.textContent || '').toLowerCase();
      return t.split(/\s+/).filter(Boolean).every(w => hay.includes(w));
    }

    function updateVisible(){
      let visible = 0;
      sections.forEach(sec => {
        const ok = matchesFilters(sec) && matchesQuery(sec);
        sec.style.display = ok ? '' : 'none';
        if(ok) visible++;
      });
      hitsPill.textContent = `${visible} visible`;
      // Update nav visibility based on section visibility
      navLinks.forEach(a => {
        const id = a.getAttribute('href').slice(1);
        const sec = document.getElementById(id);
        a.style.opacity = (sec && sec.style.display === 'none') ? 0.45 : 1;
      });
    }

    function setChipPressed(chip, pressed){
      chip.setAttribute('aria-pressed', pressed ? 'true' : 'false');
    }

    function syncChips(){
      chips.forEach(ch => {
        const f = ch.dataset.filter;
        if(f === 'urgent') setChipPressed(ch, state.urgentOnly);
        else if(f === 'routine') setChipPressed(ch, state.routineOnly);
        else setChipPressed(ch, state.filters.has(f));
      });
    }

    function resetAll(){
      state.query='';
      state.filters.clear();
      state.urgentOnly=false;
      state.routineOnly=false;
      q.value='';
      applyHighlight('');
      syncChips();
      updateVisible();
      showToast('Reset.');
    }

    // --- Chip interactions ---
    chips.forEach(chip => {
      chip.addEventListener('click', () => {
        const f = chip.dataset.filter;
        if(f === 'urgent'){
          state.urgentOnly = !state.urgentOnly;
          if(state.urgentOnly) state.routineOnly = false;
          showToast(state.urgentOnly ? 'Urgent flags only.' : 'Urgent filter off.');
        } else if(f === 'routine'){
          state.routineOnly = !state.routineOnly;
          if(state.routineOnly) state.urgentOnly = false;
          showToast(state.routineOnly ? 'Routine pathway focus.' : 'Routine filter off.');
        } else {
          if(state.filters.has(f)) state.filters.delete(f); else state.filters.add(f);
          showToast(state.filters.size ? `Filter: ${Array.from(state.filters).join(', ')}` : 'Filters cleared.');
        }
        syncChips();
        updateVisible();
      });
    });

    // --- Top buttons ---
    $('#btnUrgent').addEventListener('click', () => {
      state.urgentOnly = true;
      state.routineOnly = false;
      syncChips();
      updateVisible();
      showToast('Urgent flags only.');
      // Scroll to triage if visible
      document.getElementById('triage')?.scrollIntoView({behavior:'smooth', block:'start'});
    });

    $('#btnRoutine').addEventListener('click', () => {
      state.routineOnly = true;
      state.urgentOnly = false;
      syncChips();
      updateVisible();
      showToast('Routine pathway focus.');
      document.getElementById('initial')?.scrollIntoView({behavior:'smooth', block:'start'});
    });

    $('#btnReset').addEventListener('click', resetAll);

    // Print mode: add a class to simplify, then print
    $('#btnPrint').addEventListener('click', () => {
      document.body.classList.add('print');
      showToast('Opening print‚Ä¶');
      setTimeout(() => {
        window.print();
        setTimeout(() => document.body.classList.remove('print'), 300);
      }, 200);
    });

    // --- Search ---
    q.addEventListener('input', () => {
      state.query = q.value;
      applyHighlight(state.query);
      updateVisible();
      hitsPill.textContent = `${$$('article.card').filter(s => s.style.display !== 'none').length} visible`;
    });

    // Ctrl/‚åò + K focus search; Esc clears
    document.addEventListener('keydown', (e) => {
      const isMac = navigator.platform.toUpperCase().includes('MAC');
      const mod = isMac ? e.metaKey : e.ctrlKey;
      if(mod && e.key.toLowerCase() === 'k'){
        e.preventDefault();
        q.focus();
        q.select();
        showToast('Search focused.');
      }
      if(e.key === 'Escape'){
        if(document.activeElement === q || state.query){
          resetAll();
        }
      }
      // GitHub-like: G then U ‚Üí urgent
      if(e.key.toLowerCase() === 'g'){
        document._g = true;
        clearTimeout(document._gt);
        document._gt = setTimeout(() => (document._g=false), 600);
      } else if(document._g && e.key.toLowerCase() === 'u'){
        document._g = false;
        $('#btnUrgent').click();
      }
    });

    // --- Scrollspy ---
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if(entry.isIntersecting){
          const id = entry.target.id;
          navLinks.forEach(a => a.classList.toggle('active', a.getAttribute('href') === `#${id}`));
        }
      });
    }, { rootMargin: '-30% 0px -60% 0px', threshold: 0.01 });

    sections.forEach(sec => observer.observe(sec));

    // --- Navigation: smooth scroll + keep focus ---
    navLinks.forEach(a => {
      a.addEventListener('click', (e) => {
        e.preventDefault();
        const id = a.getAttribute('href').slice(1);
        const el = document.getElementById(id);
        if(!el) return;
        el.scrollIntoView({behavior:'smooth', block:'start'});
        history.replaceState(null, '', `#${id}`);
      });
    });

    // --- Print CSS injection ---
    const printStyle = document.createElement('style');
    printStyle.textContent = `
      @media print{
        .topbar, .sidebar, .toast, .actionbar{ display:none !important; }
        body{ background: #fff !important; color: #111 !important; }
        .wrap{ grid-template-columns: 1fr !important; max-width: 900px !important; }
        .card, .hero{ box-shadow:none !important; border: 1px solid #ddd !important; background:#fff !important; }
        .tag, .flag{ border: 1px solid #ccc !important; background:#f7f7f7 !important; color:#111 !important; }
        mark{ background: #ffe7b3 !important; color:#111 !important; }
        a{ text-decoration:none !important; color:#111 !important; }
      }
    `;
    document.head.appendChild(printStyle);

    // Initial render
    syncChips();
    updateVisible();
    showToast('Ready.');
  </script>
</body>
</html>
