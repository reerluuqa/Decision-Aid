<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Knee Pain ‚Äì Assessment (Clinical Decision Support)</title>
  <style>
    :root{
      --bg: #0b1220;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.54);
      --line: rgba(255,255,255,.10);

      --urgent: #ff4d6d;
      --urgent2:#ffb3c1;
      --routine:#4dd4ac;
      --routine2:#a6f3df;

      --amber:#ffbf3c;
      --blue:#4aa3ff;
      --violet:#b892ff;

      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(74,163,255,.18), transparent 60%),
        radial-gradient(900px 700px at 85% 15%, rgba(255,77,109,.14), transparent 55%),
        radial-gradient(1000px 800px at 70% 85%, rgba(77,212,172,.14), transparent 55%),
        linear-gradient(180deg, #070b14, var(--bg));
      line-height:1.35;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{
      max-width: 1180px;
      margin: 0 auto;
      padding: 22px 18px 80px;
      display:grid;
      gap:18px;
    }

    /* Top header */
    header.hero{
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .hero-inner{
      padding: 20px 18px 14px;
      display:flex;
      align-items:flex-start;
      gap:14px;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      flex: 1 1 auto;
      min-width: 260px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.35), transparent 60%),
        linear-gradient(135deg, rgba(255,77,109,.85), rgba(74,163,255,.85));
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.18);
      flex: 0 0 auto;
    }
    .logo svg{ opacity:.95; }
    h1{
      margin:0;
      font-size: 20px;
      letter-spacing: .2px;
    }
    .subtitle{
      margin-top:6px;
      color: var(--muted);
      font-size: 13px;
      max-width: 72ch;
    }

    .hero-actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex: 0 0 auto;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .chip{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding:8px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      display:flex;
      gap:8px;
      align-items:center;
      user-select:none;
    }
    .chip b{ color: var(--text); font-weight:650; }
    .btn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
      color: var(--text);
      padding:9px 12px;
      border-radius: 12px;
      font-size: 13px;
      cursor:pointer;
      display:inline-flex;
      gap:8px;
      align-items:center;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.22); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(77,212,172,.30), rgba(74,163,255,.22));
      border-color: rgba(166,243,223,.28);
    }

    /* Sticky nav + command bar */
    .bar{
      position: sticky;
      top: 10px;
      z-index: 50;
      border:1px solid var(--line);
      background: rgba(10,16,30,.65);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .bar-top{
      padding: 12px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .search{
      flex: 1 1 280px;
      display:flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      min-width: 250px;
    }
    .search input{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 13px;
    }
    .search input::placeholder{ color: rgba(255,255,255,.45); }
    .filters{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .toggle{
      display:flex;
      gap:8px;
      align-items:center;
      padding: 9px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size: 12px;
      color: var(--muted);
      cursor:pointer;
      user-select:none;
      transition: background .2s ease, border-color .2s ease;
    }
    .toggle:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.22); }
    .toggle input{ accent-color: var(--blue); }
    .nav{
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex;
      gap:8px;
      padding: 10px 12px;
      overflow:auto;
      scrollbar-width: thin;
    }
    .nav a{
      flex: 0 0 auto;
      padding: 9px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      font-size: 12px;
      color: var(--muted);
      display:inline-flex;
      gap:8px;
      align-items:center;
      transition: background .2s ease, transform .08s ease;
    }
    .nav a:hover{ background: rgba(255,255,255,.09); }
    .nav a:active{ transform: translateY(1px); }
    .pill-dot{
      width:8px; height:8px; border-radius: 999px;
      background: rgba(255,255,255,.25);
    }
    .pill-dot.urgent{ background: var(--urgent); }
    .pill-dot.routine{ background: var(--routine); }
    .pill-dot.tools{ background: var(--amber); }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1.35fr .9fr;
      gap: 18px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* Panels */
    .panel{
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel-head{
      padding: 14px 16px 12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    }
    .panel-head h2{
      margin:0;
      font-size: 15px;
      letter-spacing: .2px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .panel-head p{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 12.5px;
      max-width: 85ch;
    }
    .panel-body{ padding: 14px 16px 16px; }

    .badge{
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      display:inline-flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }
    .badge.urgent{
      border-color: rgba(255,77,109,.35);
      background: rgba(255,77,109,.10);
      color: rgba(255,255,255,.88);
    }
    .badge.routine{
      border-color: rgba(77,212,172,.35);
      background: rgba(77,212,172,.10);
      color: rgba(255,255,255,.88);
    }
    .badge.tools{
      border-color: rgba(255,191,60,.35);
      background: rgba(255,191,60,.10);
      color: rgba(255,255,255,.88);
    }

    /* Action boxes */
    .action{
      border-radius: var(--radius);
      padding: 12px 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      display:grid;
      gap:10px;
    }
    .action.urgent{
      border-color: rgba(255,77,109,.32);
      background: linear-gradient(180deg, rgba(255,77,109,.16), rgba(255,255,255,.04));
    }
    .action.routine{
      border-color: rgba(77,212,172,.30);
      background: linear-gradient(180deg, rgba(77,212,172,.14), rgba(255,255,255,.04));
    }
    .action .row{
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .icon{
      width: 34px; height:34px;
      border-radius: 12px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
      margin-top:1px;
    }
    .action.urgent .icon{ background: rgba(255,77,109,.12); border-color: rgba(255,77,109,.30); }
    .action.routine .icon{ background: rgba(77,212,172,.12); border-color: rgba(77,212,172,.28); }
    .action h3{ margin:0; font-size: 13.5px; }
    .action p{ margin:6px 0 0; color: var(--muted); font-size: 12.5px; }
    .action ul{ margin:8px 0 0 18px; color: rgba(255,255,255,.84); font-size: 12.7px; }
    .action li{ margin: 6px 0; }
    .mini{
      font-size: 11.5px;
      color: var(--muted2);
    }

    /* Steps */
    .steps{
      display:grid;
      gap:10px;
    }
    .step{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      padding: 12px 12px;
      display:grid;
      gap:8px;
    }
    .step-top{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
    }
    .kicker{
      display:flex; gap:10px; align-items:center;
      min-width: 0;
    }
    .num{
      width:28px; height:28px;
      border-radius: 12px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(74,163,255,.12);
      font-weight: 700;
      font-size: 12px;
    }
    .step h4{
      margin:0;
      font-size: 13px;
      letter-spacing:.15px;
    }
    .step .hint{ margin:0; color: var(--muted); font-size: 12.5px; }
    .chips{
      display:flex; flex-wrap:wrap; gap:6px;
      margin-top: 2px;
    }
    .tag{
      font-size: 11px;
      padding: 5px 9px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      white-space:nowrap;
      user-select:none;
    }
    .tag.u{ border-color: rgba(255,77,109,.26); background: rgba(255,77,109,.10); color: rgba(255,255,255,.86); }
    .tag.r{ border-color: rgba(77,212,172,.26); background: rgba(77,212,172,.10); color: rgba(255,255,255,.86); }
    .tag.t{ border-color: rgba(255,191,60,.26); background: rgba(255,191,60,.10); color: rgba(255,255,255,.86); }

    /* Accordion */
    details.acc{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      overflow:hidden;
    }
    details.acc + details.acc{ margin-top: 10px; }
    details.acc summary{
      list-style:none;
      cursor:pointer;
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      user-select:none;
    }
    details.acc summary::-webkit-details-marker{ display:none; }
    .sum-left{
      display:flex; gap:10px; align-items:center;
      min-width: 0;
    }
    .chev{
      width:28px; height:28px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      display:grid; place-items:center;
      transition: transform .18s ease;
      flex: 0 0 auto;
    }
    details[open] .chev{ transform: rotate(90deg); }
    .sum-text{
      display:grid;
      gap:3px;
      min-width: 0;
    }
    .sum-text b{
      font-size: 13px;
      letter-spacing: .12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sum-text span{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .acc-body{
      padding: 0 12px 12px;
      border-top: 1px solid rgba(255,255,255,.08);
    }

    /* Checklists */
    .checklist{
      display:grid;
      gap:8px;
      margin-top: 10px;
    }
    .check{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding: 10px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
    }
    .check input{
      margin-top: 3px;
      width: 16px; height:16px;
      accent-color: var(--blue);
      flex: 0 0 auto;
    }
    .check .txt{
      display:grid;
      gap:3px;
    }
    .check .txt b{ font-size: 12.8px; }
    .check .txt span{ color: var(--muted); font-size: 12.3px; }
    .callout{
      margin-top: 10px;
      border-radius: 16px;
      padding: 12px 12px;
      border:1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.04);
    }
    .callout .k{
      display:flex; gap:10px; align-items:center;
      font-size: 12.6px;
      font-weight: 650;
    }
    .callout p{ margin:8px 0 0; color: var(--muted); font-size: 12.5px; }
    .mono{ font-family: var(--mono); font-size: 12px; color: rgba(255,255,255,.84); }

    /* Right column sticky */
    .side{
      position: sticky;
      top: 90px;
      display:grid;
      gap: 14px;
    }
    @media (max-width: 980px){
      .side{ position: static; }
    }

    /* Flags */
    .flags{
      display:grid;
      gap:10px;
    }
    .flag{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      padding: 12px 12px;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .flag .dot{
      width:10px;height:10px;border-radius:999px;margin-top:5px;
      background: rgba(255,255,255,.25);
      flex: 0 0 auto;
    }
    .flag.urgent .dot{ background: var(--urgent); }
    .flag.routine .dot{ background: var(--routine); }
    .flag .t{
      display:grid; gap:3px;
    }
    .flag b{ font-size: 12.8px; }
    .flag span{ color: var(--muted); font-size: 12.3px; }
    .hide{ display:none !important; }

    /* Footer */
    footer{
      margin-top: 4px;
      color: var(--muted2);
      font-size: 11.5px;
      text-align:center;
    }

    /* Print */
    @media print{
      body{ background:#fff; color:#111; }
      .bar, .hero-actions, .btn, .toggle{ display:none !important; }
      .panel{ box-shadow:none; border-color:#ddd; }
      .panel-head{ background:#f7f7f7; }
      a{ text-decoration:underline; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="hero" id="top">
      <div class="hero-inner">
        <div class="brand">
          <div class="logo" aria-hidden="true" title="Clinical decision support">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <path d="M12 2c-2.8 0-5 2.2-5 5v1.1c0 .6-.2 1.1-.6 1.5L4.9 12c-.6.6-.9 1.3-.9 2.1V19c0 1.7 1.3 3 3 3h10c1.7 0 3-1.3 3-3v-4.9c0-.8-.3-1.5-.9-2.1l-1.5-1.4c-.4-.4-.6-.9-.6-1.5V7c0-2.8-2.2-5-5-5Z" stroke="rgba(255,255,255,.85)" stroke-width="1.6" />
              <path d="M9 14h6M12 11v6" stroke="rgba(255,255,255,.85)" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </div>
          <div>
            <h1>Knee Pain ‚Äì Assessment</h1>
            <div class="subtitle">
              Rapid triage + structured assessment (history, exam, fracture exclusion, red flags, investigations, referral pathways).
              Designed for high scanning efficiency and point-of-care use.
            </div>
          </div>
        </div>

        <div class="hero-actions">
          <div class="chip" title="Designed for quick scanning">
            <span class="pill-dot urgent"></span><b>Urgent</b> split
            <span style="opacity:.45">‚Ä¢</span>
            <span class="pill-dot routine"></span><b>Routine</b> split
          </div>
          <button class="btn primary" id="btnExpandAll" title="Expand all accordion panels">
            <span aria-hidden="true">‚ñæ</span> Expand all
          </button>
          <button class="btn" id="btnCollapseAll" title="Collapse all accordion panels">
            <span aria-hidden="true">‚ñ∏</span> Collapse
          </button>
          <button class="btn" id="btnPrint" title="Print-friendly view">
            <span aria-hidden="true">‚éô</span> Print
          </button>
        </div>
      </div>
    </header>

    <!-- Sticky command bar -->
    <div class="bar" role="navigation" aria-label="Quick navigation and filters">
      <div class="bar-top">
        <div class="search" role="search">
          <span aria-hidden="true">üîé</span>
          <input id="q" type="search" placeholder="Search sections (e.g., 'Ottawa', 'septic', 'effusion', 'ACL', 'tumour', 'synovitis')‚Ä¶" />
        </div>

        <div class="filters">
          <label class="toggle" title="Show only urgent / time-critical content">
            <input type="checkbox" id="fUrgent" />
            Urgent-only
          </label>
          <label class="toggle" title="Show only routine (non-urgent) assessment content">
            <input type="checkbox" id="fRoutine" />
            Routine-only
          </label>
          <label class="toggle" title="Highlight traumatic pathway content">
            <input type="checkbox" id="fTrauma" />
            Trauma focus
          </label>
          <label class="toggle" title="Persist filters across refresh (local only)">
            <input type="checkbox" id="fPersist" checked />
            Remember
          </label>
        </div>
      </div>

      <div class="nav" id="nav">
        <a href="#triage"><span class="pill-dot urgent"></span> Triage</a>
        <a href="#workflow"><span class="pill-dot tools"></span> Workflow</a>
        <a href="#history"><span class="pill-dot routine"></span> History</a>
        <a href="#exam"><span class="pill-dot routine"></span> Examination</a>
        <a href="#ottawa"><span class="pill-dot tools"></span> Ottawa knee rule</a>
        <a href="#redflags"><span class="pill-dot urgent"></span> Red flags</a>
        <a href="#differential"><span class="pill-dot routine"></span> Differential map</a>
        <a href="#investigations"><span class="pill-dot routine"></span> Investigations</a>
        <a href="#referral"><span class="pill-dot urgent"></span> Referral pathways</a>
      </div>
    </div>

    <div class="grid">
      <!-- Main column -->
      <main class="main" id="content">
        <!-- TRIAGE -->
        <section class="panel" id="triage" data-tags="urgent">
          <div class="panel-head">
            <div>
              <h2>
                <span class="badge urgent"><span aria-hidden="true">‚ö†Ô∏è</span> Urgent triage</span>
                Immediate / time-critical pathways
              </h2>
              <p>Use this first when presentation is acute, systemically unwell, post-trauma, or unable to weight bear.</p>
            </div>
            <div class="badge tools" title="Interactive triage flags"><span aria-hidden="true">üß†</span> Live flags</div>
          </div>

          <div class="panel-body">
            <div class="action urgent" id="triageAction">
              <div class="row">
                <div class="icon" aria-hidden="true">
                  <span style="font-size:18px">üöë</span>
                </div>
                <div>
                  <h3>Refer for immediate specialist assessment if ANY apply</h3>
                  <p>Ticking items below will automatically raise an ‚ÄúUrgent‚Äù banner on the right.</p>
                </div>
              </div>

              <div class="checklist" data-flaggroup="immediate">
                <label class="check">
                  <input type="checkbox" class="flag" data-flag="Septic arthritis suspected or cannot be excluded" data-level="urgent" />
                  <div class="txt">
                    <b>Septic arthritis suspected / cannot be excluded</b>
                    <span>Hot, swollen joint + marked movement restriction ¬± systemic illness.</span>
                  </div>
                </label>

                <label class="check">
                  <input type="checkbox" class="flag" data-flag="Slipped capital femoral epiphysis suspected" data-level="urgent" />
                  <div class="txt">
                    <b>Suspected SCFE (especially in children / adolescents)</b>
                    <span>Consider when knee pain with abnormal hip exam / limp.</span>
                  </div>
                </label>

                <label class="check">
                  <input type="checkbox" class="flag" data-flag="Fracture cannot be excluded (use Ottawa knee rule)" data-level="urgent" />
                  <div class="txt">
                    <b>Fracture cannot be excluded</b>
                    <span>Use Ottawa knee rule; inability to weight bear after injury is high-impact.</span>
                  </div>
                </label>

                <label class="check">
                  <input type="checkbox" class="flag" data-flag="Neurovascular compromise / compartment syndrome after trauma" data-level="urgent" />
                  <div class="txt">
                    <b>Neurovascular damage / compartment syndrome features after trauma</b>
                    <span>Loss of sensation/weakness, absent/asymmetric pulses, escalating pain.</span>
                  </div>
                </label>

                <label class="check">
                  <input type="checkbox" class="flag" data-flag="Quadriceps or patellar tendon rupture suspected" data-level="urgent" />
                  <div class="txt">
                    <b>Quadriceps or patellar tendon rupture suspected</b>
                    <span>Inability to straight leg raise/extend knee; patellar height change; palpable gap.</span>
                  </div>
                </label>

                <label class="check">
                  <input type="checkbox" class="flag" data-flag="First-time traumatic patellar dislocation (or recurrent with moderate/severe swelling)" data-level="urgent" />
                  <div class="txt">
                    <b>First-time traumatic patellar dislocation</b>
                    <span>Or recurrent dislocation with moderate/severe swelling.</span>
                  </div>
                </label>

                <label class="check">
                  <input type="checkbox" class="flag" data-flag="Severe soft-tissue injury with gross instability" data-level="urgent" />
                  <div class="txt">
                    <b>Severe soft-tissue injury + gross instability</b>
                    <span>High-energy mechanism, instability, major swelling, inability to continue activity.</span>
                  </div>
                </label>
              </div>

              <div class="callout">
                <div class="k"><span aria-hidden="true">üß≠</span> Trauma ‚Äúsignificant soft tissue injury‚Äù trigger (acute knee pain post-trauma)</div>
                <p class="mini">Consider urgent assessment / fracture clinic / acute knee clinic depending on local arrangements when any are present:
                  <span class="mono">‚Äúpop/snap‚Äù, effusion (rapid or gradual), inability to complete activity, instability, locking, giving way, difficulty weight bearing.</span>
                </p>
              </div>
            </div>
          </div>
        </section>

        <!-- WORKFLOW -->
        <section class="panel" id="workflow" data-tags="routine tools">
          <div class="panel-head">
            <div>
              <h2><span class="badge tools"><span aria-hidden="true">üß©</span> Stepwise workflow</span> Efficient assessment sequence</h2>
              <p>Use as a structured ‚Äúrunway‚Äù: triage ‚Üí characterize ‚Üí examine ‚Üí exclude fracture ‚Üí screen red flags ‚Üí targeted tests/referral.</p>
            </div>
            <div class="badge routine"><span aria-hidden="true">‚úÖ</span> Scannable</div>
          </div>

          <div class="panel-body">
            <div class="steps">
              <div class="step" data-tags="urgent routine">
                <div class="step-top">
                  <div class="kicker">
                    <div class="num">1</div>
                    <div>
                      <h4>Immediate safety screen</h4>
                      <p class="hint">Systemic illness, hot swollen joint, inability to weight bear, neurovascular compromise, major trauma.</p>
                      <div class="chips">
                        <span class="tag u">Urgent</span><span class="tag t">Trauma</span>
                      </div>
                    </div>
                  </div>
                  <a class="btn" href="#triage" title="Jump to triage">Go</a>
                </div>
              </div>

              <div class="step" data-tags="routine">
                <div class="step-top">
                  <div class="kicker">
                    <div class="num">2</div>
                    <div>
                      <h4>History characterization</h4>
                      <p class="hint">Trauma vs non-trauma; onset; pain pattern; swelling timing; mechanical symptoms; systemic features; risk factors.</p>
                      <div class="chips">
                        <span class="tag r">Routine</span>
                      </div>
                    </div>
                  </div>
                  <a class="btn" href="#history" title="Jump to history">Go</a>
                </div>
              </div>

              <div class="step" data-tags="routine">
                <div class="step-top">
                  <div class="kicker">
                    <div class="num">3</div>
                    <div>
                      <h4>Examination</h4>
                      <p class="hint">Compare both knees; ROM; effusion; adjacent joints (hip/ankle/spine); gait/weight bearing; septic signs.</p>
                      <div class="chips">
                        <span class="tag r">Routine</span>
                      </div>
                    </div>
                  </div>
                  <a class="btn" href="#exam" title="Jump to exam">Go</a>
                </div>
              </div>

              <div class="step" data-tags="tools trauma">
                <div class="step-top">
                  <div class="kicker">
                    <div class="num">4</div>
                    <div>
                      <h4>Exclude fracture (Ottawa knee rule)</h4>
                      <p class="hint">If post-injury and any Ottawa criterion present ‚Üí knee X-ray.</p>
                      <div class="chips">
                        <span class="tag t">Tool</span><span class="tag u">Time-critical</span>
                      </div>
                    </div>
                  </div>
                  <a class="btn" href="#ottawa" title="Jump to Ottawa rule">Go</a>
                </div>
              </div>

              <div class="step" data-tags="urgent">
                <div class="step-top">
                  <div class="kicker">
                    <div class="num">5</div>
                    <div>
                      <h4>Red flags: infection, tumour, inflammatory polyarthritis</h4>
                      <p class="hint">Night/rest bone pain, unexplained weight loss, persistent synovitis, hot joint + severe restriction.</p>
                      <div class="chips">
                        <span class="tag u">Urgent</span>
                      </div>
                    </div>
                  </div>
                  <a class="btn" href="#redflags" title="Jump to red flags">Go</a>
                </div>
              </div>

              <div class="step" data-tags="routine">
                <div class="step-top">
                  <div class="kicker">
                    <div class="num">6</div>
                    <div>
                      <h4>Focused investigations / referral</h4>
                      <p class="hint">Most cases: no routine tests in primary care; do not delay indicated referral for results.</p>
                      <div class="chips">
                        <span class="tag r">Routine</span>
                      </div>
                    </div>
                  </div>
                  <a class="btn" href="#investigations" title="Jump to investigations">Go</a>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- HISTORY -->
        <section class="panel" id="history" data-tags="routine">
          <div class="panel-head">
            <div>
              <h2><span class="badge routine"><span aria-hidden="true">üßæ</span> History</span> High-yield prompts</h2>
              <p>Prioritize discriminators: trauma mechanism, swelling timing, night/rest pain, mechanical symptoms, systemic features, multi-joint disease.</p>
            </div>
            <div class="badge tools"><span aria-hidden="true">‚åÅ</span> Accordion</div>
          </div>

          <div class="panel-body">
            <details class="acc" open data-tags="routine">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>Core history set</b>
                    <span>Trauma, laterality, onset, pain quality, triggers, swelling, stiffness, locking/giving way, systemic symptoms.</span>
                  </div>
                </div>
                <span class="badge routine">Routine</span>
              </summary>
              <div class="acc-body">
                <div class="checklist">
                  <label class="check">
                    <input type="checkbox" />
                    <div class="txt">
                      <b>Trauma?</b>
                      <span>Mechanism, immediate functional loss, ability to continue activity.</span>
                    </div>
                  </label>
                  <label class="check">
                    <input type="checkbox" />
                    <div class="txt">
                      <b>One knee vs both knees; other joints involved?</b>
                      <span>Polyarticular pattern raises inflammatory differential.</span>
                    </div>
                  </label>
                  <label class="check">
                    <input type="checkbox" />
                    <div class="txt">
                      <b>Pain characterization</b>
                      <span>Location, severity, radiation, quality, intermittent vs constant; triggers (stairs, squatting, twisting, rest).</span>
                    </div>
                  </label>
                  <label class="check">
                    <input type="checkbox" />
                    <div class="txt">
                      <b>Night/rest pain</b>
                      <span>Marked night or rest pain suggests tumour / inflammatory arthritis / severe OA.</span>
                    </div>
                  </label>
                  <label class="check">
                    <input type="checkbox" />
                    <div class="txt">
                      <b>Swelling timing</b>
                      <span>Acute painful swelling without trauma ‚Üí septic/inflammatory arthritis; post-trauma effusion timing is informative.</span>
                    </div>
                  </label>
                  <div class="callout">
                    <div class="k"><span aria-hidden="true">‚è±Ô∏è</span> Effusion timing heuristic (post-trauma)</div>
                    <p>
                      Rapid large tense effusion within <span class="mono">‚â§2 hours</span> ‚Üí fracture / ligament rupture (often ACL) / patellar dislocation.
                      Slower mild‚Äìmoderate effusion <span class="mono">24‚Äì36 hours</span> ‚Üí meniscal injury or ligament sprain.
                    </p>
                  </div>
                  <label class="check">
                    <input type="checkbox" />
                    <div class="txt">
                      <b>Mechanical symptoms</b>
                      <span>Locking, catching, giving way; tearing sensation; ‚Äúpop‚Äù at injury.</span>
                    </div>
                  </label>
                  <label class="check">
                    <input type="checkbox" />
                    <div class="txt">
                      <b>Systemic features</b>
                      <span>Fever, night sweats, rash, fatigue; weight loss.</span>
                    </div>
                  </label>
                  <label class="check">
                    <input type="checkbox" />
                    <div class="txt">
                      <b>Past history / risk context</b>
                      <span>Prior injuries/surgery; gout/pseudogout; RA/psoriasis/IBD/uveitis; immunosuppression; recent infection.</span>
                    </div>
                  </label>
                </div>
              </div>
            </details>

            <details class="acc" data-tags="trauma routine">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>Trauma mechanism map</b>
                    <span>Blow, twisting/pivot, hyperextension, deceleration: link to likely injured structures.</span>
                  </div>
                </div>
                <span class="badge tools">Tool</span>
              </summary>
              <div class="acc-body">
                <div class="flags">
                  <div class="flag">
                    <div class="dot" style="background:var(--blue)"></div>
                    <div class="t">
                      <b>Direct blow ‚Äì anterior knee</b>
                      <span>Patellar fracture; PCL if knee flexed; ACL if hyperextended.</span>
                    </div>
                  </div>
                  <div class="flag">
                    <div class="dot" style="background:var(--violet)"></div>
                    <div class="t">
                      <b>Direct blow ‚Äì lateral knee</b>
                      <span>MCL injury or patellar dislocation.</span>
                    </div>
                  </div>
                  <div class="flag">
                    <div class="dot" style="background:var(--amber)"></div>
                    <div class="t">
                      <b>Twisting/pivoting</b>
                      <span>Meniscal injury; ACL injury; if twist with knee extended ‚Üí patellar subluxation/dislocation.</span>
                    </div>
                  </div>
                  <div class="flag">
                    <div class="dot" style="background:rgba(255,255,255,.25)"></div>
                    <div class="t">
                      <b>Sudden deceleration / stopping</b>
                      <span>ACL injury pattern.</span>
                    </div>
                  </div>
                </div>
              </div>
            </details>
          </div>
        </section>

        <!-- EXAM -->
        <section class="panel" id="exam" data-tags="routine">
          <div class="panel-head">
            <div>
              <h2><span class="badge routine"><span aria-hidden="true">ü©∫</span> Examination</span> Compare, localize, and screen</h2>
              <p>Assess both knees and surrounding structures; include hip/ankle/spine (especially in children) to detect referred pain.</p>
            </div>
            <div class="badge tools"><span aria-hidden="true">üéØ</span> Key tests</div>
          </div>

          <div class="panel-body">
            <details class="acc" open data-tags="routine">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>Core exam sequence</b>
                    <span>Inspect ‚Üí palpate ‚Üí ROM ‚Üí gait/weight-bearing ‚Üí adjacent joints ‚Üí septic screen.</span>
                  </div>
                </div>
                <span class="badge routine">Routine</span>
              </summary>
              <div class="acc-body">
                <div class="checklist">
                  <label class="check"><input type="checkbox"/><div class="txt"><b>Inspect</b><span>Wounds, erythema/rash, deformity, atrophy, swelling.</span></div></label>
                  <label class="check"><input type="checkbox"/><div class="txt"><b>Palpate</b><span>Warmth, effusion/bursal swelling, tenderness (bony vs soft tissue).</span></div></label>
                  <label class="check"><input type="checkbox"/><div class="txt"><b>ROM</b><span>Flex/extend; compare to contralateral side (typical: 0¬∞ extension to 135¬∞ flexion).</span></div></label>
                  <label class="check"><input type="checkbox"/><div class="txt"><b>Crepitus with movement</b><span>Document but interpret in context.</span></div></label>
                  <label class="check"><input type="checkbox"/><div class="txt"><b>Gait + ability to weight bear</b><span>Functional discriminator; key post-injury.</span></div></label>
                  <label class="check"><input type="checkbox"/><div class="txt"><b>Examine hip/ankle/spine</b><span>Particularly in children to assess referred pain sources.</span></div></label>
                  <label class="check">
                    <input type="checkbox" class="flag" data-flag="Septic arthritis screen positive (fever/hot swollen knee/marked restriction)" data-level="urgent" />
                    <div class="txt">
                      <b>Septic arthritis screen</b>
                      <span>Fever, swelling, erythema, limited ROM; consider risk factors.</span>
                    </div>
                  </label>
                </div>
              </div>
            </details>

            <details class="acc" data-tags="trauma tools">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>Post-trauma essentials</b>
                    <span>Straight leg raise; patellar position; ligament laxity tests (interpret cautiously).</span>
                  </div>
                </div>
                <span class="badge tools">Tool</span>
              </summary>
              <div class="acc-body">
                <div class="flags">
                  <div class="flag">
                    <div class="dot" style="background:var(--amber)"></div>
                    <div class="t">
                      <b>Active straight leg raise</b>
                      <span>Inability suggests extensor mechanism injury.</span>
                    </div>
                  </div>
                  <div class="flag">
                    <div class="dot" style="background:var(--violet)"></div>
                    <div class="t">
                      <b>Patellar height / alignment</b>
                      <span>Patella typically lateral in dislocation; proximal migration in patellar tendon rupture; distal in quadriceps rupture.</span>
                    </div>
                  </div>
                  <div class="flag">
                    <div class="dot" style="background:var(--blue)"></div>
                    <div class="t">
                      <b>Laxity tests (limited accuracy in non-specialist settings)</b>
                      <span>Valgus/varus (collaterals), Lachman/anterior drawer (ACL), posterior drawer/sag (PCL).</span>
                    </div>
                  </div>
                </div>

                <div class="callout">
                  <div class="k"><span aria-hidden="true">üß∑</span> Meniscal provocative tests</div>
                  <p>McMurray/Thessaly/Apley have poor diagnostic accuracy in non-specialist settings; do not over-weight them in isolation.</p>
                </div>
              </div>
            </details>
          </div>
        </section>

        <!-- OTTAWA -->
        <section class="panel" id="ottawa" data-tags="tools trauma urgent">
          <div class="panel-head">
            <div>
              <h2><span class="badge tools"><span aria-hidden="true">ü¶¥</span> Ottawa knee rule</span> Fracture exclusion decision aid</h2>
              <p>Knee X-ray after injury is required if <b>any</b> Ottawa criterion is present (age &gt;2 years).</p>
            </div>
            <div class="badge urgent"><span aria-hidden="true">‚è±Ô∏è</span> Time-critical</div>
          </div>

          <div class="panel-body">
            <div class="action urgent">
              <div class="row">
                <div class="icon" aria-hidden="true"><span style="font-size:18px">üì∏</span></div>
                <div>
                  <h3>Order knee X-ray if ANY of the following are present</h3>
                  <p>Ticking items will raise an ‚ÄúOttawa positive‚Äù urgent flag.</p>
                </div>
              </div>

              <div class="checklist" id="ottawaList">
                <label class="check">
                  <input type="checkbox" class="ottawa" data-flag="Ottawa positive: cannot weight bear 4 steps (immediate + in consultation)" />
                  <div class="txt">
                    <b>Cannot weight bear 4 steps</b>
                    <span>Immediate post-injury and during assessment (4 steps = transfer weight twice onto each limb, regardless of limp).</span>
                  </div>
                </label>
                <label class="check">
                  <input type="checkbox" class="ottawa" data-flag="Ottawa positive: cannot flex to 90¬∞" />
                  <div class="txt"><b>Cannot flex knee to 90¬∞</b><span>Functional restriction criterion.</span></div>
                </label>
                <label class="check">
                  <input type="checkbox" class="ottawa" data-flag="Ottawa positive: fibular head tenderness" />
                  <div class="txt"><b>Fibular head tenderness</b><span>Posterolateral bony tenderness.</span></div>
                </label>
                <label class="check">
                  <input type="checkbox" class="ottawa" data-flag="Ottawa positive: isolated patellar tenderness" />
                  <div class="txt"><b>Isolated patellar tenderness</b><span>No other bony tenderness of knee aside from patella.</span></div>
                </label>
                <label class="check">
                  <input type="checkbox" class="ottawa" data-flag="Ottawa positive: age ‚â•55" />
                  <div class="txt"><b>Age ‚â•55 years</b><span>Age criterion.</span></div>
                </label>
              </div>

              <div class="callout" id="ottawaResult">
                <div class="k"><span aria-hidden="true">üßæ</span> Ottawa status: <span id="ottawaStatus" class="mono">Not assessed</span></div>
                <p id="ottawaAdvice">Tick criteria above to calculate.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- RED FLAGS -->
        <section class="panel" id="redflags" data-tags="urgent">
          <div class="panel-head">
            <div>
              <h2><span class="badge urgent"><span aria-hidden="true">üö®</span> Red flags</span> Serious pathology screen</h2>
              <p>Infection (septic arthritis/osteomyelitis), tumour, and inflammatory polyarthritis indicators.</p>
            </div>
            <div class="badge tools"><span aria-hidden="true">üß†</span> Flags</div>
          </div>

          <div class="panel-body">
            <details class="acc" open data-tags="urgent">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>Infection: septic arthritis / osteomyelitis</b>
                    <span>Hot swollen knee + severe movement restriction ¬± systemic illness; risk factors matter.</span>
                  </div>
                </div>
                <span class="badge urgent">Urgent</span>
              </summary>
              <div class="acc-body">
                <div class="checklist">
                  <label class="check">
                    <input type="checkbox" class="flag" data-level="urgent" data-flag="Hot swollen knee with severely restricted movement (pain on any movement)" />
                    <div class="txt"><b>Severely restricted movement (pain on any attempted movement)</b><span>Especially with redness/swelling/heat.</span></div>
                  </label>
                  <label class="check">
                    <input type="checkbox" class="flag" data-level="urgent" data-flag="Systemically unwell ¬± fever (fever absence does not exclude)" />
                    <div class="txt"><b>Systemically unwell ¬± fever</b><span>Absence of fever does not exclude septic arthritis.</span></div>
                  </label>
                  <label class="check">
                    <input type="checkbox" class="flag" data-level="urgent" data-flag="Severe pain out of proportion (esp. with pre-existing joint disease)" />
                    <div class="txt"><b>Pain out of proportion</b><span>Especially if RA/OA baseline symptoms exceeded.</span></div>
                  </label>
                  <label class="check">
                    <input type="checkbox" class="flag" data-level="urgent" data-flag="Difficulty weight bearing (esp. children/limp)" />
                    <div class="txt"><b>Difficulty weight bearing / limp</b><span>Particularly in children.</span></div>
                  </label>
                  <div class="callout">
                    <div class="k"><span aria-hidden="true">üß¨</span> Infection risk factors (raise suspicion)</div>
                    <p class="mini">
                      Recent joint surgery or corticosteroid injection, prosthetic joint, RA/other joint disease, open fracture history,
                      previous orthopaedic surgery, IV drug use, immunosuppression (e.g., diabetes, long-term steroids, alcoholism),
                      adjacent discharging sinus, skin infection/ulceration.
                    </p>
                  </div>
                </div>
              </div>
            </details>

            <details class="acc" data-tags="urgent">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>Tumour indicators</b>
                    <span>Persistent non-mechanical bone pain, night/rest pain, weight loss, mass, prior cancer.</span>
                  </div>
                </div>
                <span class="badge urgent">Urgent</span>
              </summary>
              <div class="acc-body">
                <div class="checklist">
                  <label class="check"><input type="checkbox" class="flag" data-level="urgent" data-flag="Persistent non-mechanical bone pain" />
                    <div class="txt"><b>Persistent non-mechanical bone pain</b><span>Not activity-linked; progressive.</span></div>
                  </label>
                  <label class="check"><input type="checkbox" class="flag" data-level="urgent" data-flag="Pain at night or at rest" />
                    <div class="txt"><b>Pain at night or at rest</b><span>Especially worsening.</span></div>
                  </label>
                  <label class="check"><input type="checkbox" class="flag" data-level="urgent" data-flag="Unexplained weight loss" />
                    <div class="txt"><b>Unexplained weight loss</b><span>Systemic feature.</span></div>
                  </label>
                  <label class="check"><input type="checkbox" class="flag" data-level="urgent" data-flag="Previous cancer" />
                    <div class="txt"><b>Previous cancer</b><span>Consider metastasis risk.</span></div>
                  </label>
                  <label class="check"><input type="checkbox" class="flag" data-level="urgent" data-flag="Hard localised mass adjacent to knee / increasing lump" />
                    <div class="txt"><b>Hard localised mass or enlarging lump</b><span>Swelling may be late.</span></div>
                  </label>
                  <label class="check"><input type="checkbox" class="flag" data-level="urgent" data-flag="Sudden onset pain suggesting pathological fracture/osteonecrosis" />
                    <div class="txt"><b>Sudden onset pain</b><span>May indicate pathological fracture (also can occur in osteonecrosis).</span></div>
                  </label>
                </div>
              </div>
            </details>

            <details class="acc" data-tags="urgent routine">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>Inflammatory polyarthritis / persistent synovitis</b>
                    <span>Rest pain, boggy swelling/warmth, morning stiffness &gt;15‚Äì30 min, multi-joint involvement.</span>
                  </div>
                </div>
                <span class="badge routine">Pathway</span>
              </summary>
              <div class="acc-body">
                <div class="checklist">
                  <label class="check"><input type="checkbox" class="flag" data-level="urgent" data-flag="Persistent synovitis (boggy swelling/warmth/tenderness)" />
                    <div class="txt"><b>Persistent synovitis</b><span>Boggy feel; swelling + warmth + tenderness.</span></div>
                  </label>
                  <label class="check"><input type="checkbox" class="flag" data-level="urgent" data-flag="Pain worse at rest/inactivity + morning stiffness >15‚Äì30 min" />
                    <div class="txt"><b>Inflammatory pattern</b><span>Worse at rest/inactivity; morning stiffness &gt;15‚Äì30 minutes.</span></div>
                  </label>
                  <label class="check"><input type="checkbox" class="flag" data-level="urgent" data-flag="Synovitis affecting >1 joint or small joints of hands/feet" />
                    <div class="txt"><b>Multi-joint or small joint involvement</b><span>Symmetrical small joint synovitis typical for RA.</span></div>
                  </label>
                  <div class="callout">
                    <div class="k"><span aria-hidden="true">üß©</span> Associated context</div>
                    <p class="mini">Psoriasis, IBD, recent diarrhoeal/GU infection, uveitis/episcleritis/scleritis and related ocular inflammatory features support inflammatory arthropathy.</p>
                  </div>
                </div>
              </div>
            </details>
          </div>
        </section>

        <!-- DIFFERENTIAL MAP -->
        <section class="panel" id="differential" data-tags="routine">
          <div class="panel-head">
            <div>
              <h2><span class="badge routine"><span aria-hidden="true">üó∫Ô∏è</span> Differential map</span> Quick localization + age framing</h2>
              <p>Use this to anchor likely etiologies before ordering tests. (Not an exhaustive list.)</p>
            </div>
            <div class="badge tools"><span aria-hidden="true">üéõÔ∏è</span> Filterable</div>
          </div>

          <div class="panel-body">
            <details class="acc" open data-tags="routine">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>By age group</b>
                    <span>Common patterns: &lt;18, 18‚Äì50, &gt;50.</span>
                  </div>
                </div>
                <span class="badge routine">Routine</span>
              </summary>
              <div class="acc-body">
                <div class="flags">
                  <div class="flag routine">
                    <div class="dot"></div>
                    <div class="t">
                      <b>Children / adolescents (&lt;18)</b>
                      <span>Patellofemoral pain; Osgood-Schlatter; referred hip pain (Perthes/SCFE); hypermobility; osteochondritis dissecans; septic arthritis; tumours.</span>
                    </div>
                  </div>
                  <div class="flag routine">
                    <div class="dot"></div>
                    <div class="t">
                      <b>Younger adults (18‚Äì50)</b>
                      <span>Patellofemoral pain; trauma (ligaments/meniscus); bursitis; inflammatory arthritis; septic arthritis; early OA (post-injury); IT band syndrome.</span>
                    </div>
                  </div>
                  <div class="flag routine">
                    <div class="dot"></div>
                    <div class="t">
                      <b>Older adults (&gt;50)</b>
                      <span>Osteoarthritis; gout/pseudogout; Baker‚Äôs cyst; referred hip OA; degenerative meniscal tear; septic arthritis; secondary tumours.</span>
                    </div>
                  </div>
                </div>
              </div>
            </details>

            <details class="acc" data-tags="routine">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>By anatomical site</b>
                    <span>Anterior, medial, lateral, posterior knee pain patterns.</span>
                  </div>
                </div>
                <span class="badge routine">Routine</span>
              </summary>
              <div class="acc-body">
                <div class="flags">
                  <div class="flag">
                    <div class="dot" style="background:var(--blue)"></div>
                    <div class="t">
                      <b>Anterior</b>
                      <span>Patellar subluxation/dislocation; Osgood-Schlatter; patellar tendonitis; patellofemoral pain; extensor tendon rupture; patellofemoral OA.</span>
                    </div>
                  </div>
                  <div class="flag">
                    <div class="dot" style="background:var(--violet)"></div>
                    <div class="t">
                      <b>Medial</b>
                      <span>MCL sprain; medial meniscal tear; pes anserine bursitis; medial plica; medial compartment OA.</span>
                    </div>
                  </div>
                  <div class="flag">
                    <div class="dot" style="background:var(--amber)"></div>
                    <div class="t">
                      <b>Lateral</b>
                      <span>LCL sprain; lateral meniscal tear; iliotibial band syndrome; lateral compartment OA.</span>
                    </div>
                  </div>
                  <div class="flag">
                    <div class="dot" style="background:rgba(255,255,255,.25)"></div>
                    <div class="t">
                      <b>Posterior</b>
                      <span>Baker‚Äôs cyst; PCL injury; posterior horn meniscal tears.</span>
                    </div>
                  </div>
                </div>

                <div class="callout">
                  <div class="k"><span aria-hidden="true">üß†</span> Referred pain checkpoint</div>
                  <p>Normal knee exam + persistent symptoms (especially in children) ‚Üí examine hips/ankles/spine; consider hip pathology (including septic hip/SCFE/Perthes).</p>
                </div>
              </div>
            </details>
          </div>
        </section>

        <!-- INVESTIGATIONS -->
        <section class="panel" id="investigations" data-tags="routine">
          <div class="panel-head">
            <div>
              <h2><span class="badge routine"><span aria-hidden="true">üß™</span> Investigations</span> Targeted, not reflexive</h2>
              <p>Further investigations are not normally required in primary care; if referral is indicated, do not delay while awaiting results.</p>
            </div>
            <div class="badge tools"><span aria-hidden="true">üßæ</span> Quick list</div>
          </div>

          <div class="panel-body">
            <div class="action routine">
              <div class="row">
                <div class="icon" aria-hidden="true"><span style="font-size:18px">üßæ</span></div>
                <div>
                  <h3>Tests (as presentation dictates)</h3>
                  <p>Choose based on suspected cause (inflammatory, crystal, infection, trauma, malignancy).</p>
                </div>
              </div>
              <ul>
                <li><b>Blood tests:</b> inflammatory markers, FBC, renal function, urate, autoantibodies (context-specific).</li>
                <li><b>X-ray:</b> AP/lateral/sunrise; weight-bearing if appropriate; use Ottawa knee rule after injury for fracture exclusion.</li>
                <li><b>Ultrasound:</b> Baker‚Äôs cyst, effusions, superficial ligaments.</li>
                <li><b>MRI:</b> typically secondary care; meniscal/cruciate injury, malignancy, osteomyelitis, vascular injury; some regions have direct access with criteria.</li>
              </ul>
              <div class="mini">Specialists may consider CT, bone scan, arthroscopy depending on scenario.</div>
            </div>
          </div>
        </section>

        <!-- REFERRAL -->
        <section class="panel" id="referral" data-tags="urgent routine">
          <div class="panel-head">
            <div>
              <h2><span class="badge urgent"><span aria-hidden="true">üì®</span> Referral pathways</span> Immediate vs urgent vs routine</h2>
              <p>Use alongside your local service model (ED/fracture clinic/acute knee clinic/MSK/orthopaedics/rheumatology).</p>
            </div>
            <div class="badge tools"><span aria-hidden="true">üß≠</span> Decision cues</div>
          </div>

          <div class="panel-body">
            <details class="acc" open data-tags="urgent">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>Immediate specialist assessment (same-day)</b>
                    <span>Sepsis/SCFE/fracture exclusion/neurovascular compromise/extensor rupture/patellar dislocation pattern/gross instability.</span>
                  </div>
                </div>
                <span class="badge urgent">Immediate</span>
              </summary>
              <div class="acc-body">
                <div class="flags">
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>Septic arthritis suspected / cannot be excluded</b><span>Do not delay.</span></div></div>
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>SCFE suspected</b><span>Child/adolescent limp + hip findings.</span></div></div>
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>Fracture cannot be excluded</b><span>Apply Ottawa knee rule; inability to weight bear is high priority.</span></div></div>
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>Neurovascular compromise / compartment syndrome</b><span>After trauma.</span></div></div>
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>Quadriceps/patellar tendon rupture suspected</b><span>Extensor mechanism failure signs.</span></div></div>
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>First-time traumatic patellar dislocation</b><span>Or recurrent with moderate/severe swelling.</span></div></div>
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>Severe soft tissue injury with gross instability</b><span>High energy, marked instability, major swelling.</span></div></div>
                </div>
              </div>
            </details>

            <details class="acc" data-tags="urgent">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>Urgent (seen within ~2 weeks)</b>
                    <span>Tumour suspicion; urgent inflammatory arthritis patterns; osteonecrosis concern.</span>
                  </div>
                </div>
                <span class="badge urgent">Urgent</span>
              </summary>
              <div class="acc-body">
                <div class="flags">
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>Suspected tumour</b><span>Urgent specialist review (often within 2 weeks).</span></div></div>
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>Suspected persistent synovitis (undetermined cause)</b><span>Rheumatology; urgent if small joints/hands/feet or &gt;1 joint, or delayed presentation.</span></div></div>
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>Child/young person with suspected JIA</b><span>Urgent paediatric rheumatology; discuss immediate management concurrently.</span></div></div>
                  <div class="flag urgent"><div class="dot"></div><div class="t"><b>Suspected osteonecrosis</b><span>Urgent orthopaedics.</span></div></div>
                </div>
              </div>
            </details>

            <details class="acc" data-tags="routine">
              <summary>
                <div class="sum-left">
                  <div class="chev" aria-hidden="true">‚Ä∫</div>
                  <div class="sum-text">
                    <b>Non-urgent / specialist assessment</b>
                    <span>Persistent symptoms &gt;6 weeks; degenerative meniscal tear; patellofemoral pain not improving; OCD; plica; recurrent patellar instability.</span>
                  </div>
                </div>
                <span class="badge routine">Routine</span>
              </summary>
              <div class="acc-body">
                <div class="flags">
                  <div class="flag routine"><div class="dot"></div><div class="t"><b>Persisting pain/symptoms &gt;6 weeks</b><span>Consider MSK / orthopaedics depending on pathway.</span></div></div>
                  <div class="flag routine"><div class="dot"></div><div class="t"><b>Suspected degenerative meniscal tear</b><span>Further assessment pathway.</span></div></div>
                  <div class="flag routine"><div class="dot"></div><div class="t"><b>Osteochondritis dissecans / plica / fat pad impingement</b><span>Specialist assessment; imaging often best done there.</span></div></div>
                  <div class="flag routine"><div class="dot"></div><div class="t"><b>Patellofemoral pain not improved after ~6 weeks conservative management</b><span>Escalate assessment/physio pathway.</span></div></div>
                  <div class="flag routine"><div class="dot"></div><div class="t"><b>Recurrent patellar dislocation/subluxation</b><span>Specialist instability pathway.</span></div></div>
                </div>
              </div>
            </details>
          </div>
        </section>

        <footer>
          Built as a self-contained clinical decision-support page (HTML/CSS/JS). Content aligned to NICE CKS knee pain assessment structure (Aug 2022).
        </footer>
      </main>

      <!-- Side column -->
      <aside class="side" aria-label="Right-side decision flags and quick tools">
        <section class="panel" id="flagsPanel" data-tags="tools urgent">
          <div class="panel-head">
            <div>
              <h2><span class="badge tools"><span aria-hidden="true">üèÅ</span> Visual flags</span> Live triage summary</h2>
              <p>Populates from checked items across the page. Use for rapid ‚Äúat-a-glance‚Äù risk state.</p>
            </div>
            <div class="badge urgent"><span aria-hidden="true">‚ö°</span> Dynamic</div>
          </div>
          <div class="panel-body">
            <div id="noFlags" class="action routine">
              <div class="row">
                <div class="icon" aria-hidden="true"><span style="font-size:18px">üü¢</span></div>
                <div>
                  <h3>No urgent flags selected</h3>
                  <p>Tick red flag / urgent pathway items to populate this panel.</p>
                </div>
              </div>
            </div>

            <div class="flags" id="flagList"></div>

            <div class="callout">
              <div class="k"><span aria-hidden="true">‚åÅ</span> Tip</div>
              <p>Use the top bar filters (Urgent-only / Routine-only / Trauma focus) to reduce cognitive load during resus/majors flow.</p>
            </div>
          </div>
        </section>

        <section class="panel" id="quickTools" data-tags="tools">
          <div class="panel-head">
            <div>
              <h2><span class="badge tools"><span aria-hidden="true">üß∞</span> Quick tools</span> One-tap actions</h2>
              <p>Small accelerators for point-of-care use.</p>
            </div>
            <div class="badge tools"><span aria-hidden="true">‚è©</span> Speed</div>
          </div>
          <div class="panel-body">
            <div class="action">
              <button class="btn" id="btnClearChecks" style="width:100%; justify-content:center;">
                <span aria-hidden="true">üßπ</span> Clear all ticks
              </button>
              <button class="btn" id="btnCopyFlags" style="width:100%; justify-content:center;">
                <span aria-hidden="true">üìã</span> Copy flagged items
              </button>
              <div class="mini">Clipboard output is plain text (safe for quick notes/handovers).</div>
            </div>
          </div>
        </section>
      </aside>
    </div>
  </div>

  <script>
    // ---------- Utilities ----------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const store = {
      get(k, fallback=null){
        try{ return JSON.parse(localStorage.getItem(k)) ?? fallback; }catch{ return fallback; }
      },
      set(k, v){
        try{ localStorage.setItem(k, JSON.stringify(v)); }catch{}
      }
    };

    // ---------- Accordion controls ----------
    const expandAll = () => $$("details.acc").forEach(d => d.open = true);
    const collapseAll = () => $$("details.acc").forEach(d => d.open = false);

    $("#btnExpandAll").addEventListener("click", expandAll);
    $("#btnCollapseAll").addEventListener("click", collapseAll);
    $("#btnPrint").addEventListener("click", () => window.print());

    // ---------- Live flags ----------
    const flagList = $("#flagList");
    const noFlags = $("#noFlags");

    function rebuildFlags(){
      const checked = $$(".flag:checked");
      const ottawaChecked = $$(".ottawa:checked");
      const flags = [];

      checked.forEach(cb => {
        flags.push({ level: cb.dataset.level || "urgent", text: cb.dataset.flag });
      });

      // Ottawa summary flag
      const ottawaPositive = ottawaChecked.length > 0;
      if(ottawaPositive){
        flags.push({ level:"urgent", text:"Ottawa knee rule positive ‚Üí arrange knee X-ray to rule out fracture" });
      }

      flagList.innerHTML = "";
      if(flags.length === 0){
        noFlags.classList.remove("hide");
        return;
      }
      noFlags.classList.add("hide");

      flags.forEach(f => {
        const div = document.createElement("div");
        div.className = "flag " + (f.level === "urgent" ? "urgent" : "routine");
        div.innerHTML = `
          <div class="dot"></div>
          <div class="t">
            <b>${escapeHtml(f.text)}</b>
            <span>${f.level === "urgent" ? "Urgent / time-critical" : "Routine / pathway"}</span>
          </div>`;
        flagList.appendChild(div);
      });
    }

    function escapeHtml(s){
      return (s || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ---------- Ottawa live result ----------
    function rebuildOttawa(){
      const n = $$(".ottawa:checked").length;
      const status = $("#ottawaStatus");
      const advice = $("#ottawaAdvice");

      if(n === 0){
        status.textContent = "Negative (no criteria ticked)";
        advice.textContent = "If no Ottawa criteria apply after injury, knee X-ray is usually not required for fracture exclusion.";
        return;
      }
      status.textContent = `Positive (${n} criterion${n>1?"a":""} ticked)`;
      advice.textContent = "Arrange knee X-ray to rule out fracture (Ottawa knee rule positive).";
    }

    // ---------- Filters + search ----------
    const stateKey = "knee_cds_state_v1";

    function applyVisibility(){
      const q = ($("#q").value || "").trim().toLowerCase();
      const urgentOnly = $("#fUrgent").checked;
      const routineOnly = $("#fRoutine").checked;
      const traumaOnly = $("#fTrauma").checked;

      const blocks = $$("section.panel, details.acc, .step");
      blocks.forEach(el => {
        const tags = (el.dataset.tags || "").toLowerCase();

        // Tag-based filtering
        let ok = true;
        if(urgentOnly && !tags.includes("urgent")) ok = false;
        if(routineOnly && !tags.includes("routine")) ok = false;
        if(traumaOnly && !tags.includes("trauma")) ok = false;

        // Search-based filtering (section + accordion + step)
        if(q){
          const txt = (el.innerText || "").toLowerCase();
          if(!txt.includes(q)) ok = false;
        }

        el.classList.toggle("hide", !ok);
      });

      // prevent both urgent-only and routine-only being on simultaneously (keep last toggled)
      if(urgentOnly && routineOnly){
        // If both set, prefer urgent-only (arbitrary) and unset routine
        $("#fRoutine").checked = false;
      }

      // Persist if enabled
      if($("#fPersist").checked){
        store.set(stateKey, {
          q: $("#q").value,
          fUrgent: $("#fUrgent").checked,
          fRoutine: $("#fRoutine").checked,
          fTrauma: $("#fTrauma").checked,
          fPersist: $("#fPersist").checked
        });
      }
    }

    // ---------- Copy flags ----------
    $("#btnCopyFlags").addEventListener("click", async () => {
      const items = $$(".flag:checked").map(cb => "‚Ä¢ " + cb.dataset.flag);
      const ottawa = $$(".ottawa:checked").length ? ["‚Ä¢ Ottawa knee rule positive ‚Üí arrange knee X-ray to rule out fracture"] : [];
      const out = ["Knee pain assessment ‚Äì flagged items:", ...items, ...ottawa].join("\n");

      try{
        await navigator.clipboard.writeText(out);
        $("#btnCopyFlags").textContent = "‚úÖ Copied";
        setTimeout(() => $("#btnCopyFlags").innerHTML = '<span aria-hidden="true">üìã</span> Copy flagged items', 1200);
      }catch{
        alert(out);
      }
    });

    // ---------- Clear all ticks ----------
    $("#btnClearChecks").addEventListener("click", () => {
      $$("input[type='checkbox']").forEach(cb => cb.checked = false);
      $("#fPersist").checked = true; // keep remember on by default
      rebuildFlags();
      rebuildOttawa();
      applyVisibility();
    });

    // ---------- Wire events ----------
    const watch = () => {
      $$("input.flag, input.ottawa").forEach(cb => cb.addEventListener("change", () => {
        rebuildFlags();
        rebuildOttawa();
      }));

      ["q","fUrgent","fRoutine","fTrauma","fPersist"].forEach(id => {
        $("#"+id).addEventListener("input", applyVisibility);
        $("#"+id).addEventListener("change", applyVisibility);
      });
    };

    // ---------- Restore state ----------
    function restore(){
      const saved = store.get(stateKey, null);
      if(!saved) return;
      if(saved.fPersist === false) return;

      $("#q").value = saved.q ?? "";
      $("#fUrgent").checked = !!saved.fUrgent;
      $("#fRoutine").checked = !!saved.fRoutine;
      $("#fTrauma").checked = !!saved.fTrauma;
      $("#fPersist").checked = saved.fPersist !== false;
    }

    // Init
    restore();
    watch();
    rebuildFlags();
    rebuildOttawa();
    applyVisibility();
  </script>
</body>
</html>
