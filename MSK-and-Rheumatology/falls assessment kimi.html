<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Falls Assessment Algorithm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f7ff 0%, #e6f0ff 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: #2c3e50;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            color: #5a6c7d;
            font-size: 1.2em;
            max-width: 800px;
            margin: 0 auto;
        }

        .container {
            display: flex;
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .progress-sidebar {
            position: sticky;
            top: 20px;
            width: 280px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            height: fit-content;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: transform 0.3s ease;
        }

        .progress-sidebar:hover {
            transform: translateY(-5px);
        }

        .progress-sidebar h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .progress-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            background: rgba(236, 240, 241, 0.7);
            border-left: 4px solid transparent;
        }

        .progress-item:hover {
            background: rgba(236, 240, 241, 1);
            transform: translateX(5px);
        }

        .progress-item.active {
            background: linear-gradient(135deg, #3498db, #2c80c5);
            color: white;
            border-left: 4px solid #2980b9;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .progress-item.completed {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border-left: 4px solid #27ae60;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }

        .progress-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            font-weight: bold;
        }

        .main-content {
            flex: 1;
        }

        .algorithm-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            overflow: hidden;
            position: relative;
        }

        .algorithm-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .algorithm-card.expanded {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(236, 240, 241, 0.8);
        }

        .card-title-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .assessment-icon { background: linear-gradient(135deg, #3498db, #2980b9); }
        .diagnosis-icon { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .treatment-icon { background: linear-gradient(135deg, #f39c12, #d35400); }
        .followup-icon { background: linear-gradient(135deg, #9b59b6, #8e44ad); }

        .card-title {
            font-size: 1.8em;
            color: #2c3e50;
            font-weight: 600;
        }

        .expand-icon {
            font-size: 24px;
            color: #7f8c8d;
            transition: transform 0.3s ease;
        }

        .expand-icon.rotated {
            transform: rotate(180deg);
        }

        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .card-content.expanded {
            max-height: 2000px;
        }

        .step-container {
            margin-top: 25px;
        }

        .step {
            background: rgba(236, 240, 241, 0.5);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .step:hover {
            background: rgba(236, 240, 241, 0.8);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .step h4 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 1.2em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step p {
            color: #34495e;
            margin-bottom: 15px;
            line-height: 1.7;
        }

        .step ul {
            margin-left: 25px;
            color: #34495e;
            line-height: 1.7;
        }

        .step li {
            margin-bottom: 8px;
            position: relative;
            padding-left: 15px;
        }

        .step li::before {
            content: "‚Ä¢";
            color: #3498db;
            font-weight: bold;
            position: absolute;
            left: 0;
            top: 0;
        }

        .badge-container {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }

        .badge:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .badge-urgent {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .badge-caution {
            background: linear-gradient(135deg, #f39c12, #d35400);
            color: white;
        }

        .badge-stable {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .badge-info {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .decision-point {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid #fdcb6e;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .decision-point:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .decision-point::before {
            content: "‚ö°";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #f39c12;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }

        .decision-point h4 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .decision-point p {
            color: #856404;
            line-height: 1.6;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            margin: 8px 5px;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .btn:hover::after {
            transform: translateX(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            box-shadow: 0 4px 10px rgba(149, 165, 166, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 7px 15px rgba(149, 165, 166, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 7px 15px rgba(46, 204, 113, 0.4);
        }

        .test-result {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(52, 152, 219, 0.2);
            transition: all 0.3s ease;
        }

        .test-result:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .test-result h5 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .test-result p {
            color: #34495e;
            line-height: 1.6;
        }

        .test-result input, .test-result select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .test-result input:focus, .test-result select:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        .progress-bar {
            background: rgba(236, 240, 241, 0.8);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .progress-sidebar {
                width: 100%;
                position: static;
                margin-bottom: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .card-title {
                font-size: 1.5em;
            }
            
            .algorithm-card {
                padding: 20px;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { 
                transform: scale(1); 
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.4);
            }
            70% { 
                transform: scale(1.02);
                box-shadow: 0 0 0 10px rgba(52, 152, 219, 0);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0);
            }
        }

        .tooltip {
            position: fixed;
            background: rgba(44, 62, 80, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.85em;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
            max-width: 250px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tooltip.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü©∫ Falls Assessment & Management Algorithm</h1>
        <p>Interactive clinical decision support tool for healthcare professionals</p>
    </div>

    <div class="container">
        <div class="progress-sidebar" id="progressSidebar">
            <h3>üìä Progress Tracker</h3>
            <div class="progress-item active" data-step="0">
                <div class="progress-icon">1</div>
                <span>Initial Assessment</span>
            </div>
            <div class="progress-item" data-step="1">
                <div class="progress-icon">2</div>
                <span>Risk Stratification</span>
            </div>
            <div class="progress-item" data-step="2">
                <div class="progress-icon">3</div>
                <span>Management Plan</span>
            </div>
            <div class="progress-item" data-step="3">
                <div class="progress-icon">4</div>
                <span>Follow-up</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p style="text-align: center; margin-top: 10px; font-size: 0.9em; color: #7f8c8d;">
                <span id="progressText">0%</span> Complete
            </p>
            <button class="btn" onclick="resetAlgorithm()" style="width: 100%; margin-top: 15px;">
                üîÑ Reset Algorithm
            </button>
        </div>

        <div class="main-content">
            <!-- Assessment Card -->
            <div class="algorithm-card fade-in" data-step="0">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-title-section">
                        <div class="card-icon assessment-icon">üìã</div>
                        <h2 class="card-title">Initial Assessment</h2>
                    </div>
                    <span class="expand-icon">‚ñº</span>
                </div>
                <div class="card-content">
                    <div class="step-container">
                        <div class="step">
                            <h4>üîç Patient Identification</h4>
                            <p>Identify patients aged ‚â•65 years or ‚â•50 years with risk factors:</p>
                            <ul>
                                <li>History of fall(s) in past 12 months</li>
                                <li>Recurrent falls (‚â•2 falls)</li>
                                <li>Presenting after a fall</li>
                                <li>Balance or gait abnormalities</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-info">Age ‚â•65 years</span>
                                <span class="badge badge-caution">Risk Factors</span>
                            </div>
                        </div>

                        <div class="step">
                            <h4>üìä Falls History Taking</h4>
                            <p>Obtain detailed falls history:</p>
                            <ul>
                                <li>Frequency and circumstances of falls</li>
                                <li>Activities being performed</li>
                                <li>Preceding symptoms (dizziness, palpitations, syncope)</li>
                                <li>Environmental factors</li>
                                <li>Consequences (injuries, fear of falling)</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-urgent">Eye-witness account</span>
                                <span class="badge badge-caution">Distinguish from collapse</span>
                            </div>
                        </div>

                        <div class="decision-point">
                            <h4>Is this a simple fall or collapse?</h4>
                            <p>Consider acute medical causes (arrhythmia, stroke, TIA, vertigo) vs chronic impairment</p>
                            <div class="badge-container">
                                <span class="badge badge-urgent">Urgent referral if collapse</span>
                            </div>
                        </div>

                        <div class="step">
                            <h4>üéØ Risk Factor Assessment</h4>
                            <p>Systematically assess risk factors:</p>
                            <ul>
                                <li>Cognitive impairment</li>
                                <li>Visual impairment</li>
                                <li>Mobility/balance conditions (arthritis, diabetes, stroke, Parkinson's)</li>
                                <li>Medications (polypharmacy, FRIDs)</li>
                                <li>Fear of falling</li>
                                <li>Environmental hazards</li>
                                <li>Alcohol misuse, depression</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-caution">FRIDs = Fall Risk Increasing Drugs</span>
                            </div>
                        </div>

                        <div class="step">
                            <h4>‚ö° Physical Assessment</h4>
                            <div class="test-result">
                                <h5>Timed Up & Go Test (TUG)</h5>
                                <p>Time patient getting up from chair, walking 3m, turning, returning, sitting down</p>
                                <input type="number" id="tugTime" placeholder="Enter time in seconds" min="0" max="60">
                                <button class="btn" onclick="calculateTUG()">Calculate Interpretation</button>
                                <div id="tugResult"></div>
                            </div>
                            
                            <div class="test-result">
                                <h5>Turn 180¬∞ Test</h5>
                                <p>Assess ability to turn 180¬∞ while standing</p>
                                <select id="turnSteps" onchange="calculateTurnTest()">
                                    <option value="">Select number of steps</option>
                                    <option value="3">3 steps or less</option>
                                    <option value="4">4 steps</option>
                                    <option value="5">5 steps or more</option>
                                </select>
                                <div id="turnResult"></div>
                            </div>
                        </div>

                        <div class="step">
                            <h4>üìã Frailty Assessment</h4>
                            <p>Consider using Electronic Frailty Index (eFI) for patients ‚â•65 years</p>
                            <button class="btn" onclick="showFrailtyInfo()">View Frailty Criteria</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Diagnosis Card -->
            <div class="algorithm-card fade-in" data-step="1">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-title-section">
                        <div class="card-icon diagnosis-icon">üîç</div>
                        <h2 class="card-title">Risk Stratification</h2>
                    </div>
                    <span class="expand-icon">‚ñº</span>
                </div>
                <div class="card-content">
                    <div class="step-container">
                        <div class="decision-point">
                            <h4>Comprehensive Falls Assessment Criteria</h4>
                            <p>Does the patient meet any of these criteria?</p>
                            <ul>
                                <li>Living with frailty</li>
                                <li>Fall with injury requiring medical treatment</li>
                                <li>Loss of consciousness related to fall</li>
                                <li>Unable to get up independently after fall</li>
                                <li>‚â•2 falls in past year</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-urgent">‚â•2 falls = High Risk</span>
                            </div>
                        </div>

                        <div class="step">
                            <h4>üö¶ Risk Classification</h4>
                            <div class="test-result">
                                <h5>Select Risk Category:</h5>
                                <button class="btn" onclick="setRiskLevel('high')">üî¥ High Risk</button>
                                <button class="btn btn-secondary" onclick="setRiskLevel('moderate')">üü° Moderate Risk</button>
                                <button class="btn btn-success" onclick="setRiskLevel('low')">üü¢ Low Risk</button>
                                <div id="riskResult"></div>
                            </div>
                        </div>

                        <div class="step">
                            <h4>üìä Risk Factor Analysis</h4>
                            <p>Number of risk factors correlates with fall risk:</p>
                            <ul>
                                <li>Each additional risk factor doubles 1-year fall risk</li>
                                <li>>65% of patients ‚â•65 years have multimorbidity</li>
                                <li>Previous falls: 66% chance of another fall within 1 year</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-caution">Multimorbidity >2 conditions</span>
                            </div>
                        </div>

                        <div class="decision-point">
                            <h4>Referral Decision</h4>
                            <p>Who should be referred for comprehensive assessment?</p>
                            <button class="btn" onclick="showReferralGuidance()">View Referral Criteria</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Treatment Card -->
            <div class="algorithm-card fade-in" data-step="2">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-title-section">
                        <div class="card-icon treatment-icon">üíä</div>
                        <h2 class="card-title">Management Plan</h2>
                    </div>
                    <span class="expand-icon">‚ñº</span>
                </div>
                <div class="card-content">
                    <div class="step-container">
                        <div class="step">
                            <h4>üè• Comprehensive Multifactorial Intervention</h4>
                            <p>For patients meeting high-risk criteria:</p>
                            <ul>
                                <li>Specialist falls service referral</li>
                                <li>Individualized assessment and intervention</li>
                                <li>Multidisciplinary team involvement</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-urgent">Specialist Referral</span>
                            </div>
                        </div>

                        <div class="step">
                            <h4>üõ°Ô∏è Interventions by Category</h4>
                            <div class="test-result">
                                <h5>Strength & Balance Training</h5>
                                <p>Progressive, tailored exercise programs delivered by trained professionals</p>
                                <button class="btn" onclick="showExerciseDetails()">View Program Details</button>
                            </div>
                            
                            <div class="test-result">
                                <h5>Home Hazard Assessment</h5>
                                <p>For patients discharged from hospital after a fall</p>
                                <button class="btn btn-secondary" onclick="showHomeHazards()">Common Hazards</button>
                            </div>
                            
                            <div class="test-result">
                                <h5>Medication Review</h5>
                                <p>Focus on psychotropic drugs and FRIDs</p>
                                <select id="medicationReview" onchange="showMedGuidance()">
                                    <option value="">Select medication type</option>
                                    <option value="psychotropic">Psychotropic drugs</option>
                                    <option value="antihypertensive">Antihypertensives</option>
                                    <option value="polypharmacy">Polypharmacy</option>
                                </select>
                                <div id="medGuidance"></div>
                            </div>
                            
                            <div class="test-result">
                                <h5>Vision Assessment</h5>
                                <p>Referral for visual impairment</p>
                                <button class="btn btn-success" onclick="showVisionGuidance()">Referral Criteria</button>
                            </div>
                        </div>

                        <div class="step">
                            <h4>üìà Moderate Risk Management</h4>
                            <p>For patients with gait/balance impairment but not meeting high-risk criteria:</p>
                            <ul>
                                <li>Falls prevention exercise program</li>
                                <li>Consider home hazard assessment</li>
                                <li>Annual reassessment</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-caution">Exercise Program</span>
                                <span class="badge badge-stable">Annual Review</span>
                            </div>
                        </div>

                        <div class="step">
                            <h4>üìö Low Risk Management</h4>
                            <p>For patients without significant risk factors:</p>
                            <ul>
                                <li>Health and wellbeing information</li>
                                <li>Stay active and engaged</li>
                                <li>Annual screening</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-stable">Health Promotion</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Follow-up Card -->
            <div class="algorithm-card fade-in" data-step="3">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-title-section">
                        <div class="card-icon followup-icon">üìÖ</div>
                        <h2 class="card-title">Follow-up & Monitoring</h2>
                    </div>
                    <span class="expand-icon">‚ñº</span>
                </div>
                <div class="card-content">
                    <div class="step-container">
                        <div class="step">
                            <h4>üìÖ Follow-up Schedule</h4>
                            <p>Regular monitoring based on risk level:</p>
                            <ul>
                                <li><strong>High Risk:</strong> 3-month review, then 6-monthly</li>
                                <li><strong>Moderate Risk:</strong> 6-month review, then annual</li>
                                <li><strong>Low Risk:</strong> Annual screening</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-urgent">High Risk: 3 months</span>
                                <span class="badge badge-caution">Moderate: 6 months</span>
                                <span class="badge badge-stable">Low: Annual</span>
                            </div>
                        </div>

                        <div class="step">
                            <h4>üéØ Outcome Measures</h4>
                            <p>Monitor effectiveness of interventions:</p>
                            <ul>
                                <li>Number of falls (incidence)</li>
                                <li>Injury reduction</li>
                                <li>Functional improvement</li>
                                <li>Quality of life measures</li>
                                <li>Hospital admission rates</li>
                            </ul>
                            <div class="test-result">
                                <h5>Reassessment Tools</h5>
                                <button class="btn" onclick="showReassessmentTools()">View Tools</button>
                            </div>
                        </div>

                        <div class="step">
                            <h4>‚ö†Ô∏è Red Flags for Re-referral</h4>
                            <p>Refer urgently if:</p>
                            <ul>
                                <li>New acute medical problem</li>
                                <li>Recurrent falls despite intervention</li>
                                <li>Severe injury from fall</li>
                                <li>Rapid functional decline</li>
                                <li>Change in cognitive status</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-urgent">Urgent Re-referral</span>
                            </div>
                        </div>

                        <div class="step">
                            <h4>üìö Patient Education & Resources</h4>
                            <p>Provide ongoing education:</p>
                            <ul>
                                <li>Staying active and engaged</li>
                                <li>Home safety modifications</li>
                                <li>Medication management</li>
                                <li>Community resources and support groups</li>
                                <li>Emergency planning</li>
                            </ul>
                            <div class="badge-container">
                                <span class="badge badge-info">Age UK Resources</span>
                                <span class="badge badge-info">CSP Booklet</span>
                            </div>
                        </div>

                        <div class="decision-point">
                            <h4>Algorithm Complete</h4>
                            <p>Continue to next patient assessment or review algorithm</p>
                            <button class="btn btn-success" onclick="completeAlgorithm()">
                                ‚úÖ Mark as Complete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state management
        let currentStep = 0;
        let patientData = {
            age: null,
            riskFactors: [],
            tugTime: null,
            turnSteps: null,
            riskLevel: null,
            completedSteps: []
        };

        // Initialize tooltips
        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        document.body.appendChild(tooltip);

        // Add tooltips to elements with data-tooltip attribute
        document.querySelectorAll('[data-tooltip]').forEach(element => {
            element.addEventListener('mouseenter', (e) => {
                const text = e.target.getAttribute('data-tooltip');
                tooltip.textContent = text;
                tooltip.classList.add('show');
                updateTooltipPosition(e);
            });
            
            element.addEventListener('mousemove', updateTooltipPosition);
            
            element.addEventListener('mouseleave', () => {
                tooltip.classList.remove('show');
            });
        });

        function updateTooltipPosition(e) {
            const x = e.clientX;
            const y = e.clientY;
            const offset = 10;
            
            // Position above cursor by default
            let top = y - tooltip.offsetHeight - offset;
            let left = x - tooltip.offsetWidth / 2;
            
            // Adjust if near screen edges
            if (top < 0) {
                top = y + offset;
            }
            if (left < 0) {
                left = 0;
            } else if (left + tooltip.offsetWidth > window.innerWidth) {
                left = window.innerWidth - tooltip.offsetWidth;
            }
            
            tooltip.style.top = top + 'px';
            tooltip.style.left = left + 'px';
        }

        // Card interaction functions
        function toggleCard(header) {
            const card = header.closest('.algorithm-card');
            const content = card.querySelector('.card-content');
            const expandIcon = header.querySelector('.expand-icon');
            
            // Close all other cards
            document.querySelectorAll('.algorithm-card').forEach(otherCard => {
                if (otherCard !== card && otherCard.classList.contains('expanded')) {
                    otherCard.querySelector('.card-content').classList.remove('expanded');
                    otherCard.querySelector('.expand-icon').classList.remove('rotated');
                    otherCard.classList.remove('expanded');
                }
            });
            
            // Toggle current card
            content.classList.toggle('expanded');
            expandIcon.classList.toggle('rotated');
            card.classList.toggle('expanded');
            
            // Scroll to card if expanding
            if (content.classList.contains('expanded')) {
                setTimeout(() => {
                    card.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 300);
            }
        }

        // Progress management
        function updateProgress(stepIndex) {
            const progressItems = document.querySelectorAll('.progress-item');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            // Update progress items
            progressItems.forEach((item, index) => {
                item.classList.remove('active', 'completed');
                if (index < stepIndex) {
                    item.classList.add('completed');
                } else if (index === stepIndex) {
                    item.classList.add('active');
                }
            });
            
            // Update progress bar
            const percentage = (stepIndex / progressItems.length) * 100;
            progressFill.style.width = percentage + '%';
            progressText.textContent = Math.round(percentage);
            
            currentStep = stepIndex;
            
            // Auto-expand current step card
            const cards = document.querySelectorAll('.algorithm-card');
            cards.forEach((card, index) => {
                const content = card.querySelector('.card-content');
                const expandIcon = card.querySelector('.expand-icon');
                
                if (index === stepIndex && !content.classList.contains('expanded')) {
                    content.classList.add('expanded');
                    expandIcon.classList.add('rotated');
                    card.classList.add('expanded');
                } else if (index !== stepIndex && content.classList.contains('expanded')) {
                    content.classList.remove('expanded');
                    expandIcon.classList.remove('rotated');
                    card.classList.remove('expanded');
                }
            });
        }

        // Progress item click handlers
        document.querySelectorAll('.progress-item').forEach((item, index) => {
            item.addEventListener('click', () => {
                updateProgress(index);
            });
        });

        // Assessment functions
        function calculateTUG() {
            const tugTime = parseFloat(document.getElementById('tugTime').value);
            const resultDiv = document.getElementById('tugResult');
            
            if (isNaN(tugTime) || tugTime <= 0) {
                resultDiv.innerHTML = '<p style="color: #e74c3c;">Please enter a valid time in seconds</p>';
                return;
            }
            
            patientData.tugTime = tugTime;
            let interpretation = '';
            let badgeClass = '';
            let recommendations = '';
            
            if (tugTime <= 10) {
                interpretation = 'Normal mobility';
                badgeClass = 'badge-stable';
                recommendations = 'Low risk of falls. Continue regular activities and annual screening.';
            } else if (tugTime <= 12) {
                interpretation = 'Slightly impaired mobility';
                badgeClass = 'badge-caution';
                recommendations = 'Moderate risk. Consider exercise program and home safety assessment.';
            } else if (tugTime <= 20) {
                interpretation = 'Impaired mobility';
                badgeClass = 'badge-caution';
                recommendations = 'High risk. Refer for comprehensive assessment and multifactorial intervention.';
            } else {
                interpretation = 'Severely impaired mobility';
                badgeClass = 'badge-urgent';
                recommendations = 'Urgent referral to specialist falls service required.';
            }
            
            resultDiv.innerHTML = `
                <div class="test-result">
                    <h5>Result: ${tugTime} seconds</h5>
                    <p><strong>Interpretation:</strong> <span class="badge ${badgeClass}">${interpretation}</span></p>
                    <p><strong>Recommendation:</strong> ${recommendations}</p>
                    <div class="badge-container">
                        <span class="badge ${badgeClass}">TUG Score: ${tugTime}s</span>
                        <span class="badge badge-info">Age-adjusted interpretation</span>
                    </div>
                </div>
            `;
            
            // Add to completed steps
            if (!patientData.completedSteps.includes('tug')) {
                patientData.completedSteps.push('tug');
            }
            
            // Auto-progress if high risk
            if (tugTime > 12) {
                setTimeout(() => {
                    alert('‚ö†Ô∏è Based on TUG score, consider progressing to Risk Stratification step');
                }, 1000);
            }
        }

        function calculateTurnTest() {
            const turnSteps = parseInt(document.getElementById('turnSteps').value);
            const resultDiv = document.getElementById('turnResult');
            
            if (isNaN(turnSteps)) {
                resultDiv.innerHTML = '<p style="color: #e74c3c;">Please select number of steps</p>';
                return;
            }
            
            patientData.turnSteps = turnSteps;
            let interpretation = '';
            let badgeClass = '';
            let recommendations = '';
            
            if (turnSteps <= 3) {
                interpretation = 'Normal turning ability';
                badgeClass = 'badge-stable';
                recommendations = 'No further assessment needed for turning.';
            } else if (turnSteps === 4) {
                interpretation = 'Mild impairment';
                badgeClass = 'badge-caution';
                recommendations = 'Monitor and consider balance exercises.';
            } else {
                interpretation = 'Impaired turning ability';
                badgeClass = 'badge-urgent';
                recommendations = 'Further assessment recommended. Consider referral for balance training.';
            }
            
            resultDiv.innerHTML = `
                <div class="test-result">
                    <h5>Result: ${turnSteps} steps</h5>
                    <p><strong>Interpretation:</strong> <span class="badge ${badgeClass}">${interpretation}</span></p>
                    <p><strong>Recommendation:</strong> ${recommendations}</p>
                    <div class="badge-container">
                        <span class="badge ${badgeClass}">Turn Test: ${turnSteps} steps</span>
                    </div>
                </div>
            `;
            
            if (!patientData.completedSteps.includes('turn')) {
                patientData.completedSteps.push('turn');
            }
        }

        function showFrailtyInfo() {
            alert(`Frailty Assessment (eFI):
‚Ä¢ Age ‚â•65 years
‚Ä¢ Multiple long-term conditions
‚Ä¢ Functional decline
‚Ä¢ Weight loss
‚Ä¢ Reduced mobility
‚Ä¢ Cognitive impairment
‚Ä¢ Social vulnerability

Use Electronic Frailty Index (eFI) for formal assessment.`);
        }

        // Risk stratification functions
        function setRiskLevel(level) {
            patientData.riskLevel = level;
            const resultDiv = document.getElementById('riskResult');
            
            let riskText = '';
            let badgeClass = '';
            let recommendations = '';
            
            switch(level) {
                case 'high':
                    riskText = 'üî¥ HIGH RISK';
                    badgeClass = 'badge-urgent';
                    recommendations = `
                        <strong>Required Actions:</strong>
                        <ul>
                            <li>Refer to specialist falls service</li>
                            <li>Comprehensive multifactorial assessment</li>
                            <li>Multidisciplinary intervention</li>
                            <li>3-month follow-up</li>
                        </ul>
                    `;
                    break;
                case 'moderate':
                    riskText = 'üü° MODERATE RISK';
                    badgeClass = 'badge-caution';
                    recommendations = `
                        <strong>Required Actions:</strong>
                        <ul>
                            <li>Balance and strength exercises</li>
                            <li>Consider home hazard assessment</li>
                            <li>Annual reassessment</li>
                        </ul>
                    `;
                    break;
                case 'low':
                    riskText = 'üü¢ LOW RISK';
                    badgeClass = 'badge-stable';
                    recommendations = `
                        <strong>Required Actions:</strong>
                        <ul>
                            <li>Health promotion advice</li>
                            <li>Stay active</li>
                            <li>Annual screening</li>
                        </ul>
                    `;
                    break;
            }
            
            resultDiv.innerHTML = `
                <div class="test-result">
                    <h5>Risk Classification: <span class="badge ${badgeClass}">${riskText}</span></h5>
                    ${recommendations}
                </div>
            `;
            
            if (!patientData.completedSteps.includes('risk')) {
                patientData.completedSteps.push('risk');
            }
        }

        function showReferralGuidance() {
            alert(`Referral Criteria for Comprehensive Assessment:
            
REQUIRED (any of following):
‚Ä¢ Living with frailty
‚Ä¢ Fall with injury requiring medical treatment
‚Ä¢ Loss of consciousness related to fall
‚Ä¢ Unable to get up independently after fall
‚Ä¢ ‚â•2 falls in past year

CONSIDER:
‚Ä¢ Significant gait/balance abnormalities
‚Ä¢ TUG >12 seconds
‚Ä¢ Turn test ‚â•5 steps
‚Ä¢ Multiple medications (‚â•4 drugs)
‚Ä¢ Significant fear of falling

REFERRAL TO: Specialist falls service or multidisciplinary team`);
        }

        // Treatment functions
        function showExerciseDetails() {
            alert(`Strength & Balance Training Program:
            
Components:
‚Ä¢ Progressive exercises tailored to individual
‚Ä¢ Focus on functional movements
‚Ä¢ Balance, coordination, strength, power
‚Ä¢ Delivered by trained professionals
‚Ä¢ Regular progress reviews
‚Ä¢ Behavior change support

Duration: Typically 12+ weeks
Frequency: 2-3 times per week
Setting: Community or home-based

Evidence: Reduces falls by 23-30% when adhered to`);
        }

        function showHomeHazards() {
            alert(`Common Home Hazards:
            
‚Ä¢ Loose rugs or mats
‚Ä¢ Poor lighting (especially stairs)
‚Ä¢ Uneven surfaces
‚Ä¢ Wet surfaces (bathroom)
‚Ä¢ Loose handrails
‚Ä¢ Cluttered walkways
‚Ä¢ Poor footwear
‚Ä¢ Pets underfoot
‚Ä¢ Inadequate bathroom equipment

Interventions:
‚Ä¢ Install grab bars
‚Ä¢ Improve lighting
‚Ä¢ Remove trip hazards
‚Ä¢ Non-slip mats
‚Ä¢ Stair rails both sides
‚Ä¢ Clutter removal`);
        }

        function showMedGuidance() {
            const medicationType = document.getElementById('medicationReview').value;
            const guidanceDiv = document.getElementById('medGuidance');
            
            if (!medicationType) {
                guidanceDiv.innerHTML = '<p style="color: #e74c3c;">Please select medication type</p>';
                return;
            }
            
            let guidance = '';
            
            switch(medicationType) {
                case 'psychotropic':
                    guidance = `
                        <div class="test-result">
                            <h5>Psychotropic Medication Management</h5>
                            <p><strong>Risk:</strong> Increases falls risk by 1.5-2x</p>
                            <p><strong>Action:</strong> Review with specialist input, discontinue if possible</p>
                            <div class="badge-container">
                                <span class="badge badge-urgent">Deprescribe if possible</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'antihypertensive':
                    guidance = `
                        <div class="test-result">
                            <h5>Antihypertensive Medication Management</h5>
                            <p><strong>Risk:</strong> Postural hypotension risk</p>
                            <p><strong>Action:</strong> Review blood pressure control, consider dose reduction</p>
                            <div class="badge-container">
                                <span class="badge badge-caution">Monitor BP standing/lying</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'polypharmacy':
                    guidance = `
                        <div class="test-result">
                            <h5>Polypharmacy Management</h5>
                            <p><strong>Risk:</strong> Each additional drug increases fall risk</p>
                            <p><strong>Action:</strong> Comprehensive medication review, simplify regimen</p>
                            <div class="badge-container">
                                <span class="badge badge-urgent">Review ‚â•4 medications</span>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            guidanceDiv.innerHTML = guidance;
        }

        function showVisionGuidance() {
            alert(`Vision Assessment & Referral:
            
Refer for vision assessment if:
‚Ä¢ Visual impairment reported
‚Ä¢ Not had eye check in 2+ years
‚Ä¢ New onset visual changes
‚Ä¢ Cataracts affecting function
‚Ä¢ Macular degeneration
‚Ä¢ Diabetic retinopathy

Action:
‚Ä¢ Refer to optometrist/ophthalmologist
‚Ä¢ Update glasses prescription
‚Ä¢ Consider cataract surgery if indicated
‚Ä¢ Address lighting issues at home

Evidence: Vision intervention reduces falls by 15-20%`);
        }

        // Follow-up functions
        function showReassessmentTools() {
            alert(`Reassessment Tools:

‚Ä¢ Timed Up & Go Test
‚Ä¢ Turn 180¬∞ Test
‚Ä¢ Berg Balance Scale
‚Ä¢ Functional Reach Test
‚Ä¢ Tinetti Performance-Oriented Mobility Assessment
‚Ä¢ Patient-reported fall diary

Frequency:
‚Ä¢ High risk: Every 3 months
‚Ä¢ Moderate risk: Every 6 months
‚Ä¢ Low risk: Annually

Key Metrics:
‚Ä¢ Number of falls
‚Ä¢ Fall-related injuries
‚Ä¢ Functional decline
‚Ä¢ Quality of life measures
‚Ä¢ Fear of falling reduction`);
        }

        function completeAlgorithm() {
            const completed = patientData.completedSteps.length;
            const totalSteps = 8; // Total number of assessment steps
            
            if (completed < totalSteps / 2) {
                alert(`‚ö†Ô∏è Algorithm partially complete!
                
Completed: ${completed}/${totalSteps} steps
Please ensure all necessary assessments are completed before marking as done.`);
            } else {
                alert(`‚úÖ Algorithm Complete!
                
Completed: ${completed}/${totalSteps} steps
Summary:
- Patient risk level: ${patientData.riskLevel || 'Not assessed'}
- TUG score: ${patientData.tugTime || 'Not recorded'} seconds
- Turn test: ${patientData.turnSteps || 'Not recorded'} steps
                
Documentation saved to patient record.`);
                
                // Update progress to 100%
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('progressText').textContent = '100';
                
                // Pulse effect on completion
                document.querySelector('.progress-sidebar').classList.add('pulse');
                setTimeout(() => {
                    document.querySelector('.progress-sidebar').classList.remove('pulse');
                }, 2000);
            }
        }

        // Reset function
        function resetAlgorithm() {
            if (confirm('Are you sure you want to reset the algorithm? All entered data will be cleared.')) {
                // Reset patient data
                patientData = {
                    age: null,
                    riskFactors: [],
                    tugTime: null,
                    turnSteps: null,
                    riskLevel: null,
                    completedSteps: []
                };
                
                // Reset form inputs
                document.getElementById('tugTime').value = '';
                document.getElementById('turnSteps').value = '';
                document.getElementById('medicationReview').value = '';
                
                // Clear results
                document.getElementById('tugResult').innerHTML = '';
                document.getElementById('turnResult').innerHTML = '';
                document.getElementById('riskResult').innerHTML = '';
                document.getElementById('medGuidance').innerHTML = '';
                
                // Reset progress
                updateProgress(0);
                
                // Close all cards
                document.querySelectorAll('.card-content').forEach(content => {
                    content.classList.remove('expanded');
                });
                document.querySelectorAll('.expand-icon').forEach(icon => {
                    icon.classList.remove('rotated');
                });
                document.querySelectorAll('.algorithm-card').forEach(card => {
                    card.classList.remove('expanded');
                });
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Auto-expand cards based on scroll position
        let lastScrollTop = 0;
        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const cards = document.querySelectorAll('.algorithm-card');
            
            // Determine which card is in view
            cards.forEach((card, index) => {
                const rect = card.getBoundingClientRect();
                const isVisible = rect.top < window.innerHeight / 2 && rect.bottom > window.innerHeight / 2;
                
                if (isVisible && !card.querySelector('.card-content').classList.contains('expanded')) {
                    // Auto-expand card when scrolled into view
                    setTimeout(() => {
                        card.querySelector('.card-header').click();
                    }, 300);
                }
            });
            
            lastScrollTop = scrollTop;
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowDown') {
                if (currentStep < 3) {
                    updateProgress(currentStep + 1);
                }
            } else if (e.key === 'ArrowUp') {
                if (currentStep > 0) {
                    updateProgress(currentStep - 1);
                }
            } else if (e.key === 'Enter') {
                const activeCard = document.querySelector('.algorithm-card[data-step="' + currentStep + '"]');
                if (activeCard) {
                    const header = activeCard.querySelector('.card-header');
                    header.click();
                }
            }
        });

        // Initialize on page load
        window.addEventListener('load', () => {
            updateProgress(0);
            
            // Add tooltips to key elements
            addTooltipToElement('.tug-instructions', 'TUG Instructions', 'Time from "Go" to when patient sits back down. Use walking aid if normally used.');
            addTooltipToElement('.turn-instructions', 'Turn Test Instructions', 'Count steps needed to turn 180¬∞. Patient uses upper body support if needed.');
            addTooltipToElement('.frailty-assessment', 'Frailty Assessment', 'Use Electronic Frailty Index (eFI) for age 65+ with multimorbidity');
            
            console.log('Falls Assessment Algorithm initialized. Use arrow keys for navigation.');
        });

        // Helper function to add tooltips to elements
        function addTooltipToElement(selector, title, content) {
            const element = document.querySelector(selector);
            if (element) {
                element.setAttribute('data-tooltip', content);
                element.setAttribute('data-tooltip-title', title);
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            localStorage.setItem('fallsAssessmentProgress', JSON.stringify({
                currentStep: currentStep,
                patientData: patientData,
                timestamp: new Date().toISOString()
            }));
        }

        // Load progress from localStorage
        function loadProgress() {
            const saved = localStorage.getItem('fallsAssessmentProgress');
            if (saved) {
                const data = JSON.parse(saved);
                const timestamp = new Date(data.timestamp);
                const now = new Date();
                const hoursSinceSave = (now - timestamp) / (1000 * 60 * 60);
                
                // Only restore if saved within last 24 hours
                if (hoursSinceSave < 24) {
                    if (confirm('Restore previous progress from ' + timestamp.toLocaleString() + '?')) {
                        patientData = data.patientData;
                        updateProgress(data.currentStep);
                        
                        // Restore form values
                        if (patientData.tugTime) {
                            document.getElementById('tugTime').value = patientData.tugTime;
                        }
                        if (patientData.turnSteps) {
                            document.getElementById('turnSteps').value = patientData.turnSteps;
                        }
                    }
                }
            }
        }

        // Auto-save every 30 seconds when data exists
        setInterval(() => {
            if (patientData.completedSteps.length > 0) {
                saveProgress();
            }
        }, 30000);

        // Expose functions globally for debugging
        window.fallsAlgorithm = {
            patientData,
            updateProgress,
            saveProgress,
            loadProgress,
            resetAlgorithm
        };
    </script>
</body>
</html>