<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leg Cramps Clinical Algorithm</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a3a5f;
            --primary-light: #2c5282;
            --primary-dark: #0f2540;
            --secondary: #2a9d8f;
            --accent: #e9c46a;
            --success: #2a9d8f;
            --warning: #f4a261;
            --danger: #e76f51;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --glass: rgba(255, 255, 255, 0.85);
            --shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e6f0ff 0%, #f0f9ff 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.1) 0%, transparent 40%);
            pointer-events: none;
        }

        header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            position: relative;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        header p {
            font-size: 1.3em;
            opacity: 0.85;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .main-content {
            display: flex;
            gap: 30px;
            margin-top: 30px;
        }

        .progress-sidebar {
            width: 280px;
            background: var(--glass);
            border-radius: 16px;
            padding: 25px;
            height: fit-content;
            position: sticky;
            top: 30px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .progress-sidebar:hover {
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.2);
        }

        .progress-sidebar h3 {
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4em;
            font-weight: 600;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(26, 58, 95, 0.1);
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 14px;
            margin-bottom: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .progress-item:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateX(5px);
        }

        .progress-item.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(26, 58, 95, 0.2);
        }

        .progress-item.completed {
            background: linear-gradient(135deg, var(--success) 0%, #21867a 100%);
            color: white;
        }

        .progress-item.completed::after {
            content: '✓';
            position: absolute;
            right: 15px;
            font-weight: bold;
            font-size: 1.2em;
        }

        .progress-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }

        .progress-item.active .progress-icon,
        .progress-item.completed .progress-icon {
            background: rgba(255, 255, 255, 0.2);
        }

        .progress-item.active .progress-icon {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }

        .content-area {
            flex: 1;
        }

        .algorithm-card {
            background: var(--glass);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
            opacity: 0;
            transform: translateY(30px);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .algorithm-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .algorithm-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 45px rgba(31, 38, 135, 0.2);
        }

        .card-header {
            padding: 25px;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, currentColor 0%, rgba(0,0,0,0.1) 100%);
            opacity: 0.9;
            z-index: 0;
        }

        .card-header > * {
            position: relative;
            z-index: 1;
        }

        .card-header:hover {
            filter: brightness(1.1);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 18px;
            font-size: 1.6em;
            font-weight: 600;
        }

        .card-icon {
            font-size: 2em;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .expand-icon {
            font-size: 1.2em;
            transition: var(--transition);
            opacity: 0.8;
        }

        .card-header.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.22, 0.61, 0.36, 1);
            background: rgba(255, 255, 255, 0.7);
        }

        .card-content.expanded {
            max-height: 2000px;
        }

        .card-body {
            padding: 35px;
        }

        .step-section {
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .step-section:hover {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            padding: 20px;
            margin-left: -20px;
            margin-right: -20px;
            padding-left: 20px;
            padding-right: 20px;
        }

        .step-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .step-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .step-content {
            margin-left: 0;
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 8px;
            cursor: help;
            position: relative;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .badge::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85em;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            margin-bottom: 8px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .badge:hover::after {
            opacity: 1;
        }

        .badge-urgent {
            background: linear-gradient(135deg, var(--danger) 0%, #d1583c 100%);
            color: white;
        }

        .badge-caution {
            background: linear-gradient(135deg, var(--warning) 0%, #e08c4f 100%);
            color: white;
        }

        .badge-stable {
            background: linear-gradient(135deg, var(--success) 0%, #21867a 100%);
            color: white;
        }

        .badge-info {
            background: linear-gradient(135deg, var(--primary-light) 0%, #3a6bc0 100%);
            color: white;
        }

        .criteria-list {
            list-style: none;
            margin: 15px 0;
        }

        .criteria-list li {
            padding: 12px 0;
            padding-left: 40px;
            position: relative;
            transition: var(--transition);
            border-radius: 8px;
        }

        .criteria-list li:hover {
            background: rgba(26, 58, 95, 0.03);
        }

        .criteria-list li::before {
            content: '•';
            position: absolute;
            left: 20px;
            color: var(--primary);
            font-size: 1.8em;
            top: 5px;
            line-height: 1;
        }

        .criteria-list li.positive::before {
            content: '✓';
            color: var(--success);
            font-size: 1.4em;
            top: 8px;
        }

        .criteria-list li.negative::before {
            content: '✗';
            color: var(--danger);
            font-size: 1.4em;
            top: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.05em;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255,255,255,0.2), transparent);
            pointer-events: none;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.12);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #21867a 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #e08c4f 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #d1583c 100%);
            color: white;
        }

        .diagnosis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .diagnosis-card {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            padding: 25px;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .diagnosis-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(31, 38, 135, 0.1);
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(26, 58, 95, 0.1);
        }

        .diagnosis-card h4 {
            color: var(--primary);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3em;
        }

        .diagnosis-card ul {
            list-style: none;
            font-size: 0.95em;
        }

        .diagnosis-card li {
            padding: 8px 0;
            padding-left: 28px;
            position: relative;
        }

        .diagnosis-card li::before {
            content: '→';
            position: absolute;
            left: 0;
            color: var(--secondary);
            font-weight: bold;
        }

        .treatment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .treatment-card {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            padding: 25px;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .treatment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(31, 38, 135, 0.1);
            background: rgba(255, 255, 255, 0.9);
        }

        .treatment-card h4 {
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3em;
            color: var(--primary);
        }

        .treatment-card ul {
            list-style: none;
            font-size: 0.95em;
        }

        .treatment-card li {
            padding: 8px 0;
            padding-left: 28px;
            position: relative;
        }

        .treatment-card li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: bold;
            font-size: 1.2em;
            top: 5px;
        }

        .treatment-card .badge {
            margin: 0;
            margin-bottom: 15px;
            display: inline-block;
        }

        .alert {
            padding: 18px;
            border-radius: 12px;
            margin: 20px 0;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            transition: var(--transition);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .alert:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .alert-info {
            background: rgba(52, 152, 219, 0.15);
            color: #1a3a5f;
        }

        .alert-warning {
            background: rgba(243, 156, 18, 0.15);
            color: #7d4e0e;
        }

        .alert-danger {
            background: rgba(231, 76, 60, 0.15);
            color: #7a241d;
        }

        .alert-icon {
            font-size: 1.5em;
            flex-shrink: 0;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1));
        }

        .follow-up-timeline {
            position: relative;
            padding-left: 50px;
        }

        .follow-up-timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
            border-radius: 3px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 35px;
            background: rgba(255, 255, 255, 0.7);
            padding: 25px;
            border-radius: 16px;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .timeline-item:hover {
            transform: translateX(10px);
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 25px rgba(31, 38, 135, 0.1);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -38px;
            top: 30px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid white;
            box-shadow: 0 0 0 3px var(--primary);
            z-index: 2;
        }

        .timeline-item.completed::before {
            background: var(--success);
            box-shadow: 0 0 0 3px var(--success);
        }

        .timeline-item h4 {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timeline-item p {
            font-size: 0.95em;
            color: var(--gray);
        }

        .quick-links {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 100;
        }

        .quick-link-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4em;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .quick-link-btn::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255,255,255,0.3) 0%, transparent 70%);
            pointer-events: none;
        }

        .quick-link-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 8px 25px rgba(26, 58, 95, 0.3);
        }

        .quick-link-btn:active {
            transform: scale(0.95);
        }

        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.4em;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .mobile-menu-toggle:hover {
            transform: scale(1.1);
        }

        @media (max-width: 968px) {
            .main-content {
                flex-direction: column;
            }

            .progress-sidebar {
                width: 100%;
                position: fixed;
                top: 0;
                left: -100%;
                height: 100vh;
                z-index: 999;
                border-radius: 0;
                transition: left 0.4s cubic-bezier(0.22, 0.61, 0.36, 1);
                background: var(--glass);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
            }

            .progress-sidebar.open {
                left: 0;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .quick-links {
                bottom: 20px;
                right: 20px;
            }

            .quick-link-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2em;
            }

            header h1 {
                font-size: 2.2em;
            }

            header p {
                font-size: 1.1em;
            }

            .card-title {
                font-size: 1.4em;
            }

            .card-body {
                padding: 25px;
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .severity-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            margin: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            transition: var(--transition);
        }

        .severity-indicator:hover {
            transform: scale(1.05);
        }

        .severity-indicator.red {
            background: rgba(231, 111, 81, 0.15);
            color: #7a241d;
        }

        .severity-indicator.amber {
            background: rgba(244, 162, 97, 0.15);
            color: #7d4e0e;
        }

        .severity-indicator.green {
            background: rgba(42, 157, 143, 0.15);
            color: #0d4d46;
        }

        .interactive-checklist {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .interactive-checklist h5 {
            margin-bottom: 18px;
            color: var(--primary);
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 0;
            cursor: pointer;
            transition: var(--transition);
            border-radius: 8px;
            padding: 10px;
        }

        .checklist-item:hover {
            background: rgba(26, 58, 95, 0.03);
        }

        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-top: 2px;
            accent-color: var(--primary);
        }

        .checklist-item label {
            cursor: pointer;
            flex: 1;
            font-size: 0.95em;
        }

        .checklist-item.checked {
            opacity: 0.7;
            text-decoration: line-through;
        }

        .floating-section {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--glass);
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(31, 38, 135, 0.2);
            z-index: 2000;
            max-width: 650px;
            max-height: 85vh;
            overflow-y: auto;
            opacity: 0;
            transition: transform 0.4s cubic-bezier(0.22, 0.61, 0.36, 1), opacity 0.4s ease;
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .floating-section.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .close-floating {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.8em;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-floating:hover {
            color: var(--danger);
            background: rgba(231, 111, 81, 0.1);
            transform: rotate(90deg);
        }

        .floating-section h3 {
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 1.8em;
            padding-right: 40px;
            font-weight: 600;
        }

        .floating-section p, .floating-section li {
            color: var(--dark);
        }

        .floating-section ul {
            padding-left: 20px;
            margin: 15px 0;
        }

        .floating-section li {
            margin: 10px 0;
            padding-left: 10px;
        }

        .floating-section strong {
            color: var(--primary);
        }

        .floating-section .btn {
            margin-top: 20px;
        }

        /* Card-specific colors */
        .card-assessment .card-header {
            color: #1a3a5f;
        }

        .card-diagnosis .card-header {
            color: #2a9d8f;
        }

        .card-treatment .card-header {
            color: #e9c46a;
        }

        .card-followup .card-header {
            color: #f4a261;
        }

        .card-safety .card-header {
            color: #e76f51;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .diagnosis-grid,
            .treatment-options {
                grid-template-columns: 1fr;
            }
            
            .timeline-item:hover {
                transform: none;
            }
            
            .floating-section {
                max-width: 90%;
                padding: 25px;
            }
            
            .card-title {
                font-size: 1.3em;
            }
            
            .card-icon {
                font-size: 1.7em;
            }
        }

        /* Print styles */
        @media print {
            .progress-sidebar,
            .quick-links,
            .mobile-menu-toggle,
            .action-buttons {
                display: none;
            }
            
            .card-content {
                max-height: none !important;
            }
            
            .algorithm-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            header {
                background: white !important;
                color: black !important;
            }
            
            body {
                background: white !important;
            }
        }

        /* Accessibility enhancements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        :focus {
            outline: 3px solid var(--accent);
            outline-offset: 2px;
        }

        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 0 0 5px 0;
            z-index: 1001;
        }

        .skip-link:focus {
            top: 0;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --primary: #000;
                --primary-light: #000;
                --primary-dark: #000;
                --secondary: #006400;
                --accent: #ff0;
                --success: #006400;
                --warning: #ff0;
                --danger: #f00;
                --glass: #fff;
            }
            
            .algorithm-card,
            .diagnosis-card,
            .treatment-card,
            .timeline-item,
            .interactive-checklist {
                border: 2px solid #000;
            }
            
            .badge {
                border: 2px solid;
            }
            
            .btn {
                border: 2px solid;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .algorithm-card:hover,
            .diagnosis-card:hover,
            .treatment-card:hover,
            .timeline-item:hover {
                transform: none !important;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --primary: #3a86ff;
                --primary-light: #5e9fff;
                --primary-dark: #1a3a5f;
                --secondary: #2ec4b6;
                --accent: #ffd166;
                --success: #2ec4b6;
                --warning: #ffb347;
                --danger: #ff6b6b;
                --light: #1a1a1a;
                --dark: #f8f9fa;
                --gray: #adb5bd;
                --glass: rgba(30, 30, 46, 0.7);
                --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            }

            body {
                background: linear-gradient(135deg, #121212 0%, #1a1a2e 100%);
                color: var(--dark);
            }

            .card-body,
            .diagnosis-card,
            .treatment-card,
            .timeline-item,
            .interactive-checklist {
                background: rgba(30, 30, 46, 0.5);
            }

            .criteria-list li:hover,
            .checklist-item:hover {
                background: rgba(58, 134, 255, 0.1);
            }

            .step-section:hover {
                background: rgba(58, 134, 255, 0.05);
            }

            .alert-info {
                background: rgba(52, 152, 219, 0.2);
                color: #a3d5ff;
            }

            .alert-warning {
                background: rgba(243, 156, 18, 0.2);
                color: #ffd89c;
            }

            .alert-danger {
                background: rgba(231, 76, 60, 0.2);
                color: #ffb3ac;
            }

            .severity-indicator {
                background: rgba(30, 30, 46, 0.7);
            }

            .severity-indicator.red {
                background: rgba(231, 111, 81, 0.2);
                color: #ffb3ac;
            }

            .severity-indicator.amber {
                background: rgba(244, 162, 97, 0.2);
                color: #ffd89c;
            }

            .severity-indicator.green {
                background: rgba(42, 157, 143, 0.2);
                color: #a3f5eb;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <header>
        <h1><i class="fas fa-procedures"></i> Leg Cramps Clinical Algorithm</h1>
        <p>Interactive Management Guide for Healthcare Professionals</p>
    </header>

    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle navigation menu">
        <i class="fas fa-bars"></i>
    </button>

    <div class="container">
        <div class="main-content">
            <aside class="progress-sidebar" id="progressSidebar" role="navigation" aria-label="Progress navigation">
                <h3><i class="fas fa-route"></i> Algorithm Progress</h3>
                <div class="progress-item active" data-step="assessment" onclick="scrollToCard('assessment')">
                    <div class="progress-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <span>Assessment</span>
                </div>
                <div class="progress-item" data-step="diagnosis" onclick="scrollToCard('diagnosis')">
                    <div class="progress-icon">
                        <i class="fas fa-stethoscope"></i>
                    </div>
                    <span>Diagnosis</span>
                </div>
                <div class="progress-item" data-step="treatment" onclick="scrollToCard('treatment')">
                    <div class="progress-icon">
                        <i class="fas fa-pills"></i>
                    </div>
                    <span>Treatment</span>
                </div>
                <div class="progress-item" data-step="followup" onclick="scrollToCard('followup')">
                    <div class="progress-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <span>Follow-up</span>
                </div>
                <div class="progress-item" data-step="safety" onclick="scrollToCard('safety')">
                    <div class="progress-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <span>Safety</span>
                </div>
            </aside>

            <main class="content-area" id="main-content">
                <!-- Assessment Card -->
                <div class="algorithm-card card-assessment" id="assessment-card">
                    <div class="card-header" onclick="toggleCard(this)" role="button" aria-expanded="true" aria-controls="assessment-content">
                        <div class="card-title">
                            <i class="fas fa-clipboard-check card-icon"></i>
                            Assessment & History Taking
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="card-content expanded" id="assessment-content">
                        <div class="card-body">
                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-question-circle"></i>
                                    Key Questions to Ask
                                </div>
                                <div class="step-content">
                                    <div class="interactive-checklist">
                                        <h5>Click to mark as asked:</h5>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="q1" aria-label="Duration of symptoms">
                                            <label for="q1"><strong>Duration:</strong> When did the cramps start? How long do episodes last?</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="q2" aria-label="Frequency of cramps">
                                            <label for="q2"><strong>Frequency:</strong> How often do cramps occur? (e.g., nightly, weekly)</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="q3" aria-label="Location of cramps">
                                            <label for="q3"><strong>Location:</strong> Which muscles are affected? (calf, thigh, foot)</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="q4" aria-label="Severity of pain">
                                            <label for="q4"><strong>Severity:</strong> Pain rating (0-10 scale)? Sleep disruption?</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="q5" aria-label="Triggers and relief">
                                            <label for="q5"><strong>Triggers:</strong> What brings them on? What provides relief?</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="q6" aria-label="Medical history">
                                            <label for="q6"><strong>Medical History:</strong> Diabetes, thyroid, kidney, liver disease?</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="q7" aria-label="Medication review">
                                            <label for="q7"><strong>Medications:</strong> Diuretics, statins, beta-agonists, etc.?</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="q8" aria-label="Lifestyle factors">
                                            <label for="q8"><strong>Lifestyle:</strong> Exercise habits, fluid intake, footwear?</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-search"></i>
                                    Physical Examination
                                </div>
                                <div class="step-content">
                                    <ul class="criteria-list">
                                        <li>Inspect for muscle wasting, fasciculations</li>
                                        <li>Palpate affected muscles for tenderness</li>
                                        <li>Assess peripheral pulses</li>
                                        <li>Check for varicose veins or swelling</li>
                                        <li>Neurological examination: reflexes, sensation, strength</li>
                                        <li>Evaluate gait and posture</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    Red Flags <span class="badge badge-urgent" data-tooltip="Urgent referral needed">Urgent</span>
                                </div>
                                <div class="step-content">
                                    <div class="alert alert-danger">
                                        <i class="fas fa-exclamation-circle alert-icon"></i>
                                        <div>
                                            <strong>Immediate referral if:</strong>
                                            <ul style="margin-left: 20px; margin-top: 10px;">
                                                <li>Altered consciousness with severe cramps</li>
                                                <li>Anuria or severe fluid disturbances</li>
                                                <li>Hyper/hypothermia with cramps</li>
                                                <li>Severe dehydration</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-vial"></i>
                                    Investigations to Consider
                                </div>
                                <div class="step-content">
                                    <p style="margin-bottom: 15px;">Not always necessary for typical idiopathic cramps:</p>
                                    <ul class="criteria-list">
                                        <li class="negative">U&E, calcium - if electrolyte imbalance suspected</li>
                                        <li class="negative">Thyroid function - if symptoms suggest thyroid disease</li>
                                        <li class="negative">Glucose - if diabetes suspected</li>
                                        <li class="negative">LFTs - if liver disease suspected</li>
                                        <li class="negative">CK - if muscle disease suspected</li>
                                        <li class="negative">Vascular studies - if claudication suspected</li>
                                        <li class="negative">Lumbar spine imaging - if nerve root entrapment suspected</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="showFloatingSection('assessment-summary')">
                                    <i class="fas fa-clipboard"></i> View Summary
                                </button>
                                <button class="btn btn-secondary" onclick="resetChecklist()">
                                    <i class="fas fa-redo"></i> Reset Checklist
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Diagnosis Card -->
                <div class="algorithm-card card-diagnosis" id="diagnosis-card">
                    <div class="card-header" onclick="toggleCard(this)" role="button" aria-expanded="false" aria-controls="diagnosis-content">
                        <div class="card-title">
                            <i class="fas fa-stethoscope card-icon"></i>
                            Differential Diagnosis
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="card-content" id="diagnosis-content">
                        <div class="card-body">
                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-diagnoses"></i>
                                    Key Differentiating Features
                                </div>
                                <div class="diagnosis-grid">
                                    <div class="diagnosis-card">
                                        <h4><i class="fas fa-moon"></i> Nocturnal Leg Cramps</h4>
                                        <ul>
                                            <li>Sudden, painful muscle contractions</li>
                                            <li>Usually calf muscles at night</li>
                                            <li>Lasts seconds to minutes</li>
                                            <li>Relieved by stretching/massage</li>
                                            <li>Muscle hardening visible</li>
                                        </ul>
                                        <span class="severity-indicator green">
                                            <i class="fas fa-check-circle"></i> Most Common
                                        </span>
                                    </div>

                                    <div class="diagnosis-card">
                                        <h4><i class="fas fa-walking"></i> Claudication</h4>
                                        <ul>
                                            <li>Pain with exercise</li>
                                            <li>Relieved by rest</li>
                                            <li>Reduced peripheral pulses</li>
                                            <li>Vascular origin</li>
                                            <li>Predictable distance</li>
                                        </ul>
                                        <span class="severity-indicator amber">
                                            <i class="fas fa-exclamation-triangle"></i> Vascular
                                        </span>
                                    </div>

                                    <div class="diagnosis-card">
                                        <h4><i class="fas fa-legs"></i> Restless Legs Syndrome</h4>
                                        <ul>
                                            <li>Unpleasant sensations (not pain)</li>
                                            <li>Urge to move legs</li>
                                            <li>Worse at rest, evening</li>
                                            <li>Relieved by movement</li>
                                            <li>No muscle hardening</li>
                                        </ul>
                                        <span class="severity-indicator amber">
                                            <i class="fas fa-info-circle"></i> Neurological
                                        </span>
                                    </div>

                                    <div class="diagnosis-card">
                                        <h4><i class="fas fa-tint"></i> Deep Vein Thrombosis</h4>
                                        <ul>
                                            <li>Constant pain/swelling</li>
                                            <li>Warmth and redness</li>
                                            <li>Unilateral leg swelling</li>
                                            <li>Risk factors present</li>
                                            <li>Positive D-dimer</li>
                                        </ul>
                                        <span class="severity-indicator red">
                                            <i class="fas fa-ambulance"></i> Emergency
                                        </span>
                                    </div>

                                    <div class="diagnosis-card">
                                        <h4><i class="fas fa-shoe-prints"></i> Peripheral Neuropathy</h4>
                                        <ul>
                                            <li>Numbness/tingling</li>
                                            <li>Burning sensation</li>
                                            <li>Reduced sensation</li>
                                            <li>Abnormal reflexes</li>
                                            <li>Distributed pattern</li>
                                        </ul>
                                        <span class="severity-indicator amber">
                                            <i class="fas fa-nerve"></i> Neurological
                                        </span>
                                    </div>

                                    <div class="diagnosis-card">
                                        <h4><i class="fas fa-clock"></i> Periodic Limb Movements</h4>
                                        <ul>
                                            <li>Repetitive leg movements</li>
                                            <li>During sleep</li>
                                            <li>Rhythmic dorsiflexion</li>
                                            <li>Non-painful</li>
                                            <li>No muscle hardening</li>
                                        </ul>
                                        <span class="severity-indicator stable">
                                            <i class="fas fa-bed"></i> Sleep Disorder
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-check-double"></i>
                                    Diagnostic Criteria for Idiopathic Cramps
                                </div>
                                <div class="step-content">
                                    <div class="interactive-checklist">
                                        <h5>Confirm all criteria for idiopathic diagnosis:</h5>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="d1">
                                            <label for="d1">Sudden intense calf/foot pain, usually at night or rest</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="d2">
                                            <label for="d2">Visible/palpable muscle knotting or abnormal posture</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="d3">
                                            <label for="d3">Duration: seconds to <10 minutes</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="d4">
                                            <label for="d4">Single muscle/group involvement</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="d5">
                                            <label for="d5">Unilateral symptoms typical</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="d6">
                                            <label for="d6">Good response to stretching/massage</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="d7">
                                            <label for="d7">Residual tenderness may persist</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="d8">
                                            <label for="d8">Sleep disruption common</label>
                                        </div>
                                    </div>
                                    <div id="diagnosis-result" style="margin-top: 20px; display: none;">
                                        <div class="alert alert-success">
                                            <i class="fas fa-check-circle alert-icon"></i>
                                            <div>
                                                <strong>Diagnosis Confirmed:</strong> Idiopathic Nocturnal Leg Cramps
                                                <p style="margin-top: 10px;">All criteria met. Proceed to management.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-arrow-right"></i>
                                    When to Investigate Further
                                </div>
                                <div class="step-content">
                                    <ul class="criteria-list">
                                        <li class="negative">Duration >10 minutes per episode</li>
                                        <li class="negative">Widespread/multiple muscle groups</li>
                                        <li class="negative">Abnormal neurological findings</li>
                                        <li class="negative">Signs of vascular disease</li>
                                        <li class="negative">Young age without risk factors</li>
                                        <li class="negative">Atypical pattern or progression</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="showFloatingSection('diagnosis-aid')">
                                    <i class="fas fa-question-circle"></i> Decision Aid
                                </button>
                                <button class="btn btn-secondary" onclick="showFloatingSection('referral-criteria')">
                                    <i class="fas fa-hospital"></i> Referral Criteria
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Treatment Card -->
                <div class="algorithm-card card-treatment" id="treatment-card">
                    <div class="card-header" onclick="toggleCard(this)" role="button" aria-expanded="false" aria-controls="treatment-content">
                        <div class="card-title">
                            <i class="fas fa-pills card-icon"></i>
                            Management & Treatment Options
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="card-content" id="treatment-content">
                        <div class="card-body">
                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-info-circle"></i>
                                    Self-Care Measures (First Line)
                                </div>
                                <div class="step-content">
                                    <div class="treatment-options">
                                        <div class="treatment-card">
                                            <h4><i class="fas fa-running"></i> Stretching Exercises</h4>
                                            <ul>
                                                <li>Calf stretches 3x daily</li>
                                                <li>Hamstring stretches</li>
                                                <li>Combined stretches more effective</li>
                                                <li>Continue indefinitely if beneficial</li>
                                                <li>Hold stretches for 30 seconds</li>
                                            </ul>
                                            <span class="badge badge-stable">Evidence-Based</span>
                                        </div>

                                        <div class="treatment-card">
                                            <h4><i class="fas fa-bed"></i> Sleep Positioning</h4>
                                            <ul>
                                                <li>Avoid toes pointing down</li>
                                                <li>Prop feet up with pillow</li>
                                                <li>Hang feet over bed end</li>
                                                <li>Loose blankets only</li>
                                                <li>Avoid heavy covers</li>
                                            </ul>
                                            <span class="badge badge-stable">Traditional Advice</span>
                                        </div>

                                        <div class="treatment-card">
                                            <h4><i class="fas fa-massage"></i> During Acute Cramp</h4>
                                            <ul>
                                                <li>Passive stretch of affected muscle</li>
                                                <li>Active dorsiflexion if calf involved</li>
                                                <li>Gentle massage of muscle</li>
                                                <li>Apply heat if helpful</li>
                                                <li>Walk it out if possible</li>
                                            </ul>
                                            <span class="badge badge-stable">Immediate Relief</span>
                                        </div>

                                        <div class="treatment-card">
                                            <h4><i class="fas fa-tint"></i> Lifestyle Measures</h4>
                                            <ul>
                                                <li>Stay well hydrated</li>
                                                <li>Wear supportive footwear</li>
                                                <li>Regular moderate exercise</li>
                                                <li>Avoid prolonged sitting/standing</li>
                                                <li>Maintain healthy weight</li>
                                            </ul>
                                            <span class="badge badge-stable">General Health</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-capsules"></i>
                                    Pharmacological Options
                                </div>
                                <div class="step-content">
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle alert-icon"></i>
                                        <div>
                                            <strong>Important:</strong> Quinine has poor benefit-to-risk ratio and should only be used after careful consideration.
                                        </div>
                                    </div>

                                    <div class="treatment-card" style="border: 2px solid var(--warning); background: #fff3cd;">
                                        <h4><i class="fas fa-pills"></i> Quinine Sulfate <span class="badge badge-caution">Caution</span></h4>
                                        <p><strong>Indication:</strong> Only if ALL criteria met:</p>
                                        <ul>
                                            <li>Treatable causes excluded</li>
                                            <li>Very painful and frequent cramps</li>
                                            <li>Significant quality of life impact</li>
                                            <li>Self-care measures failed</li>
                                            <li>No contraindications present</li>
                                        </ul>
                                        <p style="margin-top: 15px;"><strong>Dosing:</strong> 200-300mg at bedtime for 4 weeks trial</p>
                                        <p><strong>Monitoring:</strong> Sleep and cramp diary required</p>
                                        <p><strong>Duration:</strong> Stop if no benefit after 4 weeks. If effective, review after 3 months.</p>
                                    </div>

                                    <div class="treatment-options">
                                        <div class="treatment-card">
                                            <h4><i class="fas fa-ban"></i> Not Recommended</h4>
                                            <ul>
                                                <li>Magnesium supplements <span class="badge badge-caution">No evidence</span></li>
                                                <li>Vitamin E <span class="badge badge-caution">No evidence</span></li>
                                                <li>Calcium channel blockers <span class="badge badge-caution">No evidence</span></li>
                                                <li>NSAIDs for prevention <span class="badge badge-caution">No evidence</span></li>
                                            </ul>
                                        </div>

                                        <div class="treatment-card">
                                            <h4><i class="fas fa-flask"></i> May Consider</h4>
                                            <ul>
                                                <li>Diltiazem (weak evidence)</li>
                                                <li>Vitamin B complex (if deficient)</li>
                                                <li>Naftidrofuryl (limited data)</li>
                                                <li> gabapentin (case reports)</li>
                                            </ul>
                                            <span class="badge badge-info">Limited Evidence</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-exclamation-circle"></i>
                                    Contraindications to Quinine
                                </div>
                                <div class="step-content">
                                    <div class="severity-indicator red">
                                        <i class="fas fa-times-circle"></i> Absolute Contraindications
                                    </div>
                                    <ul class="criteria-list">
                                        <li class="negative">Previous adverse reaction to quinine (including tonic water)</li>
                                        <li class="negative">Haemolysis or haemoglobinuria</li>
                                        <li class="negative">Optic neuritis</li>
                                        <li class="negative">Tinnitus</li>
                                        <li class="negative">Myasthenia gravis</li>
                                        <li class="negative">Pregnancy (risk of miscarriage/birth defects)</li>
                                    </ul>

                                    <div class="severity-indicator amber">
                                        <i class="fas fa-exclamation-triangle"></i> Use with Caution
                                    </div>
                                    <ul class="criteria-list">
                                        <li>Older adults (increased toxicity risk)</li>
                                        <li>Cardiac disease or QT prolongation risk</li>
                                        <li>Electrolyte disturbances</li>
                                        <li>G6PD deficiency</li>
                                        <li>Drug interactions (see Safety section)</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="showFloatingSection('treatment-plan')">
                                    <i class="fas fa-calendar-plus"></i> Create Treatment Plan
                                </button>
                                <button class="btn btn-warning" onclick="showFloatingSection('quinine-calculator')">
                                    <i class="fas fa-calculator"></i> Quinine Risk Calculator
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Follow-up Card -->
                <div class="algorithm-card card-followup" id="followup-card">
                    <div class="card-header" onclick="toggleCard(this)" role="button" aria-expanded="false" aria-controls="followup-content">
                        <div class="card-title">
                            <i class="fas fa-calendar-check card-icon"></i>
                            Follow-up & Monitoring
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="card-content" id="followup-content">
                        <div class="card-body">
                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-clock"></i>
                                    Follow-up Timeline
                                </div>
                                <div class="step-content">
                                    <div class="follow-up-timeline">
                                        <div class="timeline-item" data-week="2">
                                            <h4><i class="fas fa-calendar-week"></i> 2 Weeks</h4>
                                            <p>Review self-care measures implementation</p>
                                            <p>Assess cramp diary (if started)</p>
                                            <p>Check adherence to stretching regimen</p>
                                        </div>

                                        <div class="timeline-item" data-week="4">
                                            <h4><i class="fas fa-calendar-alt"></i> 4 Weeks</h4>
                                            <p>Evaluate quinine trial effectiveness</p>
                                            <p>Assess side effects</p>
                                            <p><strong>Decision point:</strong> Continue or stop quinine</p>
                                        </div>

                                        <div class="timeline-item" data-week="12">
                                            <h4><i class="fas fa-calendar-check"></i> 12 Weeks</h4>
                                            <p>Comprehensive review if on quinine</p>
                                            <p>Consider trial discontinuation</p>
                                            <p>Assess long-term management plan</p>
                                        </div>

                                        <div class="timeline-item" data-week="26">
                                            <h4><i class="fas fa-calendar-plus"></i> 6 Months</h4>
                                            <p>Annual review for stable patients</p>
                                            <p>Reassess need for continued treatment</p>
                                            <p>Update self-care measures</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-chart-line"></i>
                                    Monitoring Parameters
                                </div>
                                <div class="step-content">
                                    <div class="treatment-options">
                                        <div class="treatment-card">
                                            <h4><i class="fas fa-book"></i> Symptom Diary</h4>
                                            <ul>
                                                <li>Frequency of cramps</li>
                                                <li>Severity (0-10 scale)</li>
                                                <li>Duration of episodes</li>
                                                <li>Sleep disturbance</li>
                                                <li>Response to treatment</li>
                                            </ul>
                                            <button class="btn btn-primary" onclick="showFloatingSection('diary-template')">
                                                <i class="fas fa-download"></i> Download Template
                                            </button>
                                        </div>

                                        <div class="treatment-card">
                                            <h4><i class="fas fa-shield-alt"></i> Safety Monitoring</h4>
                                            <ul>
                                                <li>Platelet count (quinine)</li>
                                                <li>Signs of bleeding/bruising</li>
                                                <li>Visual disturbances</li>
                                                <li>Tinnitus or hearing changes</li>
                                                <li>QT interval (if cardiac risk)</li>
                                            </ul>
                                            <span class="badge badge-caution">Quinine Only</span>
                                        </div>

                                        <div class="treatment-card">
                                            <h4><i class="fas fa-heart"></i> Quality of Life</h4>
                                            <ul>
                                                <li>Sleep quality assessment</li>
                                                <li>Daytime functioning</li>
                                                <li>Mood and anxiety</li>
                                                <li>Exercise tolerance</li>
                                                <li>Medication adherence</li>
                                            </ul>
                                            <span class="badge badge-stable">All Patients</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    When to Reassess Diagnosis
                                </div>
                                <div class="step-content">
                                    <div class="alert alert-warning">
                                        <i class="fas fa-sync-alt alert-icon"></i>
                                        <div>
                                            <strong>Red flags requiring reassessment:</strong>
                                            <ul style="margin-left: 20px; margin-top: 10px;">
                                                <li>Symptoms persist despite optimal treatment</li>
                                                <li>New neurological symptoms develop</li>
                                                <li>Pattern of cramps changes significantly</li>
                                                <li>Patient develops weakness or numbness</li>
                                                <li>Signs of vascular disease emerge</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-users"></i>
                                    Patient Education Points
                                </div>
                                <div class="step-content">
                                    <ul class="criteria-list">
                                        <li class="positive">Reassure about benign nature of idiopathic cramps</li>
                                        <li class="positive">Emphasize importance of regular stretching</li>
                                        <li class="positive">Explain self-management strategies</li>
                                        <li class="positive">Discuss realistic treatment expectations</li>
                                        <li class="positive">Provide written information/resources</li>
                                        <li class="positive">Encourage keeping symptom diary</li>
                                        <li class="positive">Explain when to seek urgent care</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="showFloatingSection('followup-plan')">
                                    <i class="fas fa-calendar"></i> Generate Follow-up Plan
                                </button>
                                <button class="btn btn-secondary" onclick="showFloatingSection('patient-resources')">
                                    <i class="fas fa-book-open"></i> Patient Resources
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Safety Card -->
                <div class="algorithm-card card-safety" id="safety-card">
                    <div class="card-header" onclick="toggleCard(this)" role="button" aria-expanded="false" aria-controls="safety-content">
                        <div class="card-title">
                            <i class="fas fa-shield-alt card-icon"></i>
                            Safety & Adverse Effects
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="card-content" id="safety-content">
                        <div class="card-body">
                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    Quinine Adverse Effects
                                </div>
                                <div class="step-content">
                                    <div class="severity-indicator red">
                                        <i class="fas fa-skull-crossbones"></i> Serious Adverse Effects
                                    </div>
                                    <ul class="criteria-list">
                                        <li class="negative"><strong>Thrombocytopenia:</strong> Can be fatal, monitor for bruising/bleeding</li>
                                        <li class="negative"><strong>Cinchonism:</strong> Nausea, vomiting, tinnitus, deafness, visual disturbances</li>
                                        <li class="negative"><strong>Arrhythmias:</strong> QT prolongation, conduction defects</li>
                                        <li class="negative"><strong>Hypersensitivity:</strong> Angioedema, anaphylaxis</li>
                                        <li class="negative"><strong>Hepatotoxicity:</strong> Elevated liver enzymes</li>
                                        <li class="negative"><strong>Renal failure:</strong> Especially with overdose</li>
                                        <li class="negative"><strong>Respiratory distress:</strong> Especially in myasthenia gravis</li>
                                    </ul>

                                    <div class="severity-indicator amber">
                                        <i class="fas fa-exclamation-circle"></i> Common Side Effects
                                    </div>
                                    <ul class="criteria-list">
                                        <li>Headache and dizziness</li>
                                        <li>Nausea and diarrhea</li>
                                        <li>Abdominal pain</li>
                                        <li>Flushing and rash</li>
                                        <li>Confusion (especially elderly)</li>
                                        <li>Vertigo and tremor</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-pills"></i>
                                    Drug Interactions
                                </div>
                                <div class="step-content">
                                    <div class="treatment-options">
                                        <div class="treatment-card">
                                            <h4><i class="fas fa-plus-circle"></i> Increased Quinine Levels</h4>
                                            <ul>
                                                <li>Azole antifungals</li>
                                                <li>HIV protease inhibitors</li>
                                                <li>Macrolide antibiotics</li>
                                                <li>Amiodarone</li>
                                            </ul>
                                            <span class="badge badge-caution">Avoid Combination</span>
                                        </div>

                                        <div class="treatment-card">
                                            <h4><i class="fas fa-minus-circle"></i> Decreased Quinine Levels</h4>
                                            <ul>
                                                <li>Rifampicin</li>
                                                <li>Carbamazepine</li>
                                                <li>Phenytoin</li>
                                                <li>Phenobarbital</li>
                                            </ul>
                                            <span class="badge badge-info">Dose Adjustment Needed</span>
                                        </div>

                                        <div class="treatment-card">
                                            <h4><i class="fas fa-heartbeat"></i> QT Prolonging Drugs</h4>
                                            <ul>
                                                <li>Amiodarone, Sotalol</li>
                                                <li>Citalopram, Escitalopram</li>
                                                <li>Macrolides, Fluoroquinolones</li>
                                                <li>Antipsychotics</li>
                                            </ul>
                                            <span class="badge badge-urgent">High Risk</span>
                                        </div>

                                        <div class="treatment-card">
                                            <h4><i class="fas fa-tint"></i> Enhanced Effects</h4>
                                            <ul>
                                                <li>Anticoagulants (bleeding risk)</li>
                                                <li>Digoxin (toxicity risk)</li>
                                                <li>Hypoglycemics (hypoglycemia)</li>
                                                <li>Flecainide (arrhythmia risk)</li>
                                            </ul>
                                            <span class="badge badge-caution">Monitor Closely</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-ban"></i>
                                    Contraindications Recap
                                </div>
                                <div class="step-content">
                                    <div class="alert alert-danger">
                                        <i class="fas fa-times-circle alert-icon"></i>
                                        <div>
                                            <strong>ABSOLUTE CONTRAINDICATIONS:</strong>
                                            <ul style="margin-left: 20px; margin-top: 10px;">
                                                <li>Previous quinine reaction</li>
                                                <li>Optic neuritis</li>
                                                <li>Tinnitus</li>
                                                <li>Myasthenia gravis</li>
                                                <li>Pregnancy</li>
                                                <li>Haemolysis/haemoglobinuria</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle alert-icon"></i>
                                        <div>
                                            <strong>CAUTION REQUIRED:</strong>
                                            <ul style="margin-left: 20px; margin-top: 10px;">
                                                <li>Cardiac disease/QT risk</li>
                                                <li>Electrolyte disturbances</li>
                                                <li>G6PD deficiency</li>
                                                <li>Advanced age</li>
                                                <li>Hepatic impairment</li>
                                                <li>Renal impairment</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-ambulance"></i>
                                    Emergency Management
                                </div>
                                <div class="step-content">
                                    <div class="severity-indicator red">
                                        <i class="fas fa-ambulance"></i> Quinine Toxicity
                                    </div>
                                    <div class="alert alert-danger">
                                        <i class="fas fa-skull-crossbones alert-icon"></i>
                                        <div>
                                            <strong>Overdose symptoms:</strong> Visual disturbances, tinnitus, headache, nausea, vomiting, confusion, arrhythmias, seizures
                                            <br><br>
                                            <strong>Immediate action:</strong> STOP quinine, seek emergency care
                                        </div>
                                    </div>

                                    <div class="severity-indicator amber">
                                        <i class="fas fa-exclamation-circle"></i> Severe Cramps
                                    </div>
                                    <div class="alert alert-warning">
                                        <i class="fas fa-procedures alert-icon"></i>
                                        <div>
                                            <strong>When to admit:</strong> Cramps with altered consciousness, anuria, severe electrolyte disturbances, or hyper/hypothermia
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">
                                    <i class="fas fa-user-shield"></i>
                                    Patient Safety Information
                                </div>
                                <div class="step-content">
                                    <div class="interactive-checklist">
                                        <h5>Patient Counseling Checklist:</h5>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="s1">
                                            <label for="s1">Explain risks and benefits of quinine</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="s2">
                                            <label for="s2">Provide written information about side effects</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="s3">
                                            <label for="s3">Instruct to stop if no benefit after 4 weeks</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="s4">
                                            <label for="s4">Warn about signs of thrombocytopenia</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="s5">
                                            <label for="s5">Advise on drug interactions</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="s6">
                                            <label for="s6">Provide emergency contact information</label>
                                        </div>
                                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                            <input type="checkbox" id="s7">
                                            <label for="s7">Document informed consent discussion</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-danger" onclick="showFloatingSection('emergency-protocol')">
                                    <i class="fas fa-exclamation-circle"></i> Emergency Protocol
                                </button>
                                <button class="btn btn-warning" onclick="showFloatingSection('drug-interaction-checker')">
                                    <i class="fas fa-search"></i> Interaction Checker
                                </button>
                                <button class="btn btn-primary" onclick="showFloatingSection('safety-summary')">
                                    <i class="fas fa-file-medical"></i> Safety Summary
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="quick-links" role="navigation" aria-label="Quick actions">
        <button class="quick-link-btn" onclick="showFloatingSection('print-summary')" aria-label="Print summary">
            <i class="fas fa-print"></i>
        </button>
        <button class="quick-link-btn" onclick="showFloatingSection('patient-leaflet')" aria-label="Patient leaflet">
            <i class="fas fa-file-pdf"></i>
        </button>
        <button class="quick-link-btn" onclick="scrollToTop()" aria-label="Scroll to top">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>

    <!-- Floating Sections -->
    <div class="overlay" id="overlay" onclick="closeFloatingSections()"></div>

    <div class="floating-section" id="assessment-summary">
        <button class="close-floating" onclick="closeFloatingSections()" aria-label="Close">×</button>
        <h3><i class="fas fa-clipboard"></i> Assessment Summary</h3>
        <p><strong>Key findings to document:</strong></p>
        <ul>
            <li>History of present complaint (onset, duration, frequency)</li>
            <li>Associated symptoms and triggers</li>
            <li>Medical history and medication review</li>
            <li>Physical examination findings</li>
            <li>Differential diagnosis considered</li>
            <li>Investigations ordered (if any)</li>
            <li>Initial management plan</li>
        </ul>
        <button class="btn btn-primary" onclick="printSection('assessment-summary')">
            <i class="fas fa-print"></i> Print Summary
        </button>
    </div>

    <div class="floating-section" id="treatment-plan">
        <button class="close-floating" onclick="closeFloatingSections()" aria-label="Close">×</button>
        <h3><i class="fas fa-calendar-plus"></i> Treatment Plan Generator</h3>
        <p><strong>Based on your assessment:</strong></p>
        <div id="treatment-plan-content">
            <div class="treatment-card">
                <h4>Recommended Self-Care Measures:</h4>
                <ul>
                    <li>Daily calf and hamstring stretching (3x/day)</li>
                    <li>Optimize sleep position</li>
                    <li>Stay well hydrated</li>
                    <li>Regular moderate exercise</li>
                    <li>Massage during acute episodes</li>
                </ul>
            </div>
            <div class="treatment-card">
                <h4>Pharmacological Treatment:</h4>
                <p id="pharm-plan">Quinine NOT recommended at this stage. Continue self-care measures for 4-6 weeks.</p>
            </div>
            <div class="treatment-card">
                <h4>Follow-up:</h4>
                <ul>
                    <li>Review in 4 weeks</li>
                    <li>Keep symptom diary</li>
                    <li>Return if symptoms worsen or red flags develop</li>
                </ul>
            </div>
        </div>
        <button class="btn btn-primary" onclick="printSection('treatment-plan')">
            <i class="fas fa-print"></i> Print Plan
        </button>
    </div>

    <div class="floating-section" id="emergency-protocol">
        <button class="close-floating" onclick="closeFloatingSections()" aria-label="Close">×</button>
        <h3><i class="fas fa-exclamation-circle"></i> Emergency Protocol</h3>
        <div class="alert alert-danger">
            <i class="fas fa-ambulance alert-icon"></i>
            <h4>Quinine Toxicity</h4>
            <p><strong>Symptoms:</strong> Visual disturbances, tinnitus, severe headache, nausea/vomiting, confusion, arrhythmias, seizures</p>
            <p><strong>Action:</strong></p>
            <ol>
                <li>STOP quinine immediately</li>
                <li>Call emergency services</li>
                <li>Monitor vital signs</li>
                <li>Consider activated charcoal if recent ingestion</li>
                <li>Supportive care in hospital</li>
            </ol>
        </div>
        <div class="alert alert-warning">
            <i class="fas fa-procedures alert-icon"></i>
            <h4>Severe Cramps Requiring Admission</h4>
            <p><strong>Criteria:</strong></p>
            <ul>
                <li>Altered consciousness</li>
                <li>Anuria or severe dehydration</li>
                <li>Extreme electrolyte disturbances</li>
                <li>Hyperthermia or hypothermia</li>
                <li>Rhabdomyolysis suspected</li>
            </ul>
        </div>
    </div>

    <div class="floating-section" id="safety-summary">
        <button class="close-floating" onclick="closeFloatingSections()" aria-label="Close">×</button>
        <h3><i class="fas fa-shield-alt"></i> Safety Summary</h3>
        <p><strong>Key Safety Points for Quinine Use:</strong></p>
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-triangle alert-icon"></i>
            <strong>Black Box Warnings:</strong> Thrombocytopenia, hypersensitivity reactions, QT prolongation
        </div>
        <div class="alert alert-warning">
            <i class="fas fa-info-circle alert-icon"></i>
            <strong>Monitoring Required:</strong> CBC, LFTs, ECG (if cardiac risk), symptom diary
        </div>
        <div class="alert alert-info">
            <i class="fas fa-user-md alert-icon"></i>
            <strong>Patient Selection:</strong> Only after careful risk-benefit assessment and informed consent
        </div>
        <button class="btn btn-primary" onclick="printSection('safety-summary')">
            <i class="fas fa-print"></i> Print Safety Checklist
        </button>
    </div>

    <script>
        // Global variables
        let currentStep = 'assessment';
        let completedSteps = new Set();
        let scrollTimeout;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Show first card expanded
            const firstCard = document.querySelector('.algorithm-card');
            firstCard.classList.add('visible');
            
            // Initialize progress sidebar
            updateProgress();
            
            // Add scroll listener for progress updates
            window.addEventListener('scroll', handleScroll);
            
            // Add intersection observer for fade-in animations
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            
            document.querySelectorAll('.algorithm-card').forEach(card => {
                observer.observe(card);
            });
            
            // Initialize checklist listeners
            initializeChecklists();
            
            // Add keyboard navigation
            document.addEventListener('keydown', handleKeyboardNavigation);
            
            // Set up print functionality
            setupPrintFunctionality();
        });

        // Card toggle functionality
        function toggleCard(header) {
            const content = header.nextElementSibling;
            const isExpanded = header.classList.contains('expanded');
            
            // Close all other cards on mobile for better UX
            if (window.innerWidth < 768) {
                document.querySelectorAll('.card-header.expanded').forEach(h => {
                    if (h !== header) {
                        h.classList.remove('expanded');
                        h.nextElementSibling.classList.remove('expanded');
                        h.setAttribute('aria-expanded', 'false');
                    }
                });
            }
            
            // Toggle current card
            header.classList.toggle('expanded');
            content.classList.toggle('expanded');
            header.setAttribute('aria-expanded', !isExpanded);
            
            // Update progress
            const cardId = header.closest('.algorithm-card').id;
            const step = cardId.replace('-card', '');
            
            if (!isExpanded) {
                completedSteps.add(step);
                updateProgress();
            }
            
            // Smooth scroll to card
            setTimeout(() => {
                header.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // Progress sidebar functionality
        function updateProgress() {
            const cards = document.querySelectorAll('.algorithm-card');
            const scrollPosition = window.scrollY + 200;
            
            cards.forEach((card, index) => {
                const cardTop = card.offsetTop;
                const cardBottom = cardTop + card.offsetHeight;
                const step = card.id.replace('-card', '');
                const progressItem = document.querySelector(`[data-step="${step}"]`);
                
                if (!progressItem) return;
                
                // Update active state
                if (scrollPosition >= cardTop && scrollPosition < cardBottom) {
                    currentStep = step;
                    progressItem.classList.add('active');
                    progressItem.classList.remove('completed');
                } else {
                    progressItem.classList.remove('active');
                    if (completedSteps.has(step) || scrollPosition > cardBottom) {
                        progressItem.classList.add('completed');
                    }
                }
                
                // Add pulse animation to current step
                if (progressItem.classList.contains('active')) {
                    progressItem.querySelector('.progress-icon').classList.add('pulse');
                } else {
                    progressItem.querySelector('.progress-icon').classList.remove('pulse');
                }
            });
        }

        function scrollToCard(step) {
            const card = document.getElementById(`${step}-card`);
            if (card) {
                card.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Expand the card
                const header = card.querySelector('.card-header');
                if (!header.classList.contains('expanded')) {
                    setTimeout(() => toggleCard(header), 300);
                }
                
                // Update progress
                completedSteps.add(step);
                updateProgress();
                
                // Close mobile menu
                if (window.innerWidth < 768) {
                    document.getElementById('progressSidebar').classList.remove('open');
                }
            }
        }

        function handleScroll() {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                updateProgress();
            }, 50);
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const sidebar = document.getElementById('progressSidebar');
            sidebar.classList.toggle('open');
            
            // Update button icon
            const button = document.querySelector('.mobile-menu-toggle');
            const icon = button.querySelector('i');
            if (sidebar.classList.contains('open')) {
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-times');
                button.setAttribute('aria-expanded', 'true');
            } else {
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
                button.setAttribute('aria-expanded', 'false');
            }
        }

        // Checklist functionality
        function initializeChecklists() {
            document.querySelectorAll('.checklist-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        item.classList.add('checked');
                        // Check if all items in this section are checked
                        checkSectionCompletion(item);
                    } else {
                        item.classList.remove('checked');
                    }
                });
            });
            
            // Special handling for diagnosis checklist
            const diagnosisCheckboxes = document.querySelectorAll('#diagnosis-content .checklist-item input[type="checkbox"]');
            diagnosisCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', checkDiagnosisCriteria);
            });
        }

        function toggleChecklistItem(item) {
            const checkbox = item.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
        }

        function checkSectionCompletion(item) {
            const section = item.closest('.step-content');
            const totalItems = section.querySelectorAll('.checklist-item input[type="checkbox"]').length;
            const checkedItems = section.querySelectorAll('.checklist-item input[type="checkbox"]:checked').length;
            
            if (totalItems > 0 && totalItems === checkedItems) {
                // Add completion animation
                const stepSection = item.closest('.step-section');
                stepSection.style.background = 'rgba(42, 157, 143, 0.1)';
                stepSection.style.borderLeft = '4px solid var(--success)';
                
                setTimeout(() => {
                    stepSection.style.background = '';
                    stepSection.style.borderLeft = '';
                }, 2000);
            }
        }

        function checkDiagnosisCriteria() {
            const total = 8;
            const checked = document.querySelectorAll('#diagnosis-content .checklist-item input[type="checkbox"]:checked').length;
            
            if (checked === total) {
                document.getElementById('diagnosis-result').style.display = 'block';
                // Add completion animation
                document.getElementById('diagnosis-result').classList.add('fade-in');
                
                // Mark diagnosis step as completed
                completedSteps.add('diagnosis');
                updateProgress();
            } else {
                document.getElementById('diagnosis-result').style.display = 'none';
            }
        }

        function resetChecklist() {
            document.querySelectorAll('.checklist-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('.checklist-item').classList.remove('checked');
            });
            document.getElementById('diagnosis-result').style.display = 'none';
            
            // Show confirmation
            showNotification('Checklist reset successfully', 'info');
        }

        // Floating sections
        function showFloatingSection(id) {
            const section = document.getElementById(id);
            const overlay = document.getElementById('overlay');
            
            if (section && overlay) {
                section.classList.add('active');
                overlay.classList.add('active');
                
                // Focus management for accessibility
                const firstFocusable = section.querySelector('button, input, a, [tabindex]');
                if (firstFocusable) {
                    setTimeout(() => firstFocusable.focus(), 100);
                }
                
                // Prevent body scroll
                document.body.style.overflow = 'hidden';
            }
        }

        function closeFloatingSections() {
            document.querySelectorAll('.floating-section.active').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('overlay').classList.remove('active');
            
            // Restore body scroll
            document.body.style.overflow = '';
            
            // Return focus to trigger element
            const activeElement = document.activeElement;
            if (activeElement && activeElement.classList.contains('btn')) {
                activeElement.focus();
            }
        }

        // Treatment plan generator
        function generateTreatmentPlan() {
            const content = document.getElementById('treatment-plan-content');
            const pharmPlan = document.getElementById('pharm-plan');
            
            // Simple logic to determine if quinine should be considered
            const severity = prompt('Rate cramp severity (0-10):');
            const frequency = prompt('How many cramps per week?');
            const qolImpact = confirm('Do cramps significantly affect quality of life?');
            const selfCareFailed = confirm('Have self-care measures failed?');
            
            if (severity > 7 && frequency > 3 && qolImpact && selfCareFailed) {
                pharmPlan.innerHTML = '<span class="badge badge-caution">Consider quinine trial after risk assessment</span>';
                pharmPlan.innerHTML += '<ul><li>Prescribe 200-300mg at bedtime</li><li>Trial period: 4 weeks</li><li>Monitor for side effects</li><li>Review after 4 weeks</li></ul>';
            } else {
                pharmPlan.textContent = 'Quinine NOT recommended at this stage. Continue self-care measures for 4-6 weeks.';
            }
            
            showFloatingSection('treatment-plan');
        }

        // Print functionality
        function setupPrintFunctionality() {
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    printCurrentSection();
                }
            });
        }

        function printSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                const printWindow = window.open('', '_blank');
                const content = section.innerHTML;
                
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Print - ${sectionId}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .btn, .close-floating, .quick-links { display: none; }
                            .card-body { padding: 20px; }
                        </style>
                    </head>
                    <body>
                        <h1>Clinical Algorithm - ${sectionId}</h1>
                        ${content}
                        <p style="margin-top: 30px; font-size: 0.8em; color: #666;">
                            Printed on: ${new Date().toLocaleString()}
                        </p>
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
                printWindow.print();
            }
        }

        function printCurrentSection() {
            const visibleCard = document.querySelector('.card-header.expanded');
            if (visibleCard) {
                const cardId = visibleCard.closest('.algorithm-card').id;
                printSection(cardId);
            } else {
                printSection('assessment');
            }
        }

        // Keyboard navigation
        function handleKeyboardNavigation(e) {
            // Arrow key navigation between cards
            if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
                e.preventDefault();
                navigateCards(1);
            } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                e.preventDefault();
                navigateCards(-1);
            }
            
            // Escape key closes floating sections
            if (e.key === 'Escape') {
                closeFloatingSections();
            }
            
            // Enter key expands/collapses cards
            if (e.key === 'Enter' && e.target.classList.contains('card-header')) {
                toggleCard(e.target);
            }
            
            // Space bar toggles checkboxes
            if (e.key === ' ' && e.target.classList.contains('checklist-item')) {
                e.preventDefault();
                toggleChecklistItem(e.target);
            }
        }

        function navigateCards(direction) {
            const cards = Array.from(document.querySelectorAll('.algorithm-card'));
            const currentIndex = cards.findIndex(card => {
                const rect = card.getBoundingClientRect();
                return rect.top >= 0 && rect.top < window.innerHeight / 2;
            });
            
            let targetIndex = currentIndex + direction;
            if (targetIndex < 0) targetIndex = 0;
            if (targetIndex >= cards.length) targetIndex = cards.length - 1;
            
            if (targetIndex !== currentIndex) {
                cards[targetIndex].scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Expand the target card
                const header = cards[targetIndex].querySelector('.card-header');
                if (!header.classList.contains('expanded')) {
                    setTimeout(() => toggleCard(header), 300);
                }
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 3000;
                animation: slideIn 0.3s ease-out;
                max-width: 300px;
            `;
            notification.innerHTML = `
                <i class="fas fa-info-circle"></i> ${message}
                <button onclick="this.parentElement.remove()" style="margin-left: 10px; background: none; border: none; color: inherit; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.animation = 'fadeOut 0.3s ease-in';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Utility functions
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Add event listeners for badges
        document.querySelectorAll('.badge').forEach(badge => {
            badge.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.1)';
            });
            badge.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        });

        // Timeline item click handler
        document.querySelectorAll('.timeline-item').forEach(item => {
            item.addEventListener('click', function() {
                this.classList.toggle('completed');
                
                // Visual feedback
                this.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 200);
            });
        });

        // Save progress to localStorage
        function saveProgress() {
            const progress = {
                currentStep: currentStep,
                completedSteps: Array.from(completedSteps),
                checklistItems: Array.from(document.querySelectorAll('.checklist-item input[type="checkbox"]:checked')).map(cb => cb.id)
            };
            localStorage.setItem('legCrampsAlgorithmProgress', JSON.stringify(progress));
            showNotification('Progress saved', 'success');
        }

        function loadProgress() {
            const saved = localStorage.getItem('legCrampsAlgorithmProgress');
            if (saved) {
                const progress = JSON.parse(saved);
                
                // Restore completed steps
                progress.completedSteps.forEach(step => completedSteps.add(step));
                
                // Restore checklist items
                progress.checklistItems.forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.checked = true;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                });
                
                // Scroll to last position
                setTimeout(() => {
                    scrollToCard(progress.currentStep);
                }, 500);
                
                showNotification('Previous progress loaded', 'info');
            }
        }

        // Add save/load buttons
        const saveButton = document.createElement('button');
        saveButton.className = 'quick-link-btn';
        saveButton.innerHTML = '<i class="fas fa-save"></i>';
        saveButton.onclick = saveProgress;
        saveButton.setAttribute('aria-label', 'Save progress');
        document.querySelector('.quick-links').appendChild(saveButton);

        // Auto-save on page unload
        window.addEventListener('beforeunload', saveProgress);

        // Load progress on page load
        window.addEventListener('load', () => {
            setTimeout(loadProgress, 1000);
        });

        // Accessibility enhancements
        document.querySelectorAll('.card-header').forEach(header => {
            header.setAttribute('tabindex', '0');
            header.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggleCard(this);
                }
            });
        });

        document.querySelectorAll('.progress-item').forEach(item => {
            item.setAttribute('tabindex', '0');
            item.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const step = this.dataset.step;
                    scrollToCard(step);
                }
            });
        });

        // Add ARIA labels
        document.querySelectorAll('.severity-indicator').forEach(indicator => {
            const severity = indicator.classList.contains('red') ? 'urgent' : 
                           indicator.classList.contains('amber') ? 'caution' : 'stable';
            indicator.setAttribute('aria-label', `Severity: ${severity}`);
        });

        // Performance optimization
        const debounce = (func, wait) => {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        };

        // Optimize scroll handler
        const optimizedScrollHandler = debounce(handleScroll, 100);
        window.addEventListener('scroll', optimizedScrollHandler);

        console.log('Leg Cramps Clinical Algorithm loaded successfully');
        console.log('Keyboard shortcuts:');
        console.log('- Arrow keys: Navigate between cards');
        console.log('- Enter/Space: Expand/collapse cards');
        console.log('- Escape: Close floating sections');
        console.log('- Ctrl+P: Print current section');
        console.log('Auto-save enabled - your progress will be saved automatically');
    </script>
</body>
</html>