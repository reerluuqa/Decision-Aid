<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Back Pain Clinical Algorithm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
        }

        /* Sidebar Styles */
        .sidebar {
            position: sticky;
            top: 20px;
            width: 280px;
            height: fit-content;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .sidebar h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .progress-steps {
            list-style: none;
        }

        .progress-steps li {
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-steps li:last-child {
            border-bottom: none;
        }

        .progress-steps li:hover {
            color: #667eea;
            transform: translateX(5px);
        }

        .progress-steps li.active {
            color: #667eea;
            font-weight: 600;
        }

        .progress-steps li.completed {
            color: #10b981;
        }

        .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .progress-steps li.active .step-icon {
            background: #667eea;
            color: white;
        }

        .progress-steps li.completed .step-icon {
            background: #10b981;
            color: white;
        }

        .progress-bar {
            margin-top: 20px;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .cards-container {
            display: grid;
            gap: 25px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
        }

        .card-header {
            padding: 25px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s ease;
        }

        .card-header:hover {
            filter: brightness(110%);
        }

        .card-icon {
            font-size: 3em;
            transition: transform 0.3s ease;
        }

        .card:hover .card-icon {
            transform: scale(1.1);
        }

        .card-title {
            flex: 1;
        }

        .card-title h2 {
            font-size: 1.6em;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .card-title p {
            opacity: 0.9;
            font-size: 0.95em;
        }

        .expand-icon {
            font-size: 1.5em;
            transition: transform 0.4s ease;
        }

        .card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        /* Card Colors */
        .assessment .card-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .diagnosis .card-header {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .treatment .card-header {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .followup .card-header {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
        }

        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .card.expanded .card-content {
            max-height: 2000px;
        }

        .card-body {
            padding: 25px;
        }

        /* Red Flags Section */
        .red-flags-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .flag-item {
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid;
            background: #f9f9f9;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .flag-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .flag-urgent {
            border-left-color: #ef4444;
            background: linear-gradient(to right, #fef2f2, #ffffff);
        }

        .flag-caution {
            border-left-color: #f59e0b;
            background: linear-gradient(to right, #fffbeb, #ffffff);
        }

        .flag-stable {
            border-left-color: #10b981;
            background: linear-gradient(to right, #f0fdf4, #ffffff);
        }

        .flag-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .severity-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-urgent {
            background: #ef4444;
            color: white;
        }

        .badge-caution {
            background: #f59e0b;
            color: white;
        }

        .badge-stable {
            background: #10b981;
            color: white;
        }

        /* Checklist Styles */
        .checklist {
            list-style: none;
        }

        .checklist li {
            padding: 15px;
            margin: 8px 0;
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checklist li:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .checklist li.checked {
            background: #f0fdf4;
            border-color: #10b981;
        }

        .checklist li.checked::before {
            content: "‚úì";
            color: #10b981;
            font-weight: bold;
            font-size: 1.2em;
        }

        .checklist li::before {
            content: "‚óã";
            color: #999;
            font-size: 1.2em;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-urgent {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-urgent:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                position: relative;
                top: 0;
                width: 100%;
                margin-bottom: 20px;
            }

            .header h1 {
                font-size: 2em;
            }
        }

        @media (max-width: 768px) {
            .cards-container {
                grid-template-columns: 1fr;
            }

            .red-flags-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Print Styles */
        @media print {
            .sidebar {
                display: none;
            }

            .card-content {
                max-height: none !important;
            }

            .card {
                break-inside: avoid;
                margin-bottom: 20px;
            }
        }

        /* Alert Styles */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-urgent {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }

        .alert-caution {
            background: #fef3c7;
            border: 1px solid #fed7aa;
            color: #92400e;
        }

        .alert-info {
            background: #dbeafe;
            border: 1px solid #bfdbfe;
            color: #1e40af;
        }

        /* Interactive Elements */
        .interactive-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
            border: 2px dashed #d1d5db;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .counter {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            font-size: 1.5em;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.4s ease;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translate(-50%, -40%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .close-modal {
            float: right;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: #667eea;
        }
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <!-- Sidebar Progress Indicator -->
        <aside class="sidebar">
            <h3>üìä Algorithm Progress</h3>
            <ul class="progress-steps">
                <li class="active" data-step="assessment">
                    <div class="step-icon">1</div>
                    <span>Assessment & Red Flags</span>
                </li>
                <li data-step="diagnosis">
                    <div class="step-icon">2</div>
                    <span>Diagnosis & Examination</span>
                </li>
                <li data-step="treatment">
                    <div class="step-icon">3</div>
                    <span>Treatment & Management</span>
                </li>
                <li data-step="followup">
                    <div class="step-icon">4</div>
                    <span>Follow-up & Referral</span>
                </li>
            </ul>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div style="margin-top: 15px; text-align: center; font-size: 0.9em; color: #666;">
                <span id="progressText">25% Complete</span>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <h1>üè• Back Pain Assessment Algorithm</h1>
                <p>Interactive clinical decision support tool based on BMJ Best Practice Guidelines</p>
                <p style="margin-top: 10px; font-size: 0.9em; color: #666;">Last updated: September 2025</p>
            </div>

            <div class="cards-container">
                <!-- Assessment Card -->
                <div class="card assessment" id="assessment">
                    <div class="card-header" onclick="toggleCard('assessment')">
                        <div class="card-icon">üö®</div>
                        <div class="card-title">
                            <h2>Initial Assessment & Red Flags</h2>
                            <p>Screen for emergencies and high-risk features</p>
                        </div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                    <div class="card-content">
                        <div class="card-body">
                            <div class="alert alert-urgent">
                                <strong>‚ö†Ô∏è Priority:</strong> Always screen for red flags first before proceeding with routine assessment
                            </div>

                            <div class="interactive-section">
                                <div class="section-title">
                                    üö© Red Flags Checklist
                                    <span class="counter" id="redFlagCount">0/15 Checked</span>
                                </div>
                                <ul class="checklist" id="redFlagChecklist">
                                    <li onclick="toggleCheck(this)"><strong>Saddle anesthesia</strong> - Loss of sensation in perineal area</li>
                                    <li onclick="toggleCheck(this)"><strong>Sphincter disturbance</strong> - Bladder/bowel dysfunction, retention, incontinence</li>
                                    <li onclick="toggleCheck(this)"><strong>Progressive neurological deficit</strong> - Worsening weakness or sensory loss</li>
                                    <li onclick="toggleCheck(this)"><strong>History of malignancy</strong> - New back pain with cancer history</li>
                                    <li onclick="toggleCheck(this)"><strong>Systemic symptoms</strong> - Fever, chills, night sweats, unexplained weight loss</li>
                                    <li onclick="toggleCheck(this)"><strong>IV drug use</strong> - Current or past intravenous drug use</li>
                                    <li onclick="toggleCheck(this)"><strong>Immunosuppression</strong> - Steroids, chemotherapy, HIV</li>
                                    <li onclick="toggleCheck(this)"><strong>Significant trauma</strong> - Major injury or minor trauma in elderly/osteoporotic</li>
                                    <li onclick="toggleCheck(this)"><strong>Thoracic pain</strong> - Mid-back pain (more likely serious)</li>
                                    <li onclick="toggleCheck(this)"><strong>Age >50 years</strong> - New onset pain in older adults</li>
                                    <li onclick="toggleCheck(this)"><strong>Osteoporosis risk</strong> - Chronic steroid use, fragility fractures</li>
                                    <li onclick="toggleCheck(this)"><strong>Rest/night pain</strong> - Pain unrelieved by rest or present at night</li>
                                    <li onclick="toggleCheck(this)"><strong>Contusion over spine</strong> - Bruising or deformity over spinal area</li>
                                    <li onclick="toggleCheck(this)"><strong>Refractory pain</strong> - Not responding to conservative treatment</li>
                                    <li onclick="toggleCheck(this)"><strong>Bilateral sciatica</strong> - Nerve pain in both legs</li>
                                </ul>
                            </div>

                            <div id="redFlagAlert"></div>

                            <div class="section-title" style="margin-top: 30px;">üìã History Taking</div>
                            <div class="red-flags-grid">
                                <div class="flag-item flag-stable">
                                    <div class="flag-title">Onset & Duration
                                        <span class="severity-badge badge-stable">Routine</span>
                                    </div>
                                    <div>Mechanical: Sudden onset, related to activity</div>
                                </div>
                                <div class="flag-item flag-caution">
                                    <div class="flag-title">Pain Character
                                        <span class="severity-badge badge-caution">Worrying</span>
                                    </div>
                                    <div>Non-mechanical: Constant, progressive, nocturnal</div>
                                </div>
                                <div class="flag-item flag-urgent">
                                    <div class="flag-title">Neurological Symptoms
                                        <span class="severity-badge badge-urgent">Urgent</span>
                                    </div>
                                    <div>Weakness, numbness, gait disturbance</div>
                                </div>
                                <div class="flag-item flag-stable">
                                    <div class="flag-title">Functional Impact</div>
                                    <div>Work, ADLs, sleep disturbance</div>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-urgent" onclick="showAlert('urgent')">
                                    üö® Urgent Referral Needed
                                </button>
                                <button class="btn btn-primary" onclick="scrollToCard('diagnosis')">
                                    Continue to Examination ‚Üí
                                </button>
                                <button class="btn btn-secondary" onclick="clearChecks()">
                                    Clear All
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Diagnosis Card -->
                <div class="card diagnosis" id="diagnosis">
                    <div class="card-header" onclick="toggleCard('diagnosis')">
                        <div class="card-icon">üî¨</div>
                        <div class="card-title">
                            <h2>Physical Examination & Diagnosis</h2>
                            <p>Systematic assessment and investigations</p>
                        </div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                    <div class="card-content">
                        <div class="card-body">
                            <div class="alert alert-info">
                                <strong>üí° Tip:</strong> Most low back pain is mechanical (97%) and self-limiting
                            </div>

                            <div class="section-title">üîç Physical Examination</div>
                            <ul class="checklist">
                                <li onclick="toggleCheck(this)">Inspection for deformity, curvature, posture</li>
                                <li onclick="toggleCheck(this)">Palpation for tenderness, step-offs</li>
                                <li onclick="toggleCheck(this)">Range of motion assessment (flexion, extension, lateral bending)</li>
                                <li onclick="toggleCheck(this)">Neurological examination (strength, sensation, reflexes)</li>
                                <li onclick="toggleCheck(this)">Provocative tests (SLR, femoral stretch, SIJ tests)</li>
                                <li onclick="toggleCheck(this)">Vascular examination (pulses, claudication)</li>
                                <li onclick="toggleCheck(this)">Hip examination (rule out hip pathology)</li>
                            </ul>

                            <div class="section-title" style="margin-top: 30px;">üéØ Differential Diagnosis</div>
                            <div class="red-flags-grid">
                                <div class="flag-item flag-stable">
                                    <div class="flag-title">Mechanical (97%)
                                        <span class="severity-badge badge-stable">Common</span>
                                    </div>
                                    <div>Muscle strain, degenerative disc disease, facet arthropathy</div>
                                </div>
                                <div class="flag-item flag-caution">
                                    <div class="flag-title">Radicular
                                        <span class="severity-badge badge-caution">Moderate</span>
                                    </div>
                                    <div>Disc herniation, spinal stenosis with neurogenic claudication</div>
                                </div>
                                <div class="flag-item flag-urgent">
                                    <div class="flag-title">Systemic (1%)
                                        <span class="severity-badge badge-urgent">Serious</span>
                                    </div>
                                    <div>Infection, malignancy, inflammatory spondyloarthropathy</div>
                                </div>
                                <div class="flag-item flag-caution">
                                    <div class="flag-title">Referred (2%)
                                        <span class="severity-badge badge-caution">Investigate</span>
                                    </div>
                                    <div>AAA, pancreatitis, renal colic, peptic ulcer</div>
                                </div>
                            </div>

                            <div class="section-title" style="margin-top: 30px;">ü©ª Imaging Guidelines</div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                <div style="padding: 20px; background: #f0fdf4; border-radius: 10px; border: 1px solid #bbf7d0;">
                                    <strong style="color: #10b981;">No Imaging Needed</strong><br>
                                    <small>No red flags, &lt;6 weeks duration, responding to treatment</small>
                                </div>
                                <div style="padding: 20px; background: #fffbeb; border-radius: 10px; border: 1px solid #fed7aa;">
                                    <strong style="color: #f59e0b;">Consider Imaging</strong><br>
                                    <small>Persistent &gt;6 weeks, progressive symptoms, surgical candidate</small>
                                </div>
                                <div style="padding: 20px; background: #fee2e2; border-radius: 10px; border: 1px solid #fecaca;">
                                    <strong style="color: #ef4444;">Urgent MRI</strong><br>
                                    <small>Red flags, neurological deficit, suspected infection/malignancy</small>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="scrollToCard('treatment')">
                                    ‚Üí Treatment Options
                                </button>
                                <button class="btn btn-secondary" onclick="showModal('imaging-criteria')">
                                    üìã Detailed Imaging Criteria
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Treatment Card -->
                <div class="card treatment" id="treatment">
                    <div class="card-header" onclick="toggleCard('treatment')">
                        <div class="card-icon">üíä</div>
                        <div class="card-title">
                            <h2>Treatment & Management</h2>
                            <p>Evidence-based management strategies</p>
                        </div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                    <div class="card-content">
                        <div class="card-body">
                            <div class="alert alert-info">
                                <strong>üìä Evidence:</strong> Most patients improve with conservative management within 6 weeks
                            </div>

                            <div class="section-title">üè• Conservative Management</div>
                            <div class="red-flags-grid">
                                <div class="flag-item flag-stable">
                                    <div class="flag-title">Activity & Education
                                        <span class="severity-badge badge-stable">First-line</span>
                                    </div>
                                    <div>Stay active, avoid bed rest, ergonomic advice</div>
                                </div>
                                <div class="flag-item flag-stable">
                                    <div class="flag-title">Analgesia</div>
                                    <div>NSAIDs first-line, consider neuropathic agents for radicular pain</div>
                                </div>
                                <div class="flag-item flag-stable">
                                    <div class="flag-title">Physical Therapy</div>
                                    <div>Exercise programs, manual therapy, core strengthening</div>
                                </div>
                                <div class="flag-item flag-caution">
                                    <div class="flag-title">Psychosocial Support
                                        <span class="severity-badge badge-caution">If Needed</span>
                                    </div>
                                    <div>Cognitive behavioral therapy for chronic pain</div>
                                </div>
                            </div>

                            <div class="section-title" style="margin-top: 30px;">‚ö†Ô∏è Red Flag Management</div>
                            <div style="display: grid; gap: 15px;">
                                <div style="padding: 20px; background: #fee2e2; border-radius: 10px; border-left: 5px solid #ef4444;">
                                    <strong style="color: #ef4444;">üö® Cauda Equina Syndrome</strong><br>
                                    <small>Emergency MRI ‚Üí Urgent surgical decompression</small>
                                </div>
                                <div style="padding: 20px; background: #fee2e2; border-radius: 10px; border-left: 5px solid #ef4444;">
                                    <strong style="color: #ef4444;">ü¶† Spinal Infection</strong><br>
                                    <small>IV antibiotics ¬± surgical drainage, blood cultures first</small>
                                </div>
                                <div style="padding: 20px; background: #fee2e2; border-radius: 10px; border-left: 5px solid #ef4444;">
                                    <strong style="color: #ef4444;">üéóÔ∏è Malignancy</strong><br>
                                    <small>Urgent oncology referral, consider steroids/radiotherapy</small>
                                </div>
                                <div style="padding: 20px; background: #fef3c7; border-radius: 10px; border-left: 5px solid #f59e0b;">
                                    <strong style="color: #f59e0b;">üí• Compression Fracture</strong><br>
                                    <small>Bracing, pain control, osteoporosis treatment</small>
                                </div>
                            </div>

                            <div class="section-title" style="margin-top: 30px;">üî™ Surgical Indications</div>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                                    <span style="color: #ef4444;">‚óè</span> Cauda equina syndrome
                                </li>
                                <li style="padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                                    <span style="color: #f59e0b;">‚óè</span> Progressive neurological deficit
                                </li>
                                <li style="padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                                    <span style="color: #f59e0b;">‚óè</span> Refractory radicular pain (&gt;6-8 weeks)
                                </li>
                                <li style="padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                                    <span style="color: #10b981;">‚óè</span> Severe spinal stenosis with claudication
                                </li>
                                <li style="padding: 10px 0;">
                                    <span style="color: #ef4444;">‚óè</span> Spinal instability/trauma
                                </li>
                            </ul>

                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="scrollToCard('followup')">
                                    ‚Üí Follow-up Plan
                                </button>
                                <button class="btn btn-urgent" onclick="showModal('urgent-referral')">
                                    üö® Emergency Referral
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Follow-up Card -->
                <div class="card followup" id="followup">
                    <div class="card-header" onclick="toggleCard('followup')">
                        <div class="card-icon">üìà</div>
                        <div class="card-title">
                            <h2>Follow-up & Referral</h2>
                            <p>Monitoring and escalation pathways</p>
                        </div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                    <div class="card-content">
                        <div class="card-body">
                            <div class="section-title">üìÖ Follow-up Timeline</div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="text-align: center; padding: 20px; background: #f0fdf4; border-radius: 10px;">
                                    <div style="font-size: 2em; color: #10b981;">2-4</div>
                                    <div style="font-weight: 600;">Weeks</div>
                                    <small style="color: #666;">Initial review</small>
                                </div>
                                <div style="text-align: center; padding: 20px; background: #fffbeb; border-radius: 10px;">
                                    <div style="font-size: 2em; color: #f59e0b;">6-8</div>
                                    <div style="font-weight: 600;">Weeks</div>
                                    <small style="color: #666;">Reassess, consider imaging</small>
                                </div>
                                <div style="text-align: center; padding: 20px; background: #fef3c7; border-radius: 10px;">
                                    <div style="font-size: 2em; color: #f59e0b;">12</div>
                                    <div style="font-weight: 600;">Weeks</div>
                                    <small style="color: #666;">Chronic pain evaluation</small>
                                </div>
                            </div>

                            <div class="section-title" style="margin-top: 30px;">üè• Referral Pathways</div>
                            <div class="red-flags-grid">
                                <div class="flag-item flag-urgent">
                                    <div class="flag-title">üö® Emergency
                                        <span class="severity-badge badge-urgent">Immediately</span>
                                    </div>
                                    <div>Cauda equina, cord compression, infection, AAA rupture</div>
                                </div>
                                <div class="flag-item flag-caution">
                                    <div class="flag-title">‚ö° Urgent
                                        <span class="severity-badge badge-caution">Same Day/Week</span>
                                    </div>
                                    <div>Malignancy suspected, progressive deficit, severe pain</div>
                                </div>
                                <div class="flag-item flag-caution">
                                    <div class="flag-title">üéØ Specialist
                                        <span class="severity-badge badge-caution">Routine</span>
                                    </div>
                                    <div>Surgical evaluation, chronic pain, rheumatology</div>
                                </div>
                                <div class="flag-item flag-stable">
                                    <div class="flag-title">üë®‚Äç‚öïÔ∏è Primary Care
                                        <span class="severity-badge badge-stable">Ongoing</span>
                                    </div>
                                    <div>Mechanical pain, stable conditions, follow-up</div>
                                </div>
                            </div>

                            <div class="section-title" style="margin-top: 30px;">üéØ Chronic Pain Assessment</div>
                            <div style="padding: 20px; background: #f9fafb; border-radius: 10px;">
                                <p style="margin-bottom: 15px;"><strong>STarT Back Tool:</strong> Risk stratification for persistent disability</p>
                                <ul style="list-style: none; padding: 0;">
                                    <li style="padding: 8px 0;"><span style="color: #10b981;">‚óè</span> <strong>Low Risk:</strong> Self-management, advice</li>
                                    <li style="padding: 8px 0;"><span style="color: #f59e0b;">‚óè</span> <strong>Medium Risk:</strong> Physical therapy, exercise</li>
                                    <li style="padding: 8px 0;"><span style="color: #ef4444;">‚óè</span> <strong>High Risk:</strong> CBT, multidisciplinary care</li>
                                </ul>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-secondary" onclick="window.print()">
                                    üñ®Ô∏è Print Summary
                                </button>
                                <button class="btn btn-primary" onclick="resetAlgorithm()">
                                    üîÑ Reset Algorithm
                                </button>
                                <button class="btn btn-secondary" onclick="showModal('references')">
                                    üìö References
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="scrollToTop()" title="Back to top">‚¨ÜÔ∏è</button>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // Global state
        let currentStep = 1;
        let redFlagCount = 0;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Enable first card by default
            document.getElementById('assessment').classList.add('expanded');
            updateProgress();
        });

        // Toggle card expansion
        function toggleCard(cardId) {
            const card = document.getElementById(cardId);
            const allCards = document.querySelectorAll('.card');
            
            // Close all other cards
            allCards.forEach(c => {
                if (c.id !== cardId) {
                    c.classList.remove('expanded');
                }
            });
            
            // Toggle current card
            card.classList.toggle('expanded');
            
            // Update current step
            const stepMap = {
                'assessment': 1,
                'diagnosis': 2,
                'treatment': 3,
                'followup': 4
            };
            
            if (card.classList.contains('expanded')) {
                currentStep = stepMap[cardId];
                updateProgress();
                updateSidebar();
            }
        }

        // Update progress bar and text
        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const percentage = (currentStep / 4) * 100;
            
            progressFill.style.width = percentage + '%';
            progressText.textContent = Math.round(percentage) + '% Complete';
        }

        // Update sidebar active state
        function updateSidebar() {
            const steps = document.querySelectorAll('.progress-steps li');
            steps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 === currentStep) {
                    step.classList.add('active');
                } else if (index + 1 < currentStep) {
                    step.classList.add('completed');
                }
            });
        }

        // Toggle checklist items
        function toggleCheck(element) {
            element.classList.toggle('checked');
            updateRedFlagCount();
        }

        // Update red flag counter
        function updateRedFlagCount() {
            const checkedItems = document.querySelectorAll('#redFlagChecklist li.checked');
            redFlagCount = checkedItems.length;
            document.getElementById('redFlagCount').textContent = `${redFlagCount}/15 Checked`;
            
            // Show alert if red flags detected
            const alertDiv = document.getElementById('redFlagAlert');
            if (redFlagCount > 0) {
                let alertHTML = '';
                if (redFlagCount >= 3) {
                    alertHTML = `<div class="alert alert-urgent">
                        <strong>üö® ${redFlagCount} red flags detected!</strong> Consider urgent referral for imaging
                    </div>`;
                } else if (redFlagCount >= 1) {
                    alertHTML = `<div class="alert alert-caution">
                        <strong>‚ö†Ô∏è ${redFlagCount} red flag(s) detected.</strong> Monitor closely and consider early referral
                    </div>`;
                }
                alertDiv.innerHTML = alertHTML;
            } else {
                alertDiv.innerHTML = '';
            }
        }

        // Clear all checks
        function clearChecks() {
            document.querySelectorAll('#redFlagChecklist li').forEach(item => {
                item.classList.remove('checked');
            });
            updateRedFlagCount();
        }

        // Scroll to specific card
        function scrollToCard(cardId) {
            const card = document.getElementById(cardId);
            card.scrollIntoView({ behavior: 'smooth', block: 'start' });
            setTimeout(() => {
                card.classList.add('expanded');
                currentStep = {
                    'assessment': 1,
                    'diagnosis': 2,
                    'treatment': 3,
                    'followup': 4
                }[cardId];
                updateProgress();
                updateSidebar();
            }, 300);
        }

        // Scroll to top
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show alert modal
        function showAlert(type) {
            if (type === 'urgent') {
                showModal('urgent-referral');
            }
        }

        // Modal functions
        function showModal(contentType) {
            const modal = document.getElementById('modal');
            const modalBody = document.getElementById('modalBody');
            
            const content = {
                'imaging-criteria': `
                    <h3>üìã Detailed Imaging Criteria</h3>
                    <h4>Plain X-ray Indications:</h4>
                    <ul>
                        <li>Suspected fracture (trauma, osteoporosis)</li>
                        <li>Plain X-ray Indications:</li>
                        <ul>
                            <li>Suspected fracture (trauma, osteoporosis)</li>
                            <li>Sacroiliitis evaluation</li>
                            <li>Scoliosis assessment</li>
                            <li>Spondylolisthesis suspicion</li>
                        </ul>
                    </ul>
                    <h4>MRI Indications:</h4>
                    <ul>
                        <li>Red flags present</li>
                        <li>Progressive neurological deficit</li>
                        <li>Infection or malignancy suspected</li>
                        <li>Persistent pain >6 weeks (if surgical candidate)</li>
                        <li>Cauda equina evaluation</li>
                    </ul>
                    <h4>CT Indications:</h4>
                    <ul>
                        <li>Trauma assessment (high sensitivity for fractures)</li>
                        <li>Contraindication to MRI</li>
                        <li>Pre-operative planning</li>
                        <li>CT myelogram alternative to MRI</li>
                    </ul>
                `,
                'urgent-referral': `
                    <h3>üö® Emergency Referral Criteria</h3>
                    <div style="background: #fee2e2; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <h4>IMMEDIATE (Same Day):</h4>
                        <ul>
                            <li>Cauda equina syndrome</li>
                            <li>Acute spinal cord compression</li>
                            <li>Suspected spinal infection with sepsis</li>
                            <li>Ruptured AAA</li>
                        </ul>
                    </div>
                    <div style="background: #fef3c7; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <h4>URGENT (Within 24-48 hours):</h4>
                        <ul>
                            <li>Suspected malignancy</li>
                            <li>Progressive neurological deficit</li>
                            <li>Spinal infection (stable patient)</li>
                            <li>Severe/progressive pain unresponsive to treatment</li>
                        </ul>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-urgent" onclick="alert('In a real system, this would trigger emergency referral workflow')">
                            Activate Emergency Referral
                        </button>
                    </div>
                `,
                'references': `
                    <h3>üìö Key References</h3>
                    <ul style="line-height: 1.8;">
                        <li><strong>NICE Guidelines:</strong> Low back pain and sciatica (NG59, 2020)</li>
                        <li><strong>American College of Radiology:</strong> ACR Appropriateness Criteria (2021)</li>
                        <li><strong>BMJ Best Practice:</strong> Assessment of back pain (2025)</li>
                        <li><strong>Lancet:</strong> Global burden of low back pain series (2018)</li>
                        <li><strong>European Spine Journal:</strong> Clinical practice guidelines (2018)</li>
                    </ul>
                    <p style="margin-top: 20px; font-size: 0.9em; color: #666;">
                        This algorithm is for educational purposes. Always consult current guidelines and specialist advice.
                    </p>
                `
            };
            
            modalBody.innerHTML = content[contentType];
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Reset algorithm
        function resetAlgorithm() {
            if (confirm('Are you sure you want to reset all selections?')) {
                clearChecks();
                currentStep = 1;
                updateProgress();
                updateSidebar();
                
                // Collapse all cards
                document.querySelectorAll('.card').forEach(card => {
                    card.classList.remove('expanded');
                });
                
                // Expand first card
                document.getElementById('assessment').classList.add('expanded');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Sidebar navigation
        document.querySelectorAll('.progress-steps li').forEach(step => {
            step.addEventListener('click', function() {
                const stepId = this.getAttribute('data-step');
                scrollToCard(stepId);
            });
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Auto-save to localStorage
        window.addEventListener('beforeunload', function() {
            const state = {
                redFlags: redFlagCount,
                currentStep: currentStep,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('backPainAlgorithmState', JSON.stringify(state));
        });

        // Load from localStorage on page load
        window.addEventListener('load', function() {
            const savedState = localStorage.getItem('backPainAlgorithmState');
            if (savedState) {
                const state = JSON.parse(savedState);
                const timeDiff = new Date() - new Date(state.timestamp);
                // Only restore if less than 1 hour old
                if (timeDiff < 3600000 && confirm('Restore previous session?')) {
                    currentStep = state.currentStep || 1;
                    updateProgress();
                    updateSidebar();
                }
            }
        });

        // Print optimization
        window.addEventListener('beforeprint', function() {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.add('expanded');
            });
        });

        window.addEventListener('afterprint', function() {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('expanded');
            });
        });
    </script>
</body>
</html>