<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T2DM GEMS Quick-Scan Reference</title>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Colors */
            --primary: #1976d2; /* Blue */
            --primary-light: #e3f2fd;
            --danger: #c62828; /* Red */
            --danger-light: #ffebee;
            --success: #2e7d32; /* Green */
            --success-light: #e8f5e9;
            --warning: #f57f17; /* Amber/Orange */
            --warning-light: #fff8e1;
            --text-main: #37474f;
            --text-light: #78909c;
            --bg-body: #f4f6f8;
            --card-bg: #ffffff;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-main);
            background-color: var(--bg-body);
            padding-bottom: 60px;
        }

        /* --- Typography & Utility --- */
        h1, h2, h3, h4 {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-main);
        }
        
        .text-danger { color: var(--danger); }
        .text-success { color: var(--success); }
        .text-primary { color: var(--primary); }
        .text-small { font-size: 0.85rem; color: var(--text-light); }
        .font-bold { font-weight: 700; }

        /* --- Layout --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-links {
            display: flex;
            gap: 15px;
        }

        .nav-links a {
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .nav-links a:hover {
            background: rgba(255,255,255,0.2);
        }

        section {
            margin: 30px 0;
            animation: fadeIn 0.5s ease-out;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: var(--primary);
        }

        /* --- Components --- */

        /* Alerts */
        .alert-box {
            background-color: var(--danger-light);
            border-left: 5px solid var(--danger);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        
        .alert-icon {
            font-size: 1.5rem;
            color: var(--danger);
        }

        .safe-box {
            background-color: var(--success-light);
            border-left: 5px solid var(--success);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s;
            border-top: 4px solid transparent;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        .card.danger-border { border-top-color: var(--danger); }
        .card.success-border { border-top-color: var(--success); }
        .card.primary-border { border-top-color: var(--primary); }

        /* Interactive Tool: CV Risk Checker */
        .tool-panel {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid #e0e0e0;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        
        .checkbox-label:hover { background: #f9f9f9; }

        .result-box {
            margin-top: 15px;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: bold;
            display: none; /* Hidden by default */
        }
        
        .result-high { background: var(--danger-light); color: var(--danger); border: 1px solid var(--danger); }
        .result-low { background: var(--success-light); color: var(--success); border: 1px solid var(--success); }

        /* Tables */
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
        }

        tr:hover {
            background-color: #f1f8e9;
        }

        /* Visual Flowchart */
        .flowchart {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .flow-step {
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            position: relative;
            text-align: center;
        }

        .flow-step::after {
            content: '\f107';
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            color: var(--text-light);
        }
        
        .flow-step:last-child::after { display: none; }

        .flow-branch {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .nav-links { display: none; } /* Simplified for mobile */
            .flow-branch { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; text-align: center; gap: 10px; }
        }
        
        /* Filters */
        .filter-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
            margin-right: 5px;
        }
        .tag.red { background: var(--danger); }
        .tag.green { background: var(--success); }
        .tag.blue { background: var(--primary); }

    </style>
</head>
<body>

    <header class="header">
        <div class="container header-content">
            <div>
                <h1><i class="fa-solid fa-notes-medical"></i> T2DM GEMS Reference</h1>
                <span class="text-small" style="color: rgba(255,255,255,0.8);">NICE NG28 & NG203 Updated | Quick-Scan Tool</span>
            </div>
            <nav class="nav-links">
                <a href="#critical"><i class="fa-solid fa-triangle-exclamation"></i> Critical</a>
                <a href="#targets"><i class="fa-solid fa-bullseye"></i> Targets</a>
                <a href="#rx-first">First Line</a>
                <a href="#rx-table">Drugs</a>
                <a href="#ckd">CKD/BP</a>
            </nav>
        </div>
    </header>

    <main class="container">

        <!-- SECTION 1: CRITICAL ALERTS -->
        <section id="critical">
            <div class="alert-box">
                <div class="alert-icon"><i class="fa-solid fa-kit-medical"></i></div>
                <div>
                    <h2 class="text-danger">SICK DAY RULES & DKA RISK</h2>
                    <p><strong>STOP</strong> Gliflozins (SGLT2i) and Metformin in <strong>acute illness</strong> (fever, D&V, dehydration).</p>
                    <p class="text-small"><i class="fa-solid fa-circle-exclamation"></i> <strong>Euglycaemic DKA Risk:</strong> Gliflozins carry DKA risk even at normal glucose levels. Stop if unwell, planning surgery, or on very low-carb/keto diet.</p>
                </div>
            </div>
        </section>

        <!-- SECTION 2: CV RISK CHECKER (Interactive) -->
        <section id="cv-check">
            <h2 class="section-title"><i class="fa-solid fa-heart-pulse"></i> CV Risk Assessment Tool</h2>
            <div class="tool-panel">
                <p class="text-small">Check if patient has "High Risk of CVD" (Qualifies for dual therapy with Gliflozin):</p>
                
                <div class="checkbox-group">
                    <label class="checkbox-label"><input type="checkbox" id="age-risk"> Age ≥ 40y <small class="text-light">& QRISK >10%</small></label>
                    <label class="checkbox-label"><input type="checkbox" id="young-risk"> Age < 40y <small class="text-light">& 1+ Risk Factor</small></label>
                    <!-- Dynamic sub-factors for <40 -->
                </div>
                
                <div id="sub-risk-factors" style="margin-left: 20px; border-left: 2px solid #ddd; padding-left: 15px; display: none;">
                    <p class="text-small">Select if Age < 40:</p>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" class="sub-factor"> Smoker</label>
                        <label class="checkbox-label"><input type="checkbox" class="sub-factor"> Obese</label>
                        <label class="checkbox-label"><input type="checkbox" class="sub-factor"> Hypertension</label>
                        <label class="checkbox-label"><input type="checkbox" class="sub-factor"> Dyslipidaemia</label>
                        <label class="checkbox-label"><input type="checkbox" class="sub-factor"> Premature CVD in 1st-deg relative</label>
                    </div>
                </div>

                <div id="cv-result" class="result-box">
                    <!-- JS Result -->
                </div>
            </div>
        </section>

        <!-- SECTION 3: TARGETS -->
        <section id="targets">
            <h2 class="section-title"><i class="fa-solid fa-bullseye"></i> Glycaemic Targets (NICE)</h2>
            <div class="card-grid">
                <div class="card primary-border">
                    <h3><i class="fa-solid fa-person-running"></i> Standard Patient</h3>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">48 mmol/mol</div>
                    <p class="text-small">(6.5%)</p>
                    <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">
                    <p class="text-small"><strong>If on hypo-inducing drugs</strong> (Sulphonylurea/Insulin):</p>
                    <div style="font-size: 1.5rem; font-weight: bold;">53 mmol/mol</div>
                    <p class="text-small">(7.0%)</p>
                </div>
                <div class="card danger-border">
                    <h3><i class="fa-solid fa-wheelchair"></i> Frail / Limited Life Exp.</h3>
                    <p><strong>Personalise Targets</strong></p>
                    <p>Risks of polypharmacy and hypoglycaemia may outweigh benefits.</p>
                    <ul class="text-small" style="margin-left: 20px; margin-top: 10px;">
                        <li>Focus on quality of life.</li>
                        <li>Relax HbA1c targets.</li>
                        <li>Avoid complex burdensome regimens.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 4: FIRST LINE THERAPY LOGIC -->
        <section id="rx-first">
            <h2 class="section-title"><i class="fa-solid fa-pills"></i> First-Line Drug Algorithm</h2>
            <div class="flowchart">
                <!-- Step 1 -->
                <div class="flow-step">
                    <h3>START DRUG THERAPY</h3>
                    <p class="text-small">If lifestyle alone fails to meet target.</p>
                </div>
                
                <!-- Step 2: Branching -->
                <div class="flow-branch">
                    <!-- Branch A -->
                    <div class="card danger-border" style="margin:0;">
                        <h4 class="text-danger">High CV Risk / Known CVD</h4>
                        <div class="text-small" style="margin-bottom: 10px;">(Ischemic stroke, IHD, PAD, Heart Failure, or Risk factors)</div>
                        <div style="background: var(--primary-light); padding: 10px; border-radius: 4px; margin-bottom: 5px;">
                            <strong>METFORMIN</strong><br>
                            <small>Titrate up over weeks</small>
                        </div>
                        <div style="font-size: 1.5rem; text-align: center;">+</div>
                        <div style="background: var(--danger-light); padding: 10px; border-radius: 4px; border: 1px solid var(--danger);">
                            <strong class="text-danger">GLIFLOZIN (SGLT2i)</strong><br>
                            <small>Add once Metformin stabilised</small>
                        </div>
                        <p class="text-small" style="margin-top:5px;"><i class="fa-solid fa-check"></i> Cardioprotective & Renoprotective</p>
                    </div>

                    <!-- Branch B -->
                    <div class="card primary-border" style="margin:0;">
                        <h4>Low CV Risk</h4>
                        <div class="text-small" style="margin-bottom: 10px;">(No specific risk factors)</div>
                        <div style="background: var(--primary-light); padding: 10px; border-radius: 4px;">
                            <strong>METFORMIN</strong><br>
                            <small>Monotherapy</small>
                        </div>
                        <p class="text-small" style="margin-top:10px;"><i class="fa-solid fa-circle-info"></i> If Metformin contraindicated: Choose oral therapy (Gliptin, Pioglitazone, Sulfonylurea, or Gliflozin).</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 5: DRUG PROFILES (Filterable Table) -->
        <section id="rx-table">
            <h2 class="section-title"><i class="fa-solid fa-table"></i> Drug Intensification Profiles</h2>
            
            <input type="text" id="drugFilter" class="filter-input" placeholder="Search by name (e.g., Metformin), indication (e.g., Obesity), or side effect...">
            
            <div class="table-container">
                <table id="drugTable">
                    <thead>
                        <tr>
                            <th>Drug Class</th>
                            <th>Pros (Use when...)</th>
                            <th>Cons / Red Flags</th>
                            <th>Renal Safety</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Metformin -->
                        <tr>
                            <td><strong>METFORMIN</strong><br><span class="tag blue">1st Line</span></td>
                            <td>Cardioprotective, Low hypo risk, Weight loss.</td>
                            <td class="text-danger">GI side effects.<br><strong>eGFR &lt;30: Stop.</strong><br>eGFR 30-44: Max 1g.</td>
                            <td><span class="text-danger">Caution</span> (Accumulates in AKI)</td>
                        </tr>
                        <!-- Gliflozins -->
                        <tr>
                            <td><strong>GLIFLOZINS</strong><br><span class="tag blue">SGLT2i</span></td>
                            <td><strong>Best Choice for CVD/HF/CKD.</strong><br>Weight loss, BP reduction.</td>
                            <td class="text-danger"><strong>DKA RISK (Euglycaemic).</strong><br>Genital infections. Stop if unwell.</td>
                            <td><span class="text-success">Safe</span> (If licensed for CKD)</td>
                        </tr>
                        <!-- Sulfonylureas -->
                        <tr>
                            <td><strong>GLICLAZIDE</strong><br><span class="tag red">Hypo Risk</span></td>
                            <td>Cheap, very effective at lowering HbA1c.</td>
                            <td class="text-danger"><strong>High Hypo Risk.</strong><br>Weight gain.</td>
                            <td><span class="text-danger">Caution</span> (Hypo risk worse in RF)</td>
                        </tr>
                        <!-- Gliptins -->
                        <tr>
                            <td><strong>GLIPTINS</strong> (DPP-4i)</td>
                            <td>Weight neutral, Low hypo risk.</td>
                            <td>Least effective for HbA1c. Cholecystitis risk.</td>
                            <td><span class="text-success">Safe</span> (Linagliptin)</td>
                        </tr>
                        <!-- Pioglitazone -->
                        <tr>
                            <td><strong>PIOGLITAZONE</strong></td>
                            <td><strong>Insulin Resistance</strong> (Central obesity).</td>
                            <td class="text-danger"><strong>Heart Failure.</strong><br>Weight gain, fractures, bladder cancer caution.</td>
                            <td><span class="text-success">Safe</span></td>
                        </tr>
                        <!-- GLP-1 -->
                        <tr>
                            <td><strong>GLP-1s</strong><br><span class="tag green">Obesity</span></td>
                            <td><strong>Obesity & CVD.</strong><br>Significant weight loss. Cardioprotective.</td>
                            <td>Expensive. GI side effects. Injected (mostly).</td>
                            <td><span class="text-primary">Caution</span> (Dehydration risk)</td>
                        </tr>
                        <!-- Insulin -->
                        <tr>
                            <td><strong>INSULIN</strong></td>
                            <td>Most effective HbA1c control. Safe in severe RF.</td>
                            <td class="text-danger"><strong>Significant Hypo Risk.</strong><br>Weight gain. Sick day rules apply.</td>
                            <td><span class="text-success">Safe</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- SECTION 6: CKD, BP & LIPIDS -->
        <section id="ckd">
            <h2 class="section-title"><i class="fa-solid fa-heart-pulse"></i> Comorbidities (CKD, BP, Lipids)</h2>
            <div class="card-grid">
                <!-- CKD Management -->
                <div class="card danger-border">
                    <h3><i class="fa-solid fa-kidneys"></i> CKD Management</h3>
                    <p><strong>Definition:</strong> ACR ≥3 OR eGFR &lt;60 x2 (3m apart) OR Structural disease.</p>
                    <div style="background: var(--primary-light); padding: 10px; border-radius: 4px; margin: 10px 0;">
                        <strong>OFFER:</strong> ARB/ACEi + Gliflozin (Dapagliflozin/Empagliflozin if licensed).
                    </div>
                    <p class="text-small"><strong>Note:</strong> Gliflozin provides renoprotection independent of glucose lowering.</p>
                </div>

                <!-- BP Management -->
                <div class="card success-border">
                    <h3><i class="fa-solid fa-gauge-high"></i> Blood Pressure</h3>
                    <p><strong>Target:</strong> &lt;140/90 (&lt;150/90 if ≥80y).</p>
                    <p><strong>CKD Specific:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>ACR ≥70: Target &lt;130/80</li>
                        <li>ACR &lt;70: Target &lt;140/90</li>
                    </ul>
                    <div style="margin-top: 10px; font-weight: bold; color: var(--primary);">
                        <i class="fa-solid fa-arrow-right"></i> First line: ACEi/ARB
                    </div>
                </div>

                <!-- Lipids -->
                <div class="card primary-border">
                    <h3><i class="fa-solid fa-droplet"></i> Cholesterol / Statins</h3>
                    <p><strong>Primary Prev (QRISK ≥10%):</strong> Atorvastatin 20mg.</p>
                    <p><strong>Secondary Prev (Known CVD):</strong> Atorvastatin 80mg.</p>
                    <p class="text-small"><strong>CKD:</strong> Atorvastatin 20mg.</p>
                    <p class="text-small"><strong>eGFR &lt;30:</strong> Increase dose only on specialist advice.</p>
                </div>
            </div>
        </section>

        <!-- SECTION 7: LIFESTYLE -->
        <section id="lifestyle">
            <h2 class="section-title"><i class="fa-solid fa-carrot"></i> Lifestyle Interventions</h2>
            <div class="card-grid">
                <div class="card">
                    <h4><i class="fa-solid fa-utensils"></i> Nutrition</h4>
                    <p class="text-small">Any diet resulting in energy deficit is beneficial.</p>
                    <p><strong>Best for Glycaemia:</strong> Low-carb, Mediterranean.</p>
                    <p><strong>Best for Sustainability:</strong> Mediterranean.</p>
                    <p><strong>Remission potential:</strong> ≥10% weight loss.</p>
                </div>
                <div class="card">
                    <h4><i class="fa-solid fa-person-walking"></i> Activity</h4>
                    <p class="text-small">Even small increases beneficial.</p>
                    <p><strong>Aim for:</strong></p>
                    <ul>
                        <li>Aerobic (Post-prandial)</li>
                        <li>Strength training (Sarcopaenia prevention)</li>
                        <li>Step more (+500/day)</li>
                    </ul>
                </div>
                <div class="card">
                    <h4><i class="fa-solid fa-bed"></i> Sleep</h4>
                    <p class="text-small">Poor sleep worsens HbA1c.</p>
                    <p><strong>Ask about:</strong> Sleep apnoea, shifts, duration (&lt;6h or &gt;8h).</p>
                </div>
            </div>
        </section>

    </main>

    <footer style="text-align: center; padding: 20px; color: var(--text-light); font-size: 0.8rem;">
        <p>Based on Red Whale GEMS (Sept 2025) & NICE NG28 (2022). Always check BNF/Spc for doses and contraindications.</p>
        <p>This is a clinical reference aid and does not replace professional judgement.</p>
    </footer>

    <script>
        // --- 1. CV Risk Calculator Logic ---
        const ageRiskCheckbox = document.getElementById('age-risk');
        const youngRiskCheckbox = document.getElementById('young-risk');
        const subRiskDiv = document.getElementById('sub-risk-factors');
        const subFactors = document.querySelectorAll('.sub-factor');
        const resultBox = document.getElementById('cv-result');

        function updateCVRisk() {
            resultBox.style.display = 'none';
            resultBox.className = 'result-box'; // reset classes

            let isHighRisk = false;
            let message = "";

            // Logic for >= 40
            if (ageRiskCheckbox.checked) {
                isHighRisk = true;
                message = "High CV Risk Indicated (Age ≥ 40 & QRISK >10%)";
            }

            // Logic for < 40
            if (youngRiskCheckbox.checked) {
                const checkedSubs = Array.from(subFactors).filter(cb => cb.checked).length;
                if (checkedSubs >= 1) {
                    isHighRisk = true;
                    message = "High CV Risk Indicated (Age < 40 & Risk Factor Present)";
                }
            }

            if (isHighRisk) {
                resultBox.innerHTML = `<i class="fa-solid fa-circle-exclamation"></i> ${message}<br><span class="text-small">Consider Gliflozin + Metformin as Dual Therapy</span>`;
                resultBox.classList.add('result-high');
                resultBox.style.display = 'block';
            } else if (ageRiskCheckbox.checked || youngRiskCheckbox.checked) {
                resultBox.innerHTML = `Risk criteria not fully met based on inputs.`;
                resultBox.classList.add('result-low');
                resultBox.style.display = 'block';
            }
        }

        // Show sub-factors only if "Age < 40" is checked
        youngRiskCheckbox.addEventListener('change', () => {
            if (youngRiskCheckbox.checked) {
                subRiskDiv.style.display = 'block';
                // Animation
                subRiskDiv.style.opacity = 0;
                setTimeout(() => subRiskDiv.style.opacity = 1, 50);
            } else {
                subRiskDiv.style.display = 'none';
            }
            updateCVRisk();
        });

        // Listeners for all checkboxes
        ageRiskCheckbox.addEventListener('change', updateCVRisk);
        subFactors.forEach(cb => cb.addEventListener('change', updateCVRisk));


        // --- 2. Drug Table Filter ---
        const filterInput = document.getElementById('drugFilter');
        const table = document.getElementById('drugTable');
        const trs = table.getElementsByTagName('tr');

        filterInput.addEventListener('keyup', function() {
            const term = this.value.toLowerCase();

            // Loop through rows, hide those that don't match query
            for (let i = 1; i < trs.length; i++) { // Start at 1 to skip header
                let rowText = trs[i].textContent || trs[i].innerText;
                if (rowText.toLowerCase().indexOf(term) > -1) {
                    trs[i].style.display = "";
                } else {
                    trs[i].style.display = "none";
                }
            }
        });
    </script>
</body>
</html>