<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lipids & Statins: Clinical Quick-Scan</title>
    <!-- Using Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #005f73;
            --primary-light: #0a9396;
            --secondary: #94d2bd;
            --bg-light: #f8f9fa;
            --text-dark: #2b2d42;
            --text-muted: #6c757d;
            --danger: #ae2012; /* Red */
            --danger-bg: #f4d6cc;
            --warning: #e9c46a; /* Yellow/Orange */
            --success: #2a9d8f; /* Green */
            --success-bg: #d1e7dd;
            --info: #0077b6; /* Blue */
            --card-shadow: 0 4px 6px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #eef4f8;
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* --- Header --- */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .brand h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .brand span {
            font-size: 0.8rem;
            opacity: 0.9;
            font-weight: 400;
        }

        /* --- Navigation Tabs --- */
        nav {
            background: white;
            padding: 0 1rem;
            overflow-x: auto;
            white-space: nowrap;
            border-bottom: 1px solid #ddd;
            -webkit-overflow-scrolling: touch;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 4px solid transparent;
            transition: var(--transition);
        }

        .tab-btn:hover {
            color: var(--primary);
            background-color: var(--bg-light);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* --- Main Layout --- */
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            min-height: 80vh;
        }

        .section-content {
            display: none; /* Hidden by default */
            animation: fadeIn 0.4s ease-in-out;
        }

        .section-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Grid & Cards --- */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            border-left: 5px solid var(--secondary);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .card h3 {
            margin-bottom: 1rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card.highlight-red { border-left-color: var(--danger); }
        .card.highlight-green { border-left-color: var(--success); }
        .card.highlight-blue { border-left-color: var(--info); }

        /* --- Visual Cues & Badges --- */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-right: 0.5rem;
        }

        .badge-danger { background: var(--danger); color: white; }
        .badge-success { background: var(--success); color: white; }
        .badge-info { background: var(--info); color: white; }

        .action-box {
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 6px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .action-danger { background-color: var(--danger-bg); color: var(--danger); border: 1px solid var(--danger); }
        .action-success { background-color: var(--success-bg); color: var(--success); border: 1px solid var(--success); }
        .action-neutral { background-color: #e2e6ea; color: var(--text-dark); }

        /* --- Typography & Lists --- */
        ul.feature-list {
            list-style: none;
        }

        ul.feature-list li {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
        }

        ul.feature-list li::before {
            content: "•";
            color: var(--primary);
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        /* --- Interactive Adverse Event Tool --- */
        .tool-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            max-width: 800px;
            margin: 0 auto;
        }

        .step-display {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            border: 1px solid #ddd;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .option-btn {
            padding: 1.5rem;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            transition: var(--transition);
            text-align: center;
        }

        .option-btn:hover {
            border-color: var(--primary);
            background-color: #f0f8ff;
        }

        .option-btn.yes:hover { border-color: var(--danger); background-color: var(--danger-bg); }
        .option-btn.no:hover { border-color: var(--success); background-color: var(--success-bg); }

        .result-panel {
            margin-top: 1.5rem;
            padding: 1.5rem;
            border-radius: 8px;
            display: none;
        }

        .result-panel.visible { display: block; animation: fadeIn 0.3s; }

        /* --- Tables --- */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .data-table th, .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background-color: #f1f1f1;
        }

        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.8rem;
            background: #e9ecef;
            margin-top: 2rem;
        }

        /* --- Mobile Tweaks --- */
        @media (max-width: 768px) {
            .options-grid { grid-template-columns: 1fr; }
            .header { flex-direction: column; align-items: flex-start; }
        }

        /* Red Banner */
        .red-banner {
            background-color: var(--danger);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>

<header>
    <div class="brand">
        <h1><i class="fa-solid fa-heart-pulse"></i> GEMS Quick-Scan</h1>
        <span>Lipids, Statins & Cardiovascular Risk (June 2025)</span>
    </div>
    <div>
        <!-- Placeholder for settings or info if needed -->
        <span class="badge badge-info">Local Reference Tool</span>
    </div>
</header>

<nav>
    <button class="tab-btn active" onclick="switchTab('tab-risk')"><i class="fa-solid fa-user-doctor"></i> Risk Assessment</button>
    <button class="tab-btn" onclick="switchTab('tab-init')"><i class="fa-solid fa-pills"></i> Initiation & Dosing</button>
    <button class="tab-btn" onclick="switchTab('tab-monitor')"><i class="fa-solid fa-clipboard-list"></i> Monitoring</button>
    <button class="tab-btn" onclick="switchTab('tab-adverse')"><i class="fa-solid fa-triangle-exclamation"></i> Adverse Events (SOS)</button>
    <button class="tab-btn" onclick="switchTab('tab-adv')"><i class="fa-solid fa-flask"></i> Advanced/Non-Statin</button>
    <button class="tab-btn" onclick="switchTab('tab-lifestyle')"><i class="fa-solid fa-carrot"></i> Lifestyle & Comm</button>
</nav>

<main>

    <!-- TAB 1: RISK ASSESSMENT -->
    <div id="tab-risk" class="section-content active">
        <div class="grid-container">
            <!-- High Risk by Definition -->
            <div class="card highlight-red">
                <h3><i class="fa-solid fa-ban"></i> High Risk By Definition <br><small>(Do NOT use QRISK3)</small></h3>
                <p class="badge badge-danger">OFFER STATIN</p>
                <h2>Atorvastatin 80mg*</h2>
                <p style="font-size: 0.9rem; color: #666;">*Regardless of baseline cholesterol. Lower dose if interactions or adverse event risk.</p>
                <hr style="margin: 1rem 0; border: 0; border-top: 1px solid #eee;">
                <ul class="feature-list">
                    <li><strong>Secondary Prevention</strong> (Known CVD)</li>
                    <li><strong>CKD</strong> (Primary & Secondary prevention) <br><small>Use Atorvastatin 20mg initially for ALL CKD.</small></li>
                    <li><strong>Type 1 Diabetes</strong> (>40y OR >10y duration)</li>
                    <li><strong>HIV</strong> (Living with HIV & >40y)</li>
                </ul>
            </div>

            <!-- QRISK3 Group -->
            <div class="card highlight-blue">
                <h3><i class="fa-solid fa-calculator"></i> Use QRISK3</h3>
                <p><strong>Target Group:</strong> Primary prevention (25-84y) with T2DM or Hypertension, but NOT CVD, CKD, T1DM.</p>
                <hr style="margin: 1rem 0; border: 0; border-top: 1px solid #eee;">
                <div class="action-box action-success">
                    <i class="fa-solid fa-check-circle fa-lg"></i>
                    <div>
                        <div>QRISK3 ≥ 10%</div>
                        <small>Offer Atorvastatin 20mg</small>
                    </div>
                </div>
                <div class="action-box action-neutral" style="margin-top: 0.5rem;">
                    <div>
                        <div>QRISK3 < 10%</div>
                        <small>Do not rule out statin. May offer if patient chooses or risk underestimated.</small>
                    </div>
                </div>
                <div style="margin-top: 1rem; font-size: 0.85rem; background: #e2e6ea; padding: 0.5rem; border-radius: 4px;">
                    <strong>Use QRISK3 Online if:</strong> Severe mental illness, ED, SLE, Migraine, atypical antipsychotics, steroids.
                </div>
            </div>

            <!-- Age 85+ -->
            <div class="card highlight-green">
                <h3><i class="fa-solid fa-person-cane"></i> Age ≥ 85</h3>
                <p><strong>Action:</strong> Do NOT do risk calculation. Age alone puts them at risk.</p>
                <ul class="feature-list">
                    <li>Consider Atorvastatin 20mg</li>
                    <li>Take frailty into account</li>
                </ul>
            </div>
        </div>

        <!-- Familial Hypercholesterolaemia Alert -->
        <div class="card highlight-red" style="border-left: none; border-top: 5px solid var(--danger);">
            <h3><i class="fa-solid fa-dna"></i> Suspect Familial Hypercholesterolaemia (FHc)</h3>
            <div class="grid-container" style="margin-bottom: 0;">
                <div>
                    <strong>Search Criteria:</strong>
                    <ul class="feature-list">
                        <li>Total Cholesterol > 7.5 (if <30y, >9 if ≥30y)</li>
                        <li>Personal history CHD < 60y</li>
                        <li>CHD < 60y in 1st degree relative</li>
                    </ul>
                </div>
                <div class="action-box action-danger">
                    <div><strong>REFER</strong> if Total Cholesterol > 9 or Non-HDL > 7.5</div>
                    <small>Even without family history</small>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 2: INITIATION & DOSING -->
    <div id="tab-init" class="section-content">
        <div class="card highlight-blue" style="margin-bottom: 2rem;">
            <h3><i class="fa-solid fa-play"></i> Key Principle</h3>
            <p><strong>Start statin at diagnosis:</strong> Do not wait to assess impact of lifestyle changes.</p>
        </div>

        <div class="grid-container">
            <!-- CKD Specifics -->
            <div class="card">
                <h3><i class="fa-solid fa-kidneys"></i> CKD Specifics</h3>
                <p><strong>Offer Statin to ALL:</strong> Both WITH and WITHOUT CVD.</p>
                <div style="margin-top: 1rem;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Group</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>All CKD (eGFR <60)</td>
                                <td><strong>Atorvastatin 20mg</strong> initially</td>
                            </tr>
                            <tr>
                                <td>eGFR ≥ 30</td>
                                <td>If target not met, increase dose</td>
                            </tr>
                            <tr>
                                <td>eGFR < 30</td>
                                <td>Agree higher doses with renal specialist</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Intensity Chart -->
            <div class="card">
                <h3><i class="fa-solid fa-chart-simple"></i> Statin Intensity</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Intensity</th>
                            <th>Drug & Dose</th>
                            <th>LDL Reduction</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background-color: #f0f8ff;">
                            <td><strong>High</strong></td>
                            <td>Atorvastatin ≥20mg</td>
                            <td>>40%</td>
                        </tr>
                        <tr>
                            <td>Medium</td>
                            <td>Atorvastatin 10mg</td>
                            <td>30-40%</td>
                        </tr>
                        <tr>
                            <td>Low</td>
                            <td>Simvastatin 10mg / Pravastatin 10-40mg</td>
                            <td>20-30%</td>
                        </tr>
                    </tbody>
                </table>
                <p style="margin-top: 0.5rem; font-size: 0.8rem; color: #666;">*Simvastatin 80mg restricted due to higher myopathy risk.</p>
            </div>
        </div>
    </div>

    <!-- TAB 3: MONITORING -->
    <div id="tab-monitor" class="section-content">
        <div class="grid-container">
            <div class="card highlight-blue">
                <h3><i class="fa-solid fa-bullseye"></i> Targets</h3>
                <div class="action-box action-neutral">
                    <div><strong>Primary Prevention</strong></div>
                    <div style="font-size: 1.2rem; color: var(--primary);">Aim for >40% reduction in non-HDL</div>
                </div>
                <div class="action-box action-success">
                    <div><strong>Secondary Prevention</strong></div>
                    <div style="font-size: 1.2rem; color: var(--success);">LDL ≤ 2mmol/l OR non-HDL ≤ 2.6mmol/l</div>
                </div>
            </div>

            <div class="card">
                <h3><i class="fa-solid fa-calendar-check"></i> Timeline</h3>
                <ul class="feature-list">
                    <li><strong>Start:</strong> Lifestyle first in primary, parallel in secondary.</li>
                    <li><strong>3 Months:</strong> Recheck Full Lipid Profile + Transaminases (AST/ALT).</li>
                    <li><strong>Annual Review:</strong>
                        <ul style="padding-left: 1.5rem; margin-top: 0.5rem;">
                            <li>Full lipid profile</li>
                            <li>ALT or AST (Check at FIRST annual review only, then stop unless symptomatic).</li>
                            <li>HbA1c</li>
                            <li>Renal function</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <div class="card">
            <h3><i class="fa-solid fa-triangle-exclamation"></i> Managing Abnormal LFTs (AST/ALT)</h3>
            <div class="grid-container" style="margin-bottom: 0;">
                <div>
                    <strong>≥ 3x Upper Limit Normal</strong>
                    <p class="badge badge-danger">STOP STATIN</p>
                    <p>Recheck in 4-6 weeks. Once normalised, cautiously reintroduce at lower dose/different statin.</p>
                </div>
                <div>
                    <strong>< 3x Upper Limit Normal</strong>
                    <p class="badge badge-success">CONTINUE STATIN</p>
                    <p>Recheck in 4-6 weeks.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 4: ADVERSE EVENTS (INTERACTIVE TOOL) -->
    <div id="tab-adverse" class="section-content">
        <div class="red-banner" id="emergency-alert" style="display:none;">
            <i class="fa-solid fa-ambulance"></i> EMERGENCY: Suspect Rhabdomyolysis - Admit Patient
        </div>

        <div class="tool-container">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: var(--primary);">Muscle Symptom Manager</h2>
            
            <div class="step-display">
                <h4 id="step-title">Step 1: Symptoms</h4>
                <p id="step-desc">New or worsening muscle symptoms (pain, tenderness, weakness) since starting statin?</p>
            </div>

            <div class="options-grid" id="options-area">
                <!-- Dynamic Buttons will be injected here -->
            </div>

            <div id="result-area" class="result-panel">
                <!-- Results appear here -->
            </div>
            
            <div style="text-align: center; margin-top: 1.5rem;">
                <button onclick="resetTool()" style="padding: 0.5rem 1rem; border: none; background: #ddd; border-radius: 4px; cursor: pointer;">Reset Tool</button>
            </div>
        </div>

        <div class="card" style="margin-top: 2rem;">
            <h3><i class="fa-solid fa-circle-info"></i> Key Definitions</h3>
            <ul class="feature-list">
                <li><strong>Rhabdomyolysis:</strong> CK > 50x ULN. Admit.</li>
                <li><strong>Statin reluctance:</strong> Hesitance to start due to perceived risks.</li>
                <li><strong>Statin-associated muscle symptoms (SAMS):</strong> May not be statin toxic. Use de-challenge/re-challenge to confirm.</li>
            </ul>
        </div>
    </div>

    <!-- TAB 5: ADVANCED / NON-STATIN -->
    <div id="tab-adv" class="section-content">
        <div class="grid-container">
            <div class="card highlight-green">
                <h3><i class="fa-solid fa-prescription-bottle"></i> Ezetimibe</h3>
                <p><strong>When to use:</strong></p>
                <ul class="feature-list">
                    <li>Statins contraindicated or genuine intolerance.</li>
                    <li>Statin at max tolerated dose not achieving target.</li>
                    <li><strong>In CVD:</strong> Even if target met, add to reduce risk further.</li>
                </ul>
            </div>

            <div class="card highlight-blue">
                <h3><i class="fa-solid fa-syringe"></i> PCSK9 Inhibitors</h3>
                <p><em>(Inclisiran, Evolocumab, Alirocumab)</em></p>
                <p><strong>NICE Criteria (Must have CVD AND...):</strong></p>
                <ul class="feature-list">
                    <li>LDL persistently ≥ 4.0 mmol/l</li>
                    <li><em>OR</em> LDL ≥ 3.5 mmol/l if recurrent events/multivascular bed</li>
                    <li><em>OR</em> LDL persistently ≥ 2.6 mmol/l (Inclisiran specific)</li>
                </ul>
            </div>
        </div>

        <div class="card" style="border-left: 5px solid var(--warning);">
            <h3><i class="fa-solid fa-ban"></i> Do NOT Routinely Use</h3>
            <div class="grid-container" style="margin-bottom: 0;">
                <div>
                    <ul class="feature-list">
                        <li>Fibrates</li>
                        <li>Bile acid sequestrants</li>
                        <li>Nicotinic acid (Niacin)</li>
                    </ul>
                </div>
                <div>
                    <ul class="feature-list">
                        <li>Omega-3 (except Icosapent Ethyl)</li>
                        <li>Co-enzyme Q10</li>
                        <li>Vitamin D</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 6: LIFESTYLE & COMMUNICATION -->
    <div id="tab-lifestyle" class="section-content">
        <div class="grid-container">
            <div class="card">
                <h3><i class="fa-solid fa-comments"></i> Communicating Risk</h3>
                <ul class="feature-list">
                    <li>Tell people 10y absolute CVD risk (QRISK3 %).</li>
                    <li>Consider <strong>QRISK3-lifetime</strong> especially if QRISK3 < 10% or < 40y.</li>
                    <li>Use "What if?" scenarios in the calculator (e.g., stop smoking).</li>
                </ul>
                <div class="action-box action-neutral" style="margin-top: 1rem;">
                    <strong>Aspirin:</strong> Do NOT routinely offer for primary prevention.
                </div>
            </div>

            <div class="card">
                <h3><i class="fa-solid fa-heart"></i> Diet & Exercise</h3>
                <ul class="feature-list">
                    <li><strong>Fat:</strong> ≤30% total energy. Swap saturated for mono/polyunsaturated.</li>
                    <li><strong>Sat Fat:</strong> ≤7% energy.</li>
                    <li><strong>Alcohol:</strong> ≤14 units/wk, spread over 3+ days.</li>
                    <li><strong>Activity:</strong> 150min moderate OR 75min vigorous + muscle strengthening 2x/wk.</li>
                </ul>
            </div>

            <div class="card highlight-red">
                <h3><i class="fa-solid fa-leaf"></i> Note on Plant Stanols/Sterols</h3>
                <p class="badge badge-danger">Do NOT Recommend</p>
                <p>If being treated for high cholesterol OR if CKD, T1DM or T2DM.</p>
                <small>(Lack of evidence of effectiveness)</small>
            </div>
        </div>
    </div>

</main>

<footer>
    <p><strong>Disclaimer:</strong> This tool is based on GEMS (June 2025) and NICE NG238 guidance. It is a brief reference and should not replace professional clinical judgement. Always consult BNF and patient history.</p>
    <p>&copy; GEMS Guidelines & Evidence Made Simple</p>
</footer>

<script>
    // --- Tab Switching Logic ---
    function switchTab(tabId) {
        // Hide all sections
        document.querySelectorAll('.section-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

        // Show selected section
        document.getElementById(tabId).classList.add('active');
        
        // Highlight button
        // Find the button that calls this function with this ID
        const buttons = Array.from(document.querySelectorAll('.tab-btn'));
        const activeBtn = buttons.find(btn => btn.getAttribute('onclick').includes(tabId));
        if(activeBtn) activeBtn.classList.add('active');
    }

    // --- Adverse Event Interactive Tool Logic ---
    const steps = {
        1: {
            title: "Step 1: Symptom Onset",
            desc: "Symptoms starting when someone has been fine on a statin for >3 months is unlikely to be statin related.",
            options: [
                { text: "New Symptoms (started recently)", next: 2, type: "no" }, // 'no' color scheme triggers danger path styling roughly, but here neutral
                { text: "Symptoms > 3 months on stable dose", next: 99, resultType: "unlikely" }
            ]
        },
        2: {
            title: "Step 2: Tolerability",
            desc: "Are the symptoms tolerable to the patient?",
            options: [
                { text: "Yes, Tolerable", next: 98, resultType: "continue" },
                { text: "No, Intolerable", next: 3, type: "yes" }
            ]
        },
        3: {
            title: "Step 3: Check CK Level",
            desc: "Creatine Kinase (CK) result:",
            options: [
                { text: "CK > 50x ULN", next: 97, resultType: "rhabdo", type: "yes" },
                { text: "CK 10–50x ULN", next: 96, resultType: "stop10", type: "yes" },
                { text: "CK 4–10x ULN", next: 95, resultType: "stop4", type: "no" },
                { text: "CK < 4x ULN", next: 94, resultType: "lowck", type: "no" }
            ]
        }
    };

    const results = {
        99: {
            title: "Unlikely to be Statin Related",
            html: `<div class="action-box action-neutral"><i class="fa-solid fa-info-circle"></i> Consider other causes. If in doubt, follow standard adverse event pathway.</div>`,
            color: "info"
        },
        98: {
            title: "Continue Statin",
            html: `<div class="action-box action-success"><i class="fa-solid fa-check-circle"></i> Continue current dose. Monitor.</div>`,
            color: "success"
        },
        97: {
            title: "SUSPECT RHABDOMYOLYSIS",
            html: `<div class="action-box action-danger"><i class="fa-solid fa-triangle-exclamation"></i> ADMIT PATIENT. Stop Statin.</div>`,
            color: "danger"
        },
        96: {
            title: "Stop Statin Immediately",
            html: `<p>Stop statin. Recheck CK in 1 week. If still >5x ULN, do not restart.</p>`,
            color: "danger"
        },
        95: {
            title: "Stop & Re-challenge",
            html: `<p><strong>STOP statin for 4–6 weeks.</strong></p>
                   <p>If CK normalises and symptom-free for ≥2 weeks:</p>
                   <ul class="feature-list">
                       <li>Restart statin at lower dose or use alternative.</li>
                       <li>Titrate up at 8 week intervals.</li>
                   </ul>`,
            color: "warning"
        },
        94: {
            title: "Management Plan",
            html: `<p><strong>Continue or Lower Dose.</strong></p>
                   <p>Check bone profile, Vit D, CRP (for PMR) if considering non-statin causes.</p>
                   <p>If persistent: Try alternate-day dosing (atorva/rosuva) or add ezetimibe.</p>`,
            color: "success"
        }
    };

    let currentStep = 1;

    function renderTool(stepNum) {
        const stepData = steps[stepNum];
        const optionsArea = document.getElementById('options-area');
        const resultArea = document.getElementById('result-area');
        const stepTitle = document.getElementById('step-title');
        const stepDesc = document.getElementById('step-desc');
        const emergencyAlert = document.getElementById('emergency-alert');

        // Hide emergency banner by default unless triggered
        emergencyAlert.style.display = 'none';

        // If stepNum is in results object (end state)
        if (results[stepNum]) {
            optionsArea.innerHTML = '';
            resultArea.innerHTML = '';
            stepTitle.innerText = "Assessment Complete";
            stepDesc.innerText = "Recommended Action:";
            
            let res = results[stepNum];
            let bgClass = res.color === 'danger' ? 'var(--danger-bg)' : 
                          res.color === 'success' ? 'var(--success-bg)' : '#e2e6ea';
            let textClass = res.color === 'danger' ? 'var(--danger)' : 
                            res.color === 'success' ? 'var(--success)' : 'var(--text-dark)';

            const panel = document.createElement('div');
            panel.className = "result-panel visible";
            panel.style.backgroundColor = bgClass;
            panel.style.color = textClass;
            panel.style.border = `1px solid ${textClass}`;
            panel.innerHTML = `<h3>${res.title}</h3>${res.html}`;
            
            // Special case for Rhabdo
            if(res.color === 'danger' && stepNum === 97) {
                emergencyAlert.style.display = 'block';
            }

            resultArea.appendChild(panel);
            return;
        }

        // Render Step
        stepTitle.innerText = stepData.title;
        stepDesc.innerText = stepData.desc;
        resultArea.innerHTML = ''; // Clear previous results
        optionsArea.innerHTML = '';

        stepData.options.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = `option-btn ${opt.type || ''}`;
            btn.innerText = opt.text;
            btn.onclick = () => {
                if (opt.next) renderTool(opt.next);
            };
            optionsArea.appendChild(btn);
        });
    }

    function resetTool() {
        currentStep = 1;
        document.getElementById('emergency-alert').style.display = 'none';
        renderTool(1);
    }

    // Initialize Tool
    renderTool(1);

</script>

</body>
</html>