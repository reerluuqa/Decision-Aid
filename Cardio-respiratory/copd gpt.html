<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clinical Dashboard</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1730;
      --card:#0f1a36;
      --text:#e8eefc;
      --muted:#a8b3d6;
      --border: rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --shadowSoft: 0 6px 18px rgba(0,0,0,.25);

      --red:#ff4d4d;
      --blue:#4ea1ff;
      --green:#33d17a;
      --amber:#ffb020;
      --focus:#b6f2ff;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(78,161,255,.18), transparent 60%),
        radial-gradient(1000px 500px at 80% 30%, rgba(51,209,122,.14), transparent 60%),
        radial-gradient(900px 600px at 60% 90%, rgba(255,77,77,.10), transparent 55%),
        var(--bg);
    }

    a { color: inherit; text-decoration: none; }
    a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible {
      outline: 2px solid var(--focus);
      outline-offset: 2px;
      border-radius: 10px;
    }

    /* Layout */
    .app{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 18px;
      max-width: 1300px;
      margin: 0 auto;
      padding: 18px;
    }

    /* Sidebar */
    .sidebar{
      position: sticky;
      top: 18px;
      align-self: start;
      height: calc(100dvh - 36px);
      overflow: hidden;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border-radius: 18px;
      box-shadow: var(--shadowSoft);
      display:flex;
      flex-direction: column;
    }

    .side-header{
      padding: 16px 16px 12px;
      border-bottom: 1px solid var(--border);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      margin-bottom: 10px;
    }
    .logo{
      width: 36px; height: 36px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 30%, rgba(78,161,255,.9), rgba(51,209,122,.7));
      box-shadow: 0 10px 25px rgba(78,161,255,.18);
      display:grid; place-items:center;
      border: 1px solid rgba(255,255,255,.12);
    }
    .brand h1{
      font-size: 14px;
      margin:0;
      letter-spacing: .2px;
      line-height: 1.2;
    }
    .brand .sub{
      display:block;
      margin-top: 2px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 500;
    }

    .side-tools{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top: 10px;
    }
    .search{
      position: relative;
    }
    .search input{
      width:100%;
      padding: 11px 12px 11px 40px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(15,23,48,.55);
      color: var(--text);
      box-shadow: inset 0 0 0 9999px rgba(255,255,255,.02);
    }
    .search .icon{
      position:absolute;
      left: 12px; top: 50%;
      transform: translateY(-50%);
      opacity: .9;
    }
    .pillrow{
      display:flex; flex-wrap:wrap; gap:8px;
    }
    .pill{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      user-select: none;
      transition: transform .08s ease, background .2s ease, color .2s ease;
    }
    .pill:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); color: var(--text); }
    .pill[data-filter="red"]{ border-left: 3px solid var(--red); }
    .pill[data-filter="blue"]{ border-left: 3px solid var(--blue); }
    .pill[data-filter="green"]{ border-left: 3px solid var(--green); }
    .pill.active{
      background: rgba(182,242,255,.10);
      color: var(--text);
      border-color: rgba(182,242,255,.35);
    }

    .nav{
      padding: 12px 10px 16px;
      overflow:auto;
    }
    .nav .group-title{
      color: var(--muted);
      font-size: 11px;
      letter-spacing: .12em;
      text-transform: uppercase;
      padding: 10px 8px 6px;
    }
    .nav a{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid transparent;
      color: rgba(232,238,252,.90);
      transition: background .2s ease, border-color .2s ease, transform .08s ease;
      margin: 4px 4px;
    }
    .nav a:hover{
      background: rgba(255,255,255,.05);
      border-color: rgba(255,255,255,.06);
      transform: translateY(-1px);
    }
    .nav a.active{
      background: rgba(78,161,255,.10);
      border-color: rgba(78,161,255,.28);
    }
    .nav .meta{
      margin-left:auto;
      font-size: 11px;
      color: var(--muted);
      border: 1px solid var(--border);
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.03);
    }

    .side-footer{
      margin-top:auto;
      padding: 12px 14px;
      border-top: 1px solid var(--border);
      color: var(--muted);
      font-size: 12px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
    }

    /* Main */
    .main{
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow: hidden;
      min-height: calc(100dvh - 36px);
    }

    .main-header{
      padding: 18px 18px 14px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 14px;
    }
    .titleblock h2{
      margin:0;
      font-size: 18px;
      letter-spacing: .2px;
    }
    .titleblock p{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.4;
    }
    .header-actions{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    .btn{
      cursor:pointer;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 14px;
      display:flex;
      align-items:center;
      gap:8px;
      font-size: 12px;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.10); }
    .btn.primary{
      background: rgba(78,161,255,.12);
      border-color: rgba(78,161,255,.25);
    }

    .content{
      padding: 18px;
    }

    .section{
      scroll-margin-top: 18px;
      margin-bottom: 18px;
    }
    .section-head{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin: 6px 4px 10px;
    }
    .section-head h3{
      margin:0;
      font-size: 14px;
      letter-spacing: .3px;
    }
    .section-head .hint{
      color: var(--muted);
      font-size: 12px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 1100px){
      .app{ grid-template-columns: 1fr; }
      .sidebar{ position: relative; height: auto; }
      .grid{ grid-template-columns: 1fr; }
    }

    /* Cards */
    .card{
      background: rgba(15,26,54,.60);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadowSoft);
      overflow: hidden;
      position: relative;
    }
    .card::before{
      content:"";
      position:absolute; left:0; top:0; bottom:0;
      width: 6px;
      background: var(--blue);
      opacity: .95;
    }
    .card[data-severity="red"]::before{ background: var(--red); }
    .card[data-severity="blue"]::before{ background: var(--blue); }
    .card[data-severity="green"]::before{ background: var(--green); }

    .card-inner{ padding: 14px 14px 12px 16px; }
    .card-top{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }
    .card-title{
      display:flex; align-items:center; gap:10px;
      margin:0;
      font-size: 13px;
      letter-spacing: .2px;
    }
    .tag{
      font-size: 11px;
      color: var(--muted);
      border: 1px solid var(--border);
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.03);
      white-space: nowrap;
    }
    .tag.red{ border-color: rgba(255,77,77,.28); background: rgba(255,77,77,.08); color: rgba(255,207,207,.95); }
    .tag.blue{ border-color: rgba(78,161,255,.28); background: rgba(78,161,255,.08); color: rgba(210,232,255,.95); }
    .tag.green{ border-color: rgba(51,209,122,.28); background: rgba(51,209,122,.08); color: rgba(210,255,230,.95); }

    .iconbubble{
      width: 34px; height: 34px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      display:grid; place-items:center;
      flex: 0 0 auto;
    }

    .card p{
      margin: 0 0 10px;
      color: rgba(232,238,252,.92);
      font-size: 12.5px;
      line-height: 1.45;
    }

    .list{
      display:grid;
      gap: 8px;
      margin-top: 8px;
    }
    .item{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px dashed rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
    }
    .item .mini{
      width: 26px; height: 26px;
      border-radius: 12px;
      display:grid; place-items:center;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      flex: 0 0 auto;
      margin-top: 1px;
    }
    .item .txt{
      display:grid;
      gap: 2px;
      min-width: 0;
    }
    .item .txt .k{
      font-size: 12px;
      color: var(--text);
      font-weight: 600;
      letter-spacing: .1px;
    }
    .item .txt .v{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.35;
    }

    .card-actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .small{
      font-size: 11.5px;
      color: var(--muted);
    }

    /* Toast */
    .toast{
      position: fixed;
      right: 18px;
      bottom: 18px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(15,26,54,.85);
      box-shadow: var(--shadow);
      max-width: 360px;
      color: var(--text);
      display:none;
      gap: 10px;
      align-items:flex-start;
      backdrop-filter: blur(10px);
    }
    .toast.show{ display:flex; }
    .toast .ticon{
      width: 30px; height: 30px;
      border-radius: 14px;
      display:grid; place-items:center;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      flex: 0 0 auto;
    }
    .toast .ttext{ font-size: 12px; line-height: 1.35; color: rgba(232,238,252,.92); }
  </style>
</head>

<body>
  <div class="app" id="app">
    <!-- SIDEBAR -->
    <aside class="sidebar" aria-label="Quick navigation">
      <div class="side-header">
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <!-- Cross icon -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M10 4h4v6h6v4h-6v6h-4v-6H4v-4h6V4z" fill="rgba(11,16,32,.9)"></path>
            </svg>
          </div>
          <div>
            <h1>Clinical Dashboard <span class="sub">Two-column module view</span></h1>
          </div>
        </div>

        <div class="side-tools">
          <div class="search">
            <span class="icon" aria-hidden="true">
              <!-- magnifier -->
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="rgba(232,238,252,.85)" stroke-width="2"/>
                <path d="M16.5 16.5 21 21" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </span>
            <input id="q" type="search" placeholder="Search modules (title, content)..." autocomplete="off" />
          </div>

          <div class="pillrow" aria-label="Quick filters">
            <div class="pill active" data-filter="all" role="button" tabindex="0">All</div>
            <div class="pill" data-filter="red" role="button" tabindex="0">Red flags</div>
            <div class="pill" data-filter="blue" role="button" tabindex="0">Standard care</div>
            <div class="pill" data-filter="green" role="button" tabindex="0">Good response</div>
          </div>
        </div>
      </div>

      <nav class="nav" id="nav">
        <div class="group-title">Sections</div>

        <a href="#overview" data-target="overview">
          <span aria-hidden="true">
            <!-- dashboard -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M4 13a8 8 0 1 1 16 0" stroke="rgba(232,238,252,.9)" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 13l4-4" stroke="rgba(232,238,252,.9)" stroke-width="2" stroke-linecap="round"/>
              <path d="M4 13v7h16v-7" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          Overview
          <span class="meta" id="count-all">—</span>
        </a>

        <a href="#assessment" data-target="assessment">
          <span aria-hidden="true">
            <!-- clipboard -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M9 4h6a2 2 0 0 1 2 2v16H7V6a2 2 0 0 1 2-2Z" stroke="rgba(232,238,252,.85)" stroke-width="2"/>
              <path d="M9 4a3 3 0 0 0 6 0" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round"/>
              <path d="M9 10h6M9 14h6M9 18h6" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          Assessment tools
          <span class="meta" id="count-assessment">—</span>
        </a>

        <a href="#treatment" data-target="treatment">
          <span aria-hidden="true">
            <!-- pill -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M10 8l6 6" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round"/>
              <path d="M7.5 10.5a4.5 4.5 0 0 1 0-6.36 4.5 4.5 0 0 1 6.36 0l6.36 6.36a4.5 4.5 0 0 1 0 6.36 4.5 4.5 0 0 1-6.36 0l-6.36-6.36Z" stroke="rgba(232,238,252,.85)" stroke-width="2"/>
            </svg>
          </span>
          Medications
          <span class="meta" id="count-treatment">—</span>
        </a>

        <a href="#referral" data-target="referral">
          <span aria-hidden="true">
            <!-- share/referral -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M16 8a3 3 0 1 0-2.83-4H13a3 3 0 0 0 3 4Z" fill="rgba(232,238,252,.0)"/>
              <path d="M18 8a3 3 0 1 1-3-3" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round"/>
              <path d="M6 14a3 3 0 1 0 3 3" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round"/>
              <path d="M18 16a3 3 0 1 1-3 3" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round"/>
              <path d="M8.7 15.3l6.6-3.6M8.7 16.7l6.6 3.6" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          Referral criteria
          <span class="meta" id="count-referral">—</span>
        </a>

        <div class="group-title">Actions</div>
        <a href="#notes" data-target="notes">
          <span aria-hidden="true">
            <!-- note -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M7 3h10a2 2 0 0 1 2 2v14l-4 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z" stroke="rgba(232,238,252,.85)" stroke-width="2"/>
              <path d="M9 8h6M9 12h6M9 16h4" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          Notes & audit
          <span class="meta" id="count-notes">—</span>
        </a>
      </nav>

      <div class="side-footer">
        <span id="status">Ready</span>
        <span class="small" id="clock">—</span>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main" aria-label="Clinical content">
      <header class="main-header">
        <div class="titleblock">
          <h2>Clinical Dashboard Modules</h2>
          <p>
            Visually distinct cards with color-coded borders (red = red flags, blue = standard care, green = good response).
            Icons differentiate assessment tools, medications, and referral criteria.
          </p>
        </div>
        <div class="header-actions">
          <button class="btn primary" id="expandAll" type="button">
            <span aria-hidden="true">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M7 12h10" stroke="rgba(232,238,252,.95)" stroke-width="2" stroke-linecap="round"/>
                <path d="M12 7v10" stroke="rgba(232,238,252,.95)" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </span>
            Expand details
          </button>
          <button class="btn" id="collapseAll" type="button">
            <span aria-hidden="true">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M7 12h10" stroke="rgba(232,238,252,.9)" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </span>
            Collapse details
          </button>
          <button class="btn" id="copySummary" type="button">
            <span aria-hidden="true">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M9 9h10v12H9z" stroke="rgba(232,238,252,.85)" stroke-width="2"/>
                <path d="M5 15H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </span>
            Copy snapshot
          </button>
        </div>
      </header>

      <div class="content" id="content">
        <!-- OVERVIEW -->
        <section class="section" id="overview" data-section="overview">
          <div class="section-head">
            <h3>Overview</h3>
            <div class="hint">At-a-glance status tiles for rapid orientation.</div>
          </div>
          <div class="grid">
            <article class="card" data-severity="blue" data-type="standard" data-title="Clinical summary">
              <div class="card-inner">
                <div class="card-top">
                  <h4 class="card-title">
                    <span class="iconbubble" aria-hidden="true">
                      <!-- info -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="rgba(232,238,252,.85)" stroke-width="2"/>
                        <path d="M12 10v7" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M12 7h.01" stroke="rgba(232,238,252,.85)" stroke-width="3" stroke-linecap="round"/>
                      </svg>
                    </span>
                    Clinical summary
                  </h4>
                  <span class="tag blue">Standard care</span>
                </div>

                <p class="small">
                  Place your pathway-specific summary here (presentation, phenotype, severity, key comorbidities).
                  Modules below are deliberately separated for rapid scanning.
                </p>

                <details class="details">
                  <summary class="small">Show structured fields</summary>
                  <div class="list" style="margin-top:10px;">
                    <div class="item">
                      <div class="mini" aria-hidden="true">
                        <!-- stethoscope-ish -->
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                          <path d="M7 3v6a5 5 0 0 0 10 0V3" stroke="rgba(232,238,252,.8)" stroke-width="2" stroke-linecap="round"/>
                          <path d="M12 14v3a4 4 0 0 0 8 0v-1" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
                          <path d="M19 16a2 2 0 1 0 0 4" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                      </div>
                      <div class="txt">
                        <div class="k">Problem representation</div>
                        <div class="v">Age, baseline function, symptom trajectory, trigger(s), objective severity markers.</div>
                      </div>
                    </div>

                    <div class="item">
                      <div class="mini" aria-hidden="true">
                        <!-- lungs -->
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                          <path d="M12 12V3" stroke="rgba(232,238,252,.75)" stroke-width="2" stroke-linecap="round"/>
                          <path d="M12 12c-2-3-6-4-8-1-2 3 0 10 4 10 3 0 4-3 4-7Z" stroke="rgba(232,238,252,.6)" stroke-width="2"/>
                          <path d="M12 12c2-3 6-4 8-1 2 3 0 10-4 10-3 0-4-3-4-7Z" stroke="rgba(232,238,252,.6)" stroke-width="2"/>
                        </svg>
                      </div>
                      <div class="txt">
                        <div class="k">Key objective data</div>
                        <div class="v">Vitals, oximetry/ABG trend, spirometry, imaging, biomarkers relevant to pathway.</div>
                      </div>
                    </div>
                  </div>
                </details>
              </div>
            </article>

            <article class="card" data-severity="green" data-type="good" data-title="Response markers">
              <div class="card-inner">
                <div class="card-top">
                  <h4 class="card-title">
                    <span class="iconbubble" aria-hidden="true">
                      <!-- trending up -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M4 16l6-6 4 4 6-8" stroke="rgba(232,238,252,.9)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 6h6v6" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </span>
                    Response markers
                  </h4>
                  <span class="tag green">Good response</span>
                </div>
                <p class="small">
                  Use these tiles to define “improving” vs “not improving” with objective and patient-centred targets.
                </p>

                <div class="list">
                  <div class="item">
                    <div class="mini" aria-hidden="true">
                      <!-- check -->
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M20 6 9 17l-5-5" stroke="rgba(232,238,252,.8)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <div class="txt">
                      <div class="k">Physiology improving</div>
                      <div class="v">Stable/improving work of breathing, gas exchange, haemodynamics.</div>
                    </div>
                  </div>
                  <div class="item">
                    <div class="mini" aria-hidden="true">
                      <!-- activity -->
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M3 12h5l2-7 4 14 2-7h5" stroke="rgba(232,238,252,.7)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <div class="txt">
                      <div class="k">Function improving</div>
                      <div class="v">Mobility, exertional tolerance, symptom burden decreasing.</div>
                    </div>
                  </div>
                </div>
              </div>
            </article>
          </div>
        </section>

        <!-- ASSESSMENT -->
        <section class="section" id="assessment" data-section="assessment">
          <div class="section-head">
            <h3>Assessment tools</h3>
            <div class="hint">Structured scores, bedside tests, and escalation triggers.</div>
          </div>

          <div class="grid">
            <article class="card" data-severity="blue" data-type="tool" data-title="Symptom / severity scoring">
              <div class="card-inner">
                <div class="card-top">
                  <h4 class="card-title">
                    <span class="iconbubble" aria-hidden="true">
                      <!-- ruler -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M3 21 21 3" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M7 17l2 2M10 14l2 2M13 11l2 2M16 8l2 2" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </span>
                    Symptom / severity scoring
                  </h4>
                  <span class="tag blue">Assessment tool</span>
                </div>

                <p class="small">Drop in your preferred tools (e.g., dyspnoea scale, CAT-style symptom score, exercise tolerance).</p>

                <details class="details">
                  <summary class="small">Show template</summary>
                  <div class="list" style="margin-top:10px;">
                    <div class="item">
                      <div class="mini" aria-hidden="true">
                        <!-- form -->
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                          <path d="M7 4h10v16H7z" stroke="rgba(232,238,252,.7)" stroke-width="2"/>
                          <path d="M9 8h6M9 12h6M9 16h4" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                      </div>
                      <div class="txt">
                        <div class="k">Score captured</div>
                        <div class="v">Name • date/time • baseline vs current • interpretation banding.</div>
                      </div>
                    </div>
                    <div class="item">
                      <div class="mini" aria-hidden="true">
                        <!-- bell -->
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                          <path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7" stroke="rgba(232,238,252,.65)" stroke-width="2" stroke-linecap="round"/>
                          <path d="M10 19a2 2 0 0 0 4 0" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                      </div>
                      <div class="txt">
                        <div class="k">Escalation threshold</div>
                        <div class="v">Predefine triggers for senior review / monitoring intensity.</div>
                      </div>
                    </div>
                  </div>
                </details>
              </div>
            </article>

            <article class="card" data-severity="red" data-type="tool" data-title="Red flags screening">
              <div class="card-inner">
                <div class="card-top">
                  <h4 class="card-title">
                    <span class="iconbubble" aria-hidden="true">
                      <!-- alert -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M12 9v5" stroke="rgba(232,238,252,.9)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M12 17h.01" stroke="rgba(232,238,252,.9)" stroke-width="3" stroke-linecap="round"/>
                        <path d="M10.3 4.3 2.6 18.1A2 2 0 0 0 4.3 21h15.4a2 2 0 0 0 1.7-2.9L13.7 4.3a2 2 0 0 0-3.4 0Z" stroke="rgba(232,238,252,.85)" stroke-width="2"/>
                      </svg>
                    </span>
                    Red flags screening
                  </h4>
                  <span class="tag red">Red flags</span>
                </div>

                <p class="small">
                  Populate this module with “must-not-miss” differentials and immediate actions (ABG, imaging, ECG, etc.).
                </p>

                <div class="list">
                  <div class="item">
                    <div class="mini" aria-hidden="true">
                      <!-- bolt -->
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M13 2 3 14h7l-1 8 12-14h-7l-1-6Z" stroke="rgba(232,238,252,.7)" stroke-width="2" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <div class="txt">
                      <div class="k">Time-critical deterioration</div>
                      <div class="v">Worsening gas exchange, rising CO₂, hypotension, altered mentation, exhaustion.</div>
                    </div>
                  </div>
                  <div class="item">
                    <div class="mini" aria-hidden="true">
                      <!-- target -->
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="rgba(232,238,252,.65)" stroke-width="2"/>
                        <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z" stroke="rgba(232,238,252,.55)" stroke-width="2"/>
                        <path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" fill="rgba(232,238,252,.65)"/>
                      </svg>
                    </div>
                    <div class="txt">
                      <div class="k">Alternative diagnosis flags</div>
                      <div class="v">Pneumonia/PE/pneumothorax/ACS/arrhythmia—define rapid rule-out set.</div>
                    </div>
                  </div>
                </div>
              </div>
            </article>
          </div>
        </section>

        <!-- TREATMENT -->
        <section class="section" id="treatment" data-section="treatment">
          <div class="section-head">
            <h3>Medications</h3>
            <div class="hint">Dose, route, response, and safety constraints in one place.</div>
          </div>

          <div class="grid">
            <article class="card" data-severity="blue" data-type="med" data-title="First-line pharmacotherapy">
              <div class="card-inner">
                <div class="card-top">
                  <h4 class="card-title">
                    <span class="iconbubble" aria-hidden="true">
                      <!-- rx -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M6 2h7a4 4 0 0 1 0 8H6V2Z" stroke="rgba(232,238,252,.85)" stroke-width="2"/>
                        <path d="M6 10l12 12" stroke="rgba(232,238,252,.75)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M14 14l4-4" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </span>
                    First-line pharmacotherapy
                  </h4>
                  <span class="tag blue">Standard care</span>
                </div>

                <p class="small">
                  Use medication rows for protocolised ordering: agent • dose • route/device • frequency • monitoring.
                </p>

                <details class="details" open>
                  <summary class="small">Show medication rows</summary>
                  <div class="list" style="margin-top:10px;">
                    <div class="item">
                      <div class="mini" aria-hidden="true">
                        <!-- inhaler -->
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                          <path d="M7 7h10v5H7z" stroke="rgba(232,238,252,.7)" stroke-width="2"/>
                          <path d="M9 12v8h6v-8" stroke="rgba(232,238,252,.6)" stroke-width="2"/>
                          <path d="M6 7V4h12v3" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                      </div>
                      <div class="txt">
                        <div class="k">Bronchodilator block</div>
                        <div class="v">SABA/SAMA or LABA/LAMA pathway • device competence check built-in.</div>
                      </div>
                    </div>
                    <div class="item">
                      <div class="mini" aria-hidden="true">
                        <!-- shield -->
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                          <path d="M12 2l8 4v6c0 5-3.4 9.4-8 10-4.6-.6-8-5-8-10V6l8-4Z" stroke="rgba(232,238,252,.65)" stroke-width="2"/>
                        </svg>
                      </div>
                      <div class="txt">
                        <div class="k">Risk mitigation</div>
                        <div class="v">Contraindications, interactions, adverse effect surveillance, follow-up timing.</div>
                      </div>
                    </div>
                  </div>
                </details>
              </div>
            </article>

            <article class="card" data-severity="green" data-type="med" data-title="De-escalation and response">
              <div class="card-inner">
                <div class="card-top">
                  <h4 class="card-title">
                    <span class="iconbubble" aria-hidden="true">
                      <!-- taper -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M4 20h16" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M6 17l12-12" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M14 5h4v4" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </span>
                    De-escalation and response
                  </h4>
                  <span class="tag green">Good response</span>
                </div>

                <p class="small">
                  Define explicit “step-down” criteria: symptom improvement, physiology stability, device mastery, safe discharge plan.
                </p>

                <div class="list">
                  <div class="item">
                    <div class="mini" aria-hidden="true">
                      <!-- calendar -->
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M7 2v3M17 2v3" stroke="rgba(232,238,252,.7)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M3 8h18" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M5 5h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z" stroke="rgba(232,238,252,.6)" stroke-width="2"/>
                      </svg>
                    </div>
                    <div class="txt">
                      <div class="k">Review cadence</div>
                      <div class="v">Reassess at predefined intervals; document objective response and tolerance.</div>
                    </div>
                  </div>
                  <div class="item">
                    <div class="mini" aria-hidden="true">
                      <!-- home -->
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M3 10 12 3l9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V10Z" stroke="rgba(232,238,252,.65)" stroke-width="2" stroke-linejoin="round"/>
                        <path d="M9 22V12h6v10" stroke="rgba(232,238,252,.55)" stroke-width="2"/>
                      </svg>
                    </div>
                    <div class="txt">
                      <div class="k">Discharge readiness</div>
                      <div class="v">Device technique, meds reconciliation, follow-up, safety-net and escalation route.</div>
                    </div>
                  </div>
                </div>
              </div>
            </article>
          </div>
        </section>

        <!-- REFERRAL -->
        <section class="section" id="referral" data-section="referral">
          <div class="section-head">
            <h3>Referral criteria</h3>
            <div class="hint">Embed service thresholds and urgency grading.</div>
          </div>

          <div class="grid">
            <article class="card" data-severity="red" data-type="ref" data-title="Urgent specialist input">
              <div class="card-inner">
                <div class="card-top">
                  <h4 class="card-title">
                    <span class="iconbubble" aria-hidden="true">
                      <!-- phone -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M22 16.9v3a2 2 0 0 1-2.2 2 19.8 19.8 0 0 1-8.6-3.1 19.5 19.5 0 0 1-6-6A19.8 19.8 0 0 1 2.1 4.2 2 2 0 0 1 4.1 2h3a2 2 0 0 1 2 1.7c.1.9.3 1.8.6 2.6a2 2 0 0 1-.5 2.1L8 9.5a16 16 0 0 0 6 6l1.1-1.1a2 2 0 0 1 2.1-.5c.8.3 1.7.5 2.6.6a2 2 0 0 1 1.7 2Z"
                              stroke="rgba(232,238,252,.75)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </span>
                    Urgent specialist input
                  </h4>
                  <span class="tag red">Red flags</span>
                </div>

                <p class="small">
                  Escalate by physiology, trajectory, diagnostic uncertainty, or need for advanced support (define locally).
                </p>

                <div class="list">
                  <div class="item">
                    <div class="mini" aria-hidden="true">
                      <!-- layers -->
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M12 2 2 7l10 5 10-5-10-5Z" stroke="rgba(232,238,252,.65)" stroke-width="2" stroke-linejoin="round"/>
                        <path d="M2 12l10 5 10-5" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linejoin="round"/>
                        <path d="M2 17l10 5 10-5" stroke="rgba(232,238,252,.45)" stroke-width="2" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <div class="txt">
                      <div class="k">Level-of-care decision</div>
                      <div class="v">Trigger for HDU/ICU consult; ventilatory support considerations; ceiling of care.</div>
                    </div>
                  </div>
                  <div class="item">
                    <div class="mini" aria-hidden="true">
                      <!-- microscope -->
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M6 18h8" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M10 18v-4l6-6" stroke="rgba(232,238,252,.7)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M14 8l-2-2 3-3 2 2-3 3Z" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linejoin="round"/>
                        <path d="M5 22h14" stroke="rgba(232,238,252,.45)" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </div>
                    <div class="txt">
                      <div class="k">Diagnostic uncertainty</div>
                      <div class="v">Disproportionate symptoms, atypical imaging, unclear phenotype—early specialty review.</div>
                    </div>
                  </div>
                </div>
              </div>
            </article>

            <article class="card" data-severity="blue" data-type="ref" data-title="Routine referral and allied health">
              <div class="card-inner">
                <div class="card-top">
                  <h4 class="card-title">
                    <span class="iconbubble" aria-hidden="true">
                      <!-- users -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="rgba(232,238,252,.75)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke="rgba(232,238,252,.75)" stroke-width="2"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.9" stroke="rgba(232,238,252,.5)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M16 3.1a4 4 0 0 1 0 7.8" stroke="rgba(232,238,252,.5)" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </span>
                    Routine referral and allied health
                  </h4>
                  <span class="tag blue">Standard care</span>
                </div>

                <p class="small">
                  Consolidate thresholds for rehab, oxygen assessment, physiotherapy, dietetics, psychology, and social care.
                </p>

                <details class="details">
                  <summary class="small">Show referral checklist</summary>
                  <div class="list" style="margin-top:10px;">
                    <div class="item">
                      <div class="mini" aria-hidden="true">
                        <!-- oxygen -->
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                          <path d="M12 2v6" stroke="rgba(232,238,252,.7)" stroke-width="2" stroke-linecap="round"/>
                          <path d="M9 8h6" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
                          <path d="M8 22h8" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                          <path d="M9 22V10h6v12" stroke="rgba(232,238,252,.6)" stroke-width="2"/>
                        </svg>
                      </div>
                      <div class="txt">
                        <div class="k">Oxygen pathway</div>
                        <div class="v">Criteria → specialist assessment → safety counsel (fire risk, monitoring, review).</div>
                      </div>
                    </div>
                    <div class="item">
                      <div class="mini" aria-hidden="true">
                        <!-- dumbbell -->
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                          <path d="M6 9v6M18 9v6" stroke="rgba(232,238,252,.7)" stroke-width="2" stroke-linecap="round"/>
                          <path d="M8 10h8M8 14h8" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                          <path d="M4 8h2v8H4zM18 8h2v8h-2z" stroke="rgba(232,238,252,.6)" stroke-width="2"/>
                        </svg>
                      </div>
                      <div class="txt">
                        <div class="k">Rehabilitation / function</div>
                        <div class="v">Eligibility, contraindications, and mode (face-to-face vs digital) per local service.</div>
                      </div>
                    </div>
                  </div>
                </details>
              </div>
            </article>
          </div>
        </section>

        <!-- NOTES -->
        <section class="section" id="notes" data-section="notes">
          <div class="section-head">
            <h3>Notes & audit</h3>
            <div class="hint">Capture decisions, rationale, and data for handover/audit.</div>
          </div>

          <div class="grid">
            <article class="card" data-severity="blue" data-type="standard" data-title="Clinical notes">
              <div class="card-inner">
                <div class="card-top">
                  <h4 class="card-title">
                    <span class="iconbubble" aria-hidden="true">
                      <!-- pen -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M12 20h9" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5Z" stroke="rgba(232,238,252,.8)" stroke-width="2" stroke-linejoin="round"/>
                      </svg>
                    </span>
                    Clinical notes
                  </h4>
                  <span class="tag blue">Standard care</span>
                </div>

                <p class="small">Type notes locally (stored in-browser). Use “Copy snapshot” for quick handover text.</p>

                <textarea id="notesBox" rows="8" style="
                  width:100%;
                  border-radius: 14px;
                  border: 1px solid var(--border);
                  background: rgba(255,255,255,.03);
                  color: var(--text);
                  padding: 10px 12px;
                  resize: vertical;
                  font-size: 12.5px;
                  line-height: 1.45;
                " placeholder="Assessment • impression • plan • response • escalation thresholds..."></textarea>

                <div class="card-actions">
                  <button class="btn" id="saveNotes" type="button">
                    <span aria-hidden="true">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2Z" stroke="rgba(232,238,252,.75)" stroke-width="2"/>
                        <path d="M17 21v-8H7v8" stroke="rgba(232,238,252,.55)" stroke-width="2"/>
                        <path d="M7 3v5h8" stroke="rgba(232,238,252,.55)" stroke-width="2"/>
                      </svg>
                    </span>
                    Save notes
                  </button>
                  <button class="btn" id="clearNotes" type="button">
                    <span aria-hidden="true">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M3 6h18" stroke="rgba(232,238,252,.7)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M8 6V4h8v2" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M19 6l-1 16H6L5 6" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linejoin="round"/>
                        <path d="M10 11v6M14 11v6" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </span>
                    Clear
                  </button>
                </div>
              </div>
            </article>

            <article class="card" data-severity="green" data-type="good" data-title="Audit-friendly snapshot">
              <div class="card-inner">
                <div class="card-top">
                  <h4 class="card-title">
                    <span class="iconbubble" aria-hidden="true">
                      <!-- checklist -->
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M9 11l2 2 4-4" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M9 17l2 2 4-4" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M4 6h16M4 12h3M4 18h3" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </span>
                    Audit-friendly snapshot
                  </h4>
                  <span class="tag green">Good response</span>
                </div>

                <p class="small">
                  This panel is designed for governance: decisions, thresholds, and outcomes—kept deliberately concise.
                </p>

                <div class="list">
                  <div class="item">
                    <div class="mini" aria-hidden="true">
                      <!-- clock -->
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="rgba(232,238,252,.65)" stroke-width="2"/>
                        <path d="M12 6v6l4 2" stroke="rgba(232,238,252,.55)" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </div>
                    <div class="txt">
                      <div class="k">Decision timeline</div>
                      <div class="v">Key interventions + response points; reasoned changes to plan.</div>
                    </div>
                  </div>
                  <div class="item">
                    <div class="mini" aria-hidden="true">
                      <!-- link -->
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <path d="M10 13a5 5 0 0 1 0-7l1-1a5 5 0 0 1 7 7l-1 1" stroke="rgba(232,238,252,.6)" stroke-width="2" stroke-linecap="round"/>
                        <path d="M14 11a5 5 0 0 1 0 7l-1 1a5 5 0 0 1-7-7l1-1" stroke="rgba(232,238,252,.5)" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </div>
                    <div class="txt">
                      <div class="k">Criteria-driven escalation</div>
                      <div class="v">Explicit thresholds → who to call → what to do while waiting.</div>
                    </div>
                  </div>
                </div>

                <p class="small" style="margin-top:10px;">
                  Source marker: :contentReference[oaicite:0]{index=0}
                </p>
              </div>
            </article>
          </div>
        </section>

      </div>
    </main>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <div class="ticon" aria-hidden="true" id="toastIcon"></div>
    <div class="ttext" id="toastText">—</div>
  </div>

  <script>
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const nav = $("#nav");
    const q = $("#q");
    const pills = $$(".pill");
    const statusEl = $("#status");
    const clockEl = $("#clock");
    const toast = $("#toast");
    const toastText = $("#toastText");
    const toastIcon = $("#toastIcon");
    const notesBox = $("#notesBox");

    const sections = $$("section.section");
    const cards = $$(".card");
    const details = $$("details.details");

    let activeFilter = "all";
    let activeQuery = "";

    function nowClock(){
      const d = new Date();
      const pad = n => String(n).padStart(2,"0");
      clockEl.textContent = `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }
    setInterval(nowClock, 1000);
    nowClock();

    function showToast(message, variant="info"){
      toastText.textContent = message;
      const icons = {
        info: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                 <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="rgba(232,238,252,.85)" stroke-width="2"/>
                 <path d="M12 10v7" stroke="rgba(232,238,252,.85)" stroke-width="2" stroke-linecap="round"/>
                 <path d="M12 7h.01" stroke="rgba(232,238,252,.85)" stroke-width="3" stroke-linecap="round"/>
               </svg>`,
        ok: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
               <path d="M20 6 9 17l-5-5" stroke="rgba(232,238,252,.9)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
             </svg>`,
        warn: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                 <path d="M12 9v5" stroke="rgba(232,238,252,.9)" stroke-width="2" stroke-linecap="round"/>
                 <path d="M12 17h.01" stroke="rgba(232,238,252,.9)" stroke-width="3" stroke-linecap="round"/>
                 <path d="M10.3 4.3 2.6 18.1A2 2 0 0 0 4.3 21h15.4a2 2 0 0 0 1.7-2.9L13.7 4.3a2 2 0 0 0-3.4 0Z" stroke="rgba(232,238,252,.85)" stroke-width="2"/>
               </svg>`
      };
      toastIcon.innerHTML = icons[variant] || icons.info;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.classList.remove("show"), 2200);
    }

    function norm(s){ return (s||"").toLowerCase().trim(); }

    function cardMatches(card){
      const sev = card.dataset.severity;
      const title = norm(card.dataset.title || card.querySelector(".card-title")?.innerText);
      const text = norm(card.innerText);

      const filterOk = (activeFilter === "all") || (sev === activeFilter);
      const queryOk = !activeQuery || title.includes(activeQuery) || text.includes(activeQuery);

      return filterOk && queryOk;
    }

    function applyFilters(){
      let visibleCards = 0;
      let perSection = new Map();

      cards.forEach(card => {
        const show = cardMatches(card);
        card.style.display = show ? "" : "none";
        if(show){
          visibleCards++;
          const section = card.closest("section.section");
          const key = section?.dataset.section || "unknown";
          perSection.set(key, (perSection.get(key) || 0) + 1);
        }
      });

      // Hide whole sections if empty
      sections.forEach(sec => {
        const key = sec.dataset.section;
        const count = perSection.get(key) || 0;
        sec.style.display = count > 0 ? "" : "none";
      });

      // Update counters in nav
      $("#count-all").textContent = visibleCards;
      $("#count-assessment").textContent = perSection.get("assessment") || 0;
      $("#count-treatment").textContent = perSection.get("treatment") || 0;
      $("#count-referral").textContent = perSection.get("referral") || 0;
      $("#count-notes").textContent = perSection.get("notes") || 0;

      statusEl.textContent = (activeFilter === "all" && !activeQuery)
        ? "Ready"
        : `Filtered: ${activeFilter}${activeQuery ? ` • "${activeQuery}"` : ""}`;

      // If active section is hidden, clear active nav
      const activeNav = $(".nav a.active");
      if(activeNav){
        const target = activeNav.dataset.target;
        const sec = document.getElementById(target);
        if(sec && sec.style.display === "none"){
          activeNav.classList.remove("active");
        }
      }
    }

    // Search
    q.addEventListener("input", () => {
      activeQuery = norm(q.value);
      applyFilters();
    });

    // Pills
    function setPill(filter){
      activeFilter = filter;
      pills.forEach(p => p.classList.toggle("active", p.dataset.filter === filter));
      applyFilters();
      showToast(filter === "all" ? "Showing all modules" : `Filter: ${filter}`, "info");
    }
    pills.forEach(p => {
      p.addEventListener("click", () => setPill(p.dataset.filter));
      p.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " "){ e.preventDefault(); setPill(p.dataset.filter); }
      });
    });

    // Sticky nav active section highlighting
    const obs = new IntersectionObserver((entries) => {
      // pick most visible intersecting section
      const visible = entries.filter(e => e.isIntersecting).sort((a,b)=>b.intersectionRatio-a.intersectionRatio)[0];
      if(!visible) return;
      const id = visible.target.id;
      $$(".nav a").forEach(a => a.classList.toggle("active", a.dataset.target === id));
    }, { root: null, threshold: [0.25, 0.4, 0.6] });

    sections.forEach(s => obs.observe(s));

    // Expand/collapse
    $("#expandAll").addEventListener("click", () => {
      details.forEach(d => d.open = true);
      showToast("Expanded details", "ok");
    });
    $("#collapseAll").addEventListener("click", () => {
      details.forEach(d => d.open = false);
      showToast("Collapsed details", "ok");
    });

    // Notes persistence
    const NOTES_KEY = "clinicalDashboard.notes.v1";
    function loadNotes(){
      const saved = localStorage.getItem(NOTES_KEY);
      if(saved) notesBox.value = saved;
    }
    function saveNotes(){
      localStorage.setItem(NOTES_KEY, notesBox.value || "");
      showToast("Notes saved locally", "ok");
    }
    function clearNotes(){
      notesBox.value = "";
      localStorage.removeItem(NOTES_KEY);
      showToast("Notes cleared", "warn");
    }
    $("#saveNotes").addEventListener("click", saveNotes);
    $("#clearNotes").addEventListener("click", clearNotes);
    notesBox.addEventListener("keydown", (e) => {
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "s"){
        e.preventDefault(); saveNotes();
      }
    });
    loadNotes();

    // Copy snapshot
    $("#copySummary").addEventListener("click", async () => {
      const visible = cards.filter(c => c.style.display !== "none");
      const lines = [];
      lines.push("CLINICAL SNAPSHOT");
      lines.push(`Generated: ${new Date().toISOString()}`);
      lines.push("");
      sections.forEach(sec => {
        if(sec.style.display === "none") return;
        const title = sec.querySelector(".section-head h3")?.innerText?.trim() || sec.id;
        const secCards = $$(".card", sec).filter(c => c.style.display !== "none");
        if(!secCards.length) return;
        lines.push(`== ${title} ==`);
        secCards.forEach(c => {
          const sev = c.dataset.severity;
          const t = c.dataset.title || c.querySelector(".card-title")?.innerText?.trim() || "Module";
          lines.push(`- [${sev}] ${t}`);
        });
        lines.push("");
      });
      const notes = notesBox.value.trim();
      if(notes){
        lines.push("== Notes ==");
        lines.push(notes);
      }

      try{
        await navigator.clipboard.writeText(lines.join("\n"));
        showToast("Snapshot copied to clipboard", "ok");
      }catch{
        showToast("Clipboard blocked by browser settings", "warn");
      }
    });

    // Init counters
    applyFilters();

    // Smooth scroll for nav
    $$(".nav a").forEach(a => {
      a.addEventListener("click", (e) => {
        const id = a.dataset.target;
        const el = document.getElementById(id);
        if(el){
          e.preventDefault();
          el.scrollIntoView({behavior:"smooth", block:"start"});
        }
      });
    });
  </script>
</body>
</html>
