<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chest Pain ‚Äî Rapid Decision Guide (Adult)</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1a33;
      --card:#0f223f;
      --card2:#0c1a33;
      --text:#e7eefc;
      --muted:#a9b6d6;
      --border:rgba(255,255,255,.10);
      --shadow: 0 12px 28px rgba(0,0,0,.35);
      --red:#ff3b5c;
      --green:#23d18b;
      --amber:#ffcc66;
      --blue:#60a5fa;
      --focus:#b7d2ff;
      --chip:#122a52;
      --chip2:#152f5c;
      --radius:18px;
      --radius2:14px;
      --gap:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(96,165,250,.22), transparent 60%),
        radial-gradient(900px 500px at 95% 10%, rgba(35,209,139,.14), transparent 55%),
        radial-gradient(900px 500px at 45% 110%, rgba(255,59,92,.12), transparent 55%),
        var(--bg);
      color:var(--text);
      line-height:1.35;
    }

    a{color:var(--blue); text-decoration:none}
    a:hover{text-decoration:underline}

    /* Layout */
    .wrap{max-width:1200px; margin:0 auto; padding:20px 18px 80px}
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(11,18,32,.92), rgba(11,18,32,.70));
      border-bottom:1px solid var(--border);
    }
    .topbar-inner{
      max-width:1200px; margin:0 auto; padding:14px 18px;
      display:flex; align-items:center; gap:12px; flex-wrap:wrap;
    }
    .brand{
      display:flex; align-items:center; gap:10px; min-width:260px;
    }
    .logo{
      width:38px; height:38px; border-radius:12px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), transparent 52%),
        linear-gradient(135deg, rgba(96,165,250,.95), rgba(35,209,139,.80));
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.16);
    }
    .logo svg{opacity:.95}
    .titleblock{display:flex; flex-direction:column; gap:2px}
    .titleblock h1{font-size:15px; margin:0; letter-spacing:.2px}
    .titleblock .sub{font-size:12px; color:var(--muted)}
    .spacer{flex:1}

    .search{
      flex: 1 1 320px;
      display:flex; gap:10px; align-items:center;
      background:rgba(255,255,255,.06);
      border:1px solid var(--border);
      border-radius:999px;
      padding:10px 12px;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      min-width:260px;
    }
    .search input{
      width:100%;
      border:0; outline:0;
      background:transparent;
      color:var(--text);
      font-size:14px;
    }
    .kbd{
      font-family:var(--mono);
      font-size:11px;
      color:rgba(231,238,252,.85);
      padding:4px 8px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.06);
      white-space:nowrap;
    }

    .chiprow{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .chip{
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color:var(--text);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      display:inline-flex; gap:8px; align-items:center;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .chip:hover{transform: translateY(-1px); background: rgba(255,255,255,.07); border-color: rgba(255,255,255,.18)}
    .chip[aria-pressed="true"]{background: rgba(96,165,250,.18); border-color: rgba(96,165,250,.40)}
    .chip .dot{width:8px; height:8px; border-radius:50%;}
    .dot.red{background:var(--red)}
    .dot.green{background:var(--green)}
    .dot.amber{background:var(--amber)}
    .dot.blue{background:var(--blue)}

    /* Hero */
    .hero{
      margin-top:18px;
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: var(--gap);
      align-items:start;
    }
    @media (max-width: 960px){
      .hero{grid-template-columns:1fr}
      .brand{min-width:auto}
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelhead{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .panelhead h2{
      margin:0; font-size:14px; letter-spacing:.2px;
      display:flex; align-items:center; gap:10px;
    }
    .panelhead .meta{font-size:12px; color:var(--muted)}
    .content{padding:14px 16px}

    /* Callouts */
    .callout{
      border-radius: var(--radius2);
      padding:12px 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      display:flex; gap:10px; align-items:flex-start;
      position:relative;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .callout:hover{transform: translateY(-1px); background: rgba(255,255,255,.055); border-color: rgba(255,255,255,.18)}
    .callout .icon{
      width:34px; height:34px; border-radius:12px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      flex:0 0 34px;
    }
    .callout h3{margin:0 0 4px 0; font-size:13px}
    .callout p{margin:0; color:var(--muted); font-size:12px}
    .callout strong{color:var(--text)}
    .tag{
      position:absolute; right:10px; top:10px;
      font-size:11px; padding:5px 8px; border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      color: rgba(231,238,252,.95);
      display:flex; gap:6px; align-items:center;
    }
    .tag.red{background: rgba(255,59,92,.16); border-color: rgba(255,59,92,.35)}
    .tag.green{background: rgba(35,209,139,.14); border-color: rgba(35,209,139,.32)}
    .tag.amber{background: rgba(255,204,102,.14); border-color: rgba(255,204,102,.30)}
    .badge{
      display:inline-flex; align-items:center; gap:7px;
      font-size:12px; padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      cursor:pointer; user-select:none;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .badge:hover{transform: translateY(-1px); background: rgba(255,255,255,.07); border-color: rgba(255,255,255,.18)}
    .badge.red{background: rgba(255,59,92,.14); border-color: rgba(255,59,92,.32)}
    .badge.green{background: rgba(35,209,139,.13); border-color: rgba(35,209,139,.30)}
    .badge.blue{background: rgba(96,165,250,.14); border-color: rgba(96,165,250,.30)}
    .badge .pill{
      font-family:var(--mono);
      font-size:11px;
      padding:3px 7px;
      border-radius:999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
    }

    /* Grid sections */
    .grid{
      margin-top: var(--gap);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
      align-items:start;
    }
    @media (max-width: 960px){
      .grid{grid-template-columns:1fr}
    }

    /* Checklists */
    .checkgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 700px){
      .checkgrid{grid-template-columns:1fr}
    }
    .check{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.10);
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      position:relative;
    }
    .check:hover{transform: translateY(-1px); background: rgba(255,255,255,.04); border-color: rgba(255,255,255,.16)}
    .check input{margin-top:3px; accent-color: var(--blue)}
    .check .t{font-size:12px; color:var(--text)}
    .check .d{font-size:11px; color:var(--muted); margin-top:2px}
    .check .mini{
      position:absolute; right:10px; top:10px;
      font-size:11px; padding:4px 8px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(231,238,252,.92);
    }
    .mini.red{border-color: rgba(255,59,92,.35); background: rgba(255,59,92,.14)}
    .mini.green{border-color: rgba(35,209,139,.32); background: rgba(35,209,139,.13)}
    .mini.amber{border-color: rgba(255,204,102,.30); background: rgba(255,204,102,.12)}
    .mini.blue{border-color: rgba(96,165,250,.32); background: rgba(96,165,250,.14)}

    /* Accordion */
    details{
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      overflow:hidden;
    }
    details + details{margin-top:10px}
    summary{
      list-style:none;
      cursor:pointer;
      padding:12px 12px;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      user-select:none;
    }
    summary::-webkit-details-marker{display:none}
    .sum-left{display:flex; align-items:center; gap:10px}
    .chev{
      width:26px; height:26px; border-radius:10px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      transition: transform .12s ease;
      flex:0 0 26px;
    }
    details[open] .chev{transform: rotate(90deg)}
    .sum-title{font-size:13px; margin:0}
    .sum-sub{font-size:11px; color:var(--muted); margin:2px 0 0 0}
    .sum-meta{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }
    .body{
      padding: 0 12px 12px 12px;
      color: var(--muted);
      font-size:12px;
    }
    .body ul{margin:10px 0 0 18px; padding:0}
    .body li{margin:6px 0}
    .body code{font-family:var(--mono); font-size:11px; color:rgba(231,238,252,.92)}
    .actions{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:10px
    }

    /* Decision banner */
    .decision{
      display:flex; gap:12px; flex-wrap:wrap; align-items:center;
      padding:12px 12px;
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.10);
    }
    .decision .status{
      display:flex; align-items:center; gap:10px; flex:1 1 220px;
    }
    .pulse{
      width:12px; height:12px; border-radius:50%;
      background: var(--amber);
      box-shadow: 0 0 0 0 rgba(255,204,102,.55);
      animation: pulse 1.6s infinite;
    }
    @keyframes pulse{
      0%{box-shadow:0 0 0 0 rgba(255,204,102,.45)}
      70%{box-shadow:0 0 0 12px rgba(255,204,102,0)}
      100%{box-shadow:0 0 0 0 rgba(255,204,102,0)}
    }
    .decision .headline{font-size:13px; margin:0}
    .decision .desc{font-size:11px; margin:2px 0 0 0; color:var(--muted)}
    .decision .cta{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; flex:1 1 260px}

    .btn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 14px;
      padding:10px 12px;
      font-size:12px;
      cursor:pointer;
      display:inline-flex; gap:10px; align-items:center;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.20)}
    .btn:active{transform: translateY(0px)}
    .btn.red{background: rgba(255,59,92,.14); border-color: rgba(255,59,92,.32)}
    .btn.green{background: rgba(35,209,139,.13); border-color: rgba(35,209,139,.30)}
    .btn.blue{background: rgba(96,165,250,.14); border-color: rgba(96,165,250,.30)}
    .btn .ic{width:18px; height:18px; display:inline-block}
    .btn:focus{outline: 2px solid rgba(183,210,255,.55); outline-offset:2px}

    /* Toast */
    .toast{
      position:fixed; right:18px; bottom:18px; z-index:80;
      max-width:520px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(11,18,32,.88);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      padding:12px 12px;
      display:none;
    }
    .toast.show{display:block; animation: pop .14s ease-out}
    @keyframes pop{from{transform: translateY(6px); opacity:.0} to{transform: translateY(0); opacity:1}}
    .toast .row{display:flex; gap:10px; align-items:flex-start}
    .toast .ticon{
      width:34px; height:34px; border-radius:12px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      flex:0 0 34px;
    }
    .toast h4{margin:0; font-size:13px}
    .toast p{margin:2px 0 0 0; font-size:12px; color:var(--muted)}
    .toast .x{
      margin-left:auto;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color:var(--text);
      width:30px; height:30px;
      border-radius:12px;
      cursor:pointer;
      display:grid; place-items:center;
    }

    /* Utility */
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .hr{height:1px; background: rgba(255,255,255,.10); margin:12px 0}
    .two{
      display:grid; grid-template-columns:1fr 1fr; gap:12px; align-items:start;
    }
    @media (max-width: 700px){
      .two{grid-template-columns:1fr}
    }
    .mono{font-family:var(--mono)}
    .kbdhint{color:rgba(231,238,252,.86)}
  </style>
</head>
<body>

  <!-- Sticky Topbar -->
  <div class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M12 2l2.2 6.5H21l-5.6 4 2.1 6.5L12 15.8 6.5 19l2.1-6.5L3 8.5h6.8L12 2z" stroke="rgba(0,0,0,.35)" stroke-width="1.5" fill="rgba(255,255,255,.85)"/>
          </svg>
        </div>
        <div class="titleblock">
          <h1>Chest Pain ‚Äî Rapid Decision Guide (Adult)</h1>
          <div class="sub">Fast triage ‚Ä¢ immediate actions ‚Ä¢ referral timing ‚Ä¢ scannable differentials</div>
        </div>
      </div>

      <div class="search" role="search" aria-label="Search">
        <span aria-hidden="true">üîé</span>
        <input id="search" type="search" placeholder="Search e.g. 'aspirin', 'SpO‚ÇÇ', 'pneumothorax', 'troponin'‚Ä¶" />
        <span class="kbd" title="Keyboard shortcut">/</span>
      </div>

      <div class="chiprow" aria-label="Quick filters">
        <div class="chip" id="fRed" aria-pressed="false" title="Highlight red-flag content">
          <span class="dot red"></span> Red flags
        </div>
        <div class="chip" id="fGreen" aria-pressed="false" title="Highlight recommended actions">
          <span class="dot green"></span> Actions
        </div>
        <div class="chip" id="fReferral" aria-pressed="false" title="Jump to referral section">
          <span class="dot blue"></span> Referrals
        </div>
      </div>
    </div>
  </div>

  <main class="wrap">
    <!-- Hero: decision banner + quick actions -->
    <section class="hero" id="top">
      <div class="panel" data-keywords="triage decision admit emergency referral red flags vitals">
        <div class="panelhead">
          <h2>‚ö° Rapid Triage (60‚Äì90 sec)</h2>
          <div class="meta"><span class="kbdhint">Tip:</span> press <span class="kbd">/</span> to search ‚Ä¢ <span class="kbd">Esc</span> clears</div>
        </div>
        <div class="content">
          <div class="decision" id="decisionBanner" aria-live="polite">
            <div class="status">
              <div class="pulse" id="pulseDot" aria-hidden="true"></div>
              <div>
                <p class="headline" id="decisionHeadline">Screen for red flags and suspected ACS</p>
                <p class="desc" id="decisionDesc">Tick criteria below ‚Üí banner updates to ‚ÄúAdmit now‚Äù, ‚ÄúUrgent same-day‚Äù, or ‚ÄúRoutine / investigate‚Äù.</p>
              </div>
            </div>
            <div class="cta">
              <button class="btn red" id="btnCopyEmergency" title="Copy immediate actions to clipboard">
                <span class="ic">üßØ</span> Copy emergency actions
              </button>
              <button class="btn blue" id="btnCopyReferral" title="Copy referral plan to clipboard">
                <span class="ic">üì®</span> Copy referral plan
              </button>
              <button class="btn" id="btnReset" title="Clear all ticks">
                <span class="ic">‚Ü∫</span> Reset
              </button>
            </div>
          </div>

          <div class="hr"></div>

          <div class="two">
            <div>
              <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px;">
                <div class="badge red" title="Any one = emergency admission / transfer" style="cursor:default">
                  üö® <strong>Red flags (physiology)</strong> <span class="pill">any = admit</span>
                </div>
                <span class="muted small">Hover for detail</span>
              </div>

              <div class="checkgrid" id="redFlags">
                <label class="check" data-keywords="respiratory rate rr >30 red flag">
                  <input type="checkbox" data-rule="admit" />
                  <div>
                    <div class="t"><strong>RR &gt; 30</strong></div>
                    <div class="d">Severe respiratory compromise</div>
                  </div>
                  <span class="mini red">ADMIT</span>
                </label>

                <label class="check" data-keywords="tachycardia heart rate hr >130 red flag">
                  <input type="checkbox" data-rule="admit" />
                  <div>
                    <div class="t"><strong>HR &gt; 130</strong></div>
                    <div class="d">High-risk physiology</div>
                  </div>
                  <span class="mini red">ADMIT</span>
                </label>

                <label class="check" data-keywords="hypotension sbp <90 dbp <60 haemodynamic instability shock red flag">
                  <input type="checkbox" data-rule="admit" />
                  <div>
                    <div class="t"><strong>SBP &lt; 90</strong> or <strong>DBP &lt; 60</strong></div>
                    <div class="d">Unless baseline for patient</div>
                  </div>
                  <span class="mini red">ADMIT</span>
                </label>

                <label class="check" data-keywords="oxygen saturation spo2 <92 cyanosis red flag">
                  <input type="checkbox" data-rule="admit" />
                  <div>
                    <div class="t"><strong>SpO‚ÇÇ &lt; 92%</strong> or <strong>central cyanosis</strong></div>
                    <div class="d">If no chronic hypoxia history</div>
                  </div>
                  <span class="mini red">ADMIT</span>
                </label>

                <label class="check" data-keywords="altered conscious level reduced gcs red flag">
                  <input type="checkbox" data-rule="admit" />
                  <div>
                    <div class="t"><strong>Altered consciousness</strong></div>
                    <div class="d">Any new reduction or confusion</div>
                  </div>
                  <span class="mini red">ADMIT</span>
                </label>

                <label class="check" data-keywords="fever temperature >38.5 infection sepsis red flag">
                  <input type="checkbox" data-rule="admit" />
                  <div>
                    <div class="t"><strong>Temp &gt; 38.5¬∞C</strong></div>
                    <div class="d">Especially systemic features</div>
                  </div>
                  <span class="mini red">ADMIT</span>
                </label>
              </div>

              <div class="hr"></div>

              <div style="display:flex; gap:10px; flex-wrap:wrap">
                <div class="badge red" style="cursor:default" data-keywords="acs unstable angina mi">
                  ‚ù§Ô∏è‚Äçüî• <strong>Suspected ACS flags</strong>
                </div>
                <div class="badge green" style="cursor:default" data-keywords="do not delay investigations transfer">
                  ‚úÖ <strong>Do not delay transfer</strong>
                </div>
              </div>

              <div class="checkgrid" style="margin-top:10px" id="acsFlags">
                <label class="check" data-keywords="current chest pain suspected acs">
                  <input type="checkbox" data-rule="admit" />
                  <div>
                    <div class="t"><strong>Suspected ACS + current chest pain</strong></div>
                    <div class="d">Most require admission / referral</div>
                  </div>
                  <span class="mini red">ADMIT</span>
                </label>

                <label class="check" data-keywords="pulmonary oedema complication suspected acs">
                  <input type="checkbox" data-rule="admit" />
                  <div>
                    <div class="t"><strong>Suspected ACS + complications</strong></div>
                    <div class="d">e.g. pulmonary oedema</div>
                  </div>
                  <span class="mini red">ADMIT</span>
                </label>

                <label class="check" data-keywords="pain-free chest pain last 12 hours abnormal ecg ecg unavailable">
                  <input type="checkbox" data-rule="admit" />
                  <div>
                    <div class="t"><strong>Pain-free</strong> but chest pain <strong>&lt; 12h</strong> + <strong>abnormal ECG</strong> or <strong>ECG unavailable</strong></div>
                    <div class="d">Treat as high-risk pathway</div>
                  </div>
                  <span class="mini red">ADMIT</span>
                </label>

                <label class="check" data-keywords="recent acs new chest pain">
                  <input type="checkbox" data-rule="admit" />
                  <div>
                    <div class="t"><strong>Recent ACS</strong> + further chest pain</div>
                    <div class="d">Escalate / re-admit</div>
                  </div>
                  <span class="mini red">ADMIT</span>
                </label>

                <label class="check" data-keywords="pain-free acs last 12 hours normal ecg no complications urgent same-day">
                  <input type="checkbox" data-rule="sameDay" />
                  <div>
                    <div class="t"><strong>Pain-free suspected ACS</strong> + pain <strong>&lt; 12h</strong> + <strong>normal ECG</strong> + no complications</div>
                    <div class="d">Urgent same-day assessment</div>
                  </div>
                  <span class="mini amber">SAME-DAY</span>
                </label>

                <label class="check" data-keywords="pain-free acs 12 to 72 hours no complications urgent same-day">
                  <input type="checkbox" data-rule="sameDay" />
                  <div>
                    <div class="t"><strong>Pain-free suspected ACS</strong> + pain <strong>12‚Äì72h</strong> + no complications</div>
                    <div class="d">Urgent same-day assessment</div>
                  </div>
                  <span class="mini amber">SAME-DAY</span>
                </label>

                <label class="check" data-keywords="pain-free acs more than 72 hours no complications within 2 weeks referral">
                  <input type="checkbox" data-rule="twoWeeks" />
                  <div>
                    <div class="t"><strong>Pain-free suspected ACS</strong> + pain <strong>&gt; 72h</strong> + no complications</div>
                    <div class="d">Refer within 2 weeks (timing by ECG/troponin/clinical)</div>
                  </div>
                  <span class="mini blue">‚â§ 2 WKS</span>
                </label>
              </div>
            </div>

            <div>
              <div class="panel" style="box-shadow:none; background:transparent; border:0">
                <div class="callout" data-keywords="oxygen target spo2 do not routinely administer">
                  <div class="icon" aria-hidden="true">ü´Å</div>
                  <div>
                    <h3>Oxygen strategy (pre-transfer)</h3>
                    <p><strong>Do not</strong> give O‚ÇÇ routinely. Give only if indicated; targets differ by hypercapnia risk.</p>
                  </div>
                  <span class="tag green">Action</span>
                </div>

                <div style="height:10px"></div>

                <div class="callout" data-keywords="aspirin 300 gtn opioid diamorphine ecg send should not delay transfer">
                  <div class="icon" aria-hidden="true">üíä</div>
                  <div>
                    <h3>Suspected ACS bundle (pre-transfer)</h3>
                    <p>Analgesia (GTN ¬± opioid), <strong>aspirin 300 mg</strong> unless allergy; 12-lead ECG <em>send with patient</em> (do not delay transfer).</p>
                  </div>
                  <span class="tag red">Immediate</span>
                </div>

                <div style="height:10px"></div>

                <div class="callout" data-keywords="tension pneumothorax life threatening cannula 2nd intercostal midclavicular">
                  <div class="icon" aria-hidden="true">üéØ</div>
                  <div>
                    <h3>Tension pneumothorax (life-threatening)</h3>
                    <p>Consider large-bore cannula <strong>2nd ICS mid-clavicular</strong> (affected side) while awaiting transfer.</p>
                  </div>
                  <span class="tag red">Time-critical</span>
                </div>

                <div class="hr"></div>

                <details data-keywords="monitor pulse blood pressure rhythm oxygen saturation ecg pain relief">
                  <summary>
                    <div class="sum-left">
                      <div class="chev" aria-hidden="true">‚Ä∫</div>
                      <div>
                        <p class="sum-title"><strong>Monitoring while awaiting admission</strong></p>
                        <p class="sum-sub">Minimum set ‚Äî repeat based on clinical judgement</p>
                      </div>
                    </div>
                    <div class="sum-meta">
                      <span class="mini green">ACTION</span>
                      <span class="mini blue">CHECKLIST</span>
                    </div>
                  </summary>
                  <div class="body">
                    <ul>
                      <li>Reassess pain/symptoms (exacerbations) and response to analgesia.</li>
                      <li>Pulse, blood pressure, and rhythm.</li>
                      <li>SpO‚ÇÇ (pulse oximetry).</li>
                      <li>12-lead ECG (repeat if needed).</li>
                    </ul>
                    <div class="actions">
                      <button class="btn green" data-copy="Monitor: symptoms/pain; pulse/BP/rhythm; SpO2; repeat ECG as needed; review analgesia efficacy.">Copy monitoring list</button>
                    </div>
                  </div>
                </details>

                <details data-keywords="suspect acs criteria pain >15 minutes crushing central nausea vomiting sweating breathlessness haemodynamic instability new onset abrupt deterioration angina">
                  <summary>
                    <div class="sum-left">
                      <div class="chev" aria-hidden="true">‚Ä∫</div>
                      <div>
                        <p class="sum-title"><strong>When to suspect ACS (pattern recognition)</strong></p>
                        <p class="sum-sub">Clinical features trump ‚ÄúGTN response‚Äù</p>
                      </div>
                    </div>
                    <div class="sum-meta">
                      <span class="mini red">HIGH-RISK</span>
                      <span class="mini amber">CLINICAL</span>
                    </div>
                  </summary>
                  <div class="body">
                    <ul>
                      <li>Chest/arm/back/jaw pain lasting <strong>&gt; 15 min</strong>.</li>
                      <li><strong>Dull, central, crushing</strong> pain ¬± radiation.</li>
                      <li>Associated <strong>nausea/vomiting</strong>, <strong>sweating</strong>, and/or <strong>breathlessness</strong>.</li>
                      <li>Associated haemodynamic instability (e.g. <code>SBP &lt; 90</code>).</li>
                      <li>New-onset angina or abrupt deterioration (frequent pain with minimal/no exertion; often &gt; 15 min).</li>
                      <li><strong>Do not</strong> use response to GTN to confirm/exclude ACS.</li>
                    </ul>
                  </div>
                </details>
              </div>
            </div>
          </div>

        </div>
      </div>

      <aside class="panel" data-keywords="referral timing same-day within 2 weeks stable angina unclear cause malignancy">
        <div class="panelhead">
          <h2>üì® Referral Timing (one glance)</h2>
          <div class="meta">Auto-summarised from ticks</div>
        </div>
        <div class="content">
          <div class="callout" id="refCard" style="background: rgba(255,255,255,.03)">
            <div class="icon" aria-hidden="true">üß≠</div>
            <div>
              <h3 id="refHeadline">No referral rule selected yet</h3>
              <p id="refDesc">Tick ‚Äúsame-day‚Äù or ‚Äú‚â§2 weeks‚Äù criteria in the triage panel to populate this card.</p>
            </div>
            <span class="tag blue">Referral</span>
          </div>

          <div class="hr"></div>

          <div class="two">
            <div class="callout" data-keywords="suspected malignancy lung cancer refer">
              <div class="icon" aria-hidden="true">üéóÔ∏è</div>
              <div>
                <h3>Suspected malignancy</h3>
                <p>Refer if features suggest lung cancer / underlying malignancy.</p>
              </div>
              <span class="tag amber">Urgent</span>
            </div>
            <div class="callout" data-keywords="pleural effusion lobar collapse refer investigate">
              <div class="icon" aria-hidden="true">ü©ª</div>
              <div>
                <h3>Lobar collapse / pleural effusion</h3>
                <p>If no admission required: refer for investigation + treatment of cause.</p>
              </div>
              <span class="tag blue">Referral</span>
            </div>
          </div>

          <div style="height:10px"></div>

          <details data-keywords="stable angina cannot be excluded aspirin 75 daily until diagnosis confirmed">
            <summary>
              <div class="sum-left">
                <div class="chev" aria-hidden="true">‚Ä∫</div>
                <div>
                  <p class="sum-title"><strong>Suspected stable angina (diagnosis uncertain)</strong></p>
                  <p class="sum-sub">Routine referral; interim aspirin may be considered</p>
                </div>
              </div>
              <div class="sum-meta">
                <span class="mini blue">ROUTINE</span>
                <span class="mini green">ACTION</span>
              </div>
            </summary>
            <div class="body">
              <ul>
                <li>Refer routinely if stable angina suspected and cannot be excluded in primary care.</li>
                <li>Consider aspirin (e.g. <code>75 mg daily</code>) until diagnosis confirmed.</li>
              </ul>
              <div class="actions">
                <button class="btn blue" data-copy="Routine referral: suspected stable angina not excluded in primary care; consider aspirin 75 mg daily until diagnosis confirmed.">Copy plan</button>
              </div>
            </div>
          </details>

          <details data-keywords="unclear cause persistent symptoms despite management refer">
            <summary>
              <div class="sum-left">
                <div class="chev" aria-hidden="true">‚Ä∫</div>
                <div>
                  <p class="sum-title"><strong>Unclear cause / persistent symptoms</strong></p>
                  <p class="sum-sub">Refer if unresolved or refractory</p>
                </div>
              </div>
              <div class="sum-meta">
                <span class="mini blue">ROUTINE</span>
              </div>
            </summary>
            <div class="body">
              <ul>
                <li>Refer if cause unclear.</li>
                <li>Refer if diagnosis clear but symptoms persist despite primary care management.</li>
              </ul>
            </div>
          </details>

        </div>
      </aside>
    </section>

    <!-- Main grid: Immediate actions + Differentials/Investigations -->
    <section class="grid" style="margin-top:16px">
      <section class="panel" id="immediateActions" data-keywords="management while awaiting admission sit up oxygen gtn opioid aspirin ecg furosemide metoclopramide pulmonary oedema pneumothorax">
        <div class="panelhead">
          <h2>üßØ Immediate Actions (pre-transfer)</h2>
          <div class="meta">Green = recommended ‚Ä¢ Red = time-critical</div>
        </div>
        <div class="content">

          <div class="two">
            <div class="callout" data-keywords="sit the person up">
              <div class="icon" aria-hidden="true">ü™ë</div>
              <div>
                <h3>Sit the person up</h3>
                <p>Default positioning while awaiting admission/transfer.</p>
              </div>
              <span class="tag green">Do now</span>
            </div>

            <div class="callout" data-keywords="do not routinely administer oxygen spo2 target 94-98 88-92 copd venturi">
              <div class="icon" aria-hidden="true">ü´ß</div>
              <div>
                <h3>Oxygen (only if indicated)</h3>
                <p><strong>No routine O‚ÇÇ.</strong> If <strong>SpO‚ÇÇ &lt; 94%</strong> and not hypercapnia-risk: simple mask <strong>5‚Äì10 L/min</strong> target <strong>94‚Äì98%</strong>. If COPD/hypercapnia-risk: <strong>28% Venturi</strong> at <strong>4 L/min</strong> target <strong>88‚Äì92%</strong>.</p>
              </div>
              <span class="tag green">Targeted</span>
            </div>
          </div>

          <div class="hr"></div>

          <details open data-keywords="acute coronary syndrome gtn opioid diamorphine aspirin 300 ecg send should not delay transfer">
            <summary>
              <div class="sum-left">
                <div class="chev" aria-hidden="true">‚Ä∫</div>
                <div>
                  <p class="sum-title"><strong>Suspected ACS bundle</strong></p>
                  <p class="sum-sub">Analgesia + antiplatelet + ECG transfer pack</p>
                </div>
              </div>
              <div class="sum-meta">
                <span class="mini red">IMMEDIATE</span>
                <span class="mini green">ACTION</span>
              </div>
            </summary>
            <div class="body">
              <ul>
                <li>Analgesia: <strong>GTN</strong> and/or opioid (e.g. <code>IV diamorphine 2.5‚Äì5.0 mg</code> slow over 5 min).</li>
                <li><strong>Aspirin 300 mg</strong> unless clear allergy; send written record that it was given.</li>
                <li>Obtain resting <strong>12-lead ECG</strong> and send with patient ‚Äî <strong>do not delay transfer</strong>.</li>
              </ul>
              <div class="actions">
                <button class="btn red" data-copy="Suspected ACS (pre-transfer): GTN ¬± opioid (e.g. IV diamorphine 2.5‚Äì5 mg slow/5 min); aspirin 300 mg unless allergy + document; 12-lead ECG send with patient (do not delay transfer).">Copy ACS bundle</button>
              </div>
            </div>
          </details>

          <details data-keywords="acute pulmonary oedema furosemide diamorphine metoclopramide nitrate gtn spray">
            <summary>
              <div class="sum-left">
                <div class="chev" aria-hidden="true">‚Ä∫</div>
                <div>
                  <p class="sum-title"><strong>Acute pulmonary oedema bundle</strong></p>
                  <p class="sum-sub">Diuretic + opioid + antiemetic + nitrate</p>
                </div>
              </div>
              <div class="sum-meta">
                <span class="mini red">IMMEDIATE</span>
                <span class="mini green">ACTION</span>
              </div>
            </summary>
            <div class="body">
              <ul>
                <li><code>IV furosemide 40‚Äì80 mg</code> slowly.</li>
                <li><code>IV diamorphine 2.5‚Äì5.0 mg</code> slowly over 5 min.</li>
                <li><code>IV metoclopramide 10 mg</code> (can be mixed with diamorphine).</li>
                <li>Nitrate: sublingual/buccal (e.g. <strong>GTN spray</strong>, 2 puffs).</li>
              </ul>
              <div class="actions">
                <button class="btn red" data-copy="Acute pulmonary oedema (pre-transfer): IV furosemide 40‚Äì80 mg slow; IV diamorphine 2.5‚Äì5 mg slow/5 min; IV metoclopramide 10 mg; nitrate e.g. GTN spray 2 puffs.">Copy oedema bundle</button>
              </div>
            </div>
          </details>

          <details data-keywords="tension pneumothorax life threatening cannula second intercostal mid clavicular">
            <summary>
              <div class="sum-left">
                <div class="chev" aria-hidden="true">‚Ä∫</div>
                <div>
                  <p class="sum-title"><strong>Tension pneumothorax (life-threatening)</strong></p>
                  <p class="sum-sub">Immediate decompression step (bridge to definitive care)</p>
                </div>
              </div>
              <div class="sum-meta">
                <span class="mini red">TIME-CRITICAL</span>
              </div>
            </summary>
            <div class="body">
              <ul>
                <li>Consider large-bore cannula through <strong>2nd intercostal space, mid-clavicular line</strong>, affected side.</li>
              </ul>
              <div class="actions">
                <button class="btn red" data-copy="Life-threatening tension pneumothorax: consider large-bore cannula via 2nd intercostal space, mid-clavicular line, affected side.">Copy step</button>
              </div>
            </div>
          </details>

        </div>
      </section>

      <section class="panel" id="workup" data-keywords="history examination investigations ecg chest xray bloods troponin differentials pulmonary embolism pneumonia pneumothorax pericarditis dissection">
        <div class="panelhead">
          <h2>üß† Fast Patterning: Differentiate + Investigate</h2>
          <div class="meta">Use to avoid misses; keep it scannable</div>
        </div>
        <div class="content">

          <details open data-keywords="history radiation jaw arm back exertional pleuritic inspiration palpitations dizziness swallowing last 12 hours">
            <summary>
              <div class="sum-left">
                <div class="chev" aria-hidden="true">‚Ä∫</div>
                <div>
                  <p class="sum-title"><strong>History: the ‚Äúhigh-yield asks‚Äù</strong></p>
                  <p class="sum-sub">Pain now? last episode within 12 hours? radiation? triggers?</p>
                </div>
              </div>
              <div class="sum-meta">
                <span class="mini blue">ASSESS</span>
              </div>
            </summary>
            <div class="body">
              <ul>
                <li>Is chest pain present now? If pain-free: when last episode ‚Äî especially <strong>&lt; 12 h</strong>.</li>
                <li>Character + radiation: acute central/band-like pain radiating to <strong>jaw/arms/back</strong> suggests cardiac pattern.</li>
                <li>Triggers: <strong>exertional</strong> pain suggests angina; <strong>pleuritic</strong> suggests MSK/pulmonary.</li>
                <li>Associated symptoms: breathlessness (cardiac/pulmonary); palpitations/dizziness/dysphagia ‚Üí less typical angina pattern.</li>
              </ul>
            </div>
          </details>

          <details data-keywords="examination blood pressure both arms aortic dissection heart sounds murmur rub jvp oedema chest wall tenderness lung fields respiratory rate oximetry">
            <summary>
              <div class="sum-left">
                <div class="chev" aria-hidden="true">‚Ä∫</div>
                <div>
                  <p class="sum-title"><strong>Examination: what changes decisions</strong></p>
                  <p class="sum-sub">BP both arms ‚Ä¢ chest wall tenderness ‚Ä¢ lung signs ‚Ä¢ SpO‚ÇÇ</p>
                </div>
              </div>
              <div class="sum-meta">
                <span class="mini blue">EXAM</span>
              </div>
            </summary>
            <div class="body">
              <ul>
                <li>CVS: heart sounds (murmur/rub), pulse rate/rhythm, JVP, oedema.</li>
                <li><strong>BP both arms</strong> (dissection clue).</li>
                <li>Chest wall tenderness/reproducibility (MSK pattern).</li>
                <li>Lung fields, RR and SpO‚ÇÇ (hypoxia = escalation).</li>
              </ul>
            </div>
          </details>

          <details data-keywords="investigations do not delay admission ecg blood glucose lipids u&e fbc tft lft amylase crp esr chest xray">
            <summary>
              <div class="sum-left">
                <div class="chev" aria-hidden="true">‚Ä∫</div>
                <div>
                  <p class="sum-title"><strong>Investigations (if NOT delaying admission)</strong></p>
                  <p class="sum-sub">Pick based on suspected cause; avoid reflex tests</p>
                </div>
              </div>
              <div class="sum-meta">
                <span class="mini green">TARGETED</span>
                <span class="mini red">NO DELAY</span>
              </div>
            </summary>
            <div class="body">
              <ul>
                <li>If admission/referral required: <strong>do not delay</strong> management to arrange tests in primary care.</li>
                <li>If no immediate admission: consider ECG, FBC (anaemia), U&amp;E, lipids/glucose, TFTs; CRP/ESR; LFT/amylase as indicated.</li>
                <li>Chest X-ray for suspected HF/pulmonary pathology (not routine for angina).</li>
              </ul>
            </div>
          </details>

          <details data-keywords="pulmonary embolism pleuritic chest pain breathlessness cough haemoptysis syncope tachypnoea >20 dvt">
            <summary>
              <div class="sum-left">
                <div class="chev" aria-hidden="true">‚Ä∫</div>
                <div>
                  <p class="sum-title"><strong>Pulmonary ‚Äúdon‚Äôt-miss‚Äù patterns</strong></p>
                  <p class="sum-sub">PE ‚Ä¢ pneumothorax ‚Ä¢ pneumonia ‚Ä¢ effusion/collapse</p>
                </div>
              </div>
              <div class="sum-meta">
                <span class="mini red">RED FLAGS</span>
              </div>
            </summary>
            <div class="body">
              <ul>
                <li><strong>PE</strong>: acute breathlessness + pleuritic pain ¬± cough/haemoptysis/syncope; signs include tachypnoea &gt;20, tachycardia, DVT signs.</li>
                <li><strong>Pneumothorax</strong>: sudden pleuritic pain + breathlessness; tension features include tracheal deviation, hypotension.</li>
                <li><strong>Pneumonia</strong>: cough + focal chest signs + systemic features; may have pleural effusion.</li>
                <li><strong>Effusion/collapse</strong>: localized pain + progressive breathlessness; reduced movement, dull/stony dull percussion, diminished breath sounds.</li>
              </ul>
            </div>
          </details>

        </div>
      </section>
    </section>

    <section class="panel" style="margin-top:14px" data-keywords="non admission management musculoskeletal analgesia dyspepsia reassurance anxiety depression shingles bornholm">
      <div class="panelhead">
        <h2>‚úÖ Not requiring admission: management snapshots</h2>
        <div class="meta">Keep it practical, low text-density</div>
      </div>
      <div class="content">
        <div class="two">
          <div class="callout" data-keywords="musculoskeletal chest pain analgesia paracetamol nsaid">
            <div class="icon" aria-hidden="true">ü¶¥</div>
            <div>
              <h3>Musculoskeletal chest pain</h3>
              <p>Analgesia (e.g. paracetamol or NSAID) + treat underlying MSK driver.</p>
            </div>
            <span class="tag green">Action</span>
          </div>
          <div class="callout" data-keywords="non-specific psychogenic reassurance anxiety written information">
            <div class="icon" aria-hidden="true">üßò</div>
            <div>
              <h3>Non-specific / psychogenic</h3>
              <p>Reassure no physical cause identified; explain anxiety linkage; provide written information; manage anxiety/depression if present.</p>
            </div>
            <span class="tag green">Action</span>
          </div>
        </div>

        <div style="height:10px"></div>

        <details data-keywords="stable angina blood tests anaemia fbc chest xray not routine">
          <summary>
            <div class="sum-left">
              <div class="chev" aria-hidden="true">‚Ä∫</div>
              <div>
                <p class="sum-title"><strong>Stable angina: quick primary care actions</strong></p>
                <p class="sum-sub">Identify exacerbators; avoid low-yield imaging</p>
              </div>
            </div>
            <div class="sum-meta">
              <span class="mini green">ACTION</span>
            </div>
          </summary>
          <div class="body">
            <ul>
              <li>Arrange blood tests for exacerbators (e.g. <strong>FBC for anaemia</strong>).</li>
              <li>Do not routinely request chest X-ray unless other diagnosis suspected.</li>
            </ul>
          </div>
        </details>

        <details data-keywords="dyspepsia reflux gerd">
          <summary>
            <div class="sum-left">
              <div class="chev" aria-hidden="true">‚Ä∫</div>
              <div>
                <p class="sum-title"><strong>Dyspepsia / reflux phenotype</strong></p>
                <p class="sum-sub">No wall of text: treat the likely cause</p>
              </div>
            </div>
            <div class="sum-meta">
              <span class="mini green">MANAGE</span>
            </div>
          </summary>
          <div class="body">
            <ul>
              <li>Manage per dyspepsia pathways when features fit (e.g. meal-related, nocturnal, positional, regurgitation).</li>
            </ul>
          </div>
        </details>

      </div>
    </section>

    <p class="muted small" style="margin-top:14px">
      Source basis (content / thresholds / actions / referral timing): NICE CKS chest pain topic (adult, revised Aug 2022). :contentReference[oaicite:1]{index=1}
    </p>
  </main>

  <!-- Toast -->
  <div class="toast" id="toast" role="status" aria-live="polite">
    <div class="row">
      <div class="ticon" id="toastIcon" aria-hidden="true">‚úÖ</div>
      <div>
        <h4 id="toastTitle">Copied</h4>
        <p id="toastBody">Text copied to clipboard.</p>
      </div>
      <button class="x" id="toastClose" aria-label="Close">‚úï</button>
    </div>
  </div>

  <script>
    // ---------- Utilities ----------
    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => Array.from(el.querySelectorAll(q));

    function setPressed(el, pressed){
      el.setAttribute("aria-pressed", pressed ? "true" : "false");
    }

    function toast(kind, title, body){
      const t = $("#toast");
      const icon = $("#toastIcon");
      const ttl = $("#toastTitle");
      const txt = $("#toastBody");

      const map = {
        ok:  {ic:"‚úÖ"},
        warn:{ic:"‚ö†Ô∏è"},
        red: {ic:"üö®"},
        info:{ic:"‚ÑπÔ∏è"}
      };
      icon.textContent = (map[kind]||map.ok).ic;
      ttl.textContent = title || "Done";
      txt.textContent = body || "";
      t.classList.add("show");
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>t.classList.remove("show"), 2200);
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        toast("ok","Copied","Placed in clipboard.");
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        toast("ok","Copied","Placed in clipboard.");
      }
    }

    function clearSearch(){
      const s = $("#search");
      s.value = "";
      applySearch("");
      toast("info","Cleared","Search cleared.");
    }

    // ---------- Decision logic ----------
    function computeDecision(){
      const admit = $$('input[type="checkbox"][data-rule="admit"]').some(cb => cb.checked);
      const sameDay = $$('input[type="checkbox"][data-rule="sameDay"]').some(cb => cb.checked);
      const twoWeeks = $$('input[type="checkbox"][data-rule="twoWeeks"]').some(cb => cb.checked);

      let state = { level:"screen", headline:"Screen for red flags and suspected ACS", desc:"Tick criteria below ‚Üí banner updates to ‚ÄúAdmit now‚Äù, ‚ÄúUrgent same-day‚Äù, or ‚ÄúRoutine / investigate‚Äù." };

      if(admit){
        state = {
          level:"admit",
          headline:"ADMIT NOW / EMERGENCY TRANSFER",
          desc:"Serious physiology or high-risk ACS criteria selected ‚Üí initiate immediate actions and transfer without delaying for primary-care investigations."
        };
      } else if(sameDay){
        state = {
          level:"sameDay",
          headline:"URGENT SAME-DAY ASSESSMENT",
          desc:"Pain-free suspected ACS with defined timing criteria ‚Üí arrange same-day assessment (no complications)."
        };
      } else if(twoWeeks){
        state = {
          level:"twoWeeks",
          headline:"REFER WITHIN 2 WEEKS (ACS pathway)",
          desc:"Pain-free suspected ACS >72h without complications ‚Üí urgency guided by ECG/troponin/clinical probability."
        };
      } else {
        state = {
          level:"routine",
          headline:"NO IMMEDIATE ADMISSION RULE SELECTED",
          desc:"If stable, proceed with targeted assessment/exam and investigations guided by suspected cause; safety-net and arrange appropriate referral if unclear/persistent."
        };
      }
      renderDecision(state);
      renderReferralCard({admit, sameDay, twoWeeks});
    }

    function renderDecision(state){
      const pulse = $("#pulseDot");
      const h = $("#decisionHeadline");
      const d = $("#decisionDesc");

      h.textContent = state.headline;
      d.textContent = state.desc;

      // colour / pulse
      if(state.level === "admit"){
        pulse.style.background = "var(--red)";
        pulse.style.animation = "pulse 1.1s infinite";
      } else if(state.level === "sameDay"){
        pulse.style.background = "var(--amber)";
        pulse.style.animation = "pulse 1.6s infinite";
      } else if(state.level === "twoWeeks"){
        pulse.style.background = "var(--blue)";
        pulse.style.animation = "pulse 1.9s infinite";
      } else {
        pulse.style.background = "var(--amber)";
        pulse.style.animation = "pulse 1.6s infinite";
      }
    }

    function renderReferralCard({admit, sameDay, twoWeeks}){
      const h = $("#refHeadline");
      const d = $("#refDesc");

      if(admit){
        h.textContent = "Admission / emergency transfer pathway triggered";
        d.textContent = "Prioritise immediate actions and transfer. Do not delay to arrange primary-care investigations.";
      } else if(sameDay){
        h.textContent = "Urgent same-day assessment (pain-free suspected ACS)";
        d.textContent = "Criteria selected: pain <12h with normal ECG and no complications, and/or pain 12‚Äì72h without complications.";
      } else if(twoWeeks){
        h.textContent = "Refer within 2 weeks (pain-free suspected ACS >72h)";
        d.textContent = "Use ECG + high-sensitivity troponin and clinical judgement to set urgency; consider cardiology discussion if needed.";
      } else {
        h.textContent = "No referral timing rule selected yet";
        d.textContent = "Tick ‚Äúsame-day‚Äù or ‚Äú‚â§2 weeks‚Äù criteria in triage; or use the referral accordions for malignancy/effusion/stable angina/unclear cause.";
      }
    }

    // ---------- Search & filtering ----------
    function applySearch(q){
      q = (q||"").trim().toLowerCase();

      const blocks = $$("[data-keywords], details, .check, .callout, .panel");
      blocks.forEach(el=>{
        const kw = (el.getAttribute("data-keywords")||"").toLowerCase();
        const text = (el.innerText||"").toLowerCase();
        const hit = !q || kw.includes(q) || text.includes(q);
        el.style.display = hit ? "" : "none";
      });

      // If searching, auto-open details that remain visible
      if(q){
        $$("details").forEach(d=>{
          if(d.style.display !== "none") d.open = true;
        });
      }
    }

    // Highlight modes (red flags / actions)
    function setHighlightMode(modeOn, kind){
      const root = document.documentElement;
      // Reset
      root.style.removeProperty("--hlRed");
      root.style.removeProperty("--hlGreen");

      if(kind === "red" && modeOn){
        root.style.setProperty("--hlRed", "1");
      }
      if(kind === "green" && modeOn){
        root.style.setProperty("--hlGreen", "1");
      }
      // Apply effect by toggling classes inline (no extra CSS file)
      $$("[data-keywords], .check, .callout, details").forEach(el=>{
        const kw = (el.getAttribute("data-keywords")||"").toLowerCase();
        el.style.outline = "";
        el.style.boxShadow = "";
        if(kind === "red" && modeOn){
          if(kw.includes("red") || kw.includes("admit") || kw.includes("acs") || kw.includes("time-critical") || kw.includes("tension")){
            el.style.outline = "2px solid rgba(255,59,92,.35)";
            el.style.boxShadow = "0 0 0 6px rgba(255,59,92,.08)";
          }
        }
        if(kind === "green" && modeOn){
          if(kw.includes("action") || kw.includes("manage") || kw.includes("monitor") || kw.includes("oxygen") || kw.includes("aspirin") || kw.includes("gtn")){
            el.style.outline = "2px solid rgba(35,209,139,.30)";
            el.style.boxShadow = "0 0 0 6px rgba(35,209,139,.07)";
          }
        }
      });
    }

    // ---------- Clipboard templates ----------
    function buildEmergencyActions(){
      return [
        "CHEST PAIN ‚Äî EMERGENCY ACTIONS (pre-transfer):",
        "‚Ä¢ Sit patient up.",
        "‚Ä¢ Oxygen: do NOT give routinely. If SpO2 <94% and NOT hypercapnia-risk: simple face mask 5‚Äì10 L/min, target 94‚Äì98%. If COPD/hypercapnia-risk: 28% Venturi at 4 L/min, target 88‚Äì92%.",
        "‚Ä¢ Suspected ACS: GTN ¬± opioid (e.g. IV diamorphine 2.5‚Äì5 mg slow/5 min); aspirin 300 mg unless allergy + document; obtain 12-lead ECG and send with patient (do not delay transfer).",
        "‚Ä¢ Acute pulmonary oedema: IV furosemide 40‚Äì80 mg slow; IV diamorphine 2.5‚Äì5 mg slow/5 min; IV metoclopramide 10 mg; nitrate (e.g. GTN spray 2 puffs).",
        "‚Ä¢ Life-threatening tension pneumothorax: consider large-bore cannula via 2nd intercostal space, mid-clavicular line, affected side.",
        "‚Ä¢ Monitor: symptoms/pain; pulse/BP/rhythm; SpO2; repeat ECG as needed; review analgesia efficacy.",
      ].join("\n");
    }

    function buildReferralPlan(){
      const admit = $$('input[type="checkbox"][data-rule="admit"]').some(cb => cb.checked);
      const sameDay = $$('input[type="checkbox"][data-rule="sameDay"]').some(cb => cb.checked);
      const twoWeeks = $$('input[type="checkbox"][data-rule="twoWeeks"]').some(cb => cb.checked);

      if(admit){
        return [
          "CHEST PAIN ‚Äî DISPOSITION:",
          "‚Ä¢ Emergency admission/transfer triggered by red flag physiology and/or high-risk ACS criteria.",
          "‚Ä¢ Do not delay transfer for primary-care investigations; initiate pre-transfer actions and monitoring."
        ].join("\n");
      }
      if(sameDay){
        return [
          "CHEST PAIN ‚Äî REFERRAL (URGENT SAME-DAY):",
          "‚Ä¢ Pain-free suspected ACS:",
          "  - Pain in last 12h + normal ECG + no complications, and/or",
          "  - Pain 12‚Äì72h + no complications.",
          "‚Ä¢ Arrange urgent same-day assessment."
        ].join("\n");
      }
      if(twoWeeks){
        return [
          "CHEST PAIN ‚Äî REFERRAL (‚â§2 WEEKS):",
          "‚Ä¢ Pain-free suspected ACS with pain >72h and no complications.",
          "‚Ä¢ Urgency guided by clinical judgement, ECG interpretation, high-sensitivity troponin; consider cardiology discussion."
        ].join("\n");
      }
      return [
        "CHEST PAIN ‚Äî DISPOSITION:",
        "‚Ä¢ No immediate admission/referral timing rule selected.",
        "‚Ä¢ If stable: proceed with targeted assessment/exam and investigations guided by suspected cause; refer if malignancy/effusion/collapse suspected, stable angina not excluded, unclear cause, or persistent symptoms."
      ].join("\n");
    }

    // ---------- Init ----------
    function init(){
      // Checkbox listeners
      $$('input[type="checkbox"]').forEach(cb=>{
        cb.addEventListener("change", computeDecision);
      });

      // Copy buttons
      $("#btnCopyEmergency").addEventListener("click", ()=>copyText(buildEmergencyActions()));
      $("#btnCopyReferral").addEventListener("click", ()=>copyText(buildReferralPlan()));
      $$(".btn[data-copy]").forEach(b=>{
        b.addEventListener("click", ()=>copyText(b.getAttribute("data-copy")));
      });

      // Reset
      $("#btnReset").addEventListener("click", ()=>{
        $$('input[type="checkbox"]').forEach(cb=>cb.checked=false);
        computeDecision();
        toast("info","Reset","All selections cleared.");
      });

      // Search
      const s = $("#search");
      s.addEventListener("input", (e)=>applySearch(e.target.value));
      window.addEventListener("keydown", (e)=>{
        if(e.key === "/" && document.activeElement !== s){
          e.preventDefault();
          s.focus();
        }
        if(e.key === "Escape"){
          if(document.activeElement === s) document.activeElement.blur();
          clearSearch();
        }
      });

      // Filter chips
      const fRed = $("#fRed");
      const fGreen = $("#fGreen");
      const fReferral = $("#fReferral");

      fRed.addEventListener("click", ()=>{
        const now = fRed.getAttribute("aria-pressed") !== "true";
        setPressed(fRed, now);
        // turning on red turns off green highlight to keep clean
        setPressed(fGreen, false);
        setHighlightMode(false, "green");
        setHighlightMode(now, "red");
      });

      fGreen.addEventListener("click", ()=>{
        const now = fGreen.getAttribute("aria-pressed") !== "true";
        setPressed(fGreen, now);
        setPressed(fRed, false);
        setHighlightMode(false, "red");
        setHighlightMode(now, "green");
      });

      fReferral.addEventListener("click", ()=>{
        const now = fReferral.getAttribute("aria-pressed") !== "true";
        setPressed(fReferral, now);
        if(now){
          document.getElementById("refCard").scrollIntoView({behavior:"smooth", block:"start"});
          toast("info","Referrals","Jumped to referral card.");
          setTimeout(()=>setPressed(fReferral,false), 700);
        }
      });

      // Toast close
      $("#toastClose").addEventListener("click", ()=>$("#toast").classList.remove("show"));

      // Initial render
      computeDecision();
    }

    init();
  </script>
</body>
</html>
