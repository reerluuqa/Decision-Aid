<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Common Cold ‚Äî Rapid Clinical Guidance (UK)</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1833;
      --panel2:#0c142c;
      --card:#101c3c;
      --text:#eaf0ff;
      --muted:#b7c3e6;
      --muted2:#93a3d6;
      --line:rgba(255,255,255,.08);
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --shadow2: 0 10px 26px rgba(0,0,0,.25);

      --good:#22c55e;
      --good2:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
      --bad2:#dc2626;
      --info:#60a5fa;
      --pill: rgba(255,255,255,.08);

      --radius:18px;
      --radius2:14px;
      --pad:18px;
      --pad2:14px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(96,165,250,.28), transparent 60%),
        radial-gradient(900px 500px at 85% 0%, rgba(34,197,94,.18), transparent 55%),
        radial-gradient(700px 500px at 60% 110%, rgba(239,68,68,.18), transparent 55%),
        linear-gradient(180deg, var(--bg), #070a14 70%);
      letter-spacing:.2px;
    }

    a{color:inherit}
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:22px 18px 48px;
    }

    /* Header */
    .topbar{
      display:flex;
      gap:14px;
      align-items:stretch;
      flex-wrap:wrap;
    }
    .brand{
      flex:1 1 520px;
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px 18px;
      box-shadow:var(--shadow2);
      position:relative;
      overflow:hidden;
    }
    .brand:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:radial-gradient(420px 180px at 10% 10%, rgba(96,165,250,.16), transparent 65%),
                 radial-gradient(420px 180px at 90% 0%, rgba(34,197,94,.12), transparent 65%);
      pointer-events:none;
    }
    .brand h1{
      margin:0 0 6px;
      font-size:20px;
      position:relative;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .brand p{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
      position:relative;
      max-width:70ch;
    }
    .chiprow{
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      position:relative;
    }
    .chip{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
    }
    .chip strong{color:var(--text); font-weight:650}
    .chip .kbd{
      font-family:var(--mono);
      font-size:11px;
      padding:2px 6px;
      border-radius:999px;
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.12);
      color:var(--muted2);
    }

    .controls{
      flex:0 0 380px;
      min-width:320px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      box-shadow:var(--shadow2);
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .seg{
      display:flex;
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:999px;
      padding:4px;
      gap:4px;
      flex:1;
      min-width:220px;
    }
    .seg button{
      flex:1;
      border:0;
      padding:10px 10px;
      border-radius:999px;
      background:transparent;
      color:var(--muted);
      font-weight:650;
      cursor:pointer;
      transition:.15s ease;
      display:flex;
      gap:8px;
      justify-content:center;
      align-items:center;
    }
    .seg button[aria-pressed="true"]{
      background:rgba(255,255,255,.07);
      color:var(--text);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.10);
    }

    .search{
      position:relative;
      flex:1;
      min-width:240px;
    }
    .search input{
      width:100%;
      padding:12px 12px 12px 38px;
      border-radius:14px;
      background:rgba(0,0,0,.20);
      border:1px solid var(--line);
      color:var(--text);
      outline:none;
      transition:.15s ease;
    }
    .search input:focus{border-color:rgba(96,165,250,.5); box-shadow:0 0 0 4px rgba(96,165,250,.14)}
    .search svg{
      position:absolute;
      left:12px; top:50%;
      transform:translateY(-50%);
      opacity:.8;
    }

    .toggles{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .toggle{
      flex:1;
      min-width:170px;
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .toggle label{
      font-size:12px;
      color:var(--muted);
      display:flex; align-items:center; gap:8px;
      user-select:none;
    }
    .switch{
      position:relative;
      width:44px; height:26px;
      border-radius:999px;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.12);
      cursor:pointer;
    }
    .switch i{
      position:absolute;
      top:3px; left:3px;
      width:20px; height:20px;
      border-radius:999px;
      background:rgba(255,255,255,.85);
      transition:.18s ease;
    }
    .switch[data-on="true"]{ background:rgba(34,197,94,.24); border-color:rgba(34,197,94,.35) }
    .switch[data-on="true"] i{ left:21px; background:rgba(34,197,94,.95) }

    .mini-actions{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:650;
      display:inline-flex;
      gap:8px;
      align-items:center;
      transition:.15s ease;
      box-shadow:0 1px 0 rgba(255,255,255,.06);
    }
    .btn:hover{ transform:translateY(-1px); background:rgba(255,255,255,.07) }
    .btn:active{ transform:translateY(0px) }
    .btn.secondary{ color:var(--muted); font-weight:600 }
    .btn.danger{
      border-color:rgba(239,68,68,.35);
      background:rgba(239,68,68,.14);
    }

    /* Layout */
    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns:1fr; }
      .controls{ flex:1 1 520px; }
    }

    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .panel .hd{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background:rgba(0,0,0,.10);
    }
    .panel .hd h2{
      margin:0;
      font-size:14px;
      letter-spacing:.4px;
      color:var(--muted);
      text-transform:uppercase;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .panel .bd{ padding:14px; }

    /* Callouts */
    .callouts{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media (max-width: 720px){ .callouts{ grid-template-columns:1fr; } }

    .callout{
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:var(--radius2);
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .callout .title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .callout h3{
      margin:0;
      font-size:15px;
      display:flex; gap:10px; align-items:center;
    }
    .badge{
      font-size:11px;
      padding:4px 9px;
      border-radius:999px;
      border:1px solid var(--line);
      background:var(--pill);
      color:var(--muted);
      display:inline-flex; gap:7px; align-items:center;
      white-space:nowrap;
    }
    .badge.good{ border-color:rgba(34,197,94,.35); background:rgba(34,197,94,.14); color:#d8ffe6 }
    .badge.bad{ border-color:rgba(239,68,68,.35); background:rgba(239,68,68,.14); color:#ffe0e0 }
    .badge.warn{ border-color:rgba(245,158,11,.35); background:rgba(245,158,11,.12); color:#ffe9c7 }

    ul.clean{ margin:0; padding-left:18px; color:var(--text); }
    ul.clean li{ margin:8px 0; color:var(--text); }
    ul.clean li span.meta{ color:var(--muted); font-size:12px; display:block; margin-top:3px }

    .inline-note{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    /* Decision card */
    .decision{
      display:grid;
      gap:12px;
    }
    .decision .step{
      border:1px solid var(--line);
      border-radius:var(--radius2);
      background:rgba(0,0,0,.18);
      padding:14px;
      position:relative;
    }
    .step .kicker{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:8px;
    }
    .kicker .num{
      font-family:var(--mono);
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--muted2);
    }
    .kicker .tag{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--muted);
    }
    .tag.good{ border-color:rgba(34,197,94,.35); background:rgba(34,197,94,.12); color:#d8ffe6}
    .tag.bad{ border-color:rgba(239,68,68,.35); background:rgba(239,68,68,.12); color:#ffe0e0}
    .tag.warn{ border-color:rgba(245,158,11,.35); background:rgba(245,158,11,.10); color:#ffe9c7}

    .step h4{ margin:0 0 8px; font-size:15px; }
    .step p{ margin:0; color:var(--muted); font-size:13px; line-height:1.35; }

    /* Accordion */
    details{
      border:1px solid var(--line);
      border-radius:var(--radius2);
      background:rgba(0,0,0,.16);
      overflow:hidden;
    }
    details + details{ margin-top:10px; }
    summary{
      list-style:none;
      cursor:pointer;
      padding:12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      user-select:none;
    }
    summary::-webkit-details-marker{display:none}
    summary .left{
      display:flex; align-items:center; gap:10px;
      min-width:0;
    }
    summary .left strong{
      font-size:14px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    summary .hint{
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    summary .chev{
      transition:.15s ease;
      opacity:.85;
      flex:0 0 auto;
    }
    details[open] summary{ background:rgba(255,255,255,.04); border-bottom:1px solid var(--line); }
    details[open] summary .chev{ transform:rotate(180deg); }
    .acc-body{ padding:12px 14px 14px; }

    /* Two-column lists */
    .two{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media (max-width: 720px){ .two{ grid-template-columns:1fr; } }

    .listcard{
      border:1px solid var(--line);
      border-radius:var(--radius2);
      background:rgba(0,0,0,.14);
      padding:12px;
    }
    .listcard h5{
      margin:0 0 10px;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.4px;
      color:var(--muted);
      display:flex; align-items:center; gap:8px;
    }

    /* Smart highlight (search) */
    mark{
      background:rgba(96,165,250,.28);
      color:var(--text);
      padding:0 .2em;
      border-radius:.35em;
    }

    /* Sticky right column */
    .sticky{
      position:sticky;
      top:14px;
    }
    @media (max-width: 980px){ .sticky{ position:static; } }

    /* Footer */
    .foot{
      margin-top:16px;
      color:var(--muted2);
      font-size:12px;
      line-height:1.4;
      opacity:.95;
    }
    .foot .pill{
      display:inline-flex;
      gap:8px; align-items:center;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      margin-right:8px;
      margin-bottom:8px;
    }

    /* Icons */
    .ic{ width:18px; height:18px; display:inline-block; }
    .ic svg{ width:18px; height:18px; display:block; }
    .ic.good svg{ stroke:var(--good); }
    .ic.bad svg{ stroke:var(--bad); }
    .ic.info svg{ stroke:var(--info); }
    .ic.warn svg{ stroke:var(--warn); }

    /* Tooltip */
    .tip{
      position:relative;
      border-bottom:1px dashed rgba(255,255,255,.25);
      cursor:help;
    }
    .tip:hover::after{
      content:attr(data-tip);
      position:absolute;
      left:0; top:120%;
      min-width:260px;
      max-width:340px;
      background:#0a0f22;
      border:1px solid rgba(255,255,255,.12);
      border-radius:12px;
      padding:10px 10px;
      color:var(--muted);
      box-shadow:var(--shadow2);
      z-index:5;
      white-space:normal;
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <section class="brand" aria-label="Header">
      <h1>
        <span class="ic info" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
            <path d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z"/>
            <path d="M12 16v-5"/><path d="M12 8h.01"/>
          </svg>
        </span>
        Common cold ‚Äî rapid clinical guidance
      </h1>
      <p>
        Designed for <strong>fast decisions</strong>: rule out serious alternative diagnoses, treat symptoms, give clear safety-netting, avoid low-value prescribing.
      </p>
      <div class="chiprow">
        <div class="chip"><strong>Focus:</strong> Assessment ‚Üí Red flags ‚Üí Symptom relief</div>
        <div class="chip"><strong>Age:</strong> ‚â• 1 month</div>
        <div class="chip"><span class="kbd">/</span> search &nbsp; <span class="kbd">R</span> red flags &nbsp; <span class="kbd">M</span> management</div>
      </div>
    </section>

    <aside class="controls" aria-label="Controls">
      <div class="row">
        <div class="seg" role="group" aria-label="Patient group">
          <button id="segAdult" aria-pressed="true" title="Adult / older child">
            <span class="ic info" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z"/>
                <path d="M6 22a6 6 0 0 1 12 0"/>
              </svg>
            </span>
            Adult / older child
          </button>
          <button id="segChild" aria-pressed="false" title="Younger child / infant">
            <span class="ic info" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                <path d="M12 13a3 3 0 1 0-3-3 3 3 0 0 0 3 3Z"/>
                <path d="M7 22a5 5 0 0 1 10 0"/>
                <path d="M5 8c.5-3 3.5-5 7-5s6.5 2 7 5"/>
              </svg>
            </span>
            Younger child / infant
          </button>
        </div>
      </div>

      <div class="row">
        <div class="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" opacity=".85">
            <path d="M21 21l-4.3-4.3"/><path d="M10.5 18a7.5 7.5 0 1 1 7.5-7.5A7.5 7.5 0 0 1 10.5 18Z"/>
          </svg>
          <input id="q" type="search" placeholder="Search (e.g., fever, nasal, decongestant, meningitis, follow-up)..." autocomplete="off" />
        </div>
      </div>

      <div class="toggles">
        <div class="toggle">
          <label>
            <span class="ic bad" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                <path d="M12 9v4"/><path d="M12 17h.01"/>
                <path d="M10.3 4.6 2.6 18a2 2 0 0 0 1.7 3h15.4a2 2 0 0 0 1.7-3L13.7 4.6a2 2 0 0 0-3.4 0Z"/>
              </svg>
            </span>
            Prioritise red flags
          </label>
          <div class="switch" id="swRed" role="switch" aria-checked="false" tabindex="0" data-on="false"><i></i></div>
        </div>

        <div class="toggle">
          <label>
            <span class="ic warn" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                <path d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z"/>
                <path d="M7 12h10"/><path d="M12 7v10"/>
              </svg>
            </span>
            Risk of complications
          </label>
          <div class="switch" id="swRisk" role="switch" aria-checked="false" tabindex="0" data-on="false"><i></i></div>
        </div>
      </div>

      <div class="mini-actions">
        <button class="btn secondary" id="btnExpand" title="Expand / collapse all accordions">
          <span class="ic info" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
              <path d="M4 9V4h5"/><path d="M20 15v5h-5"/>
              <path d="M20 4l-7 7"/><path d="M4 20l7-7"/>
            </svg>
          </span>
          Expand
        </button>
        <button class="btn" id="btnCopy" title="Copy quick plan to clipboard">
          <span class="ic good" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
              <path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
            </svg>
          </span>
          Copy plan
        </button>
        <button class="btn danger" id="btnReset" title="Reset filters and search">
          <span class="ic bad" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
              <path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M19 6l-1 14H6L5 6"/>
              <path d="M10 11v6"/><path d="M14 11v6"/>
            </svg>
          </span>
          Reset
        </button>
      </div>
    </aside>
  </div>

  <div class="grid">
    <!-- LEFT: Main content -->
    <main class="panel" id="main">
      <div class="hd">
        <h2>
          <span class="ic info" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
              <path d="M4 6h16"/><path d="M4 12h16"/><path d="M4 18h16"/>
            </svg>
          </span>
          Rapid pathway
        </h2>
        <span class="badge" id="modeBadge">Adult / older child</span>
      </div>

      <div class="bd">
        <section class="callouts" id="callouts">
          <div class="callout" data-tags="red flags referral immediate meningitis airway obstruction difficulty breathing stridor drooling">
            <div class="title">
              <h3>
                <span class="ic bad" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                    <path d="M12 9v4"/><path d="M12 17h.01"/>
                    <path d="M10.3 4.6 2.6 18a2 2 0 0 0 1.7 3h15.4a2 2 0 0 0 1.7-3L13.7 4.6a2 2 0 0 0-3.4 0Z"/>
                  </svg>
                </span>
                Red flags ‚Üí urgent assessment
              </h3>
              <span class="badge bad">Act now</span>
            </div>
            <ul class="clean">
              <li><strong>Upper/lower airway compromise</strong> <span class="meta">e.g., stridor, drooling, inability to swallow, escalating dyspnoea.</span></li>
              <li><strong>Possible meningitis/serious illness features</strong> <span class="meta">e.g., altered mental state, non-blanching rash, meningism; in infants: bulging fontanelle, high-pitched cry, floppiness.</span></li>
              <li><strong>Marked clinical deterioration</strong> <span class="meta">increasing lethargy, reduced responsiveness, or difficulty breathing.</span></li>
            </ul>
            <div class="inline-note">
              If present: arrange admission/referral as clinically appropriate.
            </div>
          </div>

          <div class="callout" data-tags="management recommended actions symptomatic relief paracetamol ibuprofen fluids rest hygiene">
            <div class="title">
              <h3>
                <span class="ic good" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                    <path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                  </svg>
                </span>
                Default plan (most patients)
              </h3>
              <span class="badge good">Recommended</span>
            </div>
            <ul class="clean">
              <li><strong>Reassure + explain natural history</strong> <span class="meta">Rapid onset; peak 2‚Äì3 days; ~7 days adults; ~10‚Äì14 days younger children; cough can persist up to ~3 weeks.</span></li>
              <li><strong>Symptom relief</strong> <span class="meta">Paracetamol or ibuprofen if needed (pain/fever; in <span class="tip" data-tip="Use antipyretic/analgesic in children with fever when distressed; do not give both simultaneously; consider switching/alternating only if distress persists or recurs before next dose is due.">children: treat distress, not the number</span>).</span></li>
              <li><strong>Fluids + rest + normal activity</strong> <span class="meta">No need for specific diet or supplements; normal activity doesn‚Äôt prolong illness.</span></li>
              <li><strong>Avoid low-value meds</strong> <span class="meta">Antibiotics and antihistamines are ineffective for common cold symptoms; potential adverse effects.</span></li>
              <li><strong>Reduce spread</strong> <span class="meta">Hand hygiene; avoid sharing towels; limit shared toys when symptomatic.</span></li>
            </ul>
          </div>
        </section>

        <section class="decision" style="margin-top:14px" id="pathway">
          <div class="step" data-tags="step 1 red flags airway obstruction meningitis referral immediate">
            <div class="kicker">
              <span class="num">STEP 1</span>
              <span class="tag bad">Rule out dangerous alternative diagnoses</span>
            </div>
            <h4>Any red flag features?</h4>
            <p>
              If yes ‚Üí urgent assessment & referral/admission appropriate to suspected pathology (airway obstruction, meningitis/serious illness, etc.).
            </p>
          </div>

          <div class="step" data-tags="step 2 diagnosis clinical history examination no swabs">
            <div class="kicker">
              <span class="num">STEP 2</span>
              <span class="tag warn">Clinical diagnosis</span>
            </div>
            <h4>Typical common cold features?</h4>
            <p>
              Clinical diagnosis from history ¬± exam to exclude complication/alternative diagnosis. Investigations (e.g., nasal/throat swabs) not required for uncomplicated common cold.
            </p>
          </div>

          <div class="step" data-tags="step 3 management self care analgesia antipyretic paracetamol ibuprofen advice">
            <div class="kicker">
              <span class="num">STEP 3</span>
              <span class="tag good">Treat symptoms + safety-net</span>
            </div>
            <h4>Provide symptom relief + safety-netting</h4>
            <p>
              Use antipyretic/analgesic if needed; add selected self-care measures; give clear follow-up triggers and timeframes.
            </p>
          </div>
        </section>

        <div style="margin-top:14px" id="accordions">
          <details open data-tags="diagnosis adults symptoms sore throat rhinorrhoea sneezing cough hoarse voice malaise">
            <summary>
              <div class="left">
                <span class="ic info" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                    <path d="M4 19V5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v14"/>
                    <path d="M6 17h12"/><path d="M8 7h8"/><path d="M8 11h8"/>
                  </svg>
                </span>
                <strong>Diagnosis ‚Äî key clinical features</strong>
              </div>
              <span class="hint">fast pattern recognition</span>
              <span class="chev">‚ñæ</span>
            </summary>
            <div class="acc-body">
              <div class="two">
                <div class="listcard" data-mode="adult">
                  <h5>
                    <span class="ic info" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                        <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z"/>
                        <path d="M6 22a6 6 0 0 1 12 0"/>
                      </svg>
                    </span>
                    Adults / older children
                  </h5>
                  <ul class="clean">
                    <li><strong>Sore/irritated throat</strong> <span class="meta">often first; sudden onset; resolves quickly.</span></li>
                    <li><strong>Nasal irritation/congestion</strong> + <strong>rhinorrhoea</strong> + <strong>sneezing</strong> <span class="meta">discharge may thicken/darken without implying bacterial infection.</span></li>
                    <li><strong>Cough</strong> <span class="meta">often later; ~30% develop cough after nasal symptoms improve.</span></li>
                    <li><strong>Hoarse voice</strong>, <strong>malaise</strong>; low-grade fever uncommon.</li>
                    <li><span class="tip" data-tip="Myalgia/headache with prominent fever is more typical of influenza than common cold."><strong>Consider influenza</strong> if myalgia/fever prominent.</span></li>
                  </ul>
                </div>

                <div class="listcard" data-mode="child">
                  <h5>
                    <span class="ic info" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                        <path d="M12 13a3 3 0 1 0-3-3 3 3 0 0 0 3 3Z"/>
                        <path d="M7 22a5 5 0 0 1 10 0"/>
                        <path d="M5 8c.5-3 3.5-5 7-5s6.5 2 7 5"/>
                      </svg>
                    </span>
                    Younger children / infants
                  </h5>
                  <ul class="clean">
                    <li><strong>Irritability/restlessness</strong></li>
                    <li><strong>Nasal congestion/rhinorrhoea</strong> <span class="meta">can impair feeding/sleep/breathing.</span></li>
                    <li><strong>Cough</strong> <span class="meta">vomiting may follow paroxysms.</span></li>
                    <li><strong>Fever</strong> <span class="meta">38‚Äì39¬∞C can occur in preschool children.</span></li>
                    <li><strong>Examine</strong> for complications/alternatives <span class="meta">ears (AOM), throat (consider strep if no nasal symptoms), fontanelle (meningism).</span></li>
                  </ul>
                </div>
              </div>
            </div>
          </details>

          <details data-tags="red flags referral meningitis airway obstruction stridor drooling rash non blanching bulging fontanelle">
            <summary>
              <div class="left">
                <span class="ic bad" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                    <path d="M12 9v4"/><path d="M12 17h.01"/>
                    <path d="M10.3 4.6 2.6 18a2 2 0 0 0 1.7 3h15.4a2 2 0 0 0 1.7-3L13.7 4.6a2 2 0 0 0-3.4 0Z"/>
                  </svg>
                </span>
                <strong>Red flags ‚Äî immediate actions</strong>
              </div>
              <span class="hint">make it binary</span>
              <span class="chev">‚ñæ</span>
            </summary>
            <div class="acc-body">
              <div class="callouts">
                <div class="callout">
                  <div class="title">
                    <h3>Airway obstruction concern</h3>
                    <span class="badge bad">Urgent</span>
                  </div>
                  <ul class="clean">
                    <li><strong>Stridor</strong>, <strong>drooling</strong>, <strong>inability to swallow</strong></li>
                    <li><strong>Progressive respiratory distress</strong></li>
                  </ul>
                </div>
                <div class="callout">
                  <div class="title">
                    <h3>Possible meningitis / serious illness</h3>
                    <span class="badge bad">Urgent</span>
                  </div>
                  <ul class="clean">
                    <li><strong>Non-blanching rash</strong>, <strong>confusion</strong>, <strong>stiff neck</strong>, <strong>photophobia</strong>, <strong>severe headache</strong></li>
                    <li><strong>Infants:</strong> high fever, drowsy/blank stare, vomiting/poor feeding, high-pitched scream, floppiness, <strong>bulging fontanelle</strong></li>
                  </ul>
                </div>
              </div>
              <div class="inline-note">
                If red flags present: arrange admission/referral as clinically appropriate.
              </div>
            </div>
          </details>

          <details data-tags="management paracetamol ibuprofen fever distress advice antibiotics antihistamines ineffective fluids rest hygiene">
            <summary>
              <div class="left">
                <span class="ic good" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                    <path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                  </svg>
                </span>
                <strong>Management ‚Äî core recommendations</strong>
              </div>
              <span class="hint">high-yield actions</span>
              <span class="chev">‚ñæ</span>
            </summary>
            <div class="acc-body">
              <div class="two">
                <div class="listcard">
                  <h5>
                    <span class="ic good" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                        <path d="M20 7h-7"/><path d="M14 7V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-3"/>
                        <path d="M20 7v10"/><path d="M20 17h-7"/>
                      </svg>
                    </span>
                    Do
                  </h5>
                  <ul class="clean">
                    <li><strong>Reassure + set expectations</strong> <span class="meta">self-limiting; peak 2‚Äì3 days; cough can last up to ~3 weeks.</span></li>
                    <li><strong>Analgesia/antipyresis if needed</strong> <span class="meta">paracetamol or ibuprofen; in children treat distress, not fever alone.</span></li>
                    <li><strong>Hydration + rest</strong> <span class="meta">no special diet or supplements required.</span></li>
                    <li><strong>Hygiene</strong> <span class="meta">handwashing; avoid shared towels; reduce toy sharing when symptomatic.</span></li>
                  </ul>
                </div>

                <div class="listcard">
                  <h5>
                    <span class="ic bad" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                        <path d="M18 6 6 18"/><path d="M6 6l12 12"/>
                      </svg>
                    </span>
                    Avoid (routine)
                  </h5>
                  <ul class="clean">
                    <li><strong>Antibiotics</strong> <span class="meta">ineffective for common cold symptoms.</span></li>
                    <li><strong>Antihistamines</strong> <span class="meta">ineffective for common cold symptoms; adverse effects.</span></li>
                    <li><strong>Multiple combination OTC products</strong> <span class="meta">risk duplicate paracetamol dosing and adverse effects.</span></li>
                  </ul>
                </div>
              </div>
            </div>
          </details>

          <details data-tags="self care steam inhalation vapour rub salt water gargle menthol sweets saline drops congestion">
            <summary>
              <div class="left">
                <span class="ic info" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                    <path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.9 4.9l1.4 1.4"/><path d="M17.7 17.7l1.4 1.4"/>
                    <path d="M2 12h2"/><path d="M20 12h2"/><path d="M4.9 19.1l1.4-1.4"/><path d="M17.7 6.3l1.4-1.4"/>
                    <path d="M12 7a5 5 0 1 0 5 5 5 5 0 0 0-5-5Z"/>
                  </svg>
                </span>
                <strong>Self-care options</strong>
              </div>
              <span class="hint">limited benefit, generally safe</span>
              <span class="chev">‚ñæ</span>
            </summary>
            <div class="acc-body">
              <div class="two">
                <div class="listcard">
                  <h5>May help (selected patients)</h5>
                  <ul class="clean">
                    <li><strong>Steam inhalation</strong> <span class="meta">care to avoid scalding; sitting in bathroom with hot shower is safer.</span></li>
                    <li><strong>Vapour rubs</strong> <span class="meta">infants/small children: apply chest/back; avoid nostril area.</span></li>
                    <li><strong>Salt-water gargles</strong> or <strong>menthol sweets</strong> <span class="meta">sore throat or congestion symptom relief.</span></li>
                    <li><strong>Nasal saline drops</strong> <span class="meta">may relieve congestion; can aid infant feeding.</span></li>
                  </ul>
                </div>

                <div class="listcard">
                  <h5>
                    <span class="ic warn" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                        <path d="M12 9v4"/><path d="M12 17h.01"/>
                        <path d="M10.3 4.6 2.6 18a2 2 0 0 0 1.7 3h15.4a2 2 0 0 0 1.7-3L13.7 4.6a2 2 0 0 0-3.4 0Z"/>
                      </svg>
                    </span>
                    ‚ÄúWorth saying out loud‚Äù
                  </h5>
                  <ul class="clean">
                    <li><strong>Limited efficacy is normal</strong> <span class="meta">no treatment shortens illness duration.</span></li>
                    <li><strong>Dark/thick nasal discharge</strong> <span class="meta">can be part of natural course; not proof of bacterial infection.</span></li>
                  </ul>
                </div>
              </div>
            </div>
          </details>

          <details data-tags="otc decongestants intranasal rebound congestion rhinitis medicamentosa oral decongestants cough medicines children under 6 avoid">
            <summary>
              <div class="left">
                <span class="ic warn" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                    <path d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z"/>
                    <path d="M12 7v5l3 3"/>
                  </svg>
                </span>
                <strong>OTC products ‚Äî what to avoid / consider</strong>
              </div>
              <span class="hint">risk‚Äìbenefit</span>
              <span class="chev">‚ñæ</span>
            </summary>
            <div class="acc-body">
              <div class="two">
                <div class="listcard">
                  <h5>Adults & children &gt;6 years</h5>
                  <ul class="clean">
                    <li><strong>Intranasal decongestants</strong> <span class="meta">may improve sleep/breathing; avoid prolonged use due to rebound congestion / rhinitis medicamentosa.</span></li>
                    <li><strong>Oral decongestants</strong> <span class="meta">small, short-lived benefit; adverse effects possible.</span></li>
                    <li><strong>Cough medicines</strong> <span class="meta">limited overall benefit but may help cough; generally safe when used as directed.</span></li>
                    <li><strong>Avoid duplicate paracetamol</strong> <span class="meta">don‚Äôt combine multiple products containing paracetamol.</span></li>
                  </ul>
                </div>

                <div class="listcard" data-mode="child">
                  <h5>
                    <span class="ic bad" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                        <path d="M18 6 6 18"/><path d="M6 6l12 12"/>
                      </svg>
                    </span>
                    Children ‚â§6 years ‚Äî avoid OTC cough/cold combos
                  </h5>
                  <ul class="clean">
                    <li><strong>Do not use</strong> OTC cough/cold products (overall risk‚Äìbenefit unfavourable).</li>
                    <li><strong>Avoid ingredients</strong> <span class="meta">antitussives (e.g., dextromethorphan/pholcodine), expectorants (guaifenesin/ipecacuanha), topical/oral decongestants (e.g., pseudoephedrine, phenylephrine, oxymetazoline, xylometazoline), antihistamines (e.g., chlorphenamine, diphenhydramine, promethazine).</span></li>
                    <li><strong>Simple remedies</strong> <span class="meta">glycerine/honey/lemon products; honey/lemon warm drink only if &gt;1 year.</span></li>
                  </ul>
                </div>
              </div>
            </div>
          </details>

          <details data-tags="follow up safety net fever 3 days worsening 5 days not improved 10 days difficulty breathing lethargy dehydration">
            <summary>
              <div class="left">
                <span class="ic bad" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                    <path d="M12 8v4l3 3"/><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9Z"/>
                  </svg>
                </span>
                <strong>Follow-up & safety-netting (time triggers)</strong>
              </div>
              <span class="hint">clear thresholds</span>
              <span class="chev">‚ñæ</span>
            </summary>
            <div class="acc-body">
              <div class="callouts">
                <div class="callout">
                  <div class="title">
                    <h3>Advise review if‚Ä¶</h3>
                    <span class="badge warn">Safety-net</span>
                  </div>
                  <ul class="clean">
                    <li><strong>Fever &gt; 3 days</strong></li>
                    <li><strong>Worsening after 5 days</strong></li>
                    <li><strong>Not improving after 10 days</strong> <span class="meta">(mild cough/congestion can persist weeks).</span></li>
                    <li><strong>Concerning symptoms</strong> <span class="meta">increasing illness, lethargy/reduced responsiveness, difficulty breathing.</span></li>
                  </ul>
                </div>

                <div class="callout" data-mode="child">
                  <div class="title">
                    <h3>Young children/babies ‚Äî earlier review</h3>
                    <span class="badge bad">Lower threshold</span>
                  </div>
                  <ul class="clean">
                    <li><strong>Dehydration</strong>, <strong>laboured breathing</strong>, <strong>prolonged fever</strong></li>
                    <li><strong>Higher risk by age</strong> <span class="meta">&lt;3 months: ‚â•38¬∞C high-risk; 3‚Äì6 months: ‚â•39¬∞C intermediate-risk (serious illness risk stratification).</span></li>
                  </ul>
                </div>
              </div>
            </div>
          </details>

          <details data-tags="differential diagnosis covid-19 influenza streptococcal pharyngitis allergic rhinitis glandular fever pertussis foreign body">
            <summary>
              <div class="left">
                <span class="ic info" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                    <path d="M12 2v4"/><path d="M12 18v4"/><path d="M4.9 4.9l2.8 2.8"/><path d="M16.3 16.3l2.8 2.8"/>
                    <path d="M2 12h4"/><path d="M18 12h4"/><path d="M4.9 19.1l2.8-2.8"/><path d="M16.3 7.7l2.8-2.8"/>
                    <path d="M12 8a4 4 0 1 0 4 4 4 4 0 0 0-4-4Z"/>
                  </svg>
                </span>
                <strong>Differentials (quick prompts)</strong>
              </div>
              <span class="hint">don‚Äôt miss</span>
              <span class="chev">‚ñæ</span>
            </summary>
            <div class="acc-body">
              <div class="two">
                <div class="listcard">
                  <h5>More likely than ‚Äúsimple cold‚Äù</h5>
                  <ul class="clean">
                    <li><strong>Influenza</strong> <span class="meta">prominent myalgia/fever.</span></li>
                    <li><strong>COVID-19</strong> <span class="meta">overlap common; consider headache, sore throat, cough, fever, breathlessness, fatigue, anosmia/ageusia.</span></li>
                    <li><strong>Streptococcal pharyngitis</strong> <span class="meta">severe sore throat; cough/sneezing/nasal congestion absent.</span></li>
                    <li><strong>Allergic rhinitis</strong> <span class="meta">nasal symptoms ‚â•2 weeks; allergen linkage.</span></li>
                  </ul>
                </div>
                <div class="listcard">
                  <h5>Don‚Äôt miss (context-dependent)</h5>
                  <ul class="clean">
                    <li><strong>Upper airway obstruction</strong> <span class="meta">stridor, drooling, inability to swallow (abscess/epiglottitis etc.).</span></li>
                    <li><strong>Meningitis</strong> <span class="meta">see red flags.</span></li>
                    <li><strong>Pertussis</strong> <span class="meta">coryzal prodrome then characteristic severe cough.</span></li>
                    <li><strong>Nasal foreign body</strong> <span class="meta">persistent unilateral discharge in a child.</span></li>
                    <li><strong>Glandular fever</strong> <span class="meta">adolescents/young adults: prolonged fever, fatigue, lymphadenopathy.</span></li>
                  </ul>
                </div>
              </div>
            </div>
          </details>
        </div>

        <div class="foot" id="foot">
          <div class="pill">üß≠ Built for rapid scanning: two-column, accordions, search highlighting</div>
          <div class="pill">üü• Red = urgent / referral</div>
          <div class="pill">üü© Green = recommended actions</div>
          <div class="pill">üüß Amber = caution / limited benefit</div>
          <div style="margin-top:8px">
            Tip: use <span style="font-family:var(--mono);background:rgba(255,255,255,.06);padding:2px 6px;border-radius:8px;border:1px solid var(--line);">/</span> to focus search.
          </div>
        </div>
      </div>
    </main>

    <!-- RIGHT: Sticky quick actions / synthesis -->
    <aside class="panel sticky" id="right">
      <div class="hd">
        <h2>
          <span class="ic good" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
              <path d="M12 2l3 7h7l-5.5 4 2 7L12 16l-6.5 4 2-7L2 9h7Z"/>
            </svg>
          </span>
          Quick plan
        </h2>
        <span class="badge" id="stateBadge">No red flags selected</span>
      </div>
      <div class="bd">
        <div class="callout" style="margin-bottom:12px" data-tags="checklist">
          <div class="title">
            <h3>
              <span class="ic bad" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                  <path d="M12 9v4"/><path d="M12 17h.01"/>
                  <path d="M10.3 4.6 2.6 18a2 2 0 0 0 1.7 3h15.4a2 2 0 0 0 1.7-3L13.7 4.6a2 2 0 0 0-3.4 0Z"/>
                </svg>
              </span>
              Red flag checklist
            </h3>
            <span class="badge bad">Binary</span>
          </div>
          <div style="display:grid; gap:10px">
            <label class="toggle" style="min-width:unset">
              <label style="gap:10px">
                <input type="checkbox" class="rf" value="airway" />
                <span>Airway obstruction / escalating dyspnoea</span>
              </label>
              <span class="badge bad">Urgent</span>
            </label>
            <label class="toggle" style="min-width:unset">
              <label style="gap:10px">
                <input type="checkbox" class="rf" value="meningitis" />
                <span>Possible meningitis / serious illness features</span>
              </label>
              <span class="badge bad">Urgent</span>
            </label>
            <label class="toggle" style="min-width:unset">
              <label style="gap:10px">
                <input type="checkbox" class="rf" value="deterioration" />
                <span>Marked deterioration / reduced responsiveness</span>
              </label>
              <span class="badge bad">Urgent</span>
            </label>
          </div>
        </div>

        <div class="callout" data-tags="recommended actions plan">
          <div class="title">
            <h3>
              <span class="ic good" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
                  <path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
              </span>
              If no red flags
            </h3>
            <span class="badge good">Default</span>
          </div>

          <div id="plan" style="display:grid; gap:10px">
            <!-- populated by JS -->
          </div>

          <div class="inline-note" id="riskNote" style="display:none"></div>
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
(function(){
  const $ = (sel, root=document)=>root.querySelector(sel);
  const $$ = (sel, root=document)=>Array.from(root.querySelectorAll(sel));

  const state = {
    mode: "adult",     // adult | child
    redPriority: false,
    risk: false,
    expanded: true,
    query: "",
    redFlags: new Set(),
  };

  const el = {
    segAdult: $("#segAdult"),
    segChild: $("#segChild"),
    modeBadge: $("#modeBadge"),
    q: $("#q"),
    swRed: $("#swRed"),
    swRisk: $("#swRisk"),
    btnExpand: $("#btnExpand"),
    btnCopy: $("#btnCopy"),
    btnReset: $("#btnReset"),
    stateBadge: $("#stateBadge"),
    plan: $("#plan"),
    riskNote: $("#riskNote"),
    accordions: $("#accordions"),
  };

  // Inline helpers
  function setPressed(btn, v){ btn.setAttribute("aria-pressed", v ? "true":"false"); }
  function setSwitch(sw, v){
    sw.dataset.on = v ? "true":"false";
    sw.setAttribute("aria-checked", v ? "true":"false");
  }

  // Mode visibility
  function applyMode(){
    const isAdult = state.mode === "adult";
    setPressed(el.segAdult, isAdult);
    setPressed(el.segChild, !isAdult);
    el.modeBadge.textContent = isAdult ? "Adult / older child" : "Younger child / infant";

    $$("[data-mode]").forEach(node=>{
      const m = node.getAttribute("data-mode");
      node.style.display = (m === state.mode) ? "" : "none";
    });

    renderPlan();
  }

  function renderPlan(){
    const anyRF = state.redFlags.size > 0;

    // Badge
    el.stateBadge.innerHTML = anyRF
      ? `Red flags selected <span style="margin-left:8px" class="badge bad">Urgent referral</span>`
      : `No red flags selected`;

    // Plan content
    const blocks = [];
    if(anyRF){
      blocks.push({
        tone:"bad",
        title:"Immediate action",
        items:[
          "Urgent assessment and arrange admission/referral as clinically appropriate.",
          "Prioritise airway / serious illness pathways according to presenting features."
        ]
      });
    } else {
      const common = [
        "Reassure: self-limiting; peak 2‚Äì3 days; usual duration ~7 days adults, 10‚Äì14 days younger children; cough can persist up to ~3 weeks.",
        "Symptom relief: paracetamol or ibuprofen if needed (pain/fever; in children treat distress).",
        "Fluids + rest; normal activity does not prolong illness.",
        "Avoid routine antibiotics and antihistamines for common cold symptoms.",
        "Hygiene advice to reduce spread (handwashing; avoid towel sharing; reduce toy sharing when symptomatic).",
      ];
      if(state.mode === "child"){
        common.splice(2,0,"In infants/young children: congestion may impair feeding‚Äîconsider saline drops, supportive measures.");
      }
      blocks.push({ tone:"good", title:"Recommended actions", items: common });

      blocks.push({
        tone:"warn",
        title:"Safety-net (time triggers)",
        items:[
          "Review if fever persists >3 days.",
          "Review if symptoms worsen after 5 days.",
          "Review if not improving after 10 days (mild cough/congestion may persist longer).",
          "Earlier review if difficulty breathing, lethargy/reduced responsiveness, dehydration, or prolonged fever in young children/babies."
        ]
      });
    }

    el.plan.innerHTML = blocks.map(b=>{
      const badge = b.tone==="good" ? "good" : b.tone==="bad" ? "bad" : "warn";
      const icon = b.tone==="good" ? "‚úÖ" : b.tone==="bad" ? "üõë" : "‚ö†Ô∏è";
      return `
        <div class="listcard" style="background:rgba(0,0,0,.14)">
          <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start;margin-bottom:10px">
            <div style="display:flex;gap:10px;align-items:center">
              <div style="font-size:18px;line-height:1">${icon}</div>
              <div style="font-weight:750">${b.title}</div>
            </div>
            <span class="badge ${badge}">${b.tone==="good"?"Do":"Act / caution"}</span>
          </div>
          <ul class="clean">${b.items.map(x=>`<li>${x}</li>`).join("")}</ul>
        </div>
      `;
    }).join("");

    // Risk note
    if(state.risk && !anyRF){
      el.riskNote.style.display = "";
      el.riskNote.innerHTML =
        `Complication risk toggled on: arrange follow-up interval using clinical judgement (e.g., significant comorbidity such as asthma/COPD/CHF/diabetes, immunocompromise, smokers).`;
    } else {
      el.riskNote.style.display = "none";
      el.riskNote.textContent = "";
    }
  }

  // Search: highlight matches + hide non-matching blocks
  function clearMarks(root){
    $$("mark", root).forEach(m=>{
      const t = document.createTextNode(m.textContent);
      m.replaceWith(t);
    });
  }
  function markMatches(root, query){
    const q = query.trim().toLowerCase();
    if(!q) return 0;
    let hits = 0;

    // Simple text-node walker highlight
    const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
      acceptNode(node){
        if(!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
        if(node.parentElement && ["SCRIPT","STYLE"].includes(node.parentElement.tagName)) return NodeFilter.FILTER_REJECT;
        return NodeFilter.FILTER_ACCEPT;
      }
    });

    const nodes = [];
    while(walker.nextNode()) nodes.push(walker.currentNode);

    nodes.forEach(node=>{
      const txt = node.nodeValue;
      const idx = txt.toLowerCase().indexOf(q);
      if(idx === -1) return;
      hits++;

      const before = txt.slice(0, idx);
      const match = txt.slice(idx, idx+q.length);
      const after  = txt.slice(idx+q.length);

      const frag = document.createDocumentFragment();
      if(before) frag.appendChild(document.createTextNode(before));
      const m = document.createElement("mark");
      m.textContent = match;
      frag.appendChild(m);
      if(after) frag.appendChild(document.createTextNode(after));

      node.parentNode.replaceChild(frag, node);
    });

    return hits;
  }

  function applyFilters(){
    // Mode already handled with data-mode nodes
    const q = state.query.trim().toLowerCase();
    const redFirst = state.redPriority;

    // clear previous highlights
    clearMarks(document.body);

    // Search/Tag filter targets
    const targets = $$("[data-tags]");
    let visibleCount = 0;

    targets.forEach(node=>{
      const tags = (node.getAttribute("data-tags") || "").toLowerCase();
      const txt = node.textContent.toLowerCase();

      const matches = !q || tags.includes(q) || txt.includes(q);
      node.style.display = matches ? "" : "none";
      if(matches) visibleCount++;
    });

    // Highlight matches within visible content (after hiding)
    if(q){
      markMatches($("#main"), q);
      markMatches($("#right"), q);
    }

    // Red priority: move red-flag accordion to top by opening it and scrolling emphasis
    if(redFirst){
      const rf = $$('details[data-tags*="red flags"]')[0];
      if(rf){ rf.open = true; }
    }
  }

  // Expand/collapse all
  function setAll(open){
    $$("details", el.accordions).forEach(d=>d.open = open);
    state.expanded = open;
    el.btnExpand.textContent = open ? "Collapse" : "Expand";
  }

  // Copy plan
  async function copyPlan(){
    const anyRF = state.redFlags.size > 0;
    let text = "";
    if(anyRF){
      text += "COMMON COLD ‚Äî URGENT FLAGS PRESENT\n";
      text += "- Red flags present: urgent assessment and arrange admission/referral as appropriate.\n";
    } else {
      text += "COMMON COLD ‚Äî QUICK PLAN\n";
      text += "- Reassure: self-limiting; peak 2‚Äì3 days; ~7 days adults; ~10‚Äì14 days younger children; cough up to ~3 weeks.\n";
      text += "- Symptom relief: paracetamol or ibuprofen if needed; in children treat distress; avoid dual dosing.\n";
      text += "- Fluids + rest; normal activity doesn‚Äôt prolong illness.\n";
      text += "- Avoid routine antibiotics/antihistamines.\n";
      text += "- Hygiene: handwashing; avoid towel sharing; reduce toy sharing when symptomatic.\n";
      text += "- Safety-net: fever >3 days; worsening after 5 days; not improving after 10 days; or breathing difficulty/lethargy/dehydration.\n";
      if(state.risk){
        text += "- Increased risk of complications: arrange follow-up per clinical judgement.\n";
      }
    }
    try{
      await navigator.clipboard.writeText(text);
      el.btnCopy.innerHTML = `‚úÖ Copied`;
      setTimeout(()=> el.btnCopy.innerHTML = `
        <span class="ic good" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor">
            <path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
          </svg>
        </span>
        Copy plan`, 900);
    } catch(e){
      alert("Clipboard blocked by browser. Select and copy manually from the Quick plan panel.");
    }
  }

  // Switch click/keyboard
  function bindSwitch(sw, key, onToggle){
    sw.addEventListener("click", ()=>onToggle());
    sw.addEventListener("keydown", (e)=>{
      if(e.key==="Enter" || e.key===" "){ e.preventDefault(); onToggle(); }
    });
    if(key){
      window.addEventListener("keydown", (e)=>{
        if(e.target && (e.target.tagName==="INPUT" || e.target.isContentEditable)) return;
        if(e.key.toLowerCase() === key.toLowerCase()){
          onToggle();
        }
      });
    }
  }

  // Init
  function load(){
    try{
      const saved = JSON.parse(localStorage.getItem("cc_state")||"{}");
      Object.assign(state, saved);
      state.redFlags = new Set(saved.redFlags || []);
    }catch(_){}
    setSwitch(el.swRed, state.redPriority);
    setSwitch(el.swRisk, state.risk);
    el.q.value = state.query || "";
    applyMode();
    setAll(state.expanded !== false);
    // set RF checks
    $$(".rf").forEach(chk => chk.checked = state.redFlags.has(chk.value));
    renderPlan();
    applyFilters();
  }
  function save(){
    const out = {
      ...state,
      redFlags: Array.from(state.redFlags),
    };
    localStorage.setItem("cc_state", JSON.stringify(out));
  }

  // Events
  el.segAdult.addEventListener("click", ()=>{ state.mode="adult"; applyMode(); applyFilters(); save(); });
  el.segChild.addEventListener("click", ()=>{ state.mode="child"; applyMode(); applyFilters(); save(); });

  bindSwitch(el.swRed, "r", ()=>{
    state.redPriority = !state.redPriority;
    setSwitch(el.swRed, state.redPriority);
    applyFilters();
    save();
  });

  bindSwitch(el.swRisk, null, ()=>{
    state.risk = !state.risk;
    setSwitch(el.swRisk, state.risk);
    renderPlan();
    save();
  });

  el.q.addEventListener("input", ()=>{
    state.query = el.q.value;
    applyFilters();
    save();
  });

  // Shortcut: "/" focus search, "m" jump to management accordion
  window.addEventListener("keydown", (e)=>{
    if(e.target && (e.target.tagName==="INPUT" || e.target.isContentEditable)) return;
    if(e.key === "/"){
      e.preventDefault();
      el.q.focus();
    }
    if(e.key.toLowerCase() === "m"){
      const mgmt = $$('details[data-tags*="management"]')[0];
      if(mgmt){ mgmt.open = true; mgmt.scrollIntoView({behavior:"smooth", block:"start"}); }
    }
  });

  el.btnExpand.addEventListener("click", ()=>{
    setAll(!state.expanded);
    save();
  });

  el.btnCopy.addEventListener("click", copyPlan);

  el.btnReset.addEventListener("click", ()=>{
    state.mode="adult";
    state.redPriority=false;
    state.risk=false;
    state.query="";
    state.redFlags = new Set();
    el.q.value="";
    setSwitch(el.swRed,false);
    setSwitch(el.swRisk,false);
    $$(".rf").forEach(chk=>chk.checked=false);
    applyMode();
    setAll(true);
    renderPlan();
    // restore all nodes
    $$("[data-tags]").forEach(n=>n.style.display="");
    clearMarks(document.body);
    save();
  });

  // Red flag checklist updates plan immediately
  $$(".rf").forEach(chk=>{
    chk.addEventListener("change", ()=>{
      if(chk.checked) state.redFlags.add(chk.value);
      else state.redFlags.delete(chk.value);
      renderPlan();
      save();
    });
  });

  load();
})();
</script>
</body>
</html>
