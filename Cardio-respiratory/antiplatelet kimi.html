<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antiplatelet Treatment Algorithm | NICE CKS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-assessment: #3498db;
            --color-diagnosis: #9b59b6;
            --color-treatment: #27ae60;
            --color-followup: #e67e22;
            --color-red: #e74c3c;
            --color-amber: #f39c12;
            --color-green: #2ecc71;
            --color-dark: #2c3e50;
            --color-light: #ecf0f1;
            --color-text: #34495e;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--color-text);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            background-attachment: fixed;
        }

        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 40px rgba(0,0,0,0.2);
        }

        /* Header */
        .main-header {
            background: linear-gradient(135deg, var(--color-dark) 0%, #1a2530 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 6s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }

        .main-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Progress Sidebar */
        .progress-sidebar {
            width: 280px;
            background: var(--color-light);
            padding: 1.5rem;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            border-right: 2px solid #bdc3c7;
        }

        .progress-sidebar h3 {
            color: var(--color-dark);
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .progress-item:hover {
            background: rgba(52, 152, 219, 0.1);
            transform: translateX(5px);
        }

        .progress-item.active {
            background: white;
            border-left-color: var(--color-assessment);
            box-shadow: var(--shadow-light);
            font-weight: 600;
        }

        .progress-item.completed {
            opacity: 0.7;
        }

        .progress-icon {
            width: 24px;
            height: 24px;
            margin-right: 0.8rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .progress-icon.assessment { background: var(--color-assessment); }
        .progress-icon.diagnosis { background: var(--color-diagnosis); }
        .progress-icon.treatment { background: var(--color-treatment); }
        .progress-icon.followup { background: var(--color-followup); }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            max-height: 100vh;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-light);
            overflow: hidden;
            transition: var(--transition);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease forwards;
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }

        .card-header {
            padding: 1.5rem;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition);
        }

        .card-header.assessment { background: var(--color-assessment); }
        .card-header.diagnosis { background: var(--color-diagnosis); }
        .card-header.treatment { background: var(--color-treatment); }
        .card-header.followup { background: var(--color-followup); }

        .card-header:hover {
            filter: brightness(1.1);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .expand-icon {
            font-size: 1.5rem;
            transition: var(--transition);
        }

        .card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card.expanded .card-content {
            max-height: 2000px;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 0.2rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-light);
        }

        .badge:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-medium);
        }

        .badge-red {
            background: var(--color-red);
            color: white;
        }

        .badge-amber {
            background: var(--color-amber);
            color: white;
        }

        .badge-green {
            background: var(--color-green);
            color: white;
        }

        .badge-icon {
            margin-right: 0.5rem;
            font-size: 0.9rem;
        }

        /* Content Sections */
        .section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #ecf0f1;
        }

        .section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--color-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .subsection {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--color-assessment);
        }

        .subsection h4 {
            color: var(--color-dark);
            margin-bottom: 0.5rem;
        }

        .subsection ul {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
        }

        .subsection li {
            margin-bottom: 0.5rem;
        }

        /* Drug Cards */
        .drug-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: var(--transition);
        }

        .drug-card:hover {
            border-color: var(--color-assessment);
            box-shadow: var(--shadow-light);
        }

        .drug-name {
            font-weight: 600;
            color: var(--color-dark);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .drug-dose {
            background: var(--color-light);
            padding: 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            margin: 0.5rem 0;
        }

        /* Risk Factors Grid */
        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .risk-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            transition: var(--transition);
        }

        .risk-item:hover {
            border-color: var(--color-amber);
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .risk-title {
            font-weight: 600;
            color: var(--color-dark);
            margin-bottom: 0.5rem;
        }

        /* Alert Boxes */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid;
            transition: var(--transition);
        }

        .alert:hover {
            transform: translateX(5px);
        }

        .alert-info {
            background: #d6eaf8;
            border-color: var(--color-assessment);
            color: #1b4f72;
        }

        .alert-warning {
            background: #fef5e7;
            border-color: var(--color-amber);
            color: #7d6608;
        }

        .alert-danger {
            background: #fadbd8;
            border-color: var(--color-red);
            color: #78281f;
        }

        .alert-success {
            background: #d5f4e6;
            border-color: var(--color-green);
            color: #186a3b;
        }

        /* Interactive Elements */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin: 0 0.5rem;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--color-assessment);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Print Button */
        .print-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--color-dark);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: var(--shadow-medium);
            transition: var(--transition);
            z-index: 1000;
        }

        .print-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background: var(--color-assessment);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            
            .progress-sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 1rem;
            }
            
            .main-content {
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .main-header h1 {
                font-size: 1.8rem;
            }
            
            .card-title {
                font-size: 1.1rem;
            }
            
            .risk-grid {
                grid-template-columns: 1fr;
            }
            
            .print-btn {
                bottom: 1rem;
                right: 1rem;
                width: 50px;
                height: 50px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--color-assessment);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--color-light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-assessment);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-dark);
        }
    </style>
</head>
<body>
    <div class="main-header">
        <h1>Antiplatelet Treatment Algorithm</h1>
        <p>Interactive clinical decision support tool based on NICE CKS guidelines (May 2025)</p>
    </div>

    <div class="container">
        <!-- Progress Sidebar -->
        <aside class="progress-sidebar">
            <h3>
                <span>üìä</span>
                Progress
            </h3>
            <div class="progress-item active" data-step="assessment">
                <div class="progress-icon assessment">1</div>
                <span>Assessment</span>
            </div>
            <div class="progress-item" data-step="diagnosis">
                <div class="progress-icon diagnosis">2</div>
                <span>Diagnosis & Scenario</span>
            </div>
            <div class="progress-item" data-step="treatment">
                <div class="progress-icon treatment">3</div>
                <span>Treatment Selection</span>
            </div>
            <div class="progress-item" data-step="followup">
                <div class="progress-icon followup">4</div>
                <span>Follow-up & Management</span>
            </div>
            
            <div style="margin-top: 2rem; padding-top: 1rem; border-top: 2px solid #bdc3c7;">
                <h4 style="color: var(--color-dark); margin-bottom: 1rem;">Quick Actions</h4>
                <button class="badge badge-green" style="width: 100%; margin: 0.2rem 0; cursor: pointer;" onclick="expandAll()">
                    <span class="badge-icon">üîç</span>Expand All
                </button>
                <button class="badge badge-amber" style="width: 100%; margin: 0.2rem 0; cursor: pointer;" onclick="collapseAll()">
                    <span class="badge-icon">üéØ</span>Collapse All
                </button>
            </div>

            <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px;">
                <h5 style="color: var(--color-dark); margin-bottom: 0.5rem;">Severity Guide</h5>
                <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                    <div class="badge badge-red" style="cursor: default;">
                        <span class="badge-icon">‚ö†Ô∏è</span>Urgent Action
                    </div>
                    <div class="badge badge-amber" style="cursor: default;">
                        <span class="badge-icon">‚ö°</span>Caution Required
                    </div>
                    <div class="badge badge-green" style="cursor: default;">
                        <span class="badge-icon">‚úÖ</span>Stable/Proceed
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Assessment Card -->
            <div class="card" id="assessment-card">
                <div class="card-header assessment" onclick="toggleCard(this)">
                    <div class="card-title">
                        <div class="card-icon">üîç</div>
                        Assessment & Indications
                    </div>
                    <div class="expand-icon">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="section">
                            <h3 class="section-title">
                                <span>üéØ</span>
                                Primary vs Secondary Prevention
                            </h3>
                            <div class="alert alert-info">
                                <strong>Key Principle:</strong> Antiplatelet treatment is NOT routinely recommended for primary prevention of cardiovascular disease. Use only on individual case-by-case basis after careful consideration.
                            </div>
                            
                            <div class="risk-grid">
                                <div class="risk-item">
                                    <div class="risk-title">
                                        <span class="badge badge-amber" style="cursor: default;">‚ö†Ô∏è</span>
                                        Secondary Prevention (Main Indication)
                                    </div>
                                    <ul>
                                        <li>Acute coronary syndrome (ACS)</li>
                                        <li>Stable angina</li>
                                        <li>Peripheral arterial disease (PAD)</li>
                                        <li>Post-myocardial infarction</li>
                                        <li>Post-stroke or TIA</li>
                                        <li>Post-cardiac intervention (PCI/CABG)</li>
                                    </ul>
                                </div>
                                
                                <div class="risk-item">
                                    <div class="risk-title">
                                        <span class="badge badge-red" style="cursor: default;">üö´</span>
                                        Exclusions & Contraindications
                                    </div>
                                    <ul>
                                        <li>Active pathological bleeding</li>
                                        <li>Severe hepatic impairment</li>
                                        <li>Severe renal impairment</li>
                                        <li>Bleeding disorders (haemophilia, thrombocytopenia)</li>
                                        <li>True hypersensitivity to aspirin/salicylates</li>
                                        <li>Children &lt;16 years (Reye's syndrome risk)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>‚ö†Ô∏è</span>
                                GI Bleeding Risk Assessment
                            </h3>
                            <div class="alert alert-warning">
                                <strong>High-Risk Factors:</strong> Age &gt;75 years, history of GI ulcer/bleeding, H. pylori infection, concomitant meds (NSAIDs, anticoagulants, corticosteroids)
                            </div>
                            
                            <div class="subsection" style="border-left-color: var(--color-amber);">
                                <h4>Gastroprotection Required</h4>
                                <p><strong>When taking low-dose aspirin alone or with ticagrelor/prasugrel:</strong></p>
                                <ul>
                                    <li>Co-prescribe PPI (lansoprazole, omeprazole, or pantoprazole)</li>
                                    <li>Test for and treat H. pylori if history of ulcer disease</li>
                                </ul>
                                <p><strong>When taking clopidogrel alone or with aspirin:</strong></p>
                                <ul>
                                    <li>Co-prescribe PPI (EXCEPT omeprazole or esomeprazole)</li>
                                    <li>Use pantoprazole or lansoprazole instead</li>
                                </ul>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>üîÑ</span>
                                Switching Scenarios
                            </h3>
                            <div class="alert alert-success">
                                Switching may be required if current treatment is unsuitable or not tolerated
                            </div>
                            <p>See Follow-up section for specific switching protocols and timing</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Diagnosis Card -->
            <div class="card" id="diagnosis-card">
                <div class="card-header diagnosis" onclick="toggleCard(this)">
                    <div class="card-title">
                        <div class="card-icon">üìã</div>
                        Clinical Scenarios & Decision Points
                    </div>
                    <div class="expand-icon">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="section">
                            <h3 class="section-title">
                                <span>üíî</span>
                                Acute Coronary Syndrome (ACS)
                            </h3>
                            <div class="drug-card">
                                <div class="drug-name">Initial Management</div>
                                <div class="drug-dose">Aspirin 300 mg loading dose ‚Üí 75 mg once daily indefinitely</div>
                                <div class="badge badge-green" style="cursor: default;">
                                    <span class="badge-icon">‚è±Ô∏è</span>Continue unless contraindicated
                                </div>
                            </div>
                            
                            <div class="subsection" style="border-left-color: var(--color-red);">
                                <h4>Dual Antiplatelet Therapy (DAPT)</h4>
                                <p>Offer DAPT for up to 12 months, unless contraindicated:</p>
                                <ul>
                                    <li><strong>Prasugrel 5 mg daily</strong> (10 mg if ‚â•60 kg and &lt;75 years)</li>
                                    <li><strong>Ticagrelor 90 mg twice daily</strong> (12 months, then 60 mg bid if extended)</li>
                                    <li><strong>Clopidogrel 75 mg daily</strong></li>
                                </ul>
                                <div class="alert alert-amber">
                                    <strong>Duration Flexibility:</strong> May extend (>12 months) in high ischaemic risk patients who tolerate DAPT without bleeding. May shorten (1-3 months) in high bleeding risk patients.
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>ü©∫</span>
                                Stable Angina & PCI
                            </h3>
                            <div class="drug-card">
                                <div class="drug-name">Post-PCI Management</div>
                                <div class="drug-dose">Aspirin 75 mg + Clopidogrel 75 mg daily for 6 months</div>
                                <div class="badge badge-amber" style="cursor: default;">
                                    <span class="badge-icon">ü©∏</span>High bleeding risk: shorten to 1-3 months
                                </div>
                                <div class="badge badge-green" style="cursor: default;">
                                    <span class="badge-icon">üéØ</span>High ischaemic risk: extend up to 36 months
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>üß†</span>
                                Stroke & TIA
                            </h3>
                            <div class="subsection" style="border-left-color: var(--color-diagnosis);">
                                <h4>Acute Phase (First 3-4 weeks)</h4>
                                <p><strong>Dual Therapy Options:</strong></p>
                                <ul>
                                    <li>Clopidogrel 300 mg ‚Üí 75 mg daily + Aspirin 300 mg ‚Üí 75 mg daily (21 days)</li>
                                    <li>Ticagrelor 180 mg ‚Üí 90 mg bid + Aspirin 300 mg ‚Üí 75 mg daily (30 days)</li>
                                </ul>
                                <p>Then continue with <strong>clopidogrel monotherapy</strong> or <strong>ticagrelor monotherapy</strong></p>
                            </div>
                            
                            <div class="subsection" style="border-left-color: var(--color-treatment);">
                                <h4>Long-term Management</h4>
                                <ul>
                                    <li><strong>Clopidogrel 75 mg daily</strong> (preferred)</li>
                                    <li>If intolerant: Aspirin 75 mg daily OR Modified-release dipyridamole 200 mg bid + Aspirin</li>
                                    <li>Modified-release dipyridamole alone (alternative)</li>
                                </ul>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>ü¶µ</span>
                                Peripheral Arterial Disease (PAD)
                            </h3>
                            <div class="drug-card">
                                <div class="drug-name">First-line Therapy</div>
                                <div class="drug-dose">Clopidogrel 75 mg daily</div>
                                <div class="badge badge-green" style="cursor: default;">
                                    <span class="badge-icon">‚úÖ</span>Preferred antiplatelet for PAD
                                </div>
                            </div>
                            <div class="alert alert-info">
                                If clopidogrel contraindicated/not tolerated: Low-dose aspirin may be considered as alternative
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>‚ùå</span>
                                Atrial Fibrillation (AF)
                            </h3>
                            <div class="alert alert-danger">
                                <strong>‚ö†Ô∏è IMPORTANT:</strong> Aspirin is NOT indicated as antiplatelet treatment in AF. Anticoagulants are usually prescribed. See NICE AF guideline for details.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Treatment Card -->
            <div class="card" id="treatment-card">
                <div class="card-header treatment" onclick="toggleCard(this)">
                    <div class="card-title">
                        <div class="card-icon">üíä</div>
                        Drug Selection & Dosing
                    </div>
                    <div class="expand-icon">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="section">
                            <h3 class="section-title">
                                <span>üíä</span>
                                Antiplatelet Medications Overview
                            </h3>
                            
                            <div class="drug-card">
                                <div class="drug-name">Aspirin (Low-dose)</div>
                                <div class="drug-dose">75 mg once daily (antiplatelet dose)</div>
                                <ul style="margin-top: 0.5rem;">
                                    <li>First choice for secondary prevention</li>
                                    <li>Take AFTER food to reduce GI irritation</li>
                                    <li>Do NOT use enteric-coated formulations</li>
                                    <li>Mechanism: Irreversibly inhibits cyclo-oxygenase, blocks thromboxane production</li>
                                </ul>
                                <div class="badge badge-green" style="cursor: default; margin-top: 0.5rem;">
                                    <span class="badge-icon">‚úÖ</span>First-line for most scenarios
                                </div>
                            </div>

                            <div class="drug-card">
                                <div class="drug-name">Clopidogrel</div>
                                <div class="drug-dose">75 mg once daily</div>
                                <ul style="margin-top: 0.5rem;">
                                    <li>Thienopyridine: inhibits ADP binding to P2Y12 receptor</li>
                                    <li>Preferred for PAD</li>
                                    <li>Alternative for aspirin hypersensitivity</li>
                                    <li>Used in DAPT regimens</li>
                                </ul>
                                <div class="badge badge-amber" style="cursor: default; margin-top: 0.5rem;">
                                    <span class="badge-icon">‚ö†Ô∏è</span>Avoid omeprazole/esomeprazole
                                </div>
                            </div>

                            <div class="drug-card">
                                <div class="drug-name">Ticagrelor</div>
                                <div class="drug-dose">90 mg twice daily (12 months) ‚Üí 60 mg twice daily (if extended)</div>
                                <ul style="margin-top: 0.5rem;">
                                    <li>ATP analogue: blocks P2Y12 receptor (reversible)</li>
                                    <li>Used in ACS and post-MI with high risk</li>
                                    <li>More potent antiplatelet effect</li>
                                    <li>Caution: dyspnoea, bradyarrhythmias, hyperuricaemia</li>
                                </ul>
                                <div class="badge badge-amber" style="cursor: default; margin-top: 0.5rem;">
                                    <span class="badge-icon">‚ö°</span>Monitor renal function monthly
                                </div>
                            </div>

                            <div class="drug-card">
                                <div class="drug-name">Prasugrel</div>
                                <div class="drug-dose">5 mg daily OR 10 mg daily (if ‚â•60 kg and &lt;75 years)</div>
                                <ul style="margin-top: 0.5rem;">
                                    <li>Thienopyridine: inhibits ADP binding to P2Y12 receptor</li>
                                    <li>Used in ACS undergoing PCI</li>
                                    <li>Contraindicated in history of stroke/TIA</li>
                                    <li>Higher bleeding risk than clopidogrel</li>
                                </ul>
                                <div class="badge badge-red" style="cursor: default; margin-top: 0.5rem;">
                                    <span class="badge-icon">üö´</span>Contraindicated post-stroke/TIA
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>‚öïÔ∏è</span>
                                Dual Antiplatelet Therapy (DAPT) Protocols
                            </h3>
                            
                            <div class="subsection" style="border-left-color: var(--color-red);">
                                <h4>ACS (Unstable Angina/NSTEMI/STEMI)</h4>
                                <ul>
                                    <li><strong>Duration:</strong> Up to 12 months (flexible based on risk)</li>
                                    <li><strong>Options:</strong> Aspirin + (Prasugrel/Ticagrelor/Clopidogrel)</li>
                                    <li><strong>Loading doses:</strong> Aspirin 300 mg + P2Y12 inhibitor (as appropriate)</li>
                                </ul>
                            </div>

                            <div class="subsection" style="border-left-color: var(--color-treatment);">
                                <h4>Elective PCI (Stable CAD)</h4>
                                <ul>
                                    <li><strong>Duration:</strong> 6 months (adjust based on bleeding/ischaemic risk)</li>
                                    <li><strong>Standard:</strong> Aspirin 75 mg + Clopidogrel 75 mg daily</li>
                                    <li><strong>High ischaemic risk:</strong> May extend up to 36 months</li>
                                </ul>
                            </div>

                            <div class="subsection" style="border-left-color: var(--color-diagnosis);">
                                <h4>Post-Stroke/TIA (Acute Phase)</h4>
                                <ul>
                                    <li><strong>Duration:</strong> 3-4 weeks</li>
                                    <li><strong>Options:</strong> Clopidogrel + Aspirin (21 days) OR Ticagrelor + Aspirin (30 days)</li>
                                    <li><strong>Then:</strong> Continue single antiplatelet long-term</li>
                                </ul>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>üõ°Ô∏è</span>
                                Gastroprotection Strategy
                            </h3>
                            <div class="alert alert-warning">
                                <strong>Rule:</strong> Always co-prescribe PPI in high GI risk patients, but AVOID omeprazole/esomeprazole with clopidogrel due to interaction
                            </div>
                            
                            <div class="risk-grid">
                                <div class="risk-item">
                                    <div class="risk-title">With Aspirin (¬± Ticagrelor/Prasugrel)</div>
                                    <p><strong>PPI Options:</strong> Lansoprazole, Omeprazole, Pantoprazole</p>
                                </div>
                                <div class="risk-item">
                                    <div class="risk-title">With Clopidogrel (¬± Aspirin)</div>
                                    <p><strong>PPI Options:</strong> Lansoprazole or Pantoprazole only</p>
                                </div>
                            </div>

                            <div class="subsection" style="border-left-color: var(--color-green);">
                                <h4>H. pylori Testing & Treatment</h4>
                                <p>Test and treat if:</p>
                                <ul>
                                    <li>History of ulcer disease or upper GI bleeding</li>
                                    <li>NOT previously tested and treated</li>
                                </ul>
                                <div class="alert alert-info">
                                    <strong>Timing:</strong> Avoid PPIs for 2 weeks before testing. Leave 2-week washout after PPI before H. pylori test.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Follow-up Card -->
            <div class="card" id="followup-card">
                <div class="card-header followup" onclick="toggleCard(this)">
                    <div class="card-title">
                        <div class="card-icon">üìà</div>
                        Follow-up & Peri-procedural Management
                    </div>
                    <div class="expand-icon">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="section">
                            <h3 class="section-title">
                                <span>üòü</span>
                                Managing Antiplatelet-Induced Dyspepsia
                            </h3>
                            
                            <div class="subsection" style="border-left-color: var(--color-red);">
                                <h4>Alarm Features ‚Üí Urgent Referral (2-week pathway)</h4>
                                <ul>
                                    <li>Dysphagia</li>
                                    <li>Weight loss</li>
                                    <li>Gastrointestinal bleeding</li>
                                    <li>Anaemia</li>
                                    <li>Persistent vomiting</li>
                                </ul>
                                <div class="alert alert-info">
                                    <strong>While waiting for endoscopy:</strong> May continue antiplatelet. Use simple antacid (avoid PPIs/H2RAs for 2 weeks before procedure).
                                </div>
                            </div>

                            <div class="subsection" style="border-left-color: var(--color-amber);">
                                <h4>Non-Alarm Dyspepsia</h4>
                                <ol>
                                    <li>Ensure general measures taken (see Dyspepsia CKS)</li>
                                    <li>Prescribe antacid/alginate PRN</li>
                                    <li>Empirical full-dose PPI for 1 month</li>
                                    <li>Test and treat H. pylori (if unknown status)</li>
                                    <li>If symptoms recur: lowest dose PPI to control symptoms</li>
                                    <li>Annual review of maintenance treatment</li>
                                </ol>
                            </div>

                            <div class="subsection" style="border-left-color: var(--color-green);">
                                <h4>If on Clopidogrel</h4>
                                <ul>
                                    <li>Avoid omeprazole/esomeprazole</li>
                                    <li>Use alternative PPI (lansoprazole/pantoprazole) OR H2RA for 1 month</li>
                                    <li>Refer to secondary care if persistent symptoms</li>
                                </ul>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>üîÑ</span>
                                Switching Antiplatelet Medications
                            </h3>
                            <div class="alert alert-warning">
                                <strong>General Rule:</strong> Wait 24 hours between stopping one and starting another in chronic setting. Loading doses required in acute setting.
                            </div>
                            
                            <div class="risk-grid">
                                <div class="risk-item">
                                    <div class="risk-title">Clopidogrel ‚Üí Ticagrelor</div>
                                    <p><strong>Start:</strong> Ticagrelor 90 mg bid, 24h after last clopidogrel dose</p>
                                </div>
                                <div class="risk-item">
                                    <div class="risk-title">Clopidogrel ‚Üí Prasugrel</div>
                                    <p><strong>Start:</strong> Prasugrel 10 mg daily, 24h after last clopidogrel dose</p>
                                </div>
                                <div class="risk-item">
                                    <div class="risk-title">Prasugrel ‚Üí Clopidogrel</div>
                                    <p><strong>Start:</strong> Clopidogrel 75 mg daily, 24h after last prasugrel dose</p>
                                </div>
                                <div class="risk-item">
                                    <div class="risk-title">Prasugrel ‚Üí Ticagrelor</div>
                                    <p><strong>Start:</strong> Ticagrelor 90 mg bid, 24h after last prasugrel dose</p>
                                </div>
                                <div class="risk-item">
                                    <div class="risk-title">Ticagrelor ‚Üí Clopidogrel</div>
                                    <p><strong>Loading dose:</strong> Clopidogrel 600 mg, 24h after last ticagrelor, then 75 mg daily</p>
                                </div>
                                <div class="risk-item">
                                    <div class="risk-title">Ticagrelor ‚Üí Prasugrel</div>
                                    <p><strong>Loading dose:</strong> Prasugrel 60 mg, 24h after last ticagrelor, then 10 mg daily</p>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>üî™</span>
                                Surgery & Dental Treatment
                            </h3>
                            <div class="alert alert-danger">
                                <strong>Critical:</strong> Advise patients to inform all healthcare providers about antiplatelet therapy before any procedure
                            </div>
                            
                            <div class="subsection" style="border-left-color: var(--color-green);">
                                <h4>Dental Surgery</h4>
                                <div class="alert alert-success">
                                    <strong>Continue antiplatelet therapy uninterrupted</strong>
                                </div>
                            </div>

                            <div class="subsection" style="border-left-color: var(--color-amber);">
                                <h4>Coronary Artery Bypass Grafting (CABG)</h4>
                                <ul>
                                    <li><strong>Ticagrelor:</strong> Discontinue 3-7 days before surgery</li>
                                    <li><strong>Clopidogrel:</strong> Discontinue 5-7 days before surgery</li>
                                    <li><strong>Prasugrel:</strong> Discontinue ‚â•7 days before surgery</li>
                                </ul>
                            </div>

                            <div class="subsection" style="border-left-color: var(--color-red);">
                                <h4>Non-Cardiac Surgery</h4>
                                <div class="alert alert-warning">
                                    <strong>Specialist decision:</strong> Balance bleeding risk vs thrombosis risk. DAPT increases surgical bleeding complications significantly.
                                </div>
                                <p>Ticagrelor and prasugrel have higher bleeding risk than clopidogrel</p>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>ü©∏</span>
                                Bleeding Management
                            </h3>
                            <div class="alert alert-danger">
                                <strong>Major Bleeding:</strong> Seek immediate medical attention. May require platelet transfusion and discontinuation of antiplatelet therapy.
                            </div>
                            <div class="risk-grid">
                                <div class="risk-item">
                                    <div class="risk-title">Minor Bleeding</div>
                                    <p>Continue antiplatelet, apply local pressure, monitor closely</p>
                                </div>
                                <div class="risk-item">
                                    <div class="risk-title">Moderate Bleeding</div>
                                    <p>Hold antiplatelet temporarily, investigate cause, consider gastroprotection</p>
                                </div>
                                <div class="risk-item">
                                    <div class="risk-title">Major/Life-threatening</div>
                                    <p>Stop antiplatelet, urgent medical assessment, possible transfusion</p>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3 class="section-title">
                                <span>üìã</span>
                                Monitoring Requirements
                            </h3>
                            <ul>
                                <li><strong>Ticagrelor:</strong> Monitor renal function 1 month after starting treatment</li>
                                <li>Assess for adverse effects at each review (bleeding, dyspepsia, dyspnoea, gout)</li>
                                <li>Annual review of ongoing need for therapy</li>
                                <li>Medication review for drug interactions</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <button class="print-btn" onclick="printAlgorithm()" title="Print Algorithm">
        üñ®Ô∏è
    </button>

    <script>
        // Card Management
        function toggleCard(header) {
            const card = header.parentElement;
            const isExpanded = card.classList.contains('expanded');
            
            // Close all other cards
            document.querySelectorAll('.card').forEach(c => {
                if (c !== card) {
                    c.classList.remove('expanded');
                }
            });
            
            // Toggle current card
            card.classList.toggle('expanded');
            
            // Update progress
            updateProgress();
            
            // Smooth scroll to card
            if (!isExpanded) {
                setTimeout(() => {
                    card.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
            
            // Save state
            saveProgress();
        }

        function expandAll() {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.add('expanded');
            });
            updateProgress();
            saveProgress();
        }

        function collapseAll() {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('expanded');
            });
            updateProgress();
            saveProgress();
        }

        // Progress Management
        function updateProgress() {
            const cards = document.querySelectorAll('.card');
            const progressItems = document.querySelectorAll('.progress-item');
            
            cards.forEach((card, index) => {
                const isExpanded = card.classList.contains('expanded');
                const progressItem = progressItems[index];
                
                if (isExpanded) {
                    progressItem.classList.add('active');
                    progressItem.classList.remove('completed');
                } else {
                    progressItem.classList.remove('active');
                    // Mark as completed if user has viewed it (simple check)
                    const hasBeenViewed = localStorage.getItem(`card-viewed-${card.id}`);
                    if (hasBeenViewed) {
                        progressItem.classList.add('completed');
                    }
                }
            });
        }

        // Progress Sidebar Interaction
        document.querySelectorAll('.progress-item').forEach((item, index) => {
            item.addEventListener('click', () => {
                const targetCard = document.querySelectorAll('.card')[index];
                const header = targetCard.querySelector('.card-header');
                
                // Expand the target card
                if (!targetCard.classList.contains('expanded')) {
                    toggleCard(header);
                }
                
                // Scroll to card
                setTimeout(() => {
                    targetCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            });
        });

        // Save/Load Progress
        function saveProgress() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                const isExpanded = card.classList.contains('expanded');
                localStorage.setItem(`card-state-${card.id}`, isExpanded);
                if (isExpanded) {
                    localStorage.setItem(`card-viewed-${card.id}`, true);
                }
            });
        }

        function loadProgress() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                const savedState = localStorage.getItem(`card-state-${card.id}`);
                if (savedState === 'true') {
                    card.classList.add('expanded');
                }
            });
            updateProgress();
        }

        // Print Function
        function printAlgorithm() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => card.classList.add('expanded'));
            
            setTimeout(() => {
                window.print();
            }, 500);
        }

        // Badge Interactions
        document.querySelectorAll('.badge').forEach(badge => {
            if (badge.style.cursor !== 'default') {
                badge.addEventListener('click', function() {
                    const message = this.getAttribute('data-message') || 'Clinical decision point selected';
                    showAlert(message, this.classList.contains('badge-red') ? 'danger' : 
                            this.classList.contains('badge-amber') ? 'warning' : 'success');
                });
            }
        });

        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: 400px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            `;
            alertDiv.innerHTML = `
                <strong>Clinical Alert:</strong> ${message}
                <button onclick="this.parentElement.remove()" style="margin-left: 1rem; background: none; border: none; font-size: 1.2rem; cursor: pointer;">√ó</button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => alertDiv.remove(), 300);
                }
            }, 5000);
        }

        // Search functionality
        function initSearch() {
            const searchBox = document.createElement('div');
            searchBox.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; align-items: center; gap: 0.5rem;">
                    <input type="text" id="search-input" placeholder="Search algorithm..." 
                           style="padding: 0.5rem 1rem; border: 2px solid var(--color-assessment); border-radius: 25px; width: 250px; transition: all 0.3s ease;">
                    <button class="badge badge-assessment" style="cursor: pointer;" onclick="clearSearch()">Clear</button>
                </div>
            `;
            document.body.appendChild(searchBox);

            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                highlightSearch(searchTerm);
            });

            // Add search result counter
            const counter = document.createElement('div');
            counter.id = 'search-counter';
            counter.style.cssText = `
                position: fixed;
                top: 60px;
                right: 20px;
                background: var(--color-assessment);
                color: white;
                padding: 0.3rem 0.8rem;
                border-radius: 15px;
                font-size: 0.8rem;
                z-index: 9999;
                display: none;
            `;
            document.body.appendChild(counter);
        }

        function highlightSearch(term) {
            // Remove previous highlights
            document.querySelectorAll('.highlight').forEach(el => {
                el.outerHTML = el.innerHTML;
            });

            const counter = document.getElementById('search-counter');
            if (!term) {
                counter.style.display = 'none';
                return;
            }

            let count = 0;
            const textNodes = getTextNodes(document.body);
            
            textNodes.forEach(node => {
                const text = node.textContent.toLowerCase();
                if (text.includes(term)) {
                    count++;
                    const span = document.createElement('span');
                    span.className = 'highlight';
                    span.style.backgroundColor = '#ffeb3b';
                    span.style.color = '#000';
                    span.style.padding = '2px 4px';
                    span.style.borderRadius = '3px';
                    span.style.fontWeight = 'bold';
                    
                    const regex = new RegExp(`(${escapeRegExp(term)})`, 'gi');
                    span.innerHTML = node.textContent.replace(regex, '<mark style="background: transparent; color: inherit;">$1</mark>');
                    
                    node.parentNode.replaceChild(span, node);
                }
            });

            if (count > 0) {
                counter.textContent = `${count} matches found`;
                counter.style.display = 'block';
            } else {
                counter.textContent = 'No matches found';
                counter.style.display = 'block';
            }

            // Show counter for 5 seconds
            setTimeout(() => {
                counter.style.display = 'none';
            }, 5000);
        }

        function clearSearch() {
            document.getElementById('search-input').value = '';
            document.querySelectorAll('.highlight').forEach(el => {
                el.outerHTML = el.innerHTML;
            });
            document.getElementById('search-counter').style.display = 'none';
        }

        function getTextNodes(element) {
            const textNodes = [];
            const walker = document.createTreeWalker(
                element,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        // Skip script, style, and the search box itself
                        if (node.parentElement.tagName === 'SCRIPT' || 
                            node.parentElement.tagName === 'STYLE' ||
                            node.parentElement.closest('#search-input')) {
                            return NodeFilter.FILTER_REJECT;
                        }
                        return NodeFilter.FILTER_ACCEPT;
                    }
                }
            );
            
            let node;
            while (node = walker.nextNode()) {
                if (node.textContent.trim()) {
                    textNodes.push(node);
                }
            }
            
            return textNodes;
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Add CSS animations for alerts
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
            initSearch();
            
            // Add some interactive examples
            setTimeout(() => {
                showAlert('Interactive antiplatelet algorithm loaded. Use the search box to find specific topics, or click on cards to expand sections.', 'info');
            }, 1000);
        });

        // Auto-save progress on scroll
        let scrollTimeout;
        window.addEventListener('scroll', function() {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                saveProgress();
            }, 500);
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth <= 1024) {
                document.querySelector('.progress-sidebar').style.height = 'auto';
            } else {
                document.querySelector('.progress-sidebar').style.height = '100vh';
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'f':
                        e.preventDefault();
                        document.getElementById('search-input').focus();
                        break;
                    case 'p':
                        e.preventDefault();
                        printAlgorithm();
                        break;
                }
            }
            
            // Escape key to clear search
            if (e.key === 'Escape') {
                clearSearch();
            }
        });

        // Add floating help button
        const helpBtn = document.createElement('button');
        helpBtn.innerHTML = '‚ùì';
        helpBtn.style.cssText = `
            position: fixed;
            bottom: 2rem;
            right: 6rem;
            background: var(--color-treatment);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: var(--shadow-medium);
            transition: var(--transition);
            z-index: 1000;
        `;
        helpBtn.onclick = function() {
            alert(`Antiplatelet Treatment Algorithm - Help

Keyboard Shortcuts:
‚Ä¢ Ctrl+F: Search algorithm
‚Ä¢ Ctrl+P: Print
‚Ä¢ Escape: Clear search

Navigation:
‚Ä¢ Click cards to expand/collapse
‚Ä¢ Use progress sidebar to jump between sections
‚Ä¢ Badges indicate severity levels

Interactions:
‚Ä¢ Hover over items for additional info
‚Ä¢ Click on colored badges for alerts
‚Ä¢ Use "Expand All" to view entire algorithm

Data Source: NICE CKS (May 2025)`);
        };
        document.body.appendChild(helpBtn);
    </script>
</body>
</html>