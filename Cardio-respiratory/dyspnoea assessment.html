<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dyspnoea Assessment: Clinical Quick-Scan</title>
    <style>
        :root {
            /* Color Palette */
            --primary-blue: #0056b3;
            --light-blue: #e7f1ff;
            --danger-red: #dc3545;
            --danger-bg: #ffebee;
            --success-green: #28a745;
            --success-bg: #d4edda;
            --warning-yellow: #ffc107;
            --text-dark: #212529;
            --text-muted: #6c757d;
            --bg-body: #f4f6f9;
            --card-bg: #ffffff;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* --- Header & Navigation --- */
        header {
            background: linear-gradient(135deg, #004085 0%, #0056b3 100%);
            color: white;
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-title h1 {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .header-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 4px;
        }

        .search-container {
            position: relative;
            width: 300px;
            max-width: 100%;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px;
            border-radius: 25px;
            border: none;
            outline: none;
            font-size: 0.95rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        /* --- Main Layout --- */
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* --- Section Styling --- */
        section {
            background: transparent;
            animation: fadeIn 0.6s ease-out;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge-urgent {
            background-color: var(--danger-red);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
        }

        /* --- Emergency Cards Grid --- */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-top: 4px solid transparent;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .card.critical {
            border-top-color: var(--danger-red);
        }

        .card.critical:hover {
            background-color: var(--danger-bg);
        }

        .card.information {
            border-top-color: var(--primary-blue);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .card-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-dark);
        }

        .card-body {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .red-flag-list {
            list-style: none;
            margin-bottom: 1rem;
        }

        .red-flag-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            margin-bottom: 6px;
            color: var(--danger-red);
            font-weight: 500;
        }

        .red-flag-item::before {
            content: '⚠️';
            font-size: 0.9rem;
        }

        .action-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: var(--success-green);
            color: white;
            text-align: center;
            border-radius: 6px;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            border: none;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            background-color: #218838;
            transform: scale(1.02);
        }

        .card.critical .action-btn {
            background-color: var(--danger-red);
        }
        .card.critical .action-btn:hover {
            background-color: #c82333;
        }

        /* --- Diagnosis Section (Split Layout) --- */
        .diagnosis-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .diagnosis-layout {
                grid-template-columns: 1fr;
            }
        }

        .timeline-box, .table-box {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .time-step {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .time-step:last-child {
            margin-bottom: 0;
        }

        .time-label {
            min-width: 80px;
            font-weight: 700;
            color: var(--primary-blue);
            text-align: right;
            padding-top: 2px;
        }

        .time-content {
            border-left: 2px solid #e9ecef;
            padding-left: 1rem;
            padding-bottom: 0.5rem;
        }

        .symptom-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .symptom-table th {
            text-align: left;
            background-color: var(--light-blue);
            padding: 8px;
            color: var(--primary-blue);
        }

        .symptom-table td {
            border-bottom: 1px solid #e9ecef;
            padding: 8px;
        }

        .symptom-table tr:hover {
            background-color: #f8f9fa;
        }

        /* --- Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            padding: 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transform: translateY(20px);
            transition: var(--transition);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            background-color: var(--primary-blue);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header.critical {
            background-color: var(--danger-red);
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
        }

        .modal-close:hover {
            opacity: 1;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-section-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-top: 1rem;
        }

        .modal-text {
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        .modal-list {
            list-style-position: inside;
            margin-bottom: 1rem;
        }

        .modal-list li {
            margin-bottom: 0.5rem;
        }

        /* --- Animations --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.8rem;
            border-top: 1px solid #e9ecef;
            margin-top: 2rem;
        }

        /* Utilities */
        .highlight-red { color: var(--danger-red); font-weight: bold; }
        .highlight-green { color: var(--success-green); font-weight: bold; }
        .hidden { display: none !important; }

    </style>
</head>
<body>

<header>
    <div class="header-title">
        <h1>Assessment of Dyspnoea</h1>
        <div class="header-subtitle">Straight to the point of care (Last updated: Sep 02, 2025)</div>
    </div>
    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Search conditions (e.g., Asthma, PE)...">
    </div>
</header>

<main>

    <!-- Critical Emergencies Section -->
    <section id="emergencies">
        <div class="section-header">
            <div class="section-title">
                <span class="badge-urgent">Critical</span> Urgent Considerations & Emergencies
            </div>
        </div>
        <div class="grid-container" id="emergencyGrid">
            <!-- Cards injected via JS -->
        </div>
    </section>

    <!-- Diagnostic Approach Section -->
    <section id="diagnosis">
        <div class="section-header">
            <div class="section-title">
                Diagnostic Approach
            </div>
        </div>
        
        <div class="diagnosis-layout">
            <!-- Time Course -->
            <div class="timeline-box">
                <div class="modal-section-title">Time Course Assessment</div>
                <div class="time-step">
                    <div class="time-label">Acute</div>
                    <div class="time-content">
                        <strong>Sudden / Minutes</strong><br>
                        PE, MI, Valve insufficiency, Pneumothorax, Anaphylaxis, Foreign body.
                    </div>
                </div>
                <div class="time-step">
                    <div class="time-label">Subacute</div>
                    <div class="time-content">
                        <strong>Hours to Days</strong><br>
                        Asthma, COPD exacerbation, Pneumonia, Pulmonary oedema.
                    </div>
                </div>
                <div class="time-step">
                    <div class="time-label">Chronic</div>
                    <div class="time-content">
                        <strong>Weeks to Months</strong><br>
                        CHF, COPD, Fibrosis, Pulmonary HTN, Anaemia, Deconditioning.
                    </div>
                </div>
            </div>

            <!-- Associated Symptoms Cheat Sheet -->
            <div class="table-box">
                <div class="modal-section-title">Key Associated Symptoms</div>
                <table class="symptom-table">
                    <thead>
                        <tr>
                            <th>Symptom</th>
                            <th>Indicates</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Chest Pain (Central)</strong></td>
                            <td>ACS, PE, Pneumothorax</td>
                        </tr>
                        <tr>
                            <td><strong>Chest Pain (Pleuritic)</strong></td>
                            <td>Pneumonia, PE, Pleuritis</td>
                        </tr>
                        <tr>
                            <td><strong>Wheezing</strong></td>
                            <td>Asthma, COPD, Anaphylaxis, PE</td>
                        </tr>
                        <tr>
                            <td><strong>Fever</strong></td>
                            <td>Pneumonia, Sepsis, Viral syndromes</td>
                        </tr>
                        <tr>
                            <td><strong>Stridor/Drooling</strong></td>
                            <td>Epiglottitis, Foreign Body</td>
                        </tr>
                        <tr>
                            <td><strong>Haemoptysis</strong></td>
                            <td>Cancer, PE, TB, Bronchiectasis</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Theory / Overview -->
    <section id="overview">
        <div class="section-header">
            <div class="section-title">
                Aetiology Overview
            </div>
        </div>
        <div class="card information" style="cursor: default; transform: none !important;">
            <div class="card-body">
                <p><strong>Acute Common Causes:</strong> Asthma, COPD, Heart Failure, Pneumonia.</p>
                <p style="margin-top: 10px;"><strong>Chronic Common Causes (>1 month):</strong> Pulmonary disease, Cardiovascular disease, Respiratory muscle dysfunction, Psychogenic, Deconditioning/Obesity.</p>
                <p style="margin-top: 10px;"><em>Checklist approach:</em> Respiratory tract (nare to alveoli), Respiratory pump (neuro/musculo), Circulatory system (anemia, pump, vasculature), Diffusion (capillary to mitochondria).</p>
            </div>
        </div>
    </section>

</main>

<footer>
    Disclaimer: This tool is based on BMJ Best Practice (Sep 02, 2025). It is for reference only and does not replace professional clinical judgment.<br>
    Use of this content is subject to the BMJ disclaimer.
</footer>

<!-- Modal for Detailed View -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
        <div class="modal-header" id="modalHeader">
            <div class="modal-title" id="modalTitle">Condition Name</div>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modalBody">
            <!-- Dynamic Content -->
        </div>
    </div>
</div>

<script>
    // Data Source based on the provided text
    const conditionsData = [
        {
            id: 'tension_pneumo',
            title: 'Tension Pneumothorax',
            type: 'critical',
            summary: 'Life-threatening air accumulation.',
            redFlags: ['Sudden-onset dyspnoea', 'Unilateral chest pain', 'Absent breath sounds', 'Tracheal deviation', 'Cardiorespiratory collapse'],
            action: 'IMMEDIATE DECOMPRESSION',
            details: `
                <p>A medical emergency requiring prompt recognition. If a ball-valve mechanism develops, air fills the pleural space, compresses the lung, and shifts the mediastinum.</p>
                <div class="modal-section-title" style="color: var(--danger-red)">Treatment</div>
                <ul class="modal-list">
                    <li>Immediate decompression by placing a large-bore needle into the second intercostal space at the mid-clavicular line (or 4th/5th intercostal space axillary line).</li>
                    <li>This acts as a bridge to tube thoracostomy (definitive treatment).</li>
                </ul>
            `
        },
        {
            id: 'anaphylaxis',
            title: 'Anaphylaxis',
            type: 'critical',
            summary: 'Systemic allergic reaction.',
            redFlags: ['Sudden dyspnoea', 'Stridor/Wheezing', 'Angio-oedema (swelling)', 'Hypotension', 'Rash/Urticaria'],
            action: 'IM ADRENALINE + AIRWAY',
            details: `
                <p>Systemic reaction to medication, food, or insect sting. Prompt treatment is life-saving.</p>
                <div class="modal-section-title" style="color: var(--danger-red)">Immediate Management</div>
                <ul class="modal-list">
                    <li>Remove inciting antigen.</li>
                    <li><strong>Intramuscular adrenaline (epinephrine)</strong> to anterolateral thigh.</li>
                    <li>Airway management (may require intubation).</li>
                    <li>Volume resuscitation.</li>
                </ul>
            `
        },
        {
            id: 'acs',
            title: 'Acute Coronary Syndrome (ACS)',
            type: 'critical',
            summary: 'Heart muscle ischemia/infarction.',
            redFlags: ['Central chest pain (radiating)', 'Dyspnoea without pain (atypical)', 'S3/S4 gallop', 'Pulmonary rales'],
            action: 'REPERFUSION / ASPIRIN',
            details: `
                <p>Dyspnoea accompanying acute coronary disease has negative prognostic significance. Atypical presentations (dyspnoea without pain) are common in women, diabetics, and elderly.</p>
                <div class="modal-section-title">Categories</div>
                <ul class="modal-list">
                    <li><strong>STEMI:</strong> ST-elevation or new LBBB. Needs prompt revascularisation (PCI or fibrinolysis).</li>
                    <li><strong>NSTEMI:</strong> Elevated cardiac enzymes, no ST elevation.</li>
                    <li><strong>Unstable Angina:</strong> Ischaemic changes, normal enzymes.</li>
                </ul>
                <div class="modal-section-title" style="color: var(--success-green)">Treatment</div>
                <p>Aspirin, antiplatelets, beta-blockers, nitrates, anticoagulants.</p>
            `
        },
        {
            id: 'pe',
            title: 'Acute Pulmonary Embolism',
            type: 'critical',
            summary: 'Blockage in pulmonary arteries.',
            redFlags: ['Sudden dyspnoea', 'Pleuritic chest pain', 'Tachycardia/Hypoxaemia', 'Neck vein engorgement', 'Previous DVT/Immobilisation'],
            action: 'ANTICOAGULATION',
            details: `
                <p>Thrombi usually from deep venous system of lower extremities/pelvis. Central emboli may cause central chest pain similar to ACS.</p>
                <div class="modal-section-title">Investigation</div>
                <p><strong>CT pulmonary angiography</strong> is the best investigation.</p>
                <div class="modal-section-title" style="color: var(--success-green)">Management</div>
                <p>Supportive therapies and empirical anticoagulation (unless contraindicated) should be instituted without delay while awaiting confirmation.</p>
            `
        },
        {
            id: 'severe_asthma',
            title: 'Acute Severe Asthma',
            type: 'critical',
            summary: 'Life-threatening bronchospasm.',
            redFlags: ['Peak flow <33-50%', 'Respiratory rate ≥25/min', 'Heart rate ≥110/min', 'Silent chest', 'Exhaustion/Confusion'],
            action: 'OXYGEN + BRONCHODILATORS',
            details: `
                <p>Life-threatening features include altered conscious level, exhaustion, arrhythmia, hypotension, cyanosis, silent chest, or PEFR <30%.</p>
                <div class="modal-section-title" style="color: var(--success-green)">Treatment</div>
                <ul class="modal-list">
                    <li>Titrated supplementary oxygen.</li>
                    <li>High-dose inhaled short-acting beta 2 agonists.</li>
                    <li>Corticosteroids.</li>
                    <li><strong>Ipratropium</strong> for severe exacerbations.</li>
                    <li>IV Magnesium sulfate if unresponsive to initial therapy.</li>
                    <li>Consider intubation/NIV.</li>
                </ul>
            `
        },
        {
            id: 'epiglottitis',
            title: 'Epiglottitis',
            type: 'critical',
            summary: 'Supraglottic cellulitis.',
            redFlags: ['Rapid sore throat', 'Drooling', 'Stridor', 'Tripod positioning', 'Toxic appearance'],
            action: 'SECURE AIRWAY (DO NOT AGITATE)',
            details: `
                <p>Airway emergency. <strong>Do not</strong> examine oral cavity, start IVs, or separate from parents (if child) as crying may exacerbate obstruction.</p>
                <div class="modal-section-title">Management</div>
                <p>Diagnosis is clinical. Secure airway first. Once airway is secure and antibiotics initiated, condition usually resolves rapidly.</p>
            `
        },
        {
            id: 'copd_ex',
            title: 'Severe COPD Exacerbation',
            type: 'critical',
            summary: 'Acute worsening of COPD.',
            redFlags: ['Increased dyspnoea', 'Purulent sputum', 'Accessory muscle use', 'Confusion/Lethargy', 'Cyanosis'],
            action: 'O2 CAUTION + NIV',
            details: `
                <p>Characterised by dyspnoea and/or cough/sputum worsening over <14 days.</p>
                <div class="modal-section-title" style="color: var(--success-green)">Management</div>
                <ul class="modal-list">
                    <li><strong>Short-acting beta-2 agonists</strong> + anticholinergics.</li>
                    <li><strong>Oxygen with caution:</strong> Prevent hypercapnia. Target 88-92%.</li>
                    <li>Systemic corticosteroids.</li>
                    <li>Antibiotics if bacterial infection suspected.</li>
                    <li><strong>Non-invasive ventilation (NIV)</strong> is first-line for respiratory failure if no contraindications.</li>
                </ul>
            `
        },
        {
            id: 'sepsis',
            title: 'Sepsis',
            type: 'critical',
            summary: 'Systemic dysregulated host response.',
            redFlags: ['Tachycardia/Tachypnoea', 'Hypotension', 'Fever/Hypothermia', 'Altered mental state', 'Mottled skin'],
            action: 'ANTIBIOTICS + FLUIDS (1 HR)',
            details: `
                <p>Medical emergency. Early treatment improves outcomes.</p>
                <div class="modal-section-title" style="color: var(--success-green)">Key Interventions (First Hour)</div>
                <ul class="modal-list">
                    <li>Measure lactate; remeasure if elevated (>2 mmol/L).</li>
                    <li>Blood cultures before antibiotics.</li>
                    <li>Broad-spectrum antibiotics (cover MRSA if risk).</li>
                    <li>Rapid crystalloid fluids for hypotension or lactate ≥4 mmol/L.</li>
                    <li>Vasopressors (Noradrenaline) if hypotensive during/after fluids.</li>
                    <li>High flow nasal oxygen for hypoxaemic respiratory failure.</li>
                </ul>
            `
        },
        {
            id: 'chf',
            title: 'Acute Congestive Heart Failure',
            type: 'critical',
            summary: 'Cardiogenic pulmonary oedema.',
            redFlags: ['Dyspnoea (exertion/orthopnoea)', 'Elevated neck veins', 'Peripheral oedema', 'S3 gallop', 'Bibasilar rales'],
            action: 'DIURETICS + NIV',
            details: `
                <p>Acute cardiogenic pulmonary oedema results from increased end-diastolic left ventricular pressure.</p>
                <div class="modal-section-title">Diagnosis</div>
                <ul class="modal-list">
                    <li>CXR: Pulmonary venous congestion, cardiomegaly.</li>
                    <li>Lung US: B-lines strongly suggest oedema.</li>
                    <li><strong>BNP:</strong> Low BNP (<100) helps <em>exclude</em> CHF.</li>
                </ul>
                <div class="modal-section-title" style="color: var(--success-green)">Treatment</div>
                <p>Diuretics, preload/afterload reduction (nitrates, ACE inhibitors), Non-invasive mechanical ventilation.</p>
            `
        },
        {
            id: 'foreign_body',
            title: 'Foreign Body Aspiration',
            type: 'critical',
            summary: 'Airway obstruction.',
            redFlags: ['Choking history', 'Epilepsy/Syncope context', 'Sudden dyspnoea', 'Stridor/Cyanosis'],
            action: 'ABDOMINAL/CHEST THRUSTS',
            details: `
                <p>If airway small (children), may cause life-threatening obstruction leading to asphyxiation.</p>
                <div class="modal-section-title" style="color: var(--success-green)">Management</div>
                <ul class="modal-list">
                    <li><strong>Conscious Adult:</strong> Back blows, then abdominal thrusts.</li>
                    <li><strong>Conscious Infant:</strong> Back blows, then chest thrusts (NO abdominal thrusts).</li>
                    <li><strong>Medical Setting:</strong> Remove foreign body, intubation, or cricothyroidotomy.</li>
                </ul>
            `
        },
        {
            id: 'tamponade',
            title: 'Pericardial Tamponade',
            type: 'critical',
            summary: 'Fluid in pericardial sac.',
            redFlags: ['Neck vein engorgement', 'Shock', 'Tachycardia', 'Dyspnoea', 'Pulsus paradoxus'],
            action: 'PERICARDIOCENTESIS',
            details: `
                <p>May complicate MI (wall rupture), aortic dissection, or pacemaker injury.</p>
                <div class="modal-section-title">Diagnosis</div>
                <p>CXR: Enlarged cardiac silhouette. ECG: Low voltage, PR depression. Echo: Diagnostic.</p>
                <div class="modal-section-title" style="color: var(--success-green)">Treatment</div>
                <p>Urgent pericardiocentesis and/or surgical intervention.</p>
            `
        }
    ];

    // Render Function
    const grid = document.getElementById('emergencyGrid');

    function renderCards(filterText = '') {
        grid.innerHTML = '';
        const lowerFilter = filterText.toLowerCase();

        conditionsData.forEach(condition => {
            if (condition.title.toLowerCase().includes(lowerFilter) || 
                condition.summary.toLowerCase().includes(lowerFilter) ||
                condition.redFlags.some(flag => flag.toLowerCase().includes(lowerFilter))) {
                
                const card = document.createElement('div');
                card.className = `card ${condition.type === 'critical' ? 'critical' : 'information'}`;
                if (condition.id === 'tension_pneumo' || condition.id === 'anaphylaxis') {
                    card.classList.add('pulse-animation');
                }

                // Generate Red Flags HTML
                const flagsHtml = condition.redFlags.slice(0, 3).map(flag => 
                    `<li class="red-flag-item">${flag}</li>`
                ).join('');
                
                const moreFlags = condition.redFlags.length > 3 ? 
                    `<li class="red-flag-item" style="color:var(--text-muted)">+${condition.redFlags.length - 3} more signs...</li>` : '';

                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${condition.title}</div>
                        ${condition.type === 'critical' ? '<span style="color:var(--danger-red)">⚠️</span>' : ''}
                    </div>
                    <div class="card-body">${condition.summary}</div>
                    <ul class="red-flag-list">
                        ${flagsHtml}
                        ${moreFlags}
                    </ul>
                    <button class="action-btn" onclick="openModal('${condition.id}')">
                        ${condition.action}
                    </button>
                `;
                grid.appendChild(card);
            }
        });

        if (grid.innerHTML === '') {
            grid.innerHTML = `<div style="grid-column: 1/-1; text-align:center; color: var(--text-muted); padding: 2rem;">No matching conditions found.</div>`;
        }
    }

    // Search Listener
    document.getElementById('searchInput').addEventListener('input', (e) => {
        renderCards(e.target.value);
    });

    // Modal Logic
    const modal = document.getElementById('modalOverlay');
    const modalHeader = document.getElementById('modalHeader');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    window.openModal = function(id) {
        const data = conditionsData.find(c => c.id === id);
        if (!data) return;

        modalTitle.innerText = data.title;
        modalBody.innerHTML = `
            <p class="modal-text"><strong>Definition:</strong> ${data.summary}</p>
            
            <div class="modal-section-title">Red Flags & Presentation</div>
            <ul class="modal-list">
                ${data.redFlags.map(flag => `<li>${flag}</li>`).join('')}
            </ul>

            ${data.details}
        `;

        if (data.type === 'critical') {
            modalHeader.classList.add('critical');
        } else {
            modalHeader.classList.remove('critical');
        }

        modal.classList.add('active');
    };

    window.closeModal = function() {
        modal.classList.remove('active');
    };

    // Close modal on click outside
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            closeModal();
        }
    });

    // Initial Render
    renderCards();

</script>

</body>
</html>