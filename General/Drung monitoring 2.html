<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Drug Monitoring Quick Reference | UK HMT</title>
  <style>
    :root {
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --border: #e2e8f0;
      --border-hover: #cbd5e1;
      
      --accent: #6366f1;
      --accent-light: #eef2ff;
      
      --danger: #dc2626;
      --danger-bg: #fef2f2;
      --danger-border: #fecaca;
      --danger-dark: #991b1b;
      
      --warning: #d97706;
      --warning-bg: #fffbeb;
      --warning-border: #fde68a;
      --warning-dark: #92400e;
      
      --success: #059669;
      --success-bg: #ecfdf5;
      --success-border: #a7f3d0;
      
      --info: #0284c7;
      --info-bg: #f0f9ff;
      
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 14px;
      --radius-xl: 20px;
      
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.05);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.08), 0 4px 6px -4px rgba(0,0,0,0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.05);
      
      --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --font-mono: 'JetBrains Mono', 'Fira Code', 'SF Mono', Consolas, monospace;
    }

    [data-theme="dark"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-muted: #64748b;
      --border: #334155;
      --border-hover: #475569;
      
      --accent-light: #312e81;
      
      --danger-bg: #450a0a;
      --danger-border: #7f1d1d;
      
      --warning-bg: #451a03;
      --warning-border: #78350f;
      
      --success-bg: #052e16;
      --success-border: #166534;
      
      --info-bg: #0c4a6e;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-sans);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Header */
    header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(12px);
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--accent), #8b5cf6);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }

    .logo-text h1 {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.3px;
    }

    .logo-text span {
      font-size: 12px;
      color: var(--text-muted);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .search-container {
      position: relative;
    }

    .search-box {
      display: flex;
      align-items: center;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 10px 16px;
      gap: 10px;
      min-width: 300px;
      transition: all 0.2s ease;
    }

    .search-box:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-light);
    }

    .search-box input {
      border: none;
      background: none;
      outline: none;
      font-size: 14px;
      color: var(--text-primary);
      width: 100%;
    }

    .search-box input::placeholder {
      color: var(--text-muted);
    }

    .search-box kbd {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 11px;
      font-family: var(--font-mono);
      color: var(--text-muted);
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: var(--bg-secondary);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      font-size: 18px;
    }

    .icon-btn:hover {
      background: var(--bg-tertiary);
      border-color: var(--border-hover);
    }

    /* Stats Bar */
    .stats-bar {
      display: flex;
      align-items: center;
      gap: 24px;
      padding: 12px 24px;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border);
      overflow-x: auto;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .stat-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .stat-dot.danger { background: var(--danger); }
    .stat-dot.warning { background: var(--warning); }
    .stat-dot.success { background: var(--success); }

    .stat-count {
      font-weight: 700;
      font-size: 16px;
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Filter Bar */
    .filter-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 24px;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .filter-bar::-webkit-scrollbar {
      display: none;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--bg-tertiary);
      padding: 4px;
      border-radius: var(--radius-lg);
    }

    .filter-btn {
      padding: 8px 16px;
      border: none;
      background: none;
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .filter-btn:hover {
      color: var(--text-primary);
    }

    .filter-btn.active {
      background: var(--bg-secondary);
      color: var(--text-primary);
      box-shadow: var(--shadow-sm);
    }

    .filter-btn.danger.active {
      background: var(--danger);
      color: white;
    }

    .filter-btn.warning.active {
      background: var(--warning);
      color: white;
    }

    .divider {
      width: 1px;
      height: 24px;
      background: var(--border);
      margin: 0 8px;
    }

    .category-tabs {
      display: flex;
      gap: 4px;
      overflow-x: auto;
    }

    .cat-tab {
      padding: 8px 14px;
      border: 1px solid transparent;
      background: none;
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .cat-tab:hover {
      background: var(--bg-tertiary);
    }

    .cat-tab.active {
      background: var(--accent-light);
      color: var(--accent);
      border-color: var(--accent);
    }

    /* Main Content */
    main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }

    .results-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .results-count {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .results-count strong {
      color: var(--text-primary);
    }

    /* Card Grid */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
      gap: 20px;
    }

    @media (max-width: 500px) {
      .card-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Drug Card */
    .drug-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-md);
      transition: all 0.2s ease;
    }

    .drug-card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .drug-card.danger {
      border-left: 4px solid var(--danger);
    }

    .drug-card.warning {
      border-left: 4px solid var(--warning);
    }

    .drug-card.success {
      border-left: 4px solid var(--success);
    }

    .card-header {
      padding: 16px 20px;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid var(--border);
      background: var(--bg-tertiary);
    }

    .card-header-left {
      flex: 1;
      min-width: 0;
    }

    .drug-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .drug-category {
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .severity-badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .severity-badge.danger {
      background: var(--danger);
      color: white;
    }

    .severity-badge.warning {
      background: var(--warning);
      color: white;
    }

    .severity-badge.success {
      background: var(--success);
      color: white;
    }

    .card-body {
      padding: 16px 20px;
    }

    .info-row {
      display: flex;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-icon {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .info-icon.baseline {
      background: var(--info-bg);
      color: var(--info);
    }

    .info-icon.monitor {
      background: var(--success-bg);
      color: var(--success);
    }

    .info-icon.risks {
      background: var(--warning-bg);
      color: var(--warning);
    }

    .info-content {
      flex: 1;
      min-width: 0;
    }

    .info-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .info-value {
      font-size: 13px;
      color: var(--text-primary);
      line-height: 1.5;
    }

    .risk-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .risk-tag {
      padding: 4px 10px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* Stop Box */
    .stop-box {
      margin: 16px 0 8px;
      padding: 14px 16px;
      border-radius: var(--radius-md);
      border: 1px solid;
    }

    .stop-box.danger {
      background: var(--danger-bg);
      border-color: var(--danger-border);
    }

    .stop-box.warning {
      background: var(--warning-bg);
      border-color: var(--warning-border);
    }

    .stop-header {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }

    .stop-box.danger .stop-header {
      color: var(--danger);
    }

    .stop-box.warning .stop-header {
      color: var(--warning);
    }

    .stop-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .stop-list li {
      font-size: 13px;
      padding-left: 20px;
      position: relative;
      line-height: 1.5;
    }

    .stop-list li::before {
      content: "‚Üí";
      position: absolute;
      left: 0;
      font-weight: bold;
    }

    .stop-box.danger .stop-list li::before {
      color: var(--danger);
    }

    .stop-box.warning .stop-list li::before {
      color: var(--warning);
    }

    /* Highlight */
    .hl {
      background: linear-gradient(120deg, #fef08a 0%, #fde047 100%);
      padding: 1px 5px;
      border-radius: 4px;
      font-weight: 700;
      color: #1e293b;
    }

    [data-theme="dark"] .hl {
      background: linear-gradient(120deg, #854d0e 0%, #a16207 100%);
      color: #fef3c7;
    }

    .threshold {
      font-family: var(--font-mono);
      font-weight: 700;
      background: var(--danger-bg);
      color: var(--danger);
      padding: 1px 6px;
      border-radius: 4px;
      font-size: 12px;
    }

    /* Expandable */
    .expandable {
      margin-top: 12px;
    }

    .expand-toggle {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .expand-toggle:hover {
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .expand-toggle .icon {
      transition: transform 0.2s ease;
    }

    .expand-toggle.open .icon {
      transform: rotate(180deg);
    }

    .expand-content {
      display: none;
      padding: 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 var(--radius-md) var(--radius-md);
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .expand-content.open {
      display: block;
    }

    /* Quick Reference Panel */
    .quick-ref {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 50;
    }

    .quick-ref-toggle {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #8b5cf6);
      color: white;
      border: none;
      box-shadow: var(--shadow-xl);
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .quick-ref-toggle:hover {
      transform: scale(1.05);
    }

    .quick-ref-panel {
      position: absolute;
      bottom: 70px;
      right: 0;
      width: 360px;
      max-height: 70vh;
      overflow-y: auto;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      display: none;
    }

    .quick-ref-panel.open {
      display: block;
    }

    .quick-ref-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .quick-ref-body {
      padding: 16px 20px;
    }

    .quick-pattern {
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      margin-bottom: 12px;
      font-size: 13px;
    }

    .quick-pattern:last-child {
      margin-bottom: 0;
    }

    .quick-pattern-title {
      font-weight: 700;
      margin-bottom: 6px;
      color: var(--text-primary);
    }

    .quick-pattern-text {
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .empty-state h3 {
      font-size: 18px;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .empty-state p {
      font-size: 14px;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--text-primary);
      color: var(--bg-primary);
      padding: 12px 24px;
      border-radius: var(--radius-lg);
      font-size: 14px;
      font-weight: 500;
      box-shadow: var(--shadow-xl);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 200;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-hover);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }

    /* Print Styles */
    @media print {
      header, .quick-ref, .toast {
        display: none !important;
      }

      body {
        background: white;
      }

      .drug-card {
        break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ddd;
      }

      main {
        max-width: 100%;
        padding: 0;
      }

      .card-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-top {
        padding: 12px 16px;
      }

      .logo-text h1 {
        font-size: 15px;
      }

      .search-box {
        min-width: 200px;
      }

      .search-box kbd {
        display: none;
      }

      .stats-bar {
        padding: 10px 16px;
        gap: 16px;
      }

      .filter-bar {
        padding: 10px 16px;
      }

      main {
        padding: 16px;
      }

      .quick-ref-panel {
        width: calc(100vw - 32px);
        right: -8px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-top">
      <div class="logo">
        <div class="logo-icon">üíä</div>
        <div class="logo-text">
          <h1>Drug Monitoring Reference</h1>
          <span>UK HMT Quick Reference Guide</span>
        </div>
      </div>
      
      <div class="header-actions">
        <div class="search-container">
          <div class="search-box">
            <span>üîç</span>
            <input type="search" id="searchInput" placeholder="Search drugs, risks, thresholds..." />
            <kbd>/</kbd>
          </div>
        </div>
        
        <button class="icon-btn" id="themeToggle" title="Toggle dark mode">üåô</button>
        <button class="icon-btn" id="printBtn" title="Print">üñ®Ô∏è</button>
      </div>
    </div>
    
    <div class="stats-bar">
      <div class="stat-item">
        <span class="stat-dot danger"></span>
        <span class="stat-count" id="dangerCount">0</span>
        <span class="stat-label">High Risk</span>
      </div>
      <div class="stat-item">
        <span class="stat-dot warning"></span>
        <span class="stat-count" id="warningCount">0</span>
        <span class="stat-label">Caution</span>
      </div>
      <div class="stat-item">
        <span class="stat-dot success"></span>
        <span class="stat-count" id="totalCount">0</span>
        <span class="stat-label">Total Drugs</span>
      </div>
    </div>
    
    <div class="filter-bar">
      <div class="filter-group">
        <button class="filter-btn active" data-severity="all">All</button>
        <button class="filter-btn danger" data-severity="danger">‚ö†Ô∏è High Risk</button>
        <button class="filter-btn warning" data-severity="warn">‚ö° Caution</button>
      </div>
      
      <div class="divider"></div>
      
      <div class="category-tabs" id="categoryTabs">
        <button class="cat-tab active" data-category="all">All Categories</button>
      </div>
    </div>
  </header>

  <main>
    <div class="results-header">
      <div class="results-count">
        Showing <strong id="visibleCount">0</strong> of <strong id="totalDrugs">0</strong> medications
      </div>
    </div>
    
    <div class="card-grid" id="cardGrid"></div>
    
    <div class="empty-state" id="emptyState" style="display: none;">
      <div class="empty-state-icon">üîç</div>
      <h3>No medications found</h3>
      <p>Try adjusting your search or filters</p>
    </div>
  </main>

  <!-- Quick Reference Panel -->
  <div class="quick-ref">
    <div class="quick-ref-panel" id="quickRefPanel">
      <div class="quick-ref-header">
        <span>üìã Quick Patterns</span>
        <button class="icon-btn" id="closeQuickRef" style="width: 32px; height: 32px;">‚úï</button>
      </div>
      <div class="quick-ref-body">
        <div class="quick-pattern">
          <div class="quick-pattern-title">ü©∏ Cytopenia Pattern</div>
          <div class="quick-pattern-text">
            FBC monitoring ‚Üí <span class="hl">WCC < 3.5</span> or <span class="hl">Plt < 150</span> ‚Üí <strong>STOP</strong>
          </div>
        </div>
        <div class="quick-pattern">
          <div class="quick-pattern-title">üíä ACEi/ARB Pattern</div>
          <div class="quick-pattern-text">
            Cr rise <span class="hl">> 30%</span> or K‚Å∫ <span class="hl">> 6.0</span> ‚Üí <strong>STOP</strong>
          </div>
        </div>
        <div class="quick-pattern">
          <div class="quick-pattern-title">‚ö†Ô∏è Methotrexate + Dyspnoea</div>
          <div class="quick-pattern-text">
            Treat as <span class="hl">pneumonitis</span> until proven otherwise
          </div>
        </div>
        <div class="quick-pattern">
          <div class="quick-pattern-title">üß™ Aminoglycoside Toxicity</div>
          <div class="quick-pattern-text">
            Monitor levels + U&E ‚Üí <span class="hl">nephrotoxicity</span> / <span class="hl">ototoxicity</span>
          </div>
        </div>
        <div class="quick-pattern">
          <div class="quick-pattern-title">‚ö° Clozapine Rule</div>
          <div class="quick-pattern-text">
            Weekly FBC mandatory ‚Üí Protocol breach = <span class="hl">STOP</span>
          </div>
        </div>
      </div>
    </div>
    <button class="quick-ref-toggle" id="quickRefToggle" title="Quick Reference Patterns">
      üìã
    </button>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // Data
    const data = [
      {
        category: "Conventional DMARDs",
        drug: "Methotrexate",
        baseline: "FBC, U&E, LFTs, CXR ¬± Hep B/C",
        monitoring: "Every 2 weeks until stable ‚Üí monthly ‚Üí 2‚Äì3 monthly",
        keyRisks: ["Myelosuppression", "Hepatotoxicity", "Pneumonitis", "Mucositis"],
        action: [
          "Stop if WCC < 3.5 or Plt < 150",
          "Stop if ALT/AST > 2‚Äì3√ó ULN (trend matters)",
          "New dyspnoea/cough/fever: stop and urgent assessment ¬± CXR for pneumonitis"
        ],
        highlight: ["WCC < 3.5", "Plt < 150", "ALT/AST > 2‚Äì3√ó ULN", "pneumonitis"],
        severity: "danger"
      },
      {
        category: "Conventional DMARDs",
        drug: "Sulfasalazine",
        baseline: "FBC, LFTs",
        monitoring: "Every 2‚Äì4 weeks √ó 3 months ‚Üí then 3 monthly",
        keyRisks: ["Agranulocytosis", "Hepatitis", "Rash"],
        action: [
          "Stop if neutrophils < 2.0",
          "Stop if ALT/AST > 2√ó ULN"
        ],
        highlight: ["neutrophils < 2.0", "ALT/AST > 2√ó ULN"],
        severity: "warn"
      },
      {
        category: "Conventional DMARDs",
        drug: "Leflunomide",
        baseline: "FBC, LFT, BP",
        monitoring: "Every 2 weeks √ó 6 months ‚Üí then monthly",
        keyRisks: ["Hepatotoxicity", "Hypertension", "Cytopenia"],
        action: [
          "Stop if ALT/AST > 3√ó ULN",
          "Severe toxicity: cholestyramine washout (specialist-led)"
        ],
        highlight: ["ALT/AST > 3√ó ULN", "cholestyramine washout"],
        severity: "danger"
      },
      {
        category: "Conventional DMARDs",
        drug: "Hydroxychloroquine",
        baseline: "Baseline ophthalmic assessment",
        monitoring: "Annual eye review after 5 years (earlier if high-risk)",
        keyRisks: ["Retinopathy"],
        action: ["Stop if OCT/visual field changes consistent with toxicity"],
        highlight: ["retinopathy", "OCT", "visual field"],
        severity: "warn"
      },
      {
        category: "Conventional DMARDs",
        drug: "Azathioprine",
        baseline: "TPMT activity (or genotype), FBC, LFT",
        monitoring: "Weekly initially ‚Üí monthly ‚Üí then 3 monthly",
        keyRisks: ["Myelosuppression", "Hepatitis", "Pancreatitis"],
        action: [
          "Dose reduce/stop if neutropenia or significant LFT derangement",
          "Acute pancreatitis symptoms: stop and assess"
        ],
        highlight: ["TPMT", "myelosuppression", "pancreatitis"],
        severity: "danger"
      },
      {
        category: "Conventional DMARDs",
        drug: "Mycophenolate mofetil",
        baseline: "FBC, LFT (¬± renal function)",
        monitoring: "Weekly initially ‚Üí monthly ‚Üí then 3 monthly",
        keyRisks: ["Cytopenia", "Infection"],
        action: [
          "Dose reduce/stop if cytopenias",
          "Hold during serious infection"
        ],
        highlight: ["cytopenia", "serious infection"],
        severity: "warn"
      },
      {
        category: "Biologics & JAK inhibitors",
        drug: "Anti-TNF agents",
        baseline: "TB screening (IGRA ¬± CXR), Hep B/C ¬± HIV; vaccinate",
        monitoring: "Clinical infection screen; periodic bloods (3‚Äì6 monthly)",
        keyRisks: ["TB reactivation", "Serious infection", "Heart failure worsening"],
        action: [
          "Hold during serious infection",
          "Investigate persistent fever/cough/night sweats: TB until proven otherwise"
        ],
        highlight: ["TB reactivation", "hold during serious infection"],
        severity: "danger"
      },
      {
        category: "Biologics & JAK inhibitors",
        drug: "Rituximab",
        baseline: "Hepatitis B status, immunoglobulins",
        monitoring: "FBC; IgG periodically (esp. recurrent infections)",
        keyRisks: ["Hypogammaglobulinaemia", "Infection"],
        action: ["Delay/review dosing if low IgG + infections; consider immunology input"],
        highlight: ["IgG", "hypogammaglobulinaemia"],
        severity: "warn"
      },
      {
        category: "Biologics & JAK inhibitors",
        drug: "JAK inhibitors",
        baseline: "FBC, LFT, lipids; VTE risk assessment; screen infections",
        monitoring: "FBC/LFT at 4‚Äì8 weeks then ~3 monthly; lipids after initiation",
        keyRisks: ["VTE", "Herpes zoster", "Cytopenia"],
        action: [
          "Stop/withhold if significant cytopenia",
          "New VTE symptoms: urgent assessment and stop pending review"
        ],
        highlight: ["VTE", "zoster", "cytopenia"],
        severity: "danger"
      },
      {
        category: "Cardiovascular",
        drug: "ACE inhibitor / ARB",
        baseline: "U&E, K‚Å∫, creatinine/eGFR",
        monitoring: "Recheck U&E/K‚Å∫ at 1‚Äì2 weeks after start/dose change",
        keyRisks: ["AKI", "Hyperkalaemia"],
        action: [
          "Stop if K‚Å∫ > 6.0 mmol/L",
          "Stop/adjust if creatinine rises > 30% from baseline"
        ],
        highlight: ["K‚Å∫ > 6.0", "creatinine rises > 30%"],
        severity: "danger"
      },
      {
        category: "Cardiovascular",
        drug: "Loop/thiazide diuretics",
        baseline: "U&E",
        monitoring: "U&E 1‚Äì2 weeks after start/change; then based on stability",
        keyRisks: ["Hyponatraemia", "Hypokalaemia", "AKI"],
        action: ["Correct electrolytes; reduce/withhold if severe derangement or AKI"],
        highlight: ["hyponatraemia", "hypokalaemia", "AKI"],
        severity: "warn"
      },
      {
        category: "Cardiovascular",
        drug: "Spironolactone",
        baseline: "U&E, K‚Å∫",
        monitoring: "U&E/K‚Å∫ at ~1 week; then monthly √ó 3; then 3‚Äì6 monthly",
        keyRisks: ["Hyperkalaemia", "Gynaecomastia"],
        action: [
          "Stop if K‚Å∫ > 5.5 mmol/L",
          "Review interacting meds (ACEi/ARB, NSAIDs)"
        ],
        highlight: ["K‚Å∫ > 5.5", "interacting meds"],
        severity: "danger"
      },
      {
        category: "Cardiovascular",
        drug: "Digoxin",
        baseline: "U&E, ECG (level only if indicated)",
        monitoring: "Digoxin level if toxicity suspected, renal dysfunction, or interactions",
        keyRisks: ["Arrhythmias", "Nausea/vomiting", "Confusion", "Visual disturbance"],
        action: ["Hold drug; check digoxin level and K‚Å∫; treat arrhythmia supportively"],
        highlight: ["toxicity suspected", "digoxin level", "K‚Å∫"],
        severity: "warn"
      },
      {
        category: "Cardiovascular",
        drug: "Amiodarone",
        baseline: "TFT, LFT, CXR (¬± ECG)",
        monitoring: "TFT + LFT every 6 months; assess respiratory symptoms",
        keyRisks: ["Hypo-/hyperthyroidism", "Pulmonary toxicity", "Hepatitis"],
        action: [
          "Suspected pulmonary toxicity: stop and urgent assessment",
          "Significant LFT derangement: review/stop"
        ],
        highlight: ["pulmonary toxicity", "TFT every 6 months"],
        severity: "danger"
      },
      {
        category: "Anticoagulation",
        drug: "Warfarin",
        baseline: "Baseline INR (and interacting meds/bleeding risk)",
        monitoring: "INR frequency depends on stability (weekly ‚Üí 4‚Äì12 weekly)",
        keyRisks: ["Bleeding", "Drug/food interactions"],
        action: ["Bleeding: manage per INR/clinical severity (hold ¬± reversal)"],
        highlight: ["INR", "reversal"],
        severity: "danger"
      },
      {
        category: "Anticoagulation",
        drug: "DOACs",
        baseline: "U&E/eGFR, LFT, weight",
        monitoring: "Renal function at least annually (more if CKD/elderly/frail)",
        keyRisks: ["Bleeding", "Accumulation with renal impairment"],
        action: ["Dose adjust or switch if eGFR declines below product thresholds"],
        highlight: ["renal function", "dose adjust"],
        severity: "warn"
      },
      {
        category: "Anticoagulation",
        drug: "Heparin (UFH/LMWH)",
        baseline: "FBC/platelets, U&E, APTT for UFH",
        monitoring: "Platelets day 5‚Äì10 for HIT risk; APTT for UFH titration",
        keyRisks: ["HIT", "Bleeding"],
        action: ["Suspected HIT: stop all heparin immediately; alternative anticoagulant"],
        highlight: ["HIT", "stop all heparin"],
        severity: "danger"
      },
      {
        category: "Endocrine & metabolic",
        drug: "Lithium",
        baseline: "U&E/eGFR, TFT, calcium, weight",
        monitoring: "Lithium level every 3 months; U&E/TFT 6 monthly",
        keyRisks: ["Toxicity", "Nephrogenic DI", "Hypothyroidism"],
        action: [
          "Toxicity suspected or level > 1.5 mmol/L: stop and urgent assessment",
          "Avoid dehydration/NSAIDs/ACEi/thiazides"
        ],
        highlight: ["level > 1.5", "NSAIDs", "thiazides"],
        severity: "danger"
      },
      {
        category: "Endocrine & metabolic",
        drug: "Metformin",
        baseline: "eGFR, B12 (if risk factors/long-term use)",
        monitoring: "eGFR at least annually; B12 periodically",
        keyRisks: ["Lactic acidosis (risk ‚Üë in AKI/hypoxia)", "B12 deficiency"],
        action: [
          "Stop if eGFR < 30 mL/min/1.73m¬≤",
          "Hold during acute illness causing dehydration/hypoxia/AKI"
        ],
        highlight: ["eGFR < 30", "hold during acute illness"],
        severity: "danger"
      },
      {
        category: "Endocrine & metabolic",
        drug: "Thionamides (carbimazole/PTU)",
        baseline: "FBC, TFT, LFT (PTU particularly)",
        monitoring: "TFT every 4‚Äì6 weeks until stable; FBC if symptoms",
        keyRisks: ["Agranulocytosis", "Hepatitis (PTU)"],
        action: [
          "Sore throat/fever/mouth ulcers: stop and urgent FBC",
          "Jaundice/marked LFT rise: stop and assess"
        ],
        highlight: ["sore throat/fever", "stop and urgent FBC"],
        severity: "danger"
      },
      {
        category: "Antimicrobials",
        drug: "Gentamicin",
        baseline: "U&E/eGFR, weight; baseline hearing risk",
        monitoring: "Drug levels per protocol + U&E during therapy",
        keyRisks: ["Nephrotoxicity", "Ototoxicity"],
        action: ["Adjust dose/interval by levels and renal function; stop if toxicity"],
        highlight: ["drug levels", "nephrotoxicity", "ototoxicity"],
        severity: "danger"
      },
      {
        category: "Antimicrobials",
        drug: "Vancomycin",
        baseline: "U&E/eGFR, weight",
        monitoring: "Trough levels + renal function during treatment",
        keyRisks: ["Nephrotoxicity"],
        action: ["Adjust dosing by levels; review if rising creatinine"],
        highlight: ["trough levels", "rising creatinine"],
        severity: "warn"
      },
      {
        category: "Antimicrobials",
        drug: "Linezolid",
        baseline: "FBC",
        monitoring: "Weekly FBC if prolonged therapy",
        keyRisks: ["Thrombocytopenia", "Anaemia", "Serotonin syndrome"],
        action: ["Stop if significant cytopenia; review serotonergic meds"],
        highlight: ["weekly FBC", "thrombocytopenia"],
        severity: "warn"
      },
      {
        category: "Antimicrobials",
        drug: "Isoniazid",
        baseline: "LFT (esp. liver disease/EtOH), neuropathy risk",
        monitoring: "LFT if symptomatic/high risk; clinical review",
        keyRisks: ["Hepatitis", "Peripheral neuropathy"],
        action: [
          "Stop if ALT/AST > 3√ó ULN with symptoms",
          "Give pyridoxine if neuropathy risk"
        ],
        highlight: ["ALT/AST > 3√ó ULN", "pyridoxine"],
        severity: "warn"
      },
      {
        category: "Other high-risk",
        drug: "Valproate",
        baseline: "LFT, platelets",
        monitoring: "LFT/platelets periodically; assess symptoms",
        keyRisks: ["Hepatotoxicity", "Thrombocytopenia", "Pancreatitis"],
        action: ["Stop if significant LFT derangement, bleeding/cytopenia, or pancreatitis"],
        highlight: ["hepatotoxicity", "thrombocytopenia", "pancreatitis"],
        severity: "danger"
      },
      {
        category: "Other high-risk",
        drug: "Carbamazepine",
        baseline: "FBC, U&E (Na‚Å∫), LFT",
        monitoring: "FBC/Na‚Å∫ periodically; sooner if symptomatic",
        keyRisks: ["Agranulocytosis", "SIADH ‚Üí hyponatraemia"],
        action: ["Stop if significant neutropenia; manage hyponatraemia"],
        highlight: ["neutropenia", "SIADH", "hyponatraemia"],
        severity: "danger"
      },
      {
        category: "Other high-risk",
        drug: "Clozapine",
        baseline: "FBC (strict protocol), ECG where indicated",
        monitoring: "FBC per mandatory schedule (weekly initially ‚Üí spaced)",
        keyRisks: ["Agranulocytosis", "Myocarditis", "Constipation/ileus"],
        action: [
          "Any protocol breach/cytopenia: stop per clozapine service",
          "Chest pain/dyspnoea early: urgent myocarditis workup"
        ],
        highlight: ["mandatory schedule", "myocarditis", "ileus"],
        severity: "danger"
      }
    ];

    // State
    let currentSeverity = 'all';
    let currentCategory = 'all';
    let searchQuery = '';

    // DOM Elements
    const searchInput = document.getElementById('searchInput');
    const cardGrid = document.getElementById('cardGrid');
    const emptyState = document.getElementById('emptyState');
    const categoryTabs = document.getElementById('categoryTabs');
    const quickRefToggle = document.getElementById('quickRefToggle');
    const quickRefPanel = document.getElementById('quickRefPanel');
    const closeQuickRef = document.getElementById('closeQuickRef');
    const themeToggle = document.getElementById('themeToggle');
    const printBtn = document.getElementById('printBtn');
    const toast = document.getElementById('toast');

    // Initialize categories
    const categories = [...new Set(data.map(d => d.category))].sort();
    categories.forEach(cat => {
      const btn = document.createElement('button');
      btn.className = 'cat-tab';
      btn.dataset.category = cat;
      btn.textContent = cat;
      categoryTabs.appendChild(btn);
    });

    // Update stats
    function updateStats() {
      const dangerCount = data.filter(d => d.severity === 'danger').length;
      const warnCount = data.filter(d => d.severity === 'warn').length;
      document.getElementById('dangerCount').textContent = dangerCount;
      document.getElementById('warningCount').textContent = warnCount;
      document.getElementById('totalCount').textContent = data.length;
      document.getElementById('totalDrugs').textContent = data.length;
    }

    // Escape HTML
    function escapeHtml(str) {
      return (str || '').toString()
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Highlight text
    function highlightText(text, highlights) {
      if (!text) return '';
      let result = escapeHtml(text);
      (highlights || []).forEach(h => {
        if (!h) return;
        const regex = new RegExp(h.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
        result = result.replace(regex, match => `<span class="hl">${match}</span>`);
      });
      return result;
    }

    // Create card HTML
    function createCard(drug) {
      const severityClass = drug.severity === 'danger' ? 'danger' : (drug.severity === 'warn' ? 'warning' : 'success');
      const severityLabel = drug.severity === 'danger' ? 'HIGH RISK' : (drug.severity === 'warn' ? 'CAUTION' : 'ROUTINE');
      
      const riskTags = (drug.keyRisks || []).map(r => 
        `<span class="risk-tag">${escapeHtml(r)}</span>`
      ).join('');
      
      const actionItems = (drug.action || []).map(a => 
        `<li>${highlightText(a, drug.highlight)}</li>`
      ).join('');

      return `
        <div class="drug-card ${severityClass}">
          <div class="card-header">
            <div class="card-header-left">
              <div class="drug-name">${escapeHtml(drug.drug)}</div>
              <div class="drug-category">
                <span>üìÅ</span> ${escapeHtml(drug.category)}
              </div>
            </div>
            <span class="severity-badge ${severityClass}">${severityLabel}</span>
          </div>
          
          <div class="card-body">
            <div class="info-row">
              <div class="info-icon baseline">üî¨</div>
              <div class="info-content">
                <div class="info-label">Baseline Tests</div>
                <div class="info-value">${highlightText(drug.baseline, drug.highlight)}</div>
              </div>
            </div>
            
            <div class="info-row">
              <div class="info-icon monitor">üìÖ</div>
              <div class="info-content">
                <div class="info-label">Monitoring Schedule</div>
                <div class="info-value">${highlightText(drug.monitoring, drug.highlight)}</div>
              </div>
            </div>
            
            <div class="info-row">
              <div class="info-icon risks">‚ö°</div>
              <div class="info-content">
                <div class="info-label">Key Risks</div>
                <div class="risk-tags">${riskTags || '<span class="risk-tag">‚Äî</span>'}</div>
              </div>
            </div>
            
            <div class="stop-box ${severityClass}">
              <div class="stop-header">
                <span>${drug.severity === 'danger' ? 'üö®' : '‚ö†Ô∏è'}</span>
                <span>${drug.severity === 'danger' ? 'STOP / URGENT ACTION' : 'ACTION REQUIRED'}</span>
              </div>
              <ul class="stop-list">
                ${actionItems || '<li>Monitor as directed</li>'}
              </ul>
            </div>
            
            <div class="expandable">
              <button class="expand-toggle" onclick="this.classList.toggle('open'); this.nextElementSibling.classList.toggle('open');">
                <span>üí° Exam Tip</span>
                <span class="icon">‚ñº</span>
              </button>
              <div class="expand-content">
                <strong>Viva framework:</strong> State <em>baseline tests</em>, then <em>first recheck interval</em>, then <em>stop thresholds</em>.<br><br>
                "For <strong>${escapeHtml(drug.drug)}</strong>, I'd check [baseline] and recheck at [interval]; I'd stop if [threshold]..."
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Filter and render
    function render() {
      const filtered = data.filter(drug => {
        // Severity filter
        if (currentSeverity !== 'all' && drug.severity !== currentSeverity) return false;
        
        // Category filter
        if (currentCategory !== 'all' && drug.category !== currentCategory) return false;
        
        // Search filter
        if (searchQuery) {
          const searchText = [
            drug.drug,
            drug.category,
            drug.baseline,
            drug.monitoring,
            ...(drug.keyRisks || []),
            ...(drug.action || [])
          ].join(' ').toLowerCase();
          if (!searchText.includes(searchQuery.toLowerCase())) return false;
        }
        
        return true;
      });

      document.getElementById('visibleCount').textContent = filtered.length;

      if (filtered.length === 0) {
        cardGrid.innerHTML = '';
        emptyState.style.display = 'block';
      } else {
        emptyState.style.display = 'none';
        cardGrid.innerHTML = filtered.map(createCard).join('');
      }
    }

    // Event Listeners
    searchInput.addEventListener('input', (e) => {
      searchQuery = e.target.value.trim();
      render();
    });

    // Severity filter buttons
    document.querySelectorAll('.filter-btn[data-severity]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn[data-severity]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentSeverity = btn.dataset.severity;
        render();
      });
    });

    // Category tabs
    categoryTabs.addEventListener('click', (e) => {
      if (e.target.classList.contains('cat-tab')) {
        document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        currentCategory = e.target.dataset.category;
        render();
      }
    });

    // Quick reference panel
    quickRefToggle.addEventListener('click', () => {
      quickRefPanel.classList.toggle('open');
    });

    closeQuickRef.addEventListener('click', () => {
      quickRefPanel.classList.remove('open');
    });

    // Theme toggle
    themeToggle.addEventListener('click', () => {
      const isDark = document.body.dataset.theme === 'dark';
      document.body.dataset.theme = isDark ? '' : 'dark';
      themeToggle.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
      showToast(isDark ? 'Light mode enabled' : 'Dark mode enabled');
    });

    // Print
    printBtn.addEventListener('click', () => window.print());

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === '/' && document.activeElement !== searchInput) {
        e.preventDefault();
        searchInput.focus();
      }
      if (e.key === 'Escape') {
        searchInput.value = '';
        searchQuery = '';
        searchInput.blur();
        render();
      }
    });

    // Toast notification
    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // Initialize
    updateStats();
    render();
  </script>
</body>
</html>