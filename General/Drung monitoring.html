<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UK HMT Drug Monitoring ‚Äì Quick Reference</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --border:#e2e8f0;

      --card:#f8fafc;
      --card2:#f1f5f9;

      --hi:#fff3b0;        /* highlight */
      --danger-bg:#fff1f2;
      --danger:#b91c1c;

      --warn-bg:#fffbeb;
      --warn:#b45309;

      --ok-bg:#ecfeff;
      --ok:#0e7490;

      --badge:#0ea5e9;
      --badgeText:#ffffff;

      --shadow: 0 10px 24px rgba(2,6,23,.08);
      --radius: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background:var(--bg);
      color:var(--text);
      line-height:1.35;
    }

    header{
      position:sticky;
      top:0;
      z-index:10;
      background:linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.90));
      border-bottom:1px solid var(--border);
      backdrop-filter: blur(6px);
    }

    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:18px 18px;
    }

    .titleRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      flex-wrap:wrap;
    }

    h1{
      margin:0;
      font-size:20px;
      letter-spacing:.2px;
    }

    .sub{
      margin:6px 0 0 0;
      color:var(--muted);
      font-size:13px;
      max-width:900px;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .search{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      min-width:280px;
      box-shadow: 0 1px 0 rgba(2,6,23,.03);
    }
    .search input{
      border:none;
      outline:none;
      width:100%;
      font-size:14px;
    }

    select, button{
      border:1px solid var(--border);
      background:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
    }
    button{
      background:#0f172a;
      color:#fff;
      border-color:#0f172a;
    }
    button.secondary{
      background:#fff;
      color:var(--text);
      border-color:var(--border);
    }
    button:active{transform:translateY(1px)}

    main{ padding:18px 0 36px; }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media(min-width: 980px){
      .grid{ grid-template-columns: 1fr 1fr; }
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .cardHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 14px 12px;
      background:var(--card2);
      border-bottom:1px solid var(--border);
    }

    .cardHead .left{
      display:flex;
      gap:10px;
      align-items:center;
      min-width:0;
    }

    .badge{
      background:var(--badge);
      color:var(--badgeText);
      font-weight:700;
      font-size:11px;
      padding:5px 10px;
      border-radius:999px;
      letter-spacing:.3px;
      white-space:nowrap;
    }

    .cardHead h2{
      margin:0;
      font-size:14px;
      font-weight:800;
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .cardHead .meta{
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    .rows{ padding:12px 14px 14px; }
    .row{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap:10px;
      padding:10px 0;
      border-bottom:1px dashed rgba(148,163,184,.65);
    }
    .row:last-child{ border-bottom:none; padding-bottom:0; }

    .k{
      color:var(--muted);
      font-size:12px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.5px;
    }
    .v{
      font-size:13px;
    }

    .pill{
      display:inline-block;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      font-size:12px;
      margin:2px 6px 2px 0;
    }

    .hl{
      background:var(--hi);
      padding:1px 4px;
      border-radius:6px;
      box-decoration-break: clone;
      -webkit-box-decoration-break: clone;
      font-weight:800;
    }

    .danger{
      background:var(--danger-bg);
      border:1px solid rgba(185,28,28,.25);
      color:var(--danger);
      padding:8px 10px;
      border-radius:12px;
      font-weight:800;
      margin-top:8px;
    }
    .warn{
      background:var(--warn-bg);
      border:1px solid rgba(180,83,9,.25);
      color:var(--warn);
      padding:8px 10px;
      border-radius:12px;
      font-weight:800;
      margin-top:8px;
    }
    .ok{
      background:var(--ok-bg);
      border:1px solid rgba(14,116,144,.25);
      color:var(--ok);
      padding:8px 10px;
      border-radius:12px;
      font-weight:800;
      margin-top:8px;
    }

    details{
      margin-top:10px;
      border:1px solid var(--border);
      background:#fff;
      border-radius:12px;
      padding:10px 12px;
    }
    summary{
      cursor:pointer;
      font-weight:800;
      font-size:13px;
    }
    .small{
      font-size:12px;
      color:var(--muted);
      margin-top:8px;
    }

    .footer{
      margin-top:18px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .hidden{ display:none !important; }

    /* Print */
    @media print{
      header{ position:static; }
      button, select, .search{ display:none !important; }
      .card{ box-shadow:none; }
      body{ background:#fff; }
      .wrap{ max-width:100%; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="titleRow">
        <div>
          <h1>UK HMT Drug Monitoring ‚Äì Quick Reference</h1>
          <p class="sub">
            White-background revision sheet with colour contrast for risk. Use search + category filters.
            <span class="hl">Stop thresholds and red flags</span> are highlighted.
          </p>
        </div>

        <div class="controls">
          <div class="search" title="Search drug name or adverse effect">
            üîé <input id="q" type="search" placeholder="Search (e.g., methotrexate, hyperkalaemia, ALT)" />
          </div>
          <select id="cat">
            <option value="all">All categories</option>
          </select>
          <button id="reset" class="secondary" title="Clear filters">Reset</button>
          <button id="print" title="Print / Save as PDF">Print</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div class="grid" id="grid"></div>

      <div class="footer">
        <div>
          Tip patterns:
          <span class="pill"><b>Cytopenia</b> ‚Üí FBC ‚Üí <span class="hl">STOP</span></span>
          <span class="pill"><b>ACEi/ARB</b> ‚Üí Cr rise <span class="hl">&gt;30%</span> or K‚Å∫ <span class="hl">&gt;6.0</span> ‚Üí STOP</span>
          <span class="pill"><b>MTX</b> + dyspnoea ‚Üí treat as <span class="hl">pneumonitis</span> until proven otherwise</span>
        </div>
        <div>Last updated: <span id="stamp"></span></div>
      </div>
    </div>
  </main>

  <script>
    const data = [
      // 1) Conventional DMARDs
      {
        category: "Conventional DMARDs",
        drug: "Methotrexate",
        baseline: "FBC, U&E, LFTs, CXR ¬± Hep B/C (local protocol)",
        monitoring: "Every 2 weeks until stable ‚Üí monthly ‚Üí 2‚Äì3 monthly",
        keyRisks: [
          "Myelosuppression", "Hepatotoxicity", "Pneumonitis", "Mucositis"
        ],
        action: [
          "Stop if WCC < 3.5 or Plt < 150",
          "Stop if ALT/AST > 2‚Äì3√ó ULN (trend matters)",
          "New dyspnoea/cough/fever: stop and urgent assessment ¬± CXR for pneumonitis"
        ],
        highlight: [
          "WCC < 3.5", "Plt < 150", "ALT/AST > 2‚Äì3√ó ULN", "pneumonitis"
        ],
        severity: "danger"
      },
      {
        category: "Conventional DMARDs",
        drug: "Sulfasalazine",
        baseline: "FBC, LFTs",
        monitoring: "Every 2‚Äì4 weeks √ó 3 months ‚Üí then 3 monthly",
        keyRisks: ["Agranulocytosis", "Hepatitis", "Rash"],
        action: [
          "Stop if neutrophils < 2.0",
          "Stop if ALT/AST > 2√ó ULN"
        ],
        highlight: ["neutrophils < 2.0", "ALT/AST > 2√ó ULN"],
        severity: "warn"
      },
      {
        category: "Conventional DMARDs",
        drug: "Leflunomide",
        baseline: "FBC, LFT, BP",
        monitoring: "Every 2 weeks √ó 6 months ‚Üí then monthly (common UK pattern)",
        keyRisks: ["Hepatotoxicity", "Hypertension", "Cytopenia"],
        action: [
          "Stop if ALT/AST > 3√ó ULN",
          "Severe toxicity: cholestyramine washout (specialist-led)"
        ],
        highlight: ["ALT/AST > 3√ó ULN", "cholestyramine washout"],
        severity: "danger"
      },
      {
        category: "Conventional DMARDs",
        drug: "Hydroxychloroquine",
        baseline: "Baseline ophthalmic assessment (local policy)",
        monitoring: "Annual eye review after 5 years (earlier if high-risk)",
        keyRisks: ["Retinopathy"],
        action: [
          "Stop if OCT/visual field changes consistent with toxicity"
        ],
        highlight: ["retinopathy", "OCT", "visual field"],
        severity: "warn"
      },
      {
        category: "Conventional DMARDs",
        drug: "Azathioprine",
        baseline: "TPMT activity (or genotype), FBC, LFT",
        monitoring: "Weekly initially ‚Üí monthly ‚Üí then 3 monthly",
        keyRisks: ["Myelosuppression", "Hepatitis", "Pancreatitis"],
        action: [
          "Dose reduce/stop if neutropenia or significant LFT derangement",
          "Acute pancreatitis symptoms: stop and assess"
        ],
        highlight: ["TPMT", "myelosuppression", "pancreatitis"],
        severity: "danger"
      },
      {
        category: "Conventional DMARDs",
        drug: "Mycophenolate mofetil",
        baseline: "FBC, LFT (¬± renal function depending indication)",
        monitoring: "Weekly initially ‚Üí monthly ‚Üí then 3 monthly",
        keyRisks: ["Cytopenia", "Infection"],
        action: [
          "Dose reduce/stop if cytopenias",
          "Hold during serious infection"
        ],
        highlight: ["cytopenia", "serious infection"],
        severity: "warn"
      },

      // 2) Biologics / targeted
      {
        category: "Biologics & JAK inhibitors",
        drug: "Anti-TNF agents (e.g., adalimumab, infliximab)",
        baseline: "TB screening (IGRA ¬± CXR), Hep B/C ¬± HIV; vaccinate as appropriate",
        monitoring: "Clinical infection screen; periodic bloods per local policy (often 3‚Äì6 monthly)",
        keyRisks: ["TB reactivation", "Serious infection", "Heart failure worsening"],
        action: [
          "Hold during serious infection",
          "Investigate persistent fever/cough/night sweats: TB until proven otherwise"
        ],
        highlight: ["TB reactivation", "hold during serious infection"],
        severity: "danger"
      },
      {
        category: "Biologics & JAK inhibitors",
        drug: "Rituximab",
        baseline: "Hepatitis B status (reactivation risk), immunoglobulins",
        monitoring: "FBC; IgG periodically (esp. recurrent infections)",
        keyRisks: ["Hypogammaglobulinaemia", "Infection"],
        action: [
          "Delay/review dosing if low IgG + infections; consider immunology input"
        ],
        highlight: ["IgG", "hypogammaglobulinaemia"],
        severity: "warn"
      },
      {
        category: "Biologics & JAK inhibitors",
        drug: "JAK inhibitors",
        baseline: "FBC, LFT, lipids; VTE risk assessment; screen infections per local protocol",
        monitoring: "FBC/LFT at 4‚Äì8 weeks then ~3 monthly; lipids after initiation",
        keyRisks: ["VTE", "Herpes zoster", "Cytopenia"],
        action: [
          "Stop/withhold if significant cytopenia",
          "New VTE symptoms: urgent assessment and stop pending review"
        ],
        highlight: ["VTE", "zoster", "cytopenia"],
        severity: "danger"
      },

      // 3) Cardiovascular
      {
        category: "Cardiovascular",
        drug: "ACE inhibitor / ARB",
        baseline: "U&E, K‚Å∫, creatinine/eGFR",
        monitoring: "Recheck U&E/K‚Å∫ at 1‚Äì2 weeks after start or dose change (then periodically)",
        keyRisks: ["AKI", "Hyperkalaemia"],
        action: [
          "Stop if K‚Å∫ > 6.0 mmol/L",
          "Stop/adjust if creatinine rises > 30% from baseline"
        ],
        highlight: ["K‚Å∫ > 6.0", "creatinine rises > 30%"],
        severity: "danger"
      },
      {
        category: "Cardiovascular",
        drug: "Loop/thiazide diuretics",
        baseline: "U&E",
        monitoring: "U&E 1‚Äì2 weeks after start/change; then based on stability/risk",
        keyRisks: ["Hyponatraemia", "Hypokalaemia", "AKI"],
        action: [
          "Correct electrolytes; reduce/withhold if severe derangement or AKI"
        ],
        highlight: ["hyponatraemia", "hypokalaemia", "AKI"],
        severity: "warn"
      },
      {
        category: "Cardiovascular",
        drug: "Spironolactone",
        baseline: "U&E, K‚Å∫",
        monitoring: "U&E/K‚Å∫ at ~1 week; then monthly √ó 3; then 3‚Äì6 monthly",
        keyRisks: ["Hyperkalaemia", "Gynaecomastia"],
        action: [
          "Stop if K‚Å∫ > 5.5 mmol/L (local thresholds vary by indication)",
          "Review interacting meds (ACEi/ARB, NSAIDs)"
        ],
        highlight: ["K‚Å∫ > 5.5", "interacting meds"],
        severity: "danger"
      },
      {
        category: "Cardiovascular",
        drug: "Digoxin",
        baseline: "U&E, ECG (and level only if indicated)",
        monitoring: "Digoxin level if toxicity suspected, renal dysfunction, or interacting drugs",
        keyRisks: ["Arrhythmias", "Nausea/vomiting", "Confusion", "Visual disturbance"],
        action: [
          "Hold drug; check digoxin level and K‚Å∫; treat arrhythmia/supportively as needed"
        ],
        highlight: ["toxicity suspected", "digoxin level", "K‚Å∫"],
        severity: "warn"
      },
      {
        category: "Cardiovascular",
        drug: "Amiodarone",
        baseline: "TFT, LFT, CXR (¬± ECG)",
        monitoring: "TFT + LFT every 6 months; assess respiratory symptoms (CXR if indicated)",
        keyRisks: ["Hypo-/hyperthyroidism", "Pulmonary toxicity", "Hepatitis"],
        action: [
          "Suspected pulmonary toxicity: stop and urgent assessment",
          "Significant LFT derangement: review/stop"
        ],
        highlight: ["pulmonary toxicity", "TFT every 6 months"],
        severity: "danger"
      },

      // 4) Anticoagulants
      {
        category: "Anticoagulation",
        drug: "Warfarin",
        baseline: "Baseline INR (and interacting meds/bleeding risk)",
        monitoring: "INR frequency depends on stability (often weekly until stable ‚Üí 4‚Äì12 weekly)",
        keyRisks: ["Bleeding", "Drug/food interactions"],
        action: [
          "Bleeding: manage per INR/clinical severity (hold ¬± reversal)"
        ],
        highlight: ["INR", "reversal"],
        severity: "danger"
      },
      {
        category: "Anticoagulation",
        drug: "DOACs (apixaban, rivaroxaban, etc.)",
        baseline: "U&E/eGFR, LFT, weight",
        monitoring: "Renal function at least annually (more frequent if CKD/elderly/frail)",
        keyRisks: ["Bleeding", "Accumulation with renal impairment"],
        action: [
          "Dose adjust or switch if eGFR declines below product thresholds"
        ],
        highlight: ["renal function", "dose adjust"],
        severity: "warn"
      },
      {
        category: "Anticoagulation",
        drug: "Heparin (UFH/LMWH)",
        baseline: "FBC/platelets, U&E (LMWH dosing), APTT for UFH",
        monitoring: "Platelets day 5‚Äì10 for HIT risk; APTT for UFH titration",
        keyRisks: ["HIT", "Bleeding"],
        action: [
          "Suspected HIT: stop all heparin immediately; alternative anticoagulant"
        ],
        highlight: ["HIT", "stop all heparin"],
        severity: "danger"
      },

      // 5) Endocrine / metabolic
      {
        category: "Endocrine & metabolic",
        drug: "Lithium",
        baseline: "U&E/eGFR, TFT, calcium (common UK practice), weight",
        monitoring: "Lithium level every 3 months; U&E/TFT 6 monthly (varies locally)",
        keyRisks: ["Toxicity", "Nephrogenic DI", "Hypothyroidism"],
        action: [
          "Toxicity suspected or level > 1.5 mmol/L: stop and urgent assessment",
          "Avoid dehydration/NSAIDs/ACEi/thiazides where possible"
        ],
        highlight: ["level > 1.5", "NSAIDs", "thiazides"],
        severity: "danger"
      },
      {
        category: "Endocrine & metabolic",
        drug: "Metformin",
        baseline: "eGFR, B12 (if risk factors/long-term use)",
        monitoring: "eGFR at least annually; B12 periodically if symptoms/long-term use",
        keyRisks: ["Lactic acidosis (risk ‚Üë in AKI/hypoxia)", "B12 deficiency"],
        action: [
          "Stop if eGFR < 30 mL/min/1.73m¬≤",
          "Hold during acute illness causing dehydration/hypoxia/AKI"
        ],
        highlight: ["eGFR < 30", "hold during acute illness"],
        severity: "danger"
      },
      {
        category: "Endocrine & metabolic",
        drug: "Thionamides (carbimazole/PTU)",
        baseline: "FBC, TFT, LFT (PTU particularly)",
        monitoring: "TFT every 4‚Äì6 weeks until stable then spaced; FBC if symptoms",
        keyRisks: ["Agranulocytosis", "Hepatitis (PTU)"],
        action: [
          "Sore throat/fever/mouth ulcers: stop and urgent FBC",
          "Jaundice/marked LFT rise: stop and assess"
        ],
        highlight: ["sore throat/fever", "stop and urgent FBC"],
        severity: "danger"
      },

      // 6) Antimicrobials
      {
        category: "Antimicrobials (levels/toxicity)",
        drug: "Gentamicin",
        baseline: "U&E/eGFR, weight; consider baseline hearing risk",
        monitoring: "Drug levels per local protocol + U&E regularly during therapy",
        keyRisks: ["Nephrotoxicity", "Ototoxicity"],
        action: [
          "Adjust dose/interval by levels and renal function; stop if toxicity"
        ],
        highlight: ["drug levels", "nephrotoxicity", "ototoxicity"],
        severity: "danger"
      },
      {
        category: "Antimicrobials (levels/toxicity)",
        drug: "Vancomycin",
        baseline: "U&E/eGFR, weight",
        monitoring: "Trough levels + renal function during treatment",
        keyRisks: ["Nephrotoxicity"],
        action: [
          "Adjust dosing by levels; review if rising creatinine"
        ],
        highlight: ["trough levels", "rising creatinine"],
        severity: "warn"
      },
      {
        category: "Antimicrobials (levels/toxicity)",
        drug: "Linezolid",
        baseline: "FBC",
        monitoring: "Weekly FBC if prolonged therapy (common practice)",
        keyRisks: ["Thrombocytopenia", "Anaemia", "Serotonin syndrome (interactions)"],
        action: [
          "Stop if significant cytopenia; review interacting serotonergic meds"
        ],
        highlight: ["weekly FBC", "thrombocytopenia"],
        severity: "warn"
      },
      {
        category: "Antimicrobials (levels/toxicity)",
        drug: "Isoniazid",
        baseline: "LFT (esp. liver disease/EtOH), assess neuropathy risk",
        monitoring: "LFT if symptomatic/high risk; clinical review",
        keyRisks: ["Hepatitis", "Peripheral neuropathy"],
        action: [
          "Stop if ALT/AST > 3√ó ULN with symptoms or marked rise",
          "Give pyridoxine if neuropathy risk"
        ],
        highlight: ["ALT/AST > 3√ó ULN", "pyridoxine"],
        severity: "warn"
      },

      // 7) Other high-risk
      {
        category: "Other high-risk drugs",
        drug: "Valproate",
        baseline: "LFT, platelets",
        monitoring: "LFT/platelets periodically; assess symptoms",
        keyRisks: ["Hepatotoxicity", "Thrombocytopenia", "Pancreatitis"],
        action: [
          "Stop if significant LFT derangement, bleeding/cytopenia, or pancreatitis"
        ],
        highlight: ["hepatotoxicity", "thrombocytopenia", "pancreatitis"],
        severity: "danger"
      },
      {
        category: "Other high-risk drugs",
        drug: "Carbamazepine",
        baseline: "FBC, U&E (Na‚Å∫), LFT",
        monitoring: "FBC/Na‚Å∫ periodically; sooner if symptomatic",
        keyRisks: ["Agranulocytosis", "SIADH ‚Üí hyponatraemia"],
        action: [
          "Stop if significant neutropenia; manage hyponatraemia (dose reduce/stop)"
        ],
        highlight: ["neutropenia", "SIADH", "hyponatraemia"],
        severity: "danger"
      },
      {
        category: "Other high-risk drugs",
        drug: "Clozapine",
        baseline: "FBC (strict protocol), ECG where indicated",
        monitoring: "FBC per mandatory schedule (weekly initially ‚Üí spaced)",
        keyRisks: ["Agranulocytosis", "Myocarditis", "Constipation/ileus"],
        action: [
          "Any protocol breach/cytopenia: stop per clozapine service instructions",
          "Chest pain/dyspnoea early treatment: urgent myocarditis workup"
        ],
        highlight: ["mandatory schedule", "myocarditis", "ileus"],
        severity: "danger"
      }
    ];

    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    const cat = document.getElementById('cat');
    const reset = document.getElementById('reset');
    const printBtn = document.getElementById('print');
    const stamp = document.getElementById('stamp');

    stamp.textContent = new Date().toLocaleString();

    // Populate categories
    const categories = Array.from(new Set(data.map(d => d.category))).sort();
    categories.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      cat.appendChild(opt);
    });

    function escapeHtml(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function highlightText(text, needles){
      if(!text) return "";
      let out = escapeHtml(text);
      (needles || []).forEach(n => {
        if(!n) return;
        // Escape for regex
        const re = new RegExp(n.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "gi");
        out = out.replace(re, (m)=>`<span class="hl">${m}</span>`);
      });
      return out;
    }

    function buildCard(d){
      const sevClass = d.severity === "danger" ? "danger" : (d.severity === "warn" ? "warn" : "ok");
      const sevLabel = d.severity === "danger" ? "HIGH RISK" : (d.severity === "warn" ? "CAUTION" : "ROUTINE");

      const keyRisks = (d.keyRisks || []).map(r => `<span class="pill">${escapeHtml(r)}</span>`).join("");
      const actionList = (d.action || []).map(a => `<li>${highlightText(a, d.highlight)}</li>`).join("");

      const el = document.createElement('div');
      el.className = "card";
      el.dataset.category = d.category;

      el.innerHTML = `
        <div class="cardHead">
          <div class="left">
            <span class="badge">${escapeHtml(sevLabel)}</span>
            <h2>${escapeHtml(d.drug)}</h2>
          </div>
          <div class="meta">${escapeHtml(d.category)}</div>
        </div>

        <div class="rows">
          <div class="row">
            <div class="k">Baseline</div>
            <div class="v">${highlightText(d.baseline, d.highlight)}</div>
          </div>

          <div class="row">
            <div class="k">Monitoring</div>
            <div class="v">${highlightText(d.monitoring, d.highlight)}</div>
          </div>

          <div class="row">
            <div class="k">Key risks</div>
            <div class="v">${keyRisks || "<span class='small'>‚Äî</span>"}</div>
          </div>

          <div class="${sevClass}"><b>What to do:</b>
            <ul style="margin:8px 0 0 18px; padding:0;">
              ${actionList || "<li>‚Äî</li>"}
            </ul>
          </div>

          <details>
            <summary>Exam-style micro-prompt</summary>
            <div class="small">
              If asked in a viva: state <b>baseline tests</b>, then <b>first recheck interval</b>, then <b>stop thresholds</b> / red flags.
              Practise: ‚ÄúFor ${escapeHtml(d.drug)}, I‚Äôd check ‚Ä¶ and recheck at ‚Ä¶; I‚Äôd stop if ‚Ä¶‚Äù
            </div>
          </details>
        </div>
      `;
      return el;
    }

    function render(){
      grid.innerHTML = "";
      const query = (q.value || "").trim().toLowerCase();
      const chosen = cat.value;

      const filtered = data.filter(d => {
        if(chosen !== "all" && d.category !== chosen) return false;
        if(!query) return true;

        const hay = [
          d.drug, d.category, d.baseline, d.monitoring,
          ...(d.keyRisks || []), ...(d.action || [])
        ].join(" ").toLowerCase();

        return hay.includes(query);
      });

      if(filtered.length === 0){
        const empty = document.createElement('div');
        empty.className = "card";
        empty.innerHTML = `
          <div class="cardHead">
            <div class="left">
              <span class="badge">NO MATCH</span>
              <h2>No results</h2>
            </div>
            <div class="meta">Try a different search term</div>
          </div>
          <div class="rows">
            <div class="small">Examples: <span class="hl">ALT</span>, <span class="hl">hyperkalaemia</span>, <span class="hl">INR</span>, <span class="hl">pneumonitis</span>.</div>
          </div>
        `;
        grid.appendChild(empty);
        return;
      }

      filtered.forEach(d => grid.appendChild(buildCard(d)));
    }

    q.addEventListener('input', render);
    cat.addEventListener('change', render);

    reset.addEventListener('click', () => {
      q.value = "";
      cat.value = "all";
      render();
    });

    printBtn.addEventListener('click', () => window.print());

    render();
  </script>
</body>
</html>
