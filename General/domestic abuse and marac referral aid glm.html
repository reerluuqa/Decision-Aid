<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCR GP DA & MARAC Quick-Scan</title>
    <style>
        :root {
            /* Color Palette */
            --primary: #005EB8; /* NHS Blue */
            --primary-dark: #003087;
            --danger: #D32F2F; /* Red for Urgent/Danger */
            --danger-bg: #FFEBEE;
            --success: #007F3B; /* Green for Safe */
            --success-bg: #E5F5EA;
            --warning: #FFB81C; /* Amber for Caution */
            --neutral: #425563;
            --light-bg: #F0F4F5;
            --white: #FFFFFF;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0,0,0,0.05);
            --transition: all 0.2s ease-in-out;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--light-bg);
            color: var(--neutral);
            line-height: 1.5;
            padding-bottom: 40px;
        }

        /* --- Header & Emergency --- */
        header {
            background: var(--white);
            padding: 1rem 2rem;
            border-bottom: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .brand h1 {
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .brand span {
            font-size: 0.9rem;
            color: var(--neutral);
            font-weight: 400;
            display: block;
        }

        .emergency-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(211, 47, 47, 0); }
            100% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0); }
        }

        /* --- Main Layout --- */
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 900px) {
            main { grid-template-columns: 1fr; }
        }

        /* --- Cards & Containers --- */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border-left: 6px solid transparent;
        }

        .card h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- Section: Immediate Triage --- */
        .triage-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .triage-item {
            background: var(--white);
            padding: 1rem;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            border: 2px solid #e0e0e0;
            transition: var(--transition);
        }

        .triage-item:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .triage-item.danger { border-color: var(--danger); background-color: var(--danger-bg); }
        .triage-item.safe { border-color: var(--success); background-color: var(--success-bg); }
        .triage-item.info { border-color: var(--primary); background-color: #E8F4FC; }

        .triage-icon { font-size: 2rem; margin-bottom: 0.5rem; display: block; }
        .triage-label { font-weight: 600; font-size: 0.9rem; }

        /* --- Section: Risk Checklist (Interactive) --- */
        .checklist-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .risk-factor {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .risk-factor:hover {
            background: #fff;
            border-color: var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .risk-factor input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            accent-color: var(--danger);
            cursor: pointer;
        }

        .risk-factor label {
            cursor: pointer;
            font-weight: 500;
            flex-grow: 1;
        }

        .risk-factor.selected {
            background-color: var(--danger-bg);
            border-color: var(--danger);
        }

        /* --- Section: Dynamic Score Output --- */
        #result-panel {
            position: sticky;
            top: 100px;
        }

        .risk-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            transition: var(--transition);
        }

        .score-display {
            font-size: 3rem;
            font-weight: 800;
            color: var(--neutral);
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .score-label {
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.8rem;
            color: #777;
            font-weight: 600;
        }

        .action-box {
            margin-top: 1.5rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
        }

        .action-box h3 { margin-bottom: 0.5rem; }
        .action-box p { margin-bottom: 1rem; font-size: 0.95rem; }

        .btn-action {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 0.8rem 1.2rem;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            width: 100%;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .btn-action:hover { background: var(--primary-dark); }
        .btn-action.secondary { background: white; color: var(--primary); border: 2px solid var(--primary); }
        .btn-action.secondary:hover { background: #f0f8ff; }

        /* --- Info Tables --- */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .info-table th, .info-table td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid #eee;
        }
        .info-table th { color: var(--primary); font-weight: 700; }
        .info-table td { font-size: 0.9rem; }

        /* --- Utility Classes --- */
        .bg-red { background-color: var(--danger) !important; }
        .bg-green { background-color: var(--success) !important; }
        .bg-amber { background-color: var(--warning) !important; }
        
        .text-red { color: var(--danger); }
        .text-green { color: var(--success); }
        .text-muted { font-size: 0.85rem; color: #666; margin-top: 5px; display: block; }

        /* --- Disclaimer Footer --- */
        .disclaimer {
            max-width: 1200px;
            margin: 2rem auto 0;
            padding: 1rem;
            background: #fff;
            border-left: 4px solid var(--warning);
            font-size: 0.8rem;
            color: #666;
        }

    </style>
</head>
<body>

    <header>
        <div class="brand">
            <h1>DA & MARAC Tool</h1>
            <span>Manchester GP Quick Reference</span>
        </div>
        <button class="emergency-btn" onclick="alert('Dial 999 immediately if there is imminent danger.')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            EMERGENCY 999
        </button>
    </header>

    <main>
        <!-- LEFT COLUMN: INPUTS & CHECKLIST -->
        <section>
            <!-- Quick Visual Triage -->
            <div class="triage-grid">
                <div class="triage-item danger">
                    <span class="triage-icon">üö®</span>
                    <span class="triage-label">Imminent Risk</span>
                </div>
                <div class="triage-item info">
                    <span class="triage-icon">üë∂</span>
                    <span class="triage-label">Children Involved</span>
                </div>
                <div class="triage-item safe">
                    <span class="triage-icon">üõ°Ô∏è</span>
                    <span class="triage-label">Safe to Talk</span>
                </div>
            </div>

            <!-- Interactive Checklist -->
            <div class="card" style="border-left-color: var(--primary);">
                <h2>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    High Risk Factors (DASH)
                </h2>
                <p class="text-muted">Check all that apply. MARAC threshold usually met if <strong>2+</strong> are present, or any 'Serious' flag.</p>
                <br>
                <div class="checklist-container" id="riskForm">
                    <!-- Javascript will populate/interact here -->
                    
                    <div class="risk-factor" onclick="toggleRisk(this)">
                        <input type="checkbox" value="strangulation">
                        <label>Strangulation / Choking (Serious Flag)</label>
                    </div>

                    <div class="risk-factor" onclick="toggleRisk(this)">
                        <input type="checkbox" value="pregnancy">
                        <label>Pregnancy / New Birth (within 12 months)</label>
                    </div>

                    <div class="risk-factor" onclick="toggleRisk(this)">
                        <input type="checkbox" value="separation">
                        <label>Recent Separation / Child Contact Issues</label>
                    </div>

                    <div class="risk-factor" onclick="toggleRisk(this)">
                        <input type="checkbox" value="weapons">
                        <label>Access to Weapons / Threats with Weapons</label>
                    </div>

                    <div class="risk-factor" onclick="toggleRisk(this)">
                        <input type="checkbox" value="escalation">
                        <label>Escalation in Frequency or Severity</label>
                    </div>

                    <div class="risk-factor" onclick="toggleRisk(this)">
                        <input type="checkbox" value="sexual">
                        <label>Serious Sexual Assault</label>
                    </div>

                    <div class="risk-factor" onclick="toggleRisk(this)">
                        <input type="checkbox" value="stalking">
                        <label>Stalking / Harassment</label>
                    </div>

                    <div class="risk-factor" onclick="toggleRisk(this)">
                        <input type="checkbox" value="isolation">
                        <label>Extreme Isolation / Controlling Finances</label>
                    </div>

                    <div class="risk-factor" onclick="toggleRisk(this)">
                        <input type="checkbox" value="child_exposure">
                        <label>Children Exposed to Abuse</label>
                    </div>

                    <div class="risk-factor" onclick="toggleRisk(this)">
                        <input type="checkbox" value="mental_health">
                        <label>Perpetrator Mental Health / Suicidal Ideation</label>
                    </div>
                </div>
                <div style="margin-top: 1rem; text-align: right;">
                    <button onclick="resetForm()" class="btn-action secondary" style="width: auto; padding: 0.5rem 1rem; font-size: 0.8rem;">Reset Checklist</button>
                </div>
            </div>

            <!-- MARAC Info -->
            <div class="card">
                <h2>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    What is MARAC?
                </h2>
                <p style="font-size: 0.95rem; margin-bottom: 1rem;">
                    <strong>Multi-Agency Risk Assessment Conference.</strong> A meeting where information is shared on the highest risk cases of domestic abuse in Manchester.
                </p>
                <table class="info-table">
                    <tr>
                        <td><strong>Who runs it?</strong></td>
                        <td>Independent IDVA Chairs</td>
                    </tr>
                    <tr>
                        <td><strong>Who attends?</strong></td>
                        <td>Police, Health (GP/HV), Probation, Housing, Children's Services.</td>
                    </tr>
                    <tr>
                        <td><strong>Goal?</strong></td>
                        <td>Create a safety plan to reduce the risk to the victim.</td>
                    </tr>
                </table>
            </div>
        </section>

        <!-- RIGHT COLUMN: DECISION SUPPORT (STICKY) -->
        <section id="result-panel">
            <!-- Decision Card -->
            <div class="card" id="decisionCard" style="border-left-color: #ccc;">
                <div class="score-label">Current Risk Score</div>
                <div class="score-display" id="scoreValue">0</div>
                <div class="risk-badge bg-amber" id="riskBadge">STANDARD RISK</div>
                
                <hr style="margin: 1rem 0; border: 0; border-top: 1px solid #eee;">

                <div id="recommendationBox" style="transition: var(--transition);">
                    <h3 id="recTitle">Routine Support</h3>
                    <p id="recText">Based on current flags, immediate MARAC referral is not standard threshold, but use clinical judgment.</p>
                </div>

                <div class="action-box" id="actionBox" style="background-color: #f0f4f5; border: 1px solid #ddd;">
                    <h3>Actions</h3>
                    <ul style="padding-left: 1.2rem; font-size: 0.9rem; line-height: 1.6;">
                        <li>Discuss safety plan.</li>
                        <li>Provide <strong>Manchester Women's Aid</strong> number.</li>
                        <li>Record using generic Read code (e.g., 99A.)</li>
                    </ul>
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <button class="btn-action" onclick="copyReferral()">Copy Referral Summary</button>
                    <button class="btn-action secondary" onclick="window.print()">Print Page</button>
                </div>
            </div>

            <!-- Manchester Contacts -->
            <div class="card">
                <h2>Manchester Contacts</h2>
                <div style="display: grid; gap: 10px;">
                    <div style="padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 4px;">
                        <strong>Domestic Abuse Helpline</strong><br>
                        <span class="text-red">0161 636 7525</span>
                    </div>
                    <div style="padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 4px;">
                        <strong>MARAC Referral (SafeLives)</strong><br>
                        <a href="#" style="color: var(--primary);">Via Secure MCR Portal</a>
                    </div>
                    <div style="padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 4px;">
                        <strong>Police (Non-Emergency)</strong><br>
                        101
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div class="disclaimer">
        <strong>Clinical Safety Disclaimer:</strong> This tool is a reference aid based on DASH/MARAC guidelines. It does not replace professional clinical judgment. If a patient is in immediate danger, call 999. Ensure all DA discussions are conducted in a safe, private environment (not if the partner is present in the room).
    </div>

    <script>
        // State
        const seriousFlags = ['strangulation', 'sexual']; 
        let checkedCount = 0;
        let hasSeriousFlag = false;

        // DOM Elements
        const scoreValue = document.getElementById('scoreValue');
        const riskBadge = document.getElementById('riskBadge');
        const decisionCard = document.getElementById('decisionCard');
        const recTitle = document.getElementById('recTitle');
        const recText = document.getElementById('recText');
        const actionBox = document.getElementById('actionBox');
        const riskFactors = document.querySelectorAll('.risk-factor');

        // Main Logic Function
        function toggleRisk(element) {
            const checkbox = element.querySelector('input');
            const value = checkbox.value;
            
            // Toggle the checkbox (handle both click on div or direct click)
            // If clicking the div, we need to flip the checkbox state manually if needed, 
            // but here the event bubbles. We just toggle the 'selected' class based on state.
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                element.classList.add('selected');
                checkedCount++;
                if (seriousFlags.includes(value)) hasSeriousFlag = true;
            } else {
                element.classList.remove('selected');
                checkedCount--;
                if (seriousFlags.includes(value)) {
                    // Check if other serious flags remain checked
                    hasSeriousFlag = false;
                    riskFactors.forEach(rf => {
                        if (rf !== element && rf.querySelector('input').checked && seriousFlags.includes(rf.querySelector('input').value)) {
                            hasSeriousFlag = true;
                        }
                    });
                }
            }

            updateUI();
        }

        function updateUI() {
            // Update Score
            scoreValue.textContent = checkedCount;

            // Logic: 
            // 1. Serious Flag (Strangulation/Sexual) -> IMMEDIATE HIGH RISK
            // 2. >= 7 flags (General rule of thumb for High Risk) -> HIGH RISK
            // 3. 2-6 flags -> MEDIUM (Consider MARAC if professional intuition says so)
            // 4. 0-1 flags -> STANDARD

            if (hasSeriousFlag || checkedCount >= 7) {
                setHighRisk();
            } else if (checkedCount >= 2) {
                setMediumRisk();
            } else {
                setStandardRisk();
            }
        }

        function setHighRisk() {
            riskBadge.textContent = "HIGH RISK";
            riskBadge.className = "risk-badge bg-red";
            decisionCard.style.borderLeftColor = "var(--danger)";
            
            recTitle.textContent = "REFER TO MARAC";
            recText.innerHTML = "Threshold met. Patient is at high risk of serious harm or homicide. <br><strong>Action: Complete MARAC Referral.</strong>";
            
            actionBox.style.backgroundColor = "var(--danger-bg)";
            actionBox.style.borderColor = "var(--danger)";
            actionBox.innerHTML = `
                <h3 style="color: var(--danger);">Urgent Actions</h3>
                <ul style="padding-left: 1.2rem; font-size: 0.9rem; line-height: 1.6;">
                    <li><strong>Do NOT</strong> include referral in patient's summary printout for them.</li>
                    <li>Consult with <strong>Practice Safeguarding Lead</strong>.</li>
                    <li>Refer via Manchester SafeLives DASH process.</li>
                    <li>Consider Police referral (if not already involved).</li>
                </ul>
            `;
        }

        function setMediumRisk() {
            riskBadge.textContent = "MEDIUM RISK";
            riskBadge.className = "risk-badge bg-amber";
            decisionCard.style.borderLeftColor = "var(--warning)";

            recTitle.textContent = "Consider MARAC / Specialist Support";
            recText.textContent = "Threshold may be met based on professional judgment. If you feel the risk is escalating, refer to MARAC.";

            actionBox.style.backgroundColor = "#FFF8E1";
            actionBox.style.borderColor = "var(--warning)";
            actionBox.innerHTML = `
                <h3 style="color: var(--warning);">Actions</h3>
                <ul style="padding-left: 1.2rem; font-size: 0.9rem; line-height: 1.6;">
                    <li>Discuss with Practice Safeguarding Lead.</li>
                    <li>Refer to IDVA (Independent Domestic Violence Advisor).</li>
                    <li>Safety planning.</li>
                </ul>
            `;
        }

        function setStandardRisk() {
            riskBadge.textContent = "STANDARD RISK";
            riskBadge.className = "risk-badge bg-green";
            decisionCard.style.borderLeftColor = "var(--success)";

            recTitle.textContent = "Routine Support";
            recText.textContent = "MARAC threshold not met based on checklist. Provide signposting and universal support.";

            actionBox.style.backgroundColor = "var(--success-bg)";
            actionBox.style.borderColor = "var(--success)";
            actionBox.innerHTML = `
                <h3 style="color: var(--success);">Actions</h3>
                <ul style="padding-left: 1.2rem; font-size: 0.9rem; line-height: 1.6;">
                    <li>Provide <strong>National DA Helpline</strong> (0808 2000 247).</li>
                    <li>Record in notes.</li>
                    <li>Review at next appointment.</li>
                </ul>
            `;
        }

        function resetForm() {
            checkedCount = 0;
            hasSeriousFlag = false;
            riskFactors.forEach(rf => {
                rf.classList.remove('selected');
                rf.querySelector('input').checked = false;
            });
            updateUI();
        }

        function copyReferral() {
            const riskLevel = riskBadge.textContent;
            const flags = [];
            riskFactors.forEach(rf => {
                if(rf.querySelector('input').checked) {
                    flags.push(rf.querySelector('label').textContent);
                }
            });

            const summary = `
DA CLINICAL REFERRAL SUMMARY
----------------------------
Risk Level: ${riskLevel}
Flags Identified (${flags.length}): ${flags.join(', ')}

Action Taken: ${riskLevel.includes('HIGH') ? 'Referred to MARAC / Safeguarding Lead Consulted' : 'Advice Given / Safety Planning'}
            `.trim();

            navigator.clipboard.writeText(summary).then(() => {
                const btn = document.querySelector('.btn-action');
                const originalText = btn.textContent;
                btn.textContent = "Copied to Clipboard!";
                setTimeout(() => btn.textContent = originalText, 2000);
            });
        }
    </script>
</body>
</html>