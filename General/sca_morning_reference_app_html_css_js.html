<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SCA Morning Reference</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --card2:#0f1630;
      --text:#e9ecf5;
      --muted:#b7bfdc;
      --accent:#6aa6ff;
      --danger:#ff3b3b;
      --dangerBg: #3a0f17;
      --ok:#26d07c;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    *{ box-sizing: border-box; }

    body{
      margin:0;
      font-family: var(--sans);
      background: radial-gradient(1200px 700px at 20% 10%, rgba(106,166,255,.25), transparent 55%),
                  radial-gradient(900px 600px at 85% 25%, rgba(255,59,59,.18), transparent 60%),
                  radial-gradient(900px 700px at 55% 90%, rgba(38,208,124,.14), transparent 60%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 22px;
    }

    header{
      max-width: 1100px;
      margin: 0 auto 16px auto;
      display:flex;
      gap:14px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .title{
      display:flex;
      flex-direction: column;
      gap:4px;
    }

    h1{
      font-size: 22px;
      margin:0;
      letter-spacing: .2px;
    }

    .subtitle{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.4;
      max-width: 720px;
    }

    .pillRow{ display:flex; gap:10px; flex-wrap: wrap; align-items:center; }

    .pill{
      border: 1px solid rgba(233,236,245,.12);
      background: rgba(18,26,51,.55);
      backdrop-filter: blur(8px);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      display:flex;
      gap:8px;
      align-items:center;
      box-shadow: var(--shadow);
    }

    .pill b{ color: var(--text); }

    .btn{
      appearance:none;
      border: 1px solid rgba(233,236,245,.16);
      background: linear-gradient(180deg, rgba(106,166,255,.22), rgba(106,166,255,.12));
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: transform .05s ease, border-color .2s ease, background .2s ease;
    }

    .btn:active{ transform: translateY(1px); }
    .btn.secondary{
      background: rgba(18,26,51,.55);
      font-weight: 600;
    }
    .btn.danger{
      background: linear-gradient(180deg, rgba(255,59,59,.26), rgba(255,59,59,.14));
      border-color: rgba(255,59,59,.35);
    }

    main{
      max-width: 1100px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 14px;
    }

    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(18,26,51,.9), rgba(15,22,48,.9));
      border: 1px solid rgba(233,236,245,.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .cardHeader{
      padding: 14px 14px 10px 14px;
      border-bottom: 1px solid rgba(233,236,245,.10);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .cardHeader h2{
      font-size: 15px;
      margin:0;
      letter-spacing: .2px;
    }

    .cardBody{ padding: 14px; }

    .redBox{
      background: linear-gradient(180deg, rgba(255,59,59,.22), rgba(58,15,23,.55));
      border: 1px solid rgba(255,59,59,.28);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 10px 25px rgba(255,59,59,.08);
      margin-bottom: 12px;
    }

    .redBox .big{
      font-size: 16px;
      line-height: 1.35;
      margin: 0 0 6px 0;
    }

    .redBox .big b{ font-weight: 900; }

    .redBox .small{
      margin:0;
      color: rgba(233,236,245,.92);
      font-size: 13px;
      line-height: 1.45;
    }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 560px){ .grid2{ grid-template-columns: 1fr; } }

    .mini{
      border-radius: 16px;
      border: 1px solid rgba(233,236,245,.12);
      background: rgba(18,26,51,.55);
      padding: 12px;
    }

    .mini h3{
      margin:0 0 6px 0;
      font-size: 13px;
      letter-spacing:.2px;
    }

    .mini p{ margin:0; color: var(--muted); font-size: 13px; line-height: 1.45; }

    .mini .tag{
      display:inline-block;
      font-family: var(--mono);
      font-size: 12px;
      border: 1px solid rgba(233,236,245,.14);
      padding: 4px 8px;
      border-radius: 999px;
      margin-top: 8px;
      color: rgba(233,236,245,.92);
      background: rgba(15,22,48,.55);
    }

    .checklist{ display:flex; flex-direction: column; gap: 10px; }

    .item{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      padding: 10px;
      border: 1px solid rgba(233,236,245,.10);
      border-radius: 14px;
      background: rgba(18,26,51,.45);
    }

    .item input{ margin-top: 3px; width: 18px; height: 18px; }

    .item label{
      display:block;
      cursor: pointer;
      font-size: 13.5px;
      line-height: 1.4;
      color: rgba(233,236,245,.95);
    }

    .item label small{ display:block; color: var(--muted); margin-top: 3px; font-size: 12px; }

    .item .emph{
      font-weight: 900;
      padding: 1px 6px;
      border-radius: 10px;
      background: rgba(255,59,59,.18);
      border: 1px solid rgba(255,59,59,.22);
      color: rgba(233,236,245,.98);
    }

    .progressWrap{ margin-top: 12px; }

    .bar{
      width:100%;
      height: 10px;
      border-radius: 999px;
      background: rgba(233,236,245,.08);
      overflow:hidden;
      border: 1px solid rgba(233,236,245,.12);
    }

    .bar > div{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(106,166,255,.9), rgba(38,208,124,.9));
      border-radius: 999px;
      transition: width .25s ease;
    }

    .muted{ color: var(--muted); font-size: 12px; }

    .kbd{
      font-family: var(--mono);
      font-size: 12px;
      border: 1px solid rgba(233,236,245,.14);
      background: rgba(15,22,48,.65);
      padding: 3px 7px;
      border-radius: 10px;
      color: rgba(233,236,245,.92);
    }

    .flash{
      border-radius: 18px;
      padding: 14px;
      border: 1px solid rgba(233,236,245,.12);
      background: linear-gradient(180deg, rgba(18,26,51,.7), rgba(15,22,48,.85));
      min-height: 170px;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 12px;
    }

    .flash .q{ font-size: 13px; color: var(--muted); }
    .flash .a{ font-size: 16px; line-height: 1.35; }
    .flash .a b{ font-weight: 900; }

    .row{ display:flex; gap: 10px; flex-wrap: wrap; align-items:center; }

    .timer{
      font-family: var(--mono);
      font-size: 22px;
      letter-spacing: .6px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(233,236,245,.14);
      background: rgba(15,22,48,.65);
      display:inline-flex;
      align-items:center;
      gap: 10px;
    }

    .timer .dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: rgba(38,208,124,.85);
      box-shadow: 0 0 0 6px rgba(38,208,124,.08);
    }

    .timer.warn .dot{
      background: rgba(255,59,59,.9);
      box-shadow: 0 0 0 6px rgba(255,59,59,.10);
    }

    .divider{ height: 1px; background: rgba(233,236,245,.10); margin: 12px 0; }

    .callout{
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(233,236,245,.12);
      background: rgba(18,26,51,.45);
      color: rgba(233,236,245,.95);
      line-height: 1.45;
      font-size: 13px;
    }

    .callout b{ font-weight: 900; }

    footer{
      max-width: 1100px;
      margin: 14px auto 0 auto;
      color: rgba(183,191,220,.9);
      font-size: 12px;
      line-height: 1.5;
    }

    a{ color: var(--accent); text-decoration: none; }
    a:hover{ text-decoration: underline; }

  </style>
</head>
<body>

<header>
  <div class="title">
    <h1>SCA Morning Reference</h1>
    <div class="subtitle">
      Daily drill to make the workshop habits automatic: <b>structure</b>, <b>time control</b>, <b>management-first marks</b>, and <b>explicit safety</b>.
    </div>
  </div>

  <div class="pillRow">
    <div class="pill">Date: <b id="today">—</b></div>
    <div class="pill">Streak: <b id="streak">0</b> days</div>
    <button class="btn" id="markDone">Mark today done</button>
    <button class="btn secondary" id="resetToday">Reset checklist</button>
  </div>
</header>

<main>
  <!-- LEFT COLUMN -->
  <section class="card">
    <div class="cardHeader">
      <h2>Non‑negotiables (read first)</h2>
      <div class="row">
        <span class="kbd">T</span><span class="muted">Start 12‑min drill</span>
        <span class="kbd">N</span><span class="muted">Next flash</span>
      </div>
    </div>
    <div class="cardBody">
      <div class="redBox">
        <p class="big">Move to management by <b>6½ minutes</b> (absolute latest <b>7:00</b>).</p>
        <p class="small">The exam rewards safe, independent GP consulting. <b>Management carries the largest weight</b>. If you don’t leave time, you can’t score it.</p>
      </div>

      <div class="grid2">
        <div class="mini">
          <h3>3‑phase structure</h3>
          <p>
            <b>Patient’s part → Doctor’s part → Shared part</b>.
            Let them tell the story; then clarify clinically; then agree a plan.
          </p>
          <span class="tag">Steer between phases</span>
        </div>
        <div class="mini">
          <h3>Safe, spoken, explicit</h3>
          <p>
            Silent safety scores nothing. Verbalise: red flags, thresholds, follow‑up, escalation.
          </p>
          <span class="tag">"If X, then Y"</span>
        </div>
      </div>

      <div class="divider"></div>

      <div class="callout">
        Examiner lens: not perfection; not checklists. A consultation should convert a <b>problem → plan</b>, showing you are <b>safe</b> and <b>independent</b>.
        Avoid hospital‑style exhaustive clerking; gather enough to manage <b>today</b>.
      </div>

      <div class="divider"></div>

      <h3 style="margin:0 0 8px 0; font-size: 14px;">Daily checklist (60–90 seconds)</h3>
      <div class="checklist" id="checklist"></div>

      <div class="progressWrap">
        <div class="bar"><div id="barFill"></div></div>
        <div class="muted" style="margin-top:6px;" id="progressText">—</div>
      </div>

    </div>
  </section>

  <!-- RIGHT COLUMN -->
  <aside class="card">
    <div class="cardHeader">
      <h2>Flash + 12‑minute drill</h2>
      <div class="row">
        <button class="btn secondary" id="prevFlash">Prev</button>
        <button class="btn" id="nextFlash">Next</button>
      </div>
    </div>
    <div class="cardBody">

      <div class="flash" id="flash">
        <div class="q" id="flashQ">—</div>
        <div class="a" id="flashA">—</div>
        <div class="row">
          <button class="btn secondary" id="toggleAnswer">Hide/Show emphasis</button>
          <button class="btn danger" id="shuffle">Shuffle</button>
        </div>
      </div>

      <div class="divider"></div>

      <div class="row" style="justify-content: space-between;">
        <div class="timer" id="timer">
          <span class="dot"></span>
          <span id="time">12:00</span>
        </div>
        <div class="row">
          <button class="btn" id="start">Start</button>
          <button class="btn secondary" id="pause">Pause</button>
          <button class="btn secondary" id="reset">Reset</button>
        </div>
      </div>

      <div class="callout" style="margin-top: 10px;">
        Use the timer for a quick mental rehearsal:
        <ul style="margin:8px 0 0 18px; padding:0; color: rgba(233,236,245,.92);">
          <li><b>0:00–3:30</b> patient story + ICE</li>
          <li><b>3:30–6:30</b> doctor clarification + red flags</li>
          <li><b>6:30–12:00</b> shared plan + options + safety‑net</li>
        </ul>
      </div>

      <div class="divider"></div>

      <div class="callout">
        Micro‑phrases that score:
        <ul style="margin:8px 0 0 18px; padding:0; color: rgba(233,236,245,.92);">
          <li><b>"What were you hoping I could help with today?"</b></li>
          <li><b>"What’s your main worry about this?"</b></li>
          <li><b>"Let me summarise…"</b></li>
          <li><b>"We have a few options…"</b></li>
          <li><b>"If X happens, I want you to…"</b> (explicit safety‑net)</li>
        </ul>
      </div>

    </div>
  </aside>
</main>

<footer>
  Built from your workshop notes: emphasis on management weighting, structured consulting (patient → doctor → shared), explicit risk handling, and authentic GP practice.
  Data is stored locally in your browser (no uploads).
</footer>

<script>
  // -----------------------------
  // Data model (from workshop themes)
  // -----------------------------
  const CHECKS = [
    {
      id: 'move_management',
      text: 'I will move to management by <span class="emph">6½ minutes</span> (latest 7:00).',
      sub: 'Protect ≥5 minutes for plan + options + safety‑net.'
    },
    {
      id: 'structure',
      text: 'I will follow <b>Patient → Doctor → Shared</b> structure and <span class="emph">steer</span> between phases.',
      sub: 'Patient story/ICE first; clinical clarification second; plan third.'
    },
    {
      id: 'spoken_safety',
      text: 'I will make <span class="emph">safety explicit</span> out loud.',
      sub: 'Red flags, thresholds, escalation, follow‑up, and safety‑netting are verbalised.'
    },
    {
      id: 'management_options',
      text: 'I will present <b>options</b> and agree a shared plan.',
      sub: 'More than one reasonable option where appropriate; documentable rationale.'
    },
    {
      id: 'gp_not_hospital',
      text: 'I will avoid hospital clerking and gather <b>enough</b> to manage <b>today</b>.',
      sub: 'Review and follow‑up are legitimate management tools.'
    },
    {
      id: 'verbalise',
      text: 'I will name the diagnosis/formulation and name the treatment/investigation.',
      sub: 'No vague “tablets”. If unsure of dose: don’t guess; check later.'
    },
    {
      id: 'authentic',
      text: 'I will consult as myself: <b>safe</b>, <b>independent</b>, and authentic.',
      sub: 'No checklist performance; no examiner‑pleasing theatre.'
    }
  ];

  const FLASH = [
    {
      q: 'What is the single most common reason candidates underperform?',
      a: 'Failing to leave time for <b>management</b>. Move on by <b>6½ minutes</b> (latest <b>7:00</b>).'
    },
    {
      q: 'What is the consultation trying to achieve (core frame)?',
      a: 'Convert a <b>problem → plan</b>. Good enough, safe, independent GP practice.'
    },
    {
      q: 'How do you gather data efficiently?',
      a: '<b>Patient’s part</b> (story + ICE) then <b>Doctor’s part</b> (clarify + red flags).'
    },
    {
      q: 'How do you “score” safety?',
      a: 'Make it <b>spoken</b>: thresholds, escalation, follow‑up, and <b>explicit safety‑netting</b>.'
    },
    {
      q: 'What do examiners use instead of checklists?',
      a: 'Global grade descriptors (“<b>word pictures</b>”) for each domain.'
    },
    {
      q: 'What is rewarded more than diagnostic cleverness?',
      a: '<b>Safe clinical management</b> and risk handling with a workable plan.'
    },
    {
      q: 'How should you handle dosing uncertainty?',
      a: 'Do <b>not</b> guess. Name the drug and key risks; state you will <b>check dose</b> after the consult.'
    },
    {
      q: 'What mindset should you adopt about examiners?',
      a: 'They are not trying to trap you. Show you can practice <b>safely</b> and <b>independently</b>.'
    }
  ];

  // -----------------------------
  // Storage helpers
  // -----------------------------
  const key = (k) => `sca_morning_${k}`;
  const todayISO = () => new Date().toISOString().slice(0,10);

  function loadJSON(k, fallback){
    try{
      const raw = localStorage.getItem(key(k));
      if(!raw) return fallback;
      return JSON.parse(raw);
    }catch{ return fallback; }
  }

  function saveJSON(k, val){
    localStorage.setItem(key(k), JSON.stringify(val));
  }

  // -----------------------------
  // Header: date + streak
  // -----------------------------
  function renderHeader(){
    const d = new Date();
    const pretty = d.toLocaleDateString(undefined, { weekday:'long', year:'numeric', month:'short', day:'numeric' });
    document.getElementById('today').textContent = pretty;

    const streak = computeStreak();
    document.getElementById('streak').textContent = String(streak);
  }

  function computeStreak(){
    const doneDays = loadJSON('done_days', []);
    const set = new Set(doneDays);

    // Count consecutive days ending today OR yesterday if not yet done today.
    let count = 0;
    let cursor = new Date();

    // If today not done, start from yesterday.
    const t = todayISO();
    if(!set.has(t)) cursor.setDate(cursor.getDate() - 1);

    while(true){
      const iso = cursor.toISOString().slice(0,10);
      if(set.has(iso)){
        count++;
        cursor.setDate(cursor.getDate() - 1);
      } else {
        break;
      }
    }
    return count;
  }

  // -----------------------------
  // Checklist
  // -----------------------------
  function renderChecklist(){
    const container = document.getElementById('checklist');
    container.innerHTML = '';

    const state = loadJSON('checks', {});
    const day = todayISO();
    const dayState = state[day] || {};

    CHECKS.forEach((c) => {
      const row = document.createElement('div');
      row.className = 'item';

      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.id = c.id;
      cb.checked = Boolean(dayState[c.id]);
      cb.addEventListener('change', () => {
        const updated = loadJSON('checks', {});
        updated[day] = updated[day] || {};
        updated[day][c.id] = cb.checked;
        saveJSON('checks', updated);
        updateProgress();
      });

      const label = document.createElement('label');
      label.htmlFor = c.id;
      label.innerHTML = `${c.text}<small>${c.sub}</small>`;

      row.appendChild(cb);
      row.appendChild(label);
      container.appendChild(row);
    });

    updateProgress();
  }

  function updateProgress(){
    const state = loadJSON('checks', {});
    const day = todayISO();
    const dayState = state[day] || {};

    const total = CHECKS.length;
    const done = CHECKS.reduce((n,c) => n + (dayState[c.id] ? 1 : 0), 0);
    const pct = total === 0 ? 0 : Math.round((done/total) * 100);

    document.getElementById('barFill').style.width = `${pct}%`;
    document.getElementById('progressText').textContent = `${done}/${total} items ticked (${pct}%).`;
  }

  function resetToday(){
    const state = loadJSON('checks', {});
    const day = todayISO();
    state[day] = {};
    saveJSON('checks', state);
    renderChecklist();
  }

  // -----------------------------
  // Streak controls
  // -----------------------------
  function markDone(){
    // Mark today done if checklist >= 80% (soft rule) OR allow anyway.
    const state = loadJSON('checks', {});
    const day = todayISO();
    const dayState = state[day] || {};

    const total = CHECKS.length;
    const done = CHECKS.reduce((n,c) => n + (dayState[c.id] ? 1 : 0), 0);
    const pct = total === 0 ? 0 : Math.round((done/total) * 100);

    const days = loadJSON('done_days', []);
    const set = new Set(days);
    set.add(day);
    saveJSON('done_days', Array.from(set).sort());

    renderHeader();

    const msg = pct >= 80
      ? `Logged ✅ Today complete (${pct}%).`
      : `Logged ✅ Today complete (only ${pct}%). Consider ticking the red non‑negotiables.`;

    toast(msg);
  }

  // -----------------------------
  // Flashcards
  // -----------------------------
  let flashOrder = loadJSON('flash_order', null);
  if(!flashOrder || flashOrder.length !== FLASH.length){
    flashOrder = [...Array(FLASH.length).keys()];
    saveJSON('flash_order', flashOrder);
  }

  let flashIdx = loadJSON('flash_idx', 0);
  let emphasisOn = loadJSON('emph', true);

  function renderFlash(){
    const idx = flashOrder[flashIdx % flashOrder.length];
    const card = FLASH[idx];

    document.getElementById('flashQ').textContent = card.q;

    // Emphasis toggle: hide bold by converting to plain text-ish
    const a = emphasisOn ? card.a : stripBold(card.a);
    document.getElementById('flashA').innerHTML = a;

    saveJSON('flash_idx', flashIdx);
    saveJSON('emph', emphasisOn);
  }

  function stripBold(html){
    return html.replaceAll('<b>', '').replaceAll('</b>', '');
  }

  function nextFlash(){
    flashIdx = (flashIdx + 1) % flashOrder.length;
    renderFlash();
  }

  function prevFlash(){
    flashIdx = (flashIdx - 1 + flashOrder.length) % flashOrder.length;
    renderFlash();
  }

  function shuffleFlash(){
    flashOrder = [...Array(FLASH.length).keys()];
    for(let i = flashOrder.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [flashOrder[i], flashOrder[j]] = [flashOrder[j], flashOrder[i]];
    }
    flashIdx = 0;
    saveJSON('flash_order', flashOrder);
    saveJSON('flash_idx', flashIdx);
    renderFlash();
    toast('Shuffled flashcards.');
  }

  // -----------------------------
  // 12-minute timer (warn at 6:30 and 7:00)
  // -----------------------------
  const START_SECONDS = 12 * 60;
  let remaining = loadJSON('timer_remaining', START_SECONDS);
  let running = false;
  let tHandle = null;

  function fmt(sec){
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  function setTimerUI(){
    const el = document.getElementById('time');
    el.textContent = fmt(remaining);

    const timer = document.getElementById('timer');
    // Warn when <= 5:30 remaining means you've crossed 6:30 in the consult.
    // 12:00 - 6:30 = 5:30 remaining.
    const crossedSixThirty = remaining <= (START_SECONDS - 390);
    const crossedSeven = remaining <= (START_SECONDS - 420);

    if(crossedSeven){
      timer.classList.add('warn');
    } else {
      timer.classList.remove('warn');
    }

    // Persist
    saveJSON('timer_remaining', remaining);
  }

  function tick(){
    if(!running) return;
    if(remaining <= 0){
      stopTimer();
      remaining = 0;
      setTimerUI();
      toast('Timer finished.');
      return;
    }
    remaining -= 1;
    setTimerUI();

    // Soft cues at 6:30 and 7:00 elapsed
    // elapsed = START_SECONDS - remaining
    const elapsed = START_SECONDS - remaining;
    if(elapsed === 390) toast('Cue: 6:30 elapsed → move to management now.');
    if(elapsed === 420) toast('Cue: 7:00 elapsed → latest to be in management.');
  }

  function startTimer(){
    if(running) return;
    running = true;
    if(!tHandle) tHandle = setInterval(tick, 1000);
    toast('Timer started.');
  }

  function pauseTimer(){
    running = false;
    toast('Timer paused.');
  }

  function stopTimer(){
    running = false;
  }

  function resetTimer(){
    running = false;
    remaining = START_SECONDS;
    setTimerUI();
    toast('Timer reset.');
  }

  // -----------------------------
  // Toast
  // -----------------------------
  let toastEl = null;
  function toast(msg){
    if(!toastEl){
      toastEl = document.createElement('div');
      toastEl.style.position = 'fixed';
      toastEl.style.bottom = '18px';
      toastEl.style.left = '50%';
      toastEl.style.transform = 'translateX(-50%)';
      toastEl.style.background = 'rgba(15,22,48,.95)';
      toastEl.style.border = '1px solid rgba(233,236,245,.16)';
      toastEl.style.color = 'rgba(233,236,245,.95)';
      toastEl.style.padding = '10px 12px';
      toastEl.style.borderRadius = '14px';
      toastEl.style.boxShadow = '0 18px 40px rgba(0,0,0,.45)';
      toastEl.style.fontSize = '13px';
      toastEl.style.maxWidth = '92vw';
      toastEl.style.zIndex = 9999;
      toastEl.style.opacity = '0';
      toastEl.style.transition = 'opacity .2s ease';
      document.body.appendChild(toastEl);
    }
    toastEl.textContent = msg;
    toastEl.style.opacity = '1';
    clearTimeout(toastEl._t);
    toastEl._t = setTimeout(() => { toastEl.style.opacity = '0'; }, 2200);
  }

  // -----------------------------
  // Wire up events
  // -----------------------------
  document.getElementById('resetToday').addEventListener('click', resetToday);
  document.getElementById('markDone').addEventListener('click', markDone);

  document.getElementById('nextFlash').addEventListener('click', nextFlash);
  document.getElementById('prevFlash').addEventListener('click', prevFlash);
  document.getElementById('shuffle').addEventListener('click', shuffleFlash);
  document.getElementById('toggleAnswer').addEventListener('click', () => {
    emphasisOn = !emphasisOn;
    renderFlash();
  });

  document.getElementById('start').addEventListener('click', startTimer);
  document.getElementById('pause').addEventListener('click', pauseTimer);
  document.getElementById('reset').addEventListener('click', resetTimer);

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if(e.target && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA')) return;
    if(e.key.toLowerCase() === 'n') nextFlash();
    if(e.key.toLowerCase() === 't') startTimer();
  });

  // -----------------------------
  // Init
  // -----------------------------
  renderHeader();
  renderChecklist();
  renderFlash();
  setTimerUI();

  // Ensure timer interval exists (but paused by default)
  tHandle = setInterval(tick, 1000);
  running = false;
</script>

</body>
</html>
