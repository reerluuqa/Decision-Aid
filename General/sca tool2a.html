  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SCA Exam Mastery Tool</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;   /* FIX: used by master button */
      --gray-500: #6b7280;   /* FIX: used by context text */
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--gray-100);
      color: var(--gray-800);
      line-height: 1.6;
    }

    .app-container { max-width: 1200px; margin: 0 auto; padding: 20px; }

    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 30px;
      border-radius: 16px;
      margin-bottom: 24px;
      text-align: center;
    }

    header h1 { font-size: 2rem; margin-bottom: 8px; }
    header p { opacity: 0.9; font-size: 1.1rem; }

    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .stat-card .number { font-size: 2rem; font-weight: 700; color: var(--primary); }
    .stat-card .label { color: var(--gray-600); font-size: 0.875rem; }

    .nav-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      background: white;
      padding: 8px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .nav-tab {
      padding: 12px 20px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--gray-600);
      transition: all 0.2s;
    }

    .nav-tab:hover { background: var(--gray-100); }
    .nav-tab.active { background: var(--primary); color: white; }

    .content-section { display: none; }
    .content-section.active { display: block; }

    .card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .card h2 {
      color: var(--gray-900);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card h3 { color: var(--gray-800); margin: 16px 0 12px; font-size: 1.1rem; }

    .mnemonic-box {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border-left: 4px solid var(--warning);
      padding: 16px 20px;
      border-radius: 0 8px 8px 0;
      margin: 16px 0;
    }

    .mnemonic-box h4 { color: #92400e; margin-bottom: 8px; font-size: 1rem; }
    .mnemonic-box .mnemonic-letters { font-size: 1.5rem; font-weight: 700; color: #92400e; letter-spacing: 4px; }
    .mnemonic-box ul { margin-top: 8px; padding-left: 20px; }
    .mnemonic-box li { color: #78350f; }

    .critical-box {
      background: linear-gradient(135deg, #fee2e2, #fecaca);
      border-left: 4px solid var(--danger);
      padding: 16px 20px;
      border-radius: 0 8px 8px 0;
      margin: 16px 0;
    }

    .critical-box h4 { color: #991b1b; margin-bottom: 8px; }
    .critical-box p, .critical-box li { color: #7f1d1d; }

    .success-box {
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
      border-left: 4px solid var(--success);
      padding: 16px 20px;
      border-radius: 0 8px 8px 0;
      margin: 16px 0;
    }

    .success-box h4 { color: #065f46; margin-bottom: 8px; }

    .phrase-card {
      background: var(--gray-50);
      border: 2px solid var(--gray-200);
      border-radius: 8px;
      padding: 16px;
      margin: 12px 0;
      position: relative;
    }

    .phrase-card .phrase { font-style: italic; color: var(--gray-700); font-size: 1.05rem; padding-right: 80px; }
    .phrase-card .context { font-size: 0.85rem; color: var(--gray-500); margin-top: 8px; }

    .phrase-card .btn-group {
      position: absolute;
      top: 12px;
      right: 12px;
      display: flex;
      gap: 6px;
    }

    .phrase-card .copy-btn, .phrase-card .master-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.75rem;
    }

    .phrase-card .copy-btn:hover { background: var(--primary-dark); }
    .phrase-card .master-btn { background: var(--gray-400); }
    .phrase-card .master-btn:hover { background: var(--success); }

    .phrase-card.mastered { border-color: var(--success); background: #f0fdf4; }
    .phrase-card.mastered .master-btn { background: var(--success); }

    .tag {
      display: inline-block;
      padding: 4px 10px;
      background: var(--gray-200);
      border-radius: 20px;
      font-size: 0.75rem;
      margin: 4px 4px 0 0;
    }

    .tag.phase-1 { background: #dbeafe; color: #1e40af; }
    .tag.phase-2 { background: #fef3c7; color: #92400e; }
    .tag.phase-3 { background: #d1fae5; color: #065f46; }

    .timeline { position: relative; padding-left: 30px; }
    .timeline::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--gray-300);
    }

    .timeline-item { position: relative; padding: 16px 0; border-bottom: 1px dashed var(--gray-200); }
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -26px;
      top: 20px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--primary);
      border: 3px solid white;
      box-shadow: 0 0 0 2px var(--primary);
    }

    .timeline-item.critical::before { background: var(--danger); box-shadow: 0 0 0 2px var(--danger); }
    .timeline-item .time { font-weight: 700; color: var(--primary); font-size: 1.1rem; }
    .timeline-item.critical .time { color: var(--danger); }

    /* Timer Styles */
    .timer-container { text-align: center; padding: 40px; }
    .timer-display {
      font-size: 5rem;
      font-weight: 700;
      color: var(--gray-800);
      font-family: 'Monaco', 'Consolas', monospace;
    }
    .timer-display.warning { color: var(--warning); }
    .timer-display.danger { color: var(--danger); }
    .timer-display.success { color: var(--success); }

    .timer-phase { font-size: 1.5rem; color: var(--primary); margin: 20px 0; font-weight: 600; }
    .timer-hint { background: var(--gray-100); padding: 16px; border-radius: 8px; margin: 20px auto; font-size: 1.1rem; max-width: 600px; }

    .timer-controls { display: flex; justify-content: center; gap: 16px; margin-top: 24px; flex-wrap: wrap; }

    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-secondary { background: var(--gray-200); color: var(--gray-700); }
    .btn-secondary:hover { background: var(--gray-300); }
    .btn-danger { background: var(--danger); color: white; }
    .btn-success { background: var(--success); color: white; }

    /* Flashcard Styles */
    .flashcard-container { perspective: 1000px; margin: 20px auto; max-width: 600px; }
    .flashcard { height: 300px; cursor: pointer; position: relative; }
    .flashcard-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
    .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }

    .flashcard-front, .flashcard-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px;
      border-radius: 12px;
      font-size: 1.2rem;
      text-align: center;
    }

    .flashcard-front { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
    .flashcard-back { background: linear-gradient(135deg, var(--success), #059669); color: white; transform: rotateY(180deg); }

    .flashcard-progress { text-align: center; margin-bottom: 20px; color: var(--gray-600); }
    .flashcard-controls { display: flex; justify-content: center; gap: 16px; margin-top: 20px; flex-wrap: wrap; }

    /* Quiz Styles */
    .quiz-container { max-width: 700px; margin: 0 auto; }
    .quiz-progress { text-align: center; margin-bottom: 20px; color: var(--gray-600); font-size: 1.1rem; }
    .quiz-question { font-size: 1.3rem; color: var(--gray-800); margin-bottom: 24px; padding: 20px; background: var(--gray-50); border-radius: 8px; text-align: center; }
    .quiz-options { display: grid; gap: 12px; }

    .quiz-option {
      padding: 16px 20px;
      border: 2px solid var(--gray-200);
      border-radius: 8px;
      background: white;
      cursor: pointer;
      text-align: left;
      font-size: 1rem;
      transition: all 0.2s;
    }

    .quiz-option:hover:not(.disabled) { border-color: var(--primary); background: var(--gray-50); }
    .quiz-option.correct { border-color: var(--success); background: #d1fae5; }
    .quiz-option.incorrect { border-color: var(--danger); background: #fee2e2; }
    .quiz-option.disabled { cursor: not-allowed; }

    .quiz-feedback { margin-top: 20px; padding: 16px; border-radius: 8px; font-weight: 500; text-align: center; }
    .quiz-feedback.correct { background: #d1fae5; color: #065f46; }
    .quiz-feedback.incorrect { background: #fee2e2; color: #991b1b; }

    .quiz-score { font-size: 1.2rem; margin-bottom: 20px; color: var(--gray-700); text-align: center; }

    /* Checklist Styles */
    .checklist-section { margin-bottom: 24px; }
    .checklist-section h3 { margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid var(--gray-200); }

    .checklist-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px;
      border-bottom: 1px solid var(--gray-100);
      transition: background 0.2s;
    }

    .checklist-item:hover { background: var(--gray-50); }

    .checklist-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-top: 2px;
      cursor: pointer;
      accent-color: var(--success);
    }

    .checklist-item label { cursor: pointer; flex: 1; }
    .checklist-item.checked label { text-decoration: line-through; color: var(--gray-500); }

    .checklist-progress { margin-top: 16px; padding: 12px; background: var(--gray-50); border-radius: 8px; }

    .progress-bar {
      height: 10px;
      background: var(--gray-200);
      border-radius: 5px;
      overflow: hidden;
      margin-top: 8px;
    }

    .progress-bar .fill { height: 100%; border-radius: 5px; transition: width 0.3s; background: var(--success); }

    /* Domain Breakdown */
    .domain-breakdown {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .domain-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      border-top: 4px solid;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .domain-card.data-gathering { border-color: #3b82f6; }
    .domain-card.clinical-management { border-color: #ef4444; }
    .domain-card.relating { border-color: #10b981; }

    .domain-card h3 { margin-bottom: 8px; }
    .domain-card .marks { font-size: 2rem; font-weight: 700; }
    .domain-card .percentage { color: var(--gray-600); margin-bottom: 12px; }

    /* Accordion */
    .accordion { border: 1px solid var(--gray-200); border-radius: 8px; margin-bottom: 12px; overflow: hidden; }
    .accordion-header {
      padding: 16px 20px;
      background: var(--gray-50);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      user-select: none;
    }
    .accordion-header:hover { background: var(--gray-100); }

    .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
    .accordion-content-inner { padding: 20px; }
    .accordion.open .accordion-content { max-height: 5000px; }
    .accordion-header .icon { transition: transform 0.3s; }
    .accordion.open .accordion-header .icon { transform: rotate(180deg); }

    /* Case Grid */
    .case-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
    .case-type {
      background: var(--gray-50);
      padding: 14px;
      border-radius: 8px;
      border: 1px solid var(--gray-200);
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Search */
    .search-box {
      width: 100%;
      padding: 14px 20px;
      border: 2px solid var(--gray-200);
      border-radius: 8px;
      font-size: 1rem;
      margin-bottom: 20px;
    }
    .search-box:focus { outline: none; border-color: var(--primary); }

    /* Responsive */
    @media (max-width: 768px) {
      .app-container { padding: 12px; }
      header { padding: 20px; }
      header h1 { font-size: 1.5rem; }
      .timer-display { font-size: 3.5rem; }
      .nav-tabs { gap: 4px; }
      .nav-tab { padding: 10px 14px; font-size: 0.85rem; }
      .phrase-card .btn-group { position: static; margin-top: 12px; }
      .phrase-card .phrase { padding-right: 0; }
    }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--gray-800);
      color: white;
      padding: 14px 24px;
      border-radius: 8px;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }
    .toast.success { background: var(--success); }
    .toast.error { background: var(--danger); }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .hidden { display: none !important; }
  </style>
</head>

<body>
  <div class="app-container">
    <header>
      <h1>üè• SCA Exam Mastery Tool</h1>
      <p>Master phrases, timing, and techniques for your Structured Clinical Assessment</p>
    </header>

    <div class="stats-bar">
      <div class="stat-card">
        <div class="number" id="phrasesLearned">0</div>
        <div class="label">Phrases Mastered</div>
      </div>
      <div class="stat-card">
        <div class="number" id="quizScore">0%</div>
        <div class="label">Quiz Accuracy</div>
      </div>
      <div class="stat-card">
        <div class="number" id="practiceTime">0</div>
        <div class="label">Practice Sessions</div>
      </div>
      <div class="stat-card">
        <div class="number" id="streak">0</div>
        <div class="label">Day Streak</div>
      </div>
    </div>

    <div class="nav-tabs">
      <button class="nav-tab active" data-tab="overview">üìã Overview</button>
      <button class="nav-tab" data-tab="structure">üèóÔ∏è Structure</button>
      <button class="nav-tab" data-tab="phrases">üí¨ Phrases</button>
      <button class="nav-tab" data-tab="timer">‚è±Ô∏è Timer</button>
      <button class="nav-tab" data-tab="flashcards">üé¥ Flashcards</button>
      <button class="nav-tab" data-tab="quiz">üìù Quiz</button>
      <button class="nav-tab" data-tab="checklist">‚úÖ Checklist</button>
    </div>

    <!-- OVERVIEW SECTION -->
    <div id="overview" class="content-section active">
      <div class="card">
        <h2>üéØ Exam At A Glance</h2>
        <div class="domain-breakdown">
          <div class="domain-card data-gathering">
            <h3>üìä Data Gathering</h3>
            <div class="marks">3 marks</div>
            <div class="percentage">28.5% of total</div>
            <div class="progress-bar"><div class="fill" style="width: 28.5%; background: #3b82f6;"></div></div>
            <p><strong>When:</strong> First half of consultation</p>
            <p><strong>Focus:</strong> Story, Impact, ICE, Medical Qs</p>
          </div>

          <div class="domain-card clinical-management">
            <h3>üíä Clinical Management</h3>
            <div class="marks">4.5 marks</div>
            <div class="percentage">43% of total ‚ö†Ô∏è HIGHEST</div>
            <div class="progress-bar"><div class="fill" style="width: 43%; background: #ef4444;"></div></div>
            <p><strong>When:</strong> Second half (from 6.5 mins)</p>
            <p><strong>Focus:</strong> Plan, Safety net, Follow-up</p>
          </div>

          <div class="domain-card relating">
            <h3>ü§ù Relating to Others</h3>
            <div class="marks">3 marks</div>
            <div class="percentage">28.5% of total</div>
            <div class="progress-bar"><div class="fill" style="width: 28.5%; background: #10b981;"></div></div>
            <p><strong>When:</strong> Throughout</p>
            <p><strong>Focus:</strong> Rapport, listening, empathy</p>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>üìä Exam Format</h2>
        <ul style="padding-left: 24px; line-height: 2;">
          <li><strong>12 consultations</strong> √ó 12 minutes each</li>
          <li><strong>3 minutes</strong> reading time between cases</li>
          <li><strong>9 video cases</strong> + <strong>3 telephone cases</strong></li>
          <li>Takes place in <strong>your own surgery</strong> (97%+ candidates)</li>
          <li>Professional role players (actors) simulate patients</li>
          <li>Recorded and marked later by different examiners</li>
          <li><strong>Standard:</strong> Newly qualified independent GP</li>
        </ul>
      </div>

      <div class="critical-box">
        <h4>‚ö†Ô∏è THE MOST CRITICAL RULE</h4>
        <p style="font-size: 1.2rem; font-weight: 600;">Move to MANAGEMENT by 6.5-7 minutes MAXIMUM</p>
        <p>Management domain is worth 43% of marks. Safety netting and follow-up often get missed if you run out of time!</p>
      </div>

      <div class="mnemonic-box">
        <h4>üß† Roger Neighbour's 3-Part Consultation: P-D-S</h4>
        <div class="mnemonic-letters">P - D - S</div>
        <ul>
          <li><strong>P</strong>atient's Part (0-4 mins) - Their story, impact, ICE</li>
          <li><strong>D</strong>octor's Part (4-6.5 mins) - Your medical questions</li>
          <li><strong>S</strong>hared Part (6.5-12 mins) - Management together</li>
        </ul>
      </div>

      <div class="mnemonic-box">
        <h4>üß† Remember: S.I.I - The Patient's Part Flow</h4>
        <div class="mnemonic-letters">Story ‚Üí Impact ‚Üí ICE</div>
        <ul>
          <li><strong>S</strong>tory - Get their narrative first with open questions</li>
          <li><strong>I</strong>mpact - How it affects their life</li>
          <li><strong>I</strong>CE - Ideas, Concerns, Expectations (ask AFTER story)</li>
        </ul>
      </div>

      <div class="success-box">
        <h4>‚ú® Golden Wisdom from Experts</h4>
        <ul style="padding-left: 20px; line-height: 1.8;">
          <li><strong>Robin:</strong> "Get the video out" - Record and review regularly</li>
          <li><strong>Roger:</strong> "Shut up and listen" at the start</li>
          <li>Be your natural best self - don't perform for examiner</li>
          <li>Examiners are NOT the enemy - they're not trying to trick you</li>
          <li>"Good enough" is fine - perfection isn't expected</li>
          <li><strong>Think out loud</strong> - this solves most problems!</li>
        </ul>
      </div>
    </div>

    <!-- STRUCTURE SECTION -->
    <div id="structure" class="content-section">
      <div class="card">
        <h2>‚è∞ 12-Minute Consultation Timeline</h2>
        <div class="timeline">
          <div class="timeline-item">
            <div class="time">0:00 - 0:20</div>
            <strong>Opening (20 seconds max!)</strong>
            <p>Confirm identity, brief greeting. Don't waste time here!</p>
          </div>
          <div class="timeline-item">
            <div class="time">0:20 - 4:00</div>
            <strong>PATIENT'S PART - Story ‚Üí Impact ‚Üí ICE</strong>
            <ul style="margin-top: 8px; padding-left: 20px;">
              <li>Use OPEN questions extensively</li>
              <li>DON'T interrupt with medical questions yet</li>
              <li>Give full attention, active listening</li>
            </ul>
          </div>
          <div class="timeline-item">
            <div class="time">4:00 - 6:00</div>
            <strong>DOCTOR'S PART - Medical Questions</strong>
            <ul style="margin-top: 8px; padding-left: 20px;">
              <li>Summarize their story first</li>
              <li>"Is there anything else you wanted to tell me?"</li>
              <li>Red flags, closed questions, fill gaps</li>
            </ul>
          </div>
          <div class="timeline-item critical">
            <div class="time">6:00 - 6:30 ‚ö†Ô∏è CRITICAL!</div>
            <strong>MUST MOVE TO MANAGEMENT NOW!</strong>
            <p>"So let's talk about what we're going to do..."</p>
          </div>
          <div class="timeline-item">
            <div class="time">6:30 - 10:00</div>
            <strong>SHARED PART - MANAGEMENT (43% of marks!)</strong>
            <ul style="margin-top: 8px; padding-left: 20px;">
              <li>Think out loud - share your reasoning</li>
              <li>Discuss options together</li>
              <li>Address BOTH medical issues AND patient's ICE</li>
            </ul>
          </div>
          <div class="timeline-item">
            <div class="time">10:00 - 11:30</div>
            <strong>Safety Netting & Follow-up</strong>
            <p>Often missed if running late - DON'T skip!</p>
          </div>
          <div class="timeline-item">
            <div class="time">11:30 - 12:00</div>
            <strong>Closing Summary</strong>
            <p>Brief recap of the plan</p>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>üìã Case Types Blueprint (12 Cases)</h2>
        <div class="case-grid">
          <div class="case-type">üë∂ Child (under 19)</div>
          <div class="case-type">üíï Sexual health</div>
          <div class="case-type">üè• Long-term condition/cancer</div>
          <div class="case-type">üë¥ Patient over 65</div>
          <div class="case-type">üß† Mental health</div>
          <div class="case-type">üö® Emergency/new illness</div>
          <div class="case-type">üìâ Health disadvantaged group</div>
          <div class="case-type">üåç Diversity/different beliefs</div>
          <div class="case-type">‚ùì Undifferentiated disease</div>
          <div class="case-type">üíä Prescribing</div>
          <div class="case-type">üìä Results review</div>
          <div class="case-type">üë• Professional conversation</div>
        </div>
      </div>

      <div class="card">
        <h2>üè† Room Setup Requirements</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
          <div>
            <h3 style="color: var(--success);">‚úÖ ALLOWED</h3>
            <ul style="padding-left: 20px; line-height: 1.8;">
              <li>One monitor only</li>
              <li>Whiteboard (A4 size, ~¬£5)</li>
              <li>Cold drink</li>
              <li>Mobile in sealed bag at arm's length</li>
            </ul>
          </div>
          <div>
            <h3 style="color: var(--danger);">‚ùå NOT ALLOWED</h3>
            <ul style="padding-left: 20px; line-height: 1.8;">
              <li>More than one monitor</li>
              <li>Clinical documents on walls</li>
              <li>Connected phone</li>
              <li>Pen, paper, or BNF access</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- PHRASES SECTION -->
    <div id="phrases" class="content-section">
      <div class="card">
        <h2>üí¨ Essential Phrases Library</h2>
        <input type="text" class="search-box" id="phraseSearch" placeholder="üîç Search phrases...">
        <div id="phraseCategories"></div>
      </div>
    </div>

    <!-- TIMER SECTION -->
    <div id="timer" class="content-section">
      <div class="card">
        <div class="timer-container">
          <h2 style="text-align: center; margin-bottom: 20px;">‚è±Ô∏è 12-Minute Consultation Timer</h2>
          <div class="timer-display" id="timerDisplay">12:00</div>
          <div class="timer-phase" id="timerPhase">Ready to Start</div>
          <div class="timer-hint" id="timerHint">Press Start to begin your 12-minute consultation practice</div>
          <div class="timer-controls">
            <button class="btn btn-primary" id="startTimer">‚ñ∂Ô∏è Start</button>
            <button class="btn btn-secondary" id="pauseTimer">‚è∏Ô∏è Pause</button>
            <button class="btn btn-danger" id="resetTimer">üîÑ Reset</button>
          </div>
          <div style="margin-top: 30px; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto;">
            <h3>Timer Phases:</h3>
            <ul style="padding-left: 20px; line-height: 1.8; margin-top: 10px;">
              <li><strong style="color: var(--success);">0:00-4:00</strong> - Patient's Part (Story, Impact, ICE)</li>
              <li><strong style="color: var(--primary);">4:00-6:00</strong> - Doctor's Part (Medical Questions)</li>
              <li><strong style="color: var(--danger);">6:00-6:30</strong> - ‚ö†Ô∏è TRANSITION NOW!</li>
              <li><strong style="color: var(--warning);">6:30-10:00</strong> - Shared Part (Management)</li>
              <li><strong style="color: var(--gray-600);">10:00-12:00</strong> - Safety Net & Close</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- FLASHCARDS SECTION -->
    <div id="flashcards" class="content-section">
      <div class="card">
        <h2 style="text-align: center;">üé¥ Flashcard Practice</h2>
        <div class="flashcard-progress" id="flashcardProgress">Card 1 of 20</div>
        <div class="flashcard-container">
          <div class="flashcard" id="flashcard">
            <div class="flashcard-inner">
              <div class="flashcard-front" id="flashcardFront">Click to reveal answer</div>
              <div class="flashcard-back" id="flashcardBack">Answer will appear here</div>
            </div>
          </div>
        </div>
        <div class="flashcard-controls">
          <button class="btn btn-secondary" id="prevCard">‚¨ÖÔ∏è Previous</button>
          <button class="btn btn-primary" id="flipCard">üîÑ Flip</button>
          <button class="btn btn-secondary" id="nextCard">Next ‚û°Ô∏è</button>
        </div>
        <div class="flashcard-controls" style="margin-top: 10px;">
          <button class="btn btn-success" id="shuffleCards">üîÄ Shuffle</button>
        </div>
      </div>
    </div>

    <!-- QUIZ SECTION -->
    <div id="quiz" class="content-section">
      <div class="card">
        <h2 style="text-align: center;">üìù Knowledge Quiz</h2>
        <div class="quiz-container">
          <div class="quiz-score" id="quizScoreDisplay">Score: 0/0</div>
          <div class="quiz-progress" id="quizProgress">Question 1 of 10</div>
          <div class="quiz-question" id="quizQuestion">Loading question...</div>
          <div class="quiz-options" id="quizOptions"></div>
          <div class="quiz-feedback hidden" id="quizFeedback"></div>
          <div class="timer-controls" style="margin-top: 20px;">
            <button class="btn btn-primary hidden" id="nextQuestion">Next Question ‚û°Ô∏è</button>
            <button class="btn btn-secondary" id="restartQuiz">üîÑ Restart Quiz</button>
          </div>
        </div>
      </div>
    </div>

    <!-- CHECKLIST SECTION -->
    <div id="checklist" class="content-section">
      <div class="card">
        <h2>‚úÖ Exam Preparation Checklist</h2>
        <div id="checklistContainer"></div>
        <div class="checklist-progress">
          <strong>Overall Progress: <span id="checklistPercent">0%</span></strong>
          <div class="progress-bar">
            <div class="fill" id="checklistProgressBar" style="width: 0%;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>




<script>
    // ============ DATA ============
    const phraseData = {
      "Opening - Video": [
        { phrase: "Hello [Name], I'm Dr [Your name]. Before we start, can I just confirm your date of birth?", context: "Opening - establishes identity safely", phase: 1 },
        { phrase: "What would you prefer me to call you?", context: "Shows respect, builds rapport", phase: 1 },
        { phrase: "So, how can I help you today?", context: "Classic open opener - invites narrative", phase: 1 }
      ],
      "Opening - Telephone": [
        { phrase: "Hello, this is Dr [Name] calling from [Practice]. Am I speaking with [Patient name]?", context: "Phone opener - confirms identity", phase: 1 },
        { phrase: "Is now a convenient time to talk? Is there anyone with you, or would you like someone to join us?", context: "Phone - checks they can talk freely", phase: 1 }
      ],
      "Open Questions (Use LOTS!)": [
        { phrase: "Tell me more about that...", context: "Encourages elaboration", phase: 1 },
        { phrase: "What happened next?", context: "Moves narrative forward", phase: 1 },
        { phrase: "Talk me through this from the beginning...", context: "Gets chronological story", phase: 1 },
        { phrase: "Help me understand what's been going on...", context: "Collaborative, inviting", phase: 1 },
        { phrase: "What else can you tell me about this?", context: "Checks for more information", phase: 1 },
        { phrase: "How did this all start?", context: "Origins of problem", phase: 1 }
      ],
      "Active Listening Receipts": [
        { phrase: "I see... / Right... / I get that...", context: "Acknowledgment cues - use throughout", phase: 1 },
        { phrase: "That's helpful... / Go on... / Mmm-hmm...", context: "Encourages continuation", phase: 1 },
        { phrase: "*Nodding* (video) or verbal 'mmm' (phone)", context: "Non-verbal/verbal acknowledgment", phase: 1 }
      ],
      "Impact Questions": [
        { phrase: "How is this affecting you?", context: "General impact", phase: 1 },
        { phrase: "What's this doing to your daily life?", context: "Functional impact", phase: 1 },
        { phrase: "How are you managing with this?", context: "Coping assessment", phase: 1 },
        { phrase: "What impact has this had on [work/family/sleep]?", context: "Specific domain impact", phase: 1 },
        { phrase: "How are you coping with all of this?", context: "Emotional coping", phase: 1 }
      ],
      "ICE - Ideas": [
        { phrase: "What do you think might be causing this?", context: "Explores patient's theory", phase: 1 },
        { phrase: "Have you any thoughts about what's going on?", context: "Alternative ideas question", phase: 1 },
        { phrase: "Have you read anything about this?", context: "Checks Dr Google influence", phase: 1 },
        { phrase: "What did you make of this when it started?", context: "Initial interpretation", phase: 1 }
      ],
      "ICE - Concerns": [
        { phrase: "What's worrying you most about this?", context: "Gets to the heart of worry", phase: 1 },
        { phrase: "What's your main concern?", context: "Direct approach", phase: 1 },
        { phrase: "Is there anything particular that's troubling you?", context: "Softer approach", phase: 1 },
        { phrase: "What was it that prompted you to come in today?", context: "Why today specifically?", phase: 1 }
      ],
      "ICE - Expectations": [
        { phrase: "What were you hoping I might be able to do today?", context: "Explores expectations", phase: 1 },
        { phrase: "How were you hoping I could help?", context: "Alternative expectations", phase: 1 },
        { phrase: "What would be most helpful for you today?", context: "Practical expectations", phase: 1 }
      ],
      "Picking Up Cues": [
        { phrase: "I noticed you said [X]... tell me more about that?", context: "Shows active listening, explores cue", phase: 1 },
        { phrase: "You seemed [worried/upset] when you mentioned [X]...", context: "Reflects emotional cue", phase: 1 },
        { phrase: "That sounds important - can you say more about that?", context: "Validates and explores", phase: 1 }
      ],
      "Transition - Summarizing": [
        { phrase: "Okay, so let me make sure I've understood correctly. You've been having [symptoms], this has been affecting [impact], and you're particularly concerned about [worry]. Is that right?", context: "Summary with ICE check", phase: 2 },
        { phrase: "Thank you for explaining all that. So if I've got this right, [brief summary]... have I missed anything?", context: "Confirms understanding", phase: 2 }
      ],
      "Transition - To Doctor's Part": [
        { phrase: "That's really helpful. Now I'd like to ask you some specific questions to help me understand this better, is that okay?", context: "Permission for medical Qs", phase: 2 },
        { phrase: "Before I ask my questions, is there anything else you wanted to tell me?", context: "CRITICAL - catches missed info", phase: 2 }
      ],
      "Doctor's Part - Medical Questions": [
        { phrase: "I need to ask some specific questions about your symptoms...", context: "Introduces focused questioning", phase: 2 },
        { phrase: "Just to be thorough, I need to check a few things...", context: "Explains systematic approach", phase: 2 },
        { phrase: "To help me rule out anything serious, can I ask...", context: "Explains red flag checking", phase: 2 },
        { phrase: "I just need to check - have you had any [red flag symptom]?", context: "Safety checking", phase: 2 }
      ],
      "Two-Part Steer (Gentle Control)": [
        { phrase: "Thank you for telling me about [X], but now I'd like to ask you about [Y]...", context: "Polite redirection", phase: 2 },
        { phrase: "I understand [what they said], but what I really need to know is...", context: "Acknowledges then refocuses", phase: 2 },
        { phrase: "That's helpful, and now can we talk about...", context: "Smooth transition", phase: 2 }
      ],
      "‚ö†Ô∏è CRITICAL: Transition to Management": [
        { phrase: "Okay, I think I've got the picture now. So let's talk about how we're going to help you with this...", context: "MUST USE BY 6.5-7 MINS!", phase: 3 },
        { phrase: "Right, I've got enough information. Now let's discuss what we can do...", context: "Alternative transition", phase: 3 },
        { phrase: "Thanks, that's clear. So now let's work out a plan together...", context: "Collaborative transition", phase: 3 },
        { phrase: "Have I got the full picture, or is there anything else I should know before we discuss what to do?", context: "Final check before management", phase: 3 }
      ],
      "Thinking Out Loud (Powerful!)": [
        { phrase: "So, here's how this looks to me... I think [diagnosis], which is why I'd like to suggest [management]. Does that make sense?", context: "Shares reasoning with patient", phase: 3 },
        { phrase: "Let me share my thinking with you... [explain reasoning]... What do you think about that?", context: "Invites collaboration", phase: 3 },
        { phrase: "I'm weighing up a couple of options here... [explain options]... What feels right to you?", context: "Shares decision process", phase: 3 }
      ],
      "When Uncertain": [
        { phrase: "I'm not entirely sure what's going on here, so I think the safest thing would be...", context: "Honest about uncertainty", phase: 3 },
        { phrase: "This is a bit of a puzzle, so here's what I suggest we do...", context: "Acknowledges complexity", phase: 3 },
        { phrase: "There are a few possibilities here, so let me explain what I'm thinking...", context: "Multiple differentials", phase: 3 }
      ],
      "Addressing ICE in Management (MARKS!)": [
        { phrase: "You mentioned you were worried about [concern]. The good news is...", context: "Links concern to reassurance", phase: 3 },
        { phrase: "I know you thought this might be [their idea]. Actually, I think it's [your diagnosis], because...", context: "Addresses their theory", phase: 3 },
        { phrase: "You said you were hoping for [expectation]. What I'd suggest instead is [alternative], because...", context: "Manages expectations", phase: 3 },
        { phrase: "So this addresses your main worry about [X], by [how management helps]...", context: "Explicit link to concern", phase: 3 }
      ],
      "Shared Decision Making": [
        { phrase: "What do you think about this plan?", context: "Seeks agreement", phase: 3 },
        { phrase: "How does that sound to you?", context: "Quick check", phase: 3 },
        { phrase: "Would that work for you?", context: "Practical check", phase: 3 },
        { phrase: "There are a couple of options... [explain]... Which appeals to you more?", context: "Offers choice", phase: 3 }
      ],
      "Prescribing": [
        { phrase: "I'm going to prescribe [drug name - be specific]. This works by [brief explanation]...", context: "Clear prescribing", phase: 3 },
        { phrase: "The main side effects to watch for are...", context: "Side effect counselling", phase: 3 },
        { phrase: "For the exact dose, I'll check and get back to you - I want to make sure I give you exactly the right amount", context: "Safe - don't guess doses!", phase: 3 }
      ],
      "Safety Netting (Don't Skip!)": [
        { phrase: "If [X happens], you need to [action]...", context: "Specific safety net", phase: 3 },
        { phrase: "Warning signs to watch for would be [symptoms]...", context: "Red flags for patient", phase: 3 },
        { phrase: "If things aren't improving by [timeframe], then [action]...", context: "Time-based safety net", phase: 3 },
        { phrase: "If you develop [red flags], you must [seek urgent help/call 999]...", context: "Urgent safety net", phase: 3 }
      ],
      "Follow-up": [
        { phrase: "I'd like to see you again in [timeframe] to...", context: "Planned review", phase: 3 },
        { phrase: "Let's review this [when], and then we can...", context: "Review with plan", phase: 3 },
        { phrase: "Come back sooner if you're worried, but otherwise I'll see you in...", context: "Flexible follow-up", phase: 3 }
      ],
      "Closing Summary": [
        { phrase: "So just to recap: we're going to [plan point 1], [plan point 2], I'll see you again in [timeframe], and if [warning sign] you need to [action]. How does that sound?", context: "Complete summary", phase: 3 },
        { phrase: "Let me make sure we're both clear... [concise summary]. Any questions?", context: "Brief summary with check", phase: 3 }
      ],
      "Difficult Situations": [
        { phrase: "I understand why you're asking for [X], but here's the difficulty... [explain honestly]", context: "Unreasonable requests", phase: 3 },
        { phrase: "I hear what you're saying, but actually the best thing for [you/your child] would be...", context: "Redirecting expectations", phase: 3 },
        { phrase: "I'm finding this quite complex, so let me think this through with you...", context: "When stuck", phase: 3 }
      ],
      "Breaking Bad News / Results": [
        { phrase: "I'm afraid the results show...", context: "Give results early and clearly", phase: 3 },
        { phrase: "What's going through your mind right now?", context: "BRILLIANT after giving news - use this!", phase: 3 },
        { phrase: "How are you feeling about this?", context: "Check emotional response", phase: 3 }
      ],
      "Time Management Phrases": [
        { phrase: "I'm conscious of time, so let me just check...", context: "Polite time pressure", phase: 2 },
        { phrase: "So we make best use of our time together, let's...", context: "Collaborative time management", phase: 2 },
        { phrase: "I want to make sure we have time to discuss what we'll do, so...", context: "Prioritizing management", phase: 2 }
      ]
    };

    const flashcardData = [
      { q: "What are the 3 domains and their marks?", a: "Data Gathering (3), Clinical Management (4.5), Relating to Others (3)" },
      { q: "Which domain is worth the most marks?", a: "Clinical Management - 43% of total marks!" },
      { q: "By what time MUST you transition to management?", a: "6.5-7 minutes MAXIMUM" },
      { q: "What is the 3-part consultation structure?", a: "P-D-S: Patient's Part, Doctor's Part, Shared Part" },
      { q: "What is the flow for Patient's Part?", a: "S.I.I: Story ‚Üí Impact ‚Üí ICE" },
      { q: "What does ICE stand for?", a: "Ideas, Concerns, Expectations" },
      { q: "What type of questions should you use early?", a: "OPEN questions - lots of them!" },
      { q: "What should you ask before moving to Doctor's Part?", a: "\"Is there anything else you wanted to tell me?\"" },
      { q: "How long should opening/introductions take?", a: "20 seconds maximum - don't waste time!" },
      { q: "What technique solves most problems when stuck?", a: "THINK OUT LOUD - share your reasoning" },
      { q: "What's the key phrase after giving bad news?", a: "\"What's going through your mind right now?\"" },
      { q: "How many video vs telephone cases?", a: "9 video cases + 3 telephone cases" },
      { q: "What's the Two-Part Steer?", a: "\"Thank you for X, but now I'd like to ask about Y...\" - polite control" },
      { q: "What must you do with ICE to get marks?", a: "ADDRESS them explicitly in your management plan!" },
      { q: "What should you NOT do with medication doses?", a: "Don't guess! Say you'll check to give exact amount" },
      { q: "What often gets missed if running late?", a: "Safety netting and follow-up" },
      { q: "What's the standard you're assessed against?", a: "Newly qualified independent GP" },
      { q: "How many monitors are allowed?", a: "One monitor only" },
      { q: "What's Roger Neighbour's key advice?", a: "\"Shut up and listen\" at the start" },
      { q: "What transition phrase signals management?", a: "\"So let's talk about what we're going to do...\"" }
    ];

    const quizData = [
      { q: "Clinical Management is worth what percentage of total marks?", options: ["28.5%", "33%", "43%", "50%"], correct: 2, explanation: "Clinical Management (4.5 marks) is worth 43% - the highest weighted domain!" },
      { q: "By what time MUST you transition to management?", options: ["5 minutes", "6.5-7 minutes", "8 minutes", "10 minutes"], correct: 1, explanation: "You MUST be in management by 6.5-7 minutes to have enough time for this crucial domain." },
      { q: "What is the correct order for Patient's Part?", options: ["ICE ‚Üí Story ‚Üí Impact", "Story ‚Üí ICE ‚Üí Impact", "Story ‚Üí Impact ‚Üí ICE", "Impact ‚Üí Story ‚Üí ICE"], correct: 2, explanation: "S.I.I: Story first (let them talk), then Impact (how it affects them), then ICE (Ideas, Concerns, Expectations)." },
      { q: "What type of questions should dominate early in the consultation?", options: ["Closed questions", "Red flag questions", "Open questions", "Leading questions"], correct: 2, explanation: "Use LOTS of open questions early to let the patient tell their story in their own words." },
      { q: "What should you ask before transitioning from Patient's Part to Doctor's Part?", options: ["What medications are you on?", "Is there anything else you wanted to tell me?", "When did this start?", "Have you seen a doctor before?"], correct: 1, explanation: "\"Is there anything else you wanted to tell me?\" catches anything they planned to mention but haven't yet." },
      { q: "The 'Two-Part Steer' technique is used for:", options: ["Opening the consultation", "Breaking bad news", "Gentle interruption/redirection", "Safety netting"], correct: 2, explanation: "Two-Part Steer: \"Thank you for X, but now I'd like to ask about Y...\" - acknowledges then redirects." },
      { q: "What is the most powerful technique when you're stuck or uncertain?", options: ["Ask more questions", "Think out loud", "Move to safety netting", "End the consultation early"], correct: 1, explanation: "THINK OUT LOUD - sharing your reasoning with the patient solves most problems and shows your clinical thinking." },
      { q: "What must you do with ICE to get marks in management?", options: ["Just ask the questions", "Write them down", "Address them explicitly in your plan", "Ask them at the end"], correct: 2, explanation: "You must ADDRESS ICE in management - make explicit links between their concerns and your plan." },
      { q: "If a patient asks about medication dose and you're unsure, you should:", options: ["Guess based on experience", "Say you'll check to give the exact amount", "Prescribe the lowest dose", "Avoid prescribing"], correct: 1, explanation: "Never guess doses! Say \"I'll check and get back to you - I want to make sure I give you exactly the right amount.\"" },
      { q: "What's the brilliant phrase to use after giving bad news?", options: ["Do you understand?", "Any questions?", "What's going through your mind right now?", "Let me explain more"], correct: 2, explanation: "\"What's going through your mind right now?\" opens space for the patient to process and share their response." },
      { q: "How long should opening/introductions take?", options: ["1 minute", "30 seconds", "20 seconds", "2 minutes"], correct: 2, explanation: "20 seconds maximum for introductions - don't waste valuable consultation time!" },
      { q: "What is Roger Neighbour's key advice for the start of consultations?", options: ["Ask red flags first", "Shut up and listen", "Examine early", "Set an agenda"], correct: 1, explanation: "\"Shut up and listen\" - let the patient tell their story without interruption early on." },
      { q: "How many monitors are you allowed in the exam room?", options: ["None", "One", "Two", "As many as needed"], correct: 1, explanation: "One monitor only is allowed in the exam room." },
      { q: "Which of these is often missed if running late?", options: ["Patient's name", "Red flag questions", "Safety netting and follow-up", "Diagnosis"], correct: 2, explanation: "Safety netting and follow-up are often missed when running late - leave time for them!" },
      { q: "What's the exam format?", options: ["10 cases √ó 10 minutes", "12 cases √ó 12 minutes", "15 cases √ó 8 minutes", "8 cases √ó 15 minutes"], correct: 1, explanation: "12 consultations √ó 12 minutes each, with 3 minutes reading time between cases." }
    ];

    const checklistData = {
      "Before the Exam": [
        "Record and review consultations weekly",
        "Practice 12-minute appointments regularly",
        "See patients across the whole curriculum",
        "Do out-of-hours work (excellent preparation)",
        "Master the IT/camera setup",
        "Choose your exam room early and use it regularly",
        "Review Good Medical Practice guidance",
        "Familiarize yourself with all professionals who visit your practice"
      ],
      "Room Setup": [
        "Confirm only ONE monitor in room",
        "Remove all clinical documents from walls",
        "Disconnect phone",
        "Prepare sealed bag for mobile at arm's length",
        "Get A4 whiteboard (~¬£5)",
        "Have a cold drink ready",
        "Confirm NO pen, paper, or BNF access"
      ],
      "Key Skills to Practice": [
        "Opening in under 20 seconds",
        "Using lots of open questions",
        "Story ‚Üí Impact ‚Üí ICE sequence",
        "Summarizing before transitions",
        "Transitioning to management by 6.5 minutes",
        "Thinking out loud during management",
        "Addressing ICE explicitly in plans",
        "Safety netting with specific red flags",
        "Two-part steer technique",
        "Breaking bad news with 'What's going through your mind?'"
      ],
      "Day Before": [
        "Early night - good rest",
        "Check all equipment working",
        "Review key phrases",
        "Plan what you'll wear (professional, comfortable)",
        "Know your room inside out"
      ],
      "On the Day": [
        "Arrive early",
        "Check camera and microphone",
        "Have water ready",
        "Mobile sealed and at arm's length",
        "Take deep breaths - you've got this!"
      ]
    };

    // ============ STATE ============
    let masteredPhrases = JSON.parse(localStorage.getItem('masteredPhrases') || '[]');
    let practiceCount = parseInt(localStorage.getItem('practiceCount') || '0', 10);
    let quizResults = JSON.parse(localStorage.getItem('quizResults') || '{"correct":0,"total":0}');
    let checklistState = JSON.parse(localStorage.getItem('checklistState') || '{}');
    let streak = parseInt(localStorage.getItem('streak') || '0', 10);
    let lastVisit = localStorage.getItem('lastVisit');

    // Timer state
    let timerInterval = null;
    let timerSeconds = 720; // 12 minutes
    let timerRunning = false;

    // Flashcard state
    let currentFlashcard = 0;
    let shuffledFlashcards = [...flashcardData];

    // Quiz state
    let currentQuestion = 0;
    let quizScore = 0;
    let shuffledQuiz = [];
    let answered = false;

    // ============ INITIALIZATION ============
    document.addEventListener('DOMContentLoaded', function () {
      updateStreak();
      updateStats();
      initTabs();
      initPhrases();
      initTimer();
      initFlashcards();
      initQuiz();
      initChecklist();
      updateTimerDisplay();
    });

    // ============ UTIL ============
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }

    async function safeCopyText(text) {
      try {
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(text);
          return true;
        }
      } catch (_) {}

      // Fallback
      try {
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        const ok = document.execCommand('copy');
        ta.remove();
        return ok;
      } catch (_) {
        return false;
      }
    }

    function updateStreak() {
      const today = new Date().toDateString();
      if (lastVisit) {
        const lastDate = new Date(lastVisit);
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);

        if (lastVisit === today) {
          // Same day, keep streak
        } else if (lastDate.toDateString() === yesterday.toDateString()) {
          streak++;
        } else {
          streak = 1;
        }
      } else {
        streak = 1;
      }
      localStorage.setItem('streak', String(streak));
      localStorage.setItem('lastVisit', today);
    }

    function updateStats() {
      document.getElementById('phrasesLearned').textContent = masteredPhrases.length;
      document.getElementById('practiceTime').textContent = practiceCount;
      document.getElementById('streak').textContent = streak;

      if (quizResults.total > 0) {
        document.getElementById('quizScore').textContent =
          Math.round((quizResults.correct / quizResults.total) * 100) + '%';
      } else {
        document.getElementById('quizScore').textContent = '0%';
      }
    }

    // ============ TABS ============
    function initTabs() {
      const tabs = document.querySelectorAll('.nav-tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');

          document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));

          const tabId = tab.getAttribute('data-tab');
          document.getElementById(tabId).classList.add('active');
        });
      });
    }

    // ============ PHRASES ============
    function initPhrases() {
      const container = document.getElementById('phraseCategories');
      container.innerHTML = '';

      for (const [category, phrases] of Object.entries(phraseData)) {
        const accordion = document.createElement('div');
        accordion.className = 'accordion';

        const isCritical = category.includes('CRITICAL');
        const headerStyle = isCritical ? 'background: #fee2e2;' : '';

        accordion.innerHTML = `
          <div class="accordion-header" style="${headerStyle}">
            <span>${isCritical ? 'üö® ' : ''}${category}</span>
            <span class="icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <div class="accordion-content-inner">
              ${phrases.map((p, i) => {
                const id = `${category}-${i}`;
                const isMastered = masteredPhrases.includes(id);
                return `
                  <div class="phrase-card ${isMastered ? 'mastered' : ''}" data-id="${id}" data-phrase="${encodeURIComponent(p.phrase)}">
                    <div class="phrase">"${p.phrase}"</div>
                    <div class="context">${p.context}</div>
                    <span class="tag phase-${p.phase}">Phase ${p.phase}</span>
                    <div class="btn-group">
                      <button class="copy-btn" data-copy="${encodeURIComponent(p.phrase)}">üìã</button>
                      <button class="master-btn" data-id="${id}">${isMastered ? '‚úì' : '‚òÜ'}</button>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;

        accordion.querySelector('.accordion-header').addEventListener('click', () => {
          accordion.classList.toggle('open');
        });

        // Add event listeners for copy and master buttons
        accordion.querySelectorAll('.copy-btn').forEach(btn => {
          btn.addEventListener('click', async (e) => {
            e.stopPropagation();
            const phrase = decodeURIComponent(btn.getAttribute('data-copy'));
            const ok = await safeCopyText(phrase);
            if (ok) {
              showToast('Phrase copied!', 'success');
              btn.textContent = '‚úì';
              setTimeout(() => btn.textContent = 'üìã', 1000);
            } else {
              showToast('Copy failed (browser blocked clipboard).', 'error');
            }
          });
        });

        accordion.querySelectorAll('.master-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const id = btn.getAttribute('data-id');
            const card = btn.closest('.phrase-card');
            if (masteredPhrases.includes(id)) {
              masteredPhrases = masteredPhrases.filter(p => p !== id);
              card.classList.remove('mastered');
              btn.textContent = '‚òÜ';
            } else {
              masteredPhrases.push(id);
              card.classList.add('mastered');
              btn.textContent = '‚úì';
              showToast('Phrase mastered! üéâ', 'success');
            }
            localStorage.setItem('masteredPhrases', JSON.stringify(masteredPhrases));
            updateStats();
          });
        });

        container.appendChild(accordion);
      }

      // Search functionality
      document.getElementById('phraseSearch').addEventListener('input', (e) => {
        const search = e.target.value.toLowerCase().trim();
        const accordions = document.querySelectorAll('.accordion');

        accordions.forEach(acc => {
          const cards = acc.querySelectorAll('.phrase-card');
          let anyVisible = false;

          cards.forEach(card => {
            const text = card.textContent.toLowerCase();
            const visible = !search || text.includes(search);
            card.classList.toggle('hidden', !visible);
            if (visible) anyVisible = true;
          });

          acc.classList.toggle('hidden', !anyVisible);
          if (search && anyVisible) acc.classList.add('open');
          if (!search) acc.classList.remove('open');
        });
      });
    }

    // ============ TIMER ============
    function initTimer() {
      document.getElementById('startTimer').addEventListener('click', startTimer);
      document.getElementById('pauseTimer').addEventListener('click', pauseTimer);
      document.getElementById('resetTimer').addEventListener('click', resetTimer);
    }

    function startTimer() {
      if (timerRunning) return;
      timerRunning = true;
      practiceCount++;
      localStorage.setItem('practiceCount', String(practiceCount));
      updateStats();

      timerInterval = setInterval(() => {
        timerSeconds--;
        updateTimerDisplay();

        if (timerSeconds <= 0) {
          clearInterval(timerInterval);
          timerRunning = false;
          showToast("Time's up! Consultation complete.", 'success');
        }
      }, 1000);
    }

    function pauseTimer() {
      clearInterval(timerInterval);
      timerRunning = false;
    }

    function resetTimer() {
      clearInterval(timerInterval);
      timerRunning = false;
      timerSeconds = 720;
      updateTimerDisplay();
    }

    function updateTimerDisplay() {
      const elapsed = 720 - timerSeconds;
      const remaining = timerSeconds;
      const mins = Math.floor(remaining / 60);
      const secs = remaining % 60;

      const display = document.getElementById('timerDisplay');
      const phase = document.getElementById('timerPhase');
      const hint = document.getElementById('timerHint');

      display.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

      display.classList.remove('warning', 'danger', 'success');

      if (!timerRunning && elapsed === 0) {
        phase.textContent = "Ready to Start";
        hint.textContent = "Press Start to begin your 12-minute consultation practice";
        return;
      }

      if (elapsed < 20) {
        phase.textContent = "üö™ OPENING";
        hint.textContent = "Quick greeting - confirm identity. 20 seconds max!";
        display.classList.add('success');
      } else if (elapsed < 240) {
        phase.textContent = "üë§ PATIENT'S PART";
        hint.textContent = "Story ‚Üí Impact ‚Üí ICE. Use OPEN questions. Don't interrupt!";
        display.classList.add('success');
      } else if (elapsed < 360) {
        phase.textContent = "ü©∫ DOCTOR'S PART";
        hint.textContent = "Medical questions, red flags, closed questions. Summarize first!";
      } else if (elapsed < 390) {
        phase.textContent = "‚ö†Ô∏è TRANSITION NOW!";
        hint.textContent = "\"So let's talk about what we're going to do...\" MOVE TO MANAGEMENT!";
        display.classList.add('danger');
      } else if (elapsed < 600) {
        phase.textContent = "üìã SHARED PART - MANAGEMENT";
        hint.textContent = "Think out loud! Address ICE in your plan. This is worth 43%!";
        display.classList.add('warning');
      } else if (elapsed < 690) {
        phase.textContent = "üõ°Ô∏è SAFETY NET & FOLLOW-UP";
        hint.textContent = "\"If X happens, do Y...\" Warning signs, when to return, follow-up plan.";
      } else {
        phase.textContent = "‚úÖ CLOSING";
        hint.textContent = "Brief summary of plan. \"Any questions?\" Wrap up!";
        display.classList.add('success');
      }

      if (timerSeconds <= 0) {
        phase.textContent = "‚è∞ TIME'S UP!";
        hint.textContent = "Consultation complete. How did you do?";
      }
    }

    // ============ FLASHCARDS ============
    function initFlashcards() {
      document.getElementById('flashcard').addEventListener('click', flipCard);
      document.getElementById('flipCard').addEventListener('click', flipCard);
      document.getElementById('prevCard').addEventListener('click', prevCard);
      document.getElementById('nextCard').addEventListener('click', nextCard);
      document.getElementById('shuffleCards').addEventListener('click', shuffleCards);
      updateFlashcard();
    }

    function flipCard() { 
      document.getElementById('flashcard').classList.toggle('flipped'); 
    }

    function prevCard() {
      document.getElementById('flashcard').classList.remove('flipped');
      currentFlashcard = (currentFlashcard - 1 + shuffledFlashcards.length) % shuffledFlashcards.length;
      setTimeout(updateFlashcard, 100);
    }

    function nextCard() {
      document.getElementById('flashcard').classList.remove('flipped');
      currentFlashcard = (currentFlashcard + 1) % shuffledFlashcards.length;
      setTimeout(updateFlashcard, 100);
    }

    function shuffleCards() {
      shuffledFlashcards = [...flashcardData].sort(() => Math.random() - 0.5);
      currentFlashcard = 0;
      document.getElementById('flashcard').classList.remove('flipped');
      updateFlashcard();
      showToast('Cards shuffled!', 'success');
    }

    function updateFlashcard() {
      const card = shuffledFlashcards[currentFlashcard];
      document.getElementById('flashcardFront').textContent = card.q;
      document.getElementById('flashcardBack').textContent = card.a;
      document.getElementById('flashcardProgress').textContent =
        `Card ${currentFlashcard + 1} of ${shuffledFlashcards.length}`;
    }

    // ============ QUIZ ============
    function initQuiz() {
      document.getElementById('nextQuestion').addEventListener('click', nextQuizQuestion);
      document.getElementById('restartQuiz').addEventListener('click', restartQuiz);
      startNewQuiz();
    }

    function startNewQuiz() {
      shuffledQuiz = [...quizData].sort(() => Math.random() - 0.5).slice(0, 10);
      currentQuestion = 0;
      quizScore = 0;
      answered = false;

      document.getElementById('quizFeedback').classList.add('hidden');
      document.getElementById('nextQuestion').classList.add('hidden');

      showQuizQuestion();
    }

    function showQuizQuestion() {
      if (currentQuestion >= shuffledQuiz.length) {
        showQuizResults();
        return;
      }

      const q = shuffledQuiz[currentQuestion];
      document.getElementById('quizQuestion').textContent = q.q;
      document.getElementById('quizProgress').textContent =
        `Question ${currentQuestion + 1} of ${shuffledQuiz.length}`;

      document.getElementById('quizScoreDisplay').textContent =
        `Score: ${quizScore}/${currentQuestion}`;

      const optionsContainer = document.getElementById('quizOptions');
      optionsContainer.innerHTML = '';

      q.options.forEach((option, i) => {
        const btn = document.createElement('button');
        btn.className = 'quiz-option';
        btn.textContent = option;
        btn.addEventListener('click', () => selectAnswer(i));
        optionsContainer.appendChild(btn);
      });

      const fb = document.getElementById('quizFeedback');
      fb.classList.add('hidden');
      fb.textContent = '';
      fb.classList.remove('correct', 'incorrect');

      document.getElementById('nextQuestion').classList.add('hidden');
      answered = false;
    }

    function selectAnswer(index) {
      if (answered) return;
      answered = true;

      const q = shuffledQuiz[currentQuestion];
      const options = document.querySelectorAll('.quiz-option');

      options.forEach((opt, i) => {
        opt.classList.add('disabled');
        if (i === q.correct) opt.classList.add('correct');
        if (i === index && i !== q.correct) opt.classList.add('incorrect');
      });

      const feedback = document.getElementById('quizFeedback');
      feedback.classList.remove('hidden');

      if (index === q.correct) {
        quizScore++;
        feedback.classList.add('correct');
        feedback.classList.remove('incorrect');
        feedback.textContent = `‚úÖ Correct! ${q.explanation}`;
      } else {
        feedback.classList.add('incorrect');
        feedback.classList.remove('correct');
        feedback.textContent = `‚ùå Incorrect. ${q.explanation}`;
      }

      document.getElementById('quizScoreDisplay').textContent =
        `Score: ${quizScore}/${currentQuestion + 1}`;

      // Persist cumulative stats
      quizResults.correct += (index === q.correct ? 1 : 0);
      quizResults.total += 1;
      localStorage.setItem('quizResults', JSON.stringify(quizResults));
      updateStats();

      document.getElementById('nextQuestion').classList.remove('hidden');
    }

    function nextQuizQuestion() {
      currentQuestion++;
      showQuizQuestion();
    }

    function showQuizResults() {
      const container = document.getElementById('quizOptions');
      container.innerHTML = '';

      document.getElementById('quizQuestion').textContent = 
        `Quiz Complete! You scored ${quizScore} out of ${shuffledQuiz.length}`;
      document.getElementById('quizProgress').textContent = 'Finished!';

      const percentage = Math.round((quizScore / shuffledQuiz.length) * 100);
      
      const feedback = document.getElementById('quizFeedback');
      feedback.classList.remove('hidden', 'incorrect');
      feedback.classList.add('correct');
      
      if (percentage >= 80) {
        feedback.textContent = `üéâ Excellent! ${percentage}% - You're well prepared!`;
      } else if (percentage >= 60) {
        feedback.textContent = `üëç Good effort! ${percentage}% - Keep practicing!`;
      } else {
        feedback.textContent = `üìö ${percentage}% - Review the material and try again!`;
        feedback.classList.remove('correct');
        feedback.classList.add('incorrect');
      }

      document.getElementById('nextQuestion').classList.add('hidden');
    }

    function restartQuiz() {
      startNewQuiz();
    }

    // ============ CHECKLIST ============
    function initChecklist() {
      const container = document.getElementById('checklistContainer');
      container.innerHTML = '';

      let totalItems = 0;
      let checkedItems = 0;

      for (const [section, items] of Object.entries(checklistData)) {
        const sectionDiv = document.createElement('div');
        sectionDiv.className = 'checklist-section';
        sectionDiv.innerHTML = `<h3>${section}</h3>`;

        items.forEach((item, i) => {
          const id = `${section}-${i}`;
          const isChecked = checklistState[id] === true;
          totalItems++;
          if (isChecked) checkedItems++;

          const itemDiv = document.createElement('div');
          itemDiv.className = `checklist-item ${isChecked ? 'checked' : ''}`;
          itemDiv.innerHTML = `
            <input type="checkbox" id="${id}" ${isChecked ? 'checked' : ''}>
            <label for="${id}">${item}</label>
          `;

          const checkbox = itemDiv.querySelector('input');
          checkbox.addEventListener('change', () => {
            checklistState[id] = checkbox.checked;
            localStorage.setItem('checklistState', JSON.stringify(checklistState));
            itemDiv.classList.toggle('checked', checkbox.checked);
            updateChecklistProgress();
          });

          sectionDiv.appendChild(itemDiv);
        });

        container.appendChild(sectionDiv);
      }

      updateChecklistProgress();
    }

    function updateChecklistProgress() {
      let totalItems = 0;
      let checkedItems = 0;

      for (const [section, items] of Object.entries(checklistData)) {
        items.forEach((item, i) => {
          const id = `${section}-${i}`;
          totalItems++;
          if (checklistState[id] === true) checkedItems++;
        });
      }

      const percentage = totalItems > 0 ? Math.round((checkedItems / totalItems) * 100) : 0;
      document.getElementById('checklistPercent').textContent = `${percentage}%`;
      document.getElementById('checklistProgressBar').style.width = `${percentage}%`;
    }
  </script>
</body>
</html>