<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contraception â€“ Assessment | Oneâ€‘Page Algorithm (NICE CKS 2024)</title>
  <style>
    /* ========= Design Tokens ========= */
    :root {
      --bg: #0b0c10;            /* dark base for depth */
      --panel: #111317;         /* card background */
      --muted: #9aa3af;        /* secondary text */
      --text: #e8eaed;          /* primary text */
      --brand: #6ee7b7;         /* teal */
      --brand-2: #93c5fd;       /* blue */
      --accent: #fda4af;        /* rose */
      --warn: #fde68a;          /* amber */
      --danger: #fca5a5;        /* red */
      --ok: #86efac;            /* green */
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 18px;
      --radius-sm: 12px;
    }

    /* Light theme */
    [data-theme="light"] {
      --bg: #f7fafc;
      --panel: #ffffff;
      --muted: #6b7280;
      --text: #111827;
      --brand: #0ea5e9;
      --brand-2: #7c3aed;
      --accent: #db2777;
      --warn: #b45309;
      --danger: #b91c1c;
      --ok: #047857;
      --shadow: 0 10px 25px rgba(2,6,23,.08);
    }

    html, body {
      height: 100%;
    }

    body {
      margin: 0;
      background: radial-gradient(1200px 800px at 10% -10%, rgba(147,197,253,.12), transparent 60%),
                  radial-gradient(1000px 600px at 90% -20%, rgba(110,231,183,.12), transparent 60%),
                  var(--bg);
      color: var(--text);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    .wrap {
      max-width: 1040px;
      margin: 32px auto 64px;
      padding: 0 20px;
    }

    /* ========= Header ========= */
    .header {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 16px;
      align-items: center;
      margin-bottom: 18px;
    }

    .title {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo {
      width: 44px; height: 44px; border-radius: 14px; display: grid; place-items: center;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      box-shadow: var(--shadow);
      color: #00131a; font-weight: 800;
    }

    h1 {
      font-size: clamp(22px, 3vw, 34px);
      line-height: 1.15;
      margin: 0;
      letter-spacing: -0.02em;
    }

    .subtitle {
      margin: 2px 0 0; color: var(--muted); font-size: 14px;
    }

    /* ========= Actions ========= */
    .actions { display: flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end; }

    .btn {
      appearance: none; border: 0; cursor: pointer;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      color: var(--text);
      padding: 10px 14px; border-radius: 999px; font-weight: 600; font-size: 14px;
      display: inline-flex; align-items: center; gap: 10px; box-shadow: var(--shadow);
    }
    .btn:hover { filter: brightness(1.05); transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .btn.primary { background: linear-gradient(135deg, var(--brand), var(--brand-2)); color: #07131b; }

    .chip { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background: rgba(255,255,255,.06); color: var(--muted); font-size: 12px; }

    /* ========= Utility Bar ========= */
    .utility {
      display: grid; grid-template-columns: 1fr auto; gap: 14px; align-items: center;
      background: rgba(255,255,255,.05); border: 1px solid rgba(255,255,255,.08);
      padding: 12px; border-radius: var(--radius);
      backdrop-filter: blur(6px);
    }

    .search { position: relative; }
    .search input {
      width: 100%; border: 0; outline: 0; padding: 12px 42px 12px 40px; border-radius: 12px;
      background: var(--panel); color: var(--text); box-shadow: var(--shadow);
    }
    .search svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: .7; }

    .legend { display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
    .legend .tag { padding:6px 10px; border-radius:999px; font-size:12px; font-weight:600; }
    .ukm1{background:rgba(134,239,172,.18); color: var(--ok);}  /* UKMEC 1 */
    .ukm2{background:rgba(147,197,253,.18); color: var(--brand-2);} /* UKMEC 2 */
    .ukm3{background:rgba(253,230,138,.18); color: var(--warn);} /* UKMEC 3 */
    .ukm4{background:rgba(252,165,165,.18); color: var(--danger);} /* UKMEC 4 */

    /* ========= Grid ========= */
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(12, 1fr); margin-top: 18px; }
    .col-12{ grid-column: span 12; }
    .col-8{ grid-column: span 8; }
    .col-6{ grid-column: span 6; }
    .col-4{ grid-column: span 4; }

    @media (max-width: 900px){ .col-8,.col-6,.col-4{ grid-column: span 12; } }

    /* ========= Card ========= */
    .card {
      background: var(--panel); border-radius: var(--radius); padding: 16px 16px 12px; box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.06);
    }

    .card h2, .card h3 { margin: 0 0 6px; line-height: 1.2; letter-spacing: -0.01em; }
    .card h2 small { color: var(--muted); font-weight: 600; font-size: .75em; }
    .card p { margin: 8px 0; color: var(--muted); }
    .card ul { margin: 8px 0 0 1rem; padding: 0; }
    .card li { margin: 6px 0; }

    .step { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
    .step .num { width: 28px; height: 28px; border-radius: 999px; display:grid; place-items:center; font-weight:800; color:#07131b; background: linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow: var(--shadow);}    

    .badges { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
    .badge { padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700; }
    .ok { background: rgba(134,239,172,.18); color: var(--ok);} 
    .warn { background: rgba(253,230,138,.18); color: var(--warn);} 
    .danger { background: rgba(252,165,165,.18); color: var(--danger);} 
    .info { background: rgba(147,197,253,.18); color: var(--brand-2);} 

    details { border: 1px dashed rgba(255,255,255,.08); padding: 10px 12px; border-radius: var(--radius-sm); background: rgba(255,255,255,.02); }
    summary { cursor: pointer; font-weight: 700; }

    .two-col { columns: 2; column-gap: 22px; }
    @media (max-width: 900px){ .two-col{ columns:1; } }

    .footer { margin-top: 16px; color: var(--muted); font-size: 12px; text-align: center; }

    /* ========= Print ========= */
    @media print {
      :root { --bg:#fff; --panel:#fff; --text:#000; --muted:#333; }
      body { background:#fff; }
      .actions, .utility { display:none !important; }
      .wrap { margin: 0; }
      @page { size: A4; margin: 12mm; }
      .card { break-inside: avoid; box-shadow: none; border: 1px solid #e5e7eb; }
      .grid { gap: 10px; }
      .col-8,.col-6,.col-4 { grid-column: span 6; }
      .col-12 { grid-column: span 12; }
      .two-col { columns: 2; }
    }
  </style>
</head>
<body>
  <div class="wrap" id="app">

    <header class="header">
      <div class="title">
        <div class="logo" aria-hidden="true">CKS</div>
        <div>
          <h1>Contraception â€“ Assessment Â· Oneâ€‘Page Clinical Algorithm</h1>
          <p class="subtitle">Based on NICE CKS (UK), last revised JanÂ 2024. For rapid recall during consultations. Not a substitute for full UKMEC/FSRH guidance.</p>
        </div>
      </div>
      <div class="actions">
        <button class="btn" id="toggleTheme" title="Toggle light/dark">ğŸŒ“ <span>Theme</span></button>
        <button class="btn" id="expandAll" title="Expand all sections">â• <span>Expand</span></button>
        <button class="btn" id="collapseAll" title="Collapse all sections">â– <span>Collapse</span></button>
        <button class="btn primary" onclick="window.print()" title="Print to PDF">ğŸ–¨ï¸ <span>Print</span></button>
      </div>
    </header>

    <div class="utility">
      <div class="search">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input id="q" type="search" placeholder="Type to filter sections (e.g., â€˜migraineâ€™, â€˜postpartumâ€™, â€˜lamotrigineâ€™)" aria-label="Filter sections">
      </div>
      <div class="legend">
        <span class="tag ukm1" title="UKMEC 1 â€“ No restriction">UKMECÂ 1</span>
        <span class="tag ukm2" title="UKMEC 2 â€“ Advantages outweigh risks">UKMECÂ 2</span>
        <span class="tag ukm3" title="UKMEC 3 â€“ Risks outweigh benefits">UKMECÂ 3</span>
        <span class="tag ukm4" title="UKMEC 4 â€“ Unacceptable risk">UKMECÂ 4</span>
      </div>
    </div>

    <div class="badges" style="margin:10px 0 4px;">
      <span class="chip">Focus: **Assessment & selection** (not EC details)</span>
      <span class="chip">Audience: UK Primary Care</span>
      <span class="chip">Consider local STI prevalence</span>
    </div>

    <section class="grid" id="cards">

      <!-- STEP 1: Initial -->
      <article class="card col-8" data-tags="initial assessment preferences stis safeguarding fraser capacity">
        <div class="step"><div class="num">1</div><h2>Initial steps</h2></div>
        <ul class="two-col">
          <li><strong>Clarify request & preferences</strong> â€” method, fertility plans, beliefs, partner/family attitudes.</li>
          <li><strong>Inform on all methods</strong> incl. LARC: efficacy, mechanism, common adverse effects, benefits/risks, drug interactions, <em>return to fertility</em>.</li>
          <li><strong>Exclude pregnancy</strong> (see criteria).</li>
          <li><strong>STI risk</strong> â€” test if indicated; promote safer sex; consider local prevalence.</li>
          <li><strong>Safeguarding</strong> â€” under 16: apply <strong>Fraser criteria</strong>; consider abuse/nonâ€‘consensual sex; vulnerable adults: assess capacity/consent.</li>
        </ul>
      </article>

      <!-- STEP 2: Excluding pregnancy -->
      <article class="card col-4" data-tags="exclude pregnancy quick start ec hcg">
        <div class="step"><div class="num">2</div><h2>Excluding pregnancy</h2></div>
        <p>Reasonably certain <em>not pregnant</em> if any one applies <span class="badge ok">and no symptoms/signs</span>:</p>
        <ul>
          <li>No intercourse since start of last normal period/abortion/miscarriage/childbirth.</li>
          <li>Correct & consistent use of reliable contraception (barriers acceptable if used every time).</li>
          <li>Within <strong>5 days</strong> of onset of normal menses or postâ€‘abortion/miscarriage/ectopic/GTN evacuation.</li>
          <li><strong>&lt;21 days postpartum</strong> (not breastfeeding) or fully breastfeeding, amenorrhoeic, <strong>&lt;6 months</strong> postpartum.</li>
          <li>&gt;21 days since intercourse <strong>and</strong> negative highâ€‘sensitivity urine hCG (~20 mIU/mL).</li>
        </ul>
        <details open>
          <summary>Unable to exclude?</summary>
          <ul>
            <li>Assess need for <strong>emergency contraception (EC)</strong>.</li>
            <li><strong>Quick start</strong> POP/implant/CHC if acceptable; <span class="badge warn">DMPA less preferred</span> but consider if others unsuitable.</li>
            <li>Explain limited evidence for DMPA exposure in very early pregnancy.</li>
          </ul>
        </details>
      </article>

      <!-- STEP 3: Method selection overview -->
      <article class="card col-12" data-tags="ukmec method selection chc pop implant dmpa iud iuc barrier natural sterilisation">
        <div class="step"><div class="num">3</div><h2>Method selection â€” UKMECâ€‘guided highlights</h2></div>
        <div class="grid">
          <div class="col-4">
            <h3>Combined hormonal (CHC)</h3>
            <ul>
              <li><span class="badge danger">Avoid (UKMECÂ 4)</span>: migraine <em>with aura</em>, VTE history/current VTE (on AC), major surgery + prolonged immob., hypertension â‰¥160/100, vascular disease.</li>
              <li><span class="badge warn">Not recommended (UKMECÂ 3)</span>: smoker â‰¥35y (any), BMI â‰¥35, diabetes with vascular disease, multiple CVD risks, family history VTE &lt;45y, immobility (nonâ€‘surgical), controlled HTN or 140â€“159/90â€“99.</li>
            </ul>
          </div>
          <div class="col-4">
            <h3>Progestogenâ€‘only</h3>
            <ul>
              <li><strong>POP / Implant</strong>: generally UKMECÂ 1â€“2 across comorbidities. Watch <strong>drug interactions</strong> (enzyme inducers).</li>
              <li><strong>DMPA</strong>: review â‰¤2â€‘yearly; <span class="badge warn">avoid &lt;18Â y unless last resort</span>; avoid if major osteoporosis risk; HTN + vascular disease â†’ <span class="badge warn">UKMECÂ 3</span>.</li>
              <li><strong>Drospirenone POP</strong>: assess renal function, hyperkalaemia risk, interacting Kâ€‘sparing drugs; consider U&E/BP monitoring in CKD risk >50y.</li>
            </ul>
          </div>
          <div class="col-4">
            <h3>Intrauterine (Cuâ€‘IUD / LNGâ€‘IUD)</h3>
            <ul>
              <li>Highly effective LARC; effectiveness userâ€‘independent.</li>
              <li><span class="badge danger">Do not insert</span> with active PID, purulent cervicitis, gonorrhoea, postpartum sepsis (UKMECÂ 4). If device already in situ, benefits usually outweigh risks (UKMECÂ 2).</li>
              <li><strong>Fibroids distorting cavity</strong>: IUC risks outweigh benefits (UKMECÂ 3). No distortion: UKMECÂ 1.</li>
            </ul>
          </div>
        </div>
        <div class="badges"><span class="badge info">Always offer condoms for STI protection</span><span class="badge info">Sterilisation = permanent</span><span class="badge info">Natural methods = lower efficacy</span></div>
      </article>

      <!-- STEP 4: Special populations -->
      <article class="card col-8" data-tags="postpartum breastfeeding not breastfeeding iud insertion windows vte risk">
        <div class="step"><div class="num">4</div><h2>Special populations â€” Postpartum</h2></div>
        <div class="grid">
          <div class="col-6">
            <h3>Breastfeeding</h3>
            <ul>
              <li><strong>IUD</strong>: &lt;48h OK (UKMECÂ 1); 48hâ€“&lt;4w <span class="badge warn">UKMECÂ 3</span>; â‰¥4w OK.</li>
              <li><strong>CHC</strong>: <span class="badge danger">Avoid &lt;6Â weeks</span> (UKMECÂ 4). â‰¥6Â weeks to &lt;6Â months primarily breastfeeding â†’ UKMECÂ 1â€“2; â‰¥6Â months â†’ UKMECÂ 1.</li>
              <li>Other hormonal methods: generally UKMECÂ 1â€“2 at all stages.</li>
            </ul>
          </div>
          <div class="col-6">
            <h3>Not breastfeeding</h3>
            <ul>
              <li><strong>IUD</strong>: same timing as above; avoid with postpartum sepsis (UKMECÂ 4).</li>
              <li><strong>CHC</strong>:
                <ul>
                  <li>&lt;3Â w with VTE risk (BMIâ‰¥30, CS, PPH, immobility, transfusion, preâ€‘eclampsia, smoking): <span class="badge danger">UKMECÂ 4</span>.</li>
                  <li>&lt;3Â w without VTE risk: <span class="badge warn">UKMECÂ 3</span>.</li>
                  <li>3â€“&lt;6Â w with VTE risk: <span class="badge warn">UKMECÂ 3</span>.</li>
                  <li>3â€“&lt;6Â w without VTE risk: all hormonal OK (UKMECÂ 1â€“2).</li>
                  <li>â‰¥6Â w: all hormonal OK (UKMECÂ 1).</li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </article>

      <article class="card col-4" data-tags="adolescents under 18 fraser bmd sti testing follow up">
        <div class="step"><div class="num">4b</div><h2>Special populations â€” Under 18</h2></div>
        <ul>
          <li>All methods can be considered; avoid <strong>routine hormonal contraception</strong> before menarche.</li>
          <li><strong>DMPA</strong>: last resort only; avoid if osteoporosis risk; review â‰¤2â€‘yearly.</li>
          <li>Emphasise <strong>condoms</strong> and <strong>STI testing</strong> (2Â w & 12Â w postâ€‘UPSI).</li>
          <li>Followâ€‘up within <strong>3Â months</strong> of starting hormonal contraception.</li>
        </ul>
      </article>

      <!-- STEP 5: Comorbidities quick picks -->
      <article class="card col-12" data-tags="comorbidities migraine hypertension diabetes vte obesity pid sti fibroids ectopic abnormal bleeding">
        <div class="step"><div class="num">5</div><h2>Comorbidities â€” quick pointers</h2></div>
        <div class="grid">
          <div class="col-4">
            <h3>Migraine & Headache</h3>
            <ul>
              <li><strong>Nonâ€‘migrainous</strong>: all OK (UKMECÂ 1).</li>
              <li><strong>Migraine w/o aura</strong>: may <em>initiate</em> CHC (UKMECÂ 2); if it develops on CHC â†’ switch (UKMECÂ 3).</li>
              <li><strong>Migraine with aura (ever)</strong>: <span class="badge danger">avoid CHC</span> (UKMECÂ 4). Past â‰¥5Â y aura â†’ CHC <span class="badge warn">UKMECÂ 3</span>.</li>
            </ul>
          </div>
          <div class="col-4">
            <h3>Hypertension</h3>
            <ul>
              <li>â‰¥160/100: <span class="badge danger">no CHC</span> (UKMECÂ 4).</li>
              <li>Controlled or 140â€“159/90â€“99: CHC <span class="badge warn">UKMECÂ 3</span>.</li>
              <li>Vascular disease: <span class="badge danger">no CHC</span>; DMPA <span class="badge warn">UKMECÂ 3</span>. Others OK (UKMECÂ 1â€“2).</li>
            </ul>
          </div>
          <div class="col-4">
            <h3>Diabetes</h3>
            <ul>
              <li>No vascular disease: all OK (UKMECÂ 1â€“2).</li>
              <li>With nephropathy/retinopathy/neuropathy/vascular: <strong>avoid CHC</strong> (UKMECÂ 3). Others OK.</li>
              <li>History of GDM: all OK (UKMECÂ 1).</li>
            </ul>
          </div>
          <div class="col-4">
            <h3>VTE / Risk factors</h3>
            <ul>
              <li>Hx VTE / current VTE / major surgery + immob.: <span class="badge danger">no CHC</span> (UKMECÂ 4).</li>
              <li>FHx VTE &lt;45y; immobility (nonâ€‘surgical): CHC <span class="badge warn">UKMECÂ 3</span>.</li>
              <li>Others (POP/implant/IUC): UKMECÂ 1â€“2.</li>
            </ul>
          </div>
          <div class="col-4">
            <h3>Obesity & Smoking</h3>
            <ul>
              <li><strong>BMI â‰¥35</strong>: CHC <span class="badge warn">UKMECÂ 3</span>. Patch less effective if >90Â kg; implant may need earlier replacement in heavier women (manufacturer advice).</li>
              <li><strong>Smoker â‰¥35y</strong>: â‰¥15 cig/day <span class="badge danger">CHC UKMECÂ 4</span>; &lt;15/day or quit &lt;1Â y: <span class="badge warn">UKMECÂ 3</span>.</li>
              <li>DMPA may cause further weight gain.</li>
            </ul>
          </div>
          <div class="col-4">
            <h3>PID / STIs / Gynae</h3>
            <ul>
              <li>Active PID, purulent cervicitis, gonorrhoea: <span class="badge danger">do not insert IUD</span> (UKMECÂ 4). If in situ, usually leave (UKMECÂ 2).</li>
              <li>Asymptomatic chlamydia: IUD <span class="badge warn">UKMECÂ 3</span> to <span class="badge danger">4</span> depending on status; if already in situ, usually leave (UKMECÂ 2). Others OK.</li>
              <li>Abnormal bleeding: investigate; avoid implant/injectable (<span class="badge warn">UKMECÂ 3</span>); IUC usually OK with assessment.</li>
              <li>Fibroids with cavity distortion: IUC <span class="badge warn">UKMECÂ 3</span>.</li>
              <li>Past ectopic: all methods OK (UKMECÂ 1).</li>
            </ul>
          </div>
        </div>
      </article>

      <!-- STEP 6: Teratogens / Interactions -->
      <article class="card col-8" data-tags="teratogenic drugs pregnancy prevention plan larc highly effective dmpa supervised">
        <div class="step"><div class="num">6</div><h2>When teratogens are involved</h2></div>
        <ul class="two-col">
          <li>Use <strong>highly effective contraception</strong>: <span class="badge ok">LARC (implant, Cuâ€‘IUD, LNGâ€‘IUD)</span>.</li>
          <li><strong>DMPA</strong> can be considered highly effective if injections are onâ€‘schedule and documented.</li>
          <li>CHC/POP alone â†’ higher failure rates; consider additional method and condoms for STI protection.</li>
          <li>Ensure a <strong>pregnancy prevention plan</strong> is documented.</li>
        </ul>
      </article>

      <article class="card col-4" data-tags="drug interactions enzyme inducers lamotrigine griseofulvin vomiting diarrhoea orlistat rifampicin carbamazepine topiramate st johns wort">
        <h3>Key drug interactions</h3>
        <ul>
          <li><strong>Enzyme inducers</strong> (e.g., rifampicin/rifabutin; carbamazepine, phenytoin, phenobarbital, primidone, topiramate; some ARVs; bosentan, modafinil, aprepitant, StÂ Johnâ€™s Wort):
            <ul>
              <li>Prefer <strong>Cuâ€‘IUD, LNGâ€‘IUD, or DMPA</strong>. CHC/POP/implant may be reduced.</li>
            </ul>
          </li>
          <li><strong>Lamotrigine</strong>: avoid CHC (reduces levels during active pills; rebound in Hâ€‘free week). Desogestrel may raise lamotrigine; monitor if POP used.</li>
          <li><strong>Griseofulvin</strong>: avoid POP/implant; CHC generally avoided; if used, add condoms during & 28Â days after.</li>
          <li><strong>Severe diarrhoea/vomiting</strong> (e.g., orlistat): consider IUD/implant/DMPA; if CHC/POP, follow missedâ€‘pill rules and add condoms during illness.</li>
        </ul>
      </article>

      <!-- STEP 7: Always remember -->
      <article class="card col-12" data-tags="counselling condoms ukmec references safety">
        <div class="step"><div class="num">7</div><h2>Always</h2></div>
        <ul class="two-col">
          <li><strong>Offer condoms</strong> for STI protection regardless of chosen method.</li>
          <li>Document counselling, eligibility (UKMEC category), and followâ€‘up plan.</li>
          <li>Use full <strong>UKMEC</strong> tables/FSRH guidance for complex cases; consider specialist referral where needed.</li>
        </ul>
      </article>

    </section>

    <p class="footer">Â© For clinical use by healthcare professionals. Synthesised from NICE CKS Contraception â€“ Assessment (JanÂ 2024) and aligned FSRH guidance. Version: 1.0</p>
  </div>

  <script>
    // Theme persistence
    (function(){
      const root = document.documentElement;
      const current = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
      if(current==='light') root.setAttribute('data-theme','light');
      document.getElementById('toggleTheme').addEventListener('click', () => {
        const isLight = root.getAttribute('data-theme') === 'light';
        if(isLight){ root.removeAttribute('data-theme'); localStorage.setItem('theme','dark'); }
        else { root.setAttribute('data-theme','light'); localStorage.setItem('theme','light'); }
      });
    })();

    // Filter
    (function(){
      const q = document.getElementById('q');
      const cards = Array.from(document.querySelectorAll('#cards .card'));
      q.addEventListener('input', () => {
        const term = q.value.trim().toLowerCase();
        cards.forEach(c => {
          const hay = (c.innerText + ' ' + (c.dataset.tags||'')).toLowerCase();
          c.style.display = term && !hay.includes(term) ? 'none' : '';
        });
      });
    })();

    // Expand/Collapse all <details>
    (function(){
      const openAll = () => document.querySelectorAll('details').forEach(d => d.open = true);
      const closeAll = () => document.querySelectorAll('details').forEach(d => d.open = false);
      document.getElementById('expandAll').addEventListener('click', openAll);
      document.getElementById('collapseAll').addEventListener('click', closeAll);
    })();
  </script>
</body>
</html>