<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ob/Gyn Rapid Reference: Pregnancy Complications</title>
    <style>
        :root {
            --primary-bg: #f4f7f9;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --text-muted: #637381;
            
            /* Status Colors */
            --color-critical: #d32f2f; /* Red */
            --color-critical-bg: #ffebee;
            --color-warning: #f57c00; /* Orange */
            --color-warning-bg: #fff3e0;
            --color-safe: #388e3c; /* Green */
            --color-safe-bg: #e8f5e9;
            --color-info: #1976d2; /* Blue */
            --color-info-bg: #e3f2fd;

            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            
            --radius: 8px;
            --transition: all 0.2s ease;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }

        body {
            background-color: var(--primary-bg);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background: #fff;
            padding: 1rem 2rem;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            box-shadow: var(--shadow-sm);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .brand h1 { font-size: 1.25rem; font-weight: 700; color: var(--text-main); }
        .brand span { color: var(--color-info); }

        .search-container {
            position: relative;
            width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid #d1d5db;
            border-radius: 20px;
            font-size: 0.95rem;
            background: var(--primary-bg);
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--color-info);
            background: #fff;
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        /* --- Filters --- */
        .filters {
            display: flex;
            gap: 10px;
            margin-left: 20px;
        }

        .filter-btn {
            border: none;
            background: transparent;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-muted);
            transition: var(--transition);
        }

        .filter-btn:hover { background: #e0e0e0; }
        .filter-btn.active { background: #e0e0e0; color: var(--text-main); }
        
        .filter-btn.active[data-filter="critical"] { background: var(--color-critical); color: white; }
        .filter-btn.active[data-filter="moderate"] { background: var(--color-warning); color: white; }
        .filter-btn.active[data-filter="routine"] { background: var(--color-safe); color: white; }

        /* --- Main Layout --- */
        main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        /* --- Cards --- */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem;
            cursor: pointer;
            position: relative;
            border-left: 5px solid #ccc;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .card.critical { border-left-color: var(--color-critical); }
        .card.moderate { border-left-color: var(--color-warning); }
        .card.routine { border-left-color: var(--color-safe); }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .card-meta {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
        }

        .critical .card-meta { color: var(--color-critical); background: var(--color-critical-bg); }
        .moderate .card-meta { color: var(--color-warning); background: var(--color-warning-bg); }
        .routine .card-meta { color: var(--color-safe); background: var(--color-safe-bg); }

        .card-body {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.4;
            flex: 1;
        }

        .card-footer {
            margin-top: auto;
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            color: var(--color-info);
            font-weight: 600;
        }

        .card-footer svg { margin-right: 5px; width: 16px; height: 16px; }

        /* --- Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 100;
        }

        .modal-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }

        .modal {
            background: #fff;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.open .modal { transform: scale(1); }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fafafa;
        }

        .modal-title h2 { font-size: 1.5rem; color: var(--text-main); }
        .modal-subtitle { font-size: 0.9rem; color: var(--text-muted); margin-top: 4px; }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #999;
            cursor: pointer;
            transition: color 0.2s;
        }
        .close-btn:hover { color: var(--color-critical); }

        .modal-body {
            padding: 0;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr 1fr; /* Two column layout */
            gap: 0;
        }

        @media (max-width: 768px) {
            .modal-body { grid-template-columns: 1fr; }
        }

        .column {
            padding: 1.5rem;
        }

        .column-left {
            border-right: 1px solid #f0f0f0;
            background: #fff;
        }

        .column-right {
            background: #fafafa;
        }

        /* Sections within Modal */
        .section-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .red-flags-section .section-title { color: var(--color-critical); }
        .action-section .section-title { color: var(--color-info); }
        .safe-section .section-title { color: var(--color-safe); }

        /* Checklist Style */
        .checklist {
            list-style: none;
            margin-bottom: 2rem;
        }

        .checklist li {
            position: relative;
            padding-left: 24px;
            margin-bottom: 12px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .checklist li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 8px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .red-flags-section .checklist li::before { background: var(--color-critical); }
        .safe-section .checklist li::before { background: var(--color-safe); }
        .info-section .checklist li::before { background: var(--color-info); }
        .action-section .checklist li::before { 
            background: var(--color-info); 
            border-radius: 2px; /* Square for actions */
        }

        /* Action Table */
        .action-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .action-table th, .action-table td {
            text-align: left;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .action-table th { color: var(--text-muted); font-weight: 600; font-size: 0.8rem; }
        .action-table tr:last-child td { border-bottom: none; }
        
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .banner {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .banner.critical { background: var(--color-critical-bg); color: var(--color-critical); border: 1px solid rgba(211, 47, 47, 0.2); }
        .banner.info { background: var(--color-info-bg); color: var(--color-info); }

        /* SVG Icons Inline */
        .icon { width: 20px; height: 20px; }

    </style>
</head>
<body>

    <header>
        <div class="brand">
            <!-- Stethoscope Icon -->
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--color-info);">
                <path d="M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"></path>
                <path d="M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4"></path>
                <circle cx="20" cy="10" r="2"></circle>
            </svg>
            <h1>Ob/Gyn <span>QuickScan</span></h1>
        </div>

        <div style="display: flex; align-items: center;">
            <div class="filters">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="critical">Critical</button>
                <button class="filter-btn" data-filter="moderate">Urgent</button>
                <button class="filter-btn" data-filter="routine">Routine</button>
            </div>
            <div class="search-container">
                <span class="search-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </span>
                <input type="text" class="search-input" id="searchInput" placeholder="Search condition (e.g., Preeclampsia)...">
            </div>
        </div>
    </header>

    <main id="cardGrid" class="grid">
        <!-- Cards injected by JS -->
    </main>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <h2 id="modalTitle">Condition Name</h2>
                    <div class="modal-subtitle" id="modalSubtitle">Category • Last Updated Jan 2024</div>
                </div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                
                <!-- Left Column: Assessment & Flags -->
                <div class="column column-left">
                    
                    <div id="modalCriticalBanner" class="banner critical" style="display:none;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        <span>Immediate Medical Attention Required</span>
                    </div>

                    <div class="section-title red-flags-section">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        Red Flags & Symptoms
                    </div>
                    <ul class="checklist" id="modalRedFlags"></ul>

                    <div class="section-title info-section">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                        Key Info & Risk Factors
                    </div>
                    <p id="modalDescription" style="font-size: 0.95rem; color: #555; margin-bottom: 1rem; line-height: 1.5;"></p>
                    <ul class="checklist info-section" id="modalRisks"></ul>
                </div>

                <!-- Right Column: Actions & Management -->
                <div class="column column-right">
                    <div class="section-title action-section">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                        Immediate Actions & Plan
                    </div>
                    
                    <div id="modalActionsContainer">
                        <!-- Actions can be list or table -->
                    </div>

                    <div class="section-title safe-section" style="margin-top: 2rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                        Prevention / Follow-up
                    </div>
                    <ul class="checklist safe-section" id="modalPrevention"></ul>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- Data Source based on provided PDF ---
        const conditions = [
            {
                id: 'ectopic',
                name: 'Ectopic Pregnancy',
                urgency: 'critical',
                description: 'Fertilised ovum implants outside uterine cavity (97% fallopian tube). Global rate ~1.1-1.6%.',
                redFlags: [
                    'Unilateral abdominal pain',
                    'Vaginal bleeding',
                    'Amenorrhoea',
                    'Shoulder tip pain (suggests rupture)',
                    'Unstable vital signs / Orthostatic changes',
                    'Signs of intraperitoneal bleeding (acute abdomen)'
                ],
                risks: [
                    'Prior ectopic pregnancy',
                    'Tubal surgery',
                    'History of STIs',
                    'Smoking',
                    'IVF pregnancy',
                    'Pregnant despite IUD usage'
                ],
                actions: [
                    { label: 'Assess ABCs & Stability', priority: 'High' },
                    { label: 'Transvaginal Ultrasound', priority: 'High' },
                    { label: 'Serial Beta hCG titres', priority: 'High' },
                    { label: 'Consult Gynaecology immediately', priority: 'Critical' }
                ],
                prevention: [
                    'Early antenatal scanning',
                    'Education on risk factors'
                ]
            },
            {
                id: 'preeclampsia',
                name: 'Pre-eclampsia',
                urgency: 'critical',
                description: 'New-onset hypertension (>140/90) after 20 weeks, often with proteinuria. Occurs in ~4% of US pregnancies.',
                redFlags: [
                    'Severe headache (unrelieved by analgesia)',
                    'Visual disturbances (flashing lights, blurring)',
                    'Epigastric/RUQ pain',
                    'Seizures (Eclampsia)',
                    'Sudden swelling (face/hands)',
                    'Shortness of breath (pulmonary oedema)'
                ],
                risks: [
                    'First pregnancy',
                    'Age > 40',
                    'BMI > 30',
                    'History of pre-eclampsia',
                    'Chronic hypertension',
                    'Renal disease',
                    'Diabetes'
                ],
                actions: [
                    { label: 'Check BP & Proteinuria', priority: 'High' },
                    { label: 'Fetal monitoring (CTG)', priority: 'Moderate' },
                    { label: 'Magnesium Sulfate if severe/eclampsia', priority: 'Critical' },
                    { label: 'Plan for delivery (only cure)', priority: 'High' }
                ],
                prevention: [
                    'Low-dose aspirin 75-150mg daily (if high risk)',
                    'Calcium supplementation (if low intake)'
                ]
            },
            {
                id: 'hellp',
                name: 'HELLP Syndrome',
                urgency: 'critical',
                description: 'Severe form of pre-eclampsia: Haemolysis, Elevated Liver enzymes, Low Platelets. Occurs in 1-8/1000 pregnancies.',
                redFlags: [
                    'Significant RUQ or epigastric pain',
                    'Nausea/Vomiting (often misdiagnosed as viral)',
                    'Headache',
                    'Visual changes',
                    'Bleeding tendency'
                ],
                risks: [
                    'History of pre-eclampsia',
                    'Nulliparity',
                    'Age > 25'
                ],
                actions: [
                    { label: 'Urgent Labs: CBC, LFTs, Coagulation', priority: 'Critical' },
                    { label: 'Stabilize mother (BP, Seizure prophylaxis)', priority: 'Critical' },
                    { label: 'Immediate Obstetric consult', priority: 'Critical' },
                    { label: 'Prepare for immediate delivery', priority: 'Critical' }
                ],
                prevention: [
                    'Same as Pre-eclampsia',
                    'Rapid recognition of symptoms'
                ]
            },
            {
                id: 'abruption',
                name: 'Placental Abruption',
                urgency: 'critical',
                description: 'Premature separation of placenta. Occurs in 0.3-1% of births. High perinatal mortality.',
                redFlags: [
                    'Painful vaginal bleeding',
                    'Uterine tenderness',
                    'Rapidly changing uterine shape/tone',
                    'Fetal distress / Absent FHR',
                    'Maternal shock'
                ],
                risks: [
                    'Hypertensive disorders',
                    'Abdominal trauma',
                    'Cocaine use',
                    'Smoking',
                    'Polyhydramnios',
                    'Previous abruption'
                ],
                actions: [
                    { label: 'Emergency assessment (Mother & Baby)', priority: 'Critical' },
                    { label: 'Resuscitate with IV fluids/Blood', priority: 'Critical' },
                    { label: 'Continuous fetal monitoring', priority: 'High' },
                    { label: 'Emergency C-section if fetal distress', priority: 'Critical' }
                ],
                prevention: [
                    'Smoking cessation',
                    'Avoid cocaine',
                    'Manage hypertension'
                ]
            },
            {
                id: 'placenta_previa',
                name: 'Placenta Praevia',
                urgency: 'moderate',
                description: 'Placenta covering or near cervical os. Presents as painless 2nd/3rd trimester bleeding.',
                redFlags: [
                    'Painless, bright red vaginal bleeding',
                    'Bleeding may be intermittent or profuse'
                ],
                risks: [
                    'Previous C-section',
                    'Advanced maternal age',
                    'Multiparity',
                    'Smoking',
                    'Prior praevia'
                ],
                actions: [
                    { label: 'Speculum exam (ONLY in OR setup)', priority: 'Critical' },
                    { label: 'Transabdominal Ultrasound', priority: 'High' },
                    { label: 'Rh Immune Globulin if Rh-negative', priority: 'Moderate' },
                    { label: 'C-section delivery planning', priority: 'Moderate' }
                ],
                prevention: [
                    'Ultrasound screening at 20 weeks'
                ]
            },
            {
                id: 'gdm',
                name: 'Gestational Diabetes',
                urgency: 'moderate',
                description: 'Hyperglycaemia in pregnancy. Affects 16.7% of pregnancies globally.',
                redFlags: [
                    'Often asymptomatic',
                    'Polyuria, Polydipsia (if severe)'
                ],
                risks: [
                    'BMI > 30',
                    'Previous GDM or macrosomia',
                    'Family history of Type 2 DM',
                    'PCOS',
                    'Age > 40'
                ],
                actions: [
                    { label: 'OGTT (75g glucose) at 24-28 weeks', priority: 'Moderate' },
                    { label: 'Dietary modification', priority: 'Moderate' },
                    { label: 'Blood glucose monitoring', priority: 'Moderate' },
                    { label: 'Insulin/Metformin if diet fails', priority: 'Moderate' }
                ],
                prevention: [
                    'Weight management before pregnancy',
                    'Regular exercise'
                ]
            },
            {
                id: 'miscarriage',
                name: 'Miscarriage',
                urgency: 'moderate',
                description: 'Spontaneous loss <20-24 weeks. Occurs in up to 1/3 of pregnancies.',
                redFlags: [
                    'Vaginal bleeding (scant to heavy)',
                    'Suprapubic pain/Cramping',
                    'Passage of tissue'
                ],
                risks: [
                    'Older parental age',
                    'Uterine malformation',
                    'Antiphospholipid syndrome',
                    'Thrombophilias'
                ],
                actions: [
                    { label: 'Pelvic exam (assess cervical os)', priority: 'High' },
                    { label: 'Transvaginal Ultrasound', priority: 'High' },
                    { label: 'Serial Beta hCG', priority: 'Moderate' },
                    { label: 'Rhesus status check', priority: 'Moderate' }
                ],
                prevention: [
                    'Genetic counselling (recurrent)',
                    'Folic acid supplementation'
                ]
            },
            {
                id: 'uti',
                name: 'UTI in Pregnancy',
                urgency: 'moderate',
                description: 'Infection of kidneys/bladder. Considered complicated UTI. Risk of pyelonephritis.',
                redFlags: [
                    'Dysuria, Frequency, Urgency',
                    'Suprapubic pain',
                    'Fever/Chills (Pyelonephritis)',
                    'Flank pain'
                ],
                risks: [
                    'Asymptomatic bacteriuria (screen all)'
                ],
                actions: [
                    { label: 'Midstream urine culture', priority: 'Moderate' },
                    { label: 'Safe antibiotic therapy (e.g., Nitrofurantoin)', priority: 'Moderate' },
                    { label: 'Repeat test of cure', priority: 'Low' }
                ],
                prevention: [
                    'Screen for asymptomatic bacteriuria at first visit'
                ]
            },
            {
                id: 'list',
                name: 'Listeriosis',
                urgency: 'critical',
                description: 'Foodborne infection. Can cause fetal sepsis, meningitis, death.',
                redFlags: [
                    'Flu-like symptoms in mother',
                    'Fever, myalgias, headache',
                    'Back pain'
                ],
                risks: [
                    'Consuming unpasteurised milk/cheese',
                    'Raw/undercooked meat',
                    'Ready-to-eat deli meats'
                ],
                actions: [
                    { label: 'Blood cultures', priority: 'High' },
                    { label: 'Ampicillin +/- Gentamicin', priority: 'Critical' },
                    { label: 'High index of suspicion for fetal distress', priority: 'High' }
                ],
                prevention: [
                    'Avoid high-risk foods',
                    'Thorough cooking of meats'
                ]
            },
            {
                id: 'routines',
                name: 'Routine Antenatal Care',
                urgency: 'routine',
                description: 'Regular care to identify complications and promote health.',
                redFlags: [
                    'Missed appointments',
                    'Lack of fetal movements'
                ],
                risks: [
                    'Low socioeconomic status',
                    'Lack of education'
                ],
                actions: [
                    { label: 'Schedule visits: 4-28 wks (4 wkly), 28-36 wks (2 wkly), 36+ (weekly)', priority: 'Low' },
                    { label: 'Blood pressure check', priority: 'Low' },
                    { label: 'Urine protein/glucose', priority: 'Low' },
                    { label: 'Fetal growth assessment', priority: 'Low' }
                ],
                prevention: [
                    'Health education',
                    'Folic acid 400mcg daily (pre-conception to 12 wks)'
                ]
            }
        ];

        // --- DOM Elements ---
        const grid = document.getElementById('cardGrid');
        const searchInput = document.getElementById('searchInput');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const modal = document.getElementById('detailModal');

        // --- Render Functions ---
        function renderCards(filter = 'all', query = '') {
            grid.innerHTML = '';
            
            const filtered = conditions.filter(c => {
                const matchesFilter = filter === 'all' || c.urgency === filter;
                const matchesSearch = c.name.toLowerCase().includes(query.toLowerCase()) || 
                                      c.description.toLowerCase().includes(query.toLowerCase());
                return matchesFilter && matchesSearch;
            });

            if (filtered.length === 0) {
                grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; color: #888; padding: 2rem;">No conditions found matching criteria.</div>`;
                return;
            }

            filtered.forEach(c => {
                const card = document.createElement('div');
                card.className = `card ${c.urgency}`;
                card.onclick = () => openModal(c.id);
                
                const urgencyLabel = c.urgency === 'critical' ? 'CRITICAL' : c.urgency === 'moderate' ? 'URGENT' : 'ROUTINE';
                
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${c.name}</div>
                        <span class="card-meta">${urgencyLabel}</span>
                    </div>
                    <div class="card-body">
                        ${c.description.substring(0, 90)}...
                    </div>
                    <div class="card-footer">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        Quick Scan
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function openModal(id) {
            const c = conditions.find(item => item.id === id);
            if (!c) return;

            document.getElementById('modalTitle').innerText = c.name;
            document.getElementById('modalSubtitle').innerText = `${c.urgency.toUpperCase()} • Clinical Reference`;
            document.getElementById('modalDescription').innerText = c.description;

            // Critical Banner
            const banner = document.getElementById('modalCriticalBanner');
            if (c.urgency === 'critical') {
                banner.style.display = 'flex';
            } else {
                banner.style.display = 'none';
            }

            // Lists
            const flagsList = document.getElementById('modalRedFlags');
            flagsList.innerHTML = c.redFlags.map(f => `<li>${f}</li>`).join('');

            const risksList = document.getElementById('modalRisks');
            risksList.innerHTML = c.risks.map(r => `<li>${r}</li>`).join('');

            const preventList = document.getElementById('modalPrevention');
            preventList.innerHTML = c.prevention.map(p => `<li>${p}</li>`).join('');

            // Actions Table
            const actionsContainer = document.getElementById('modalActionsContainer');
            if (c.actions && c.actions.length > 0) {
                let tableHTML = `<table class="action-table"><thead><tr><th>Action</th><th>Priority</th></tr></thead><tbody>`;
                c.actions.forEach(a => {
                    const color = a.priority === 'Critical' ? 'var(--color-critical)' : 
                                  a.priority === 'High' ? 'var(--color-warning)' : 'var(--color-safe)';
                    tableHTML += `
                        <tr>
                            <td>${a.label}</td>
                            <td><span class="status-badge" style="background:${color}; color:white;">${a.priority}</span></td>
                        </tr>
                    `;
                });
                tableHTML += `</tbody></table>`;
                actionsContainer.innerHTML = tableHTML;
            } else {
                actionsContainer.innerHTML = '<p style="color:#888; font-style:italic;">Standard antenatal management.</p>';
            }

            modal.classList.add('open');
        }

        function closeModal() {
            modal.classList.remove('open');
        }

        // --- Event Listeners ---
        
        // Search
        searchInput.addEventListener('input', (e) => {
            const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
            renderCards(activeFilter, e.target.value);
        });

        // Filters
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderCards(btn.dataset.filter, searchInput.value);
            });
        });

        // Close Modal on outside click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        // Keyboard
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // Initialize
        renderCards();

    </script>
</body>
</html>