<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abnormal Uterine Bleeding - Clinical Algorithm</title>
    <style>
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #f1f5f9;
            --bg-card: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --accent-assessment: #818cf8;
            --accent-diagnosis: #34d399;
            --accent-treatment: #f87171;
            --accent-followup: #38bdf8;
            --red-badge: #ef4444;
            --amber-badge: #f59e0b;
            --green-badge: #10b981;
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border-color: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            transition: var(--transition);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: flex;
            gap: 2rem;
        }

        .main-content {
            flex: 1;
            padding-top: 1rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, var(--accent-assessment) 0%, var(--accent-diagnosis) 100%);
            border-radius: 16px;
            color: white;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 6px solid var(--card-color);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .assessment-card { --card-color: var(--accent-assessment); }
        .diagnosis-card { --card-color: var(--accent-diagnosis); }
        .treatment-card { --card-color: var(--accent-treatment); }
        .followup-card { --card-color: var(--accent-followup); }

        .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            cursor: pointer;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: var(--card-color);
            color: white;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-toggle {
            margin-left: auto;
            font-size: 1.2rem;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .card-content {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out;
        }

        .card.collapsed .card-content {
            max-height: 0;
        }

        .card.collapsed .card-toggle {
            transform: rotate(-90deg);
        }

        .subsection {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .subsection-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            white-space: nowrap;
        }

        .badge-red { background: var(--red-badge); }
        .badge-amber { background: var(--amber-badge); }
        .badge-green { background: var(--green-badge); }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .checklist-item:hover {
            transform: translateX(4px);
            border-color: var(--card-color);
        }

        .checklist-item input[type="checkbox"] {
            margin-top: 0.2rem;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checklist-item label {
            cursor: pointer;
            flex: 1;
        }

        .sidebar {
            width: 280px;
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .progress-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .progress-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
        }

        .progress-item:hover {
            background: var(--bg-secondary);
        }

        .progress-item.active {
            background: var(--card-color);
            color: white;
        }

        .progress-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            background: var(--bg-secondary);
        }

        .progress-item.active .progress-icon {
            background: rgba(255, 255, 255, 0.2);
        }

        .controls {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
            z-index: 100;
        }

        .control-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: var(--accent-assessment);
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .control-btn:hover {
            transform: scale(1.1);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .search-box {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--bg-card);
            border-radius: 12px;
            padding: 0.75rem;
            box-shadow: var(--shadow);
            display: none;
            z-index: 200;
        }

        .search-box input {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem;
            width: 250px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-radius: 8px;
            box-shadow: var(--shadow);
            max-height: 300px;
            overflow-y: auto;
            margin-top: 0.5rem;
            display: none;
        }

        .search-result {
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .search-result:hover {
            background: var(--bg-secondary);
        }

        .highlight {
            background: #fde047;
            color: #0f172a;
            padding: 0.125rem 0.25rem;
            border-radius: 4px;
        }

        .alert {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--red-badge);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            display: none;
            z-index: 300;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                padding: 1rem;
            }
            
            .sidebar {
                width: 100%;
                position: relative;
                top: 0;
            }
            
            .controls {
                bottom: 1rem;
                right: 1rem;
            }
        }

        .print-only {
            display: none;
        }

        @media print {
            .sidebar, .controls, .search-box, .alert {
                display: none !important;
            }
            
            .card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid var(--border-color);
            }
            
            .print-only {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Assessment of Abnormal Uterine Bleeding</h1>
        <p>Clinical Decision Support Algorithm | BMJ Best Practice Guidelines</p>
    </div>

    <div class="container">
        <div class="main-content">
            <!-- Assessment Card -->
            <div class="card assessment-card" id="assessment">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-icon">üìã</div>
                    <h2 class="card-title">Assessment</h2>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üìÖ</span>
                            Menstrual History
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cycle-frequency">
                            <label for="cycle-frequency">Frequency: ‚â•24 and ‚â§38 days is normal</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cycle-duration">
                            <label for="cycle-duration">Duration: ‚â§8 days is normal</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cycle-regularity">
                            <label for="cycle-regularity">Regularity: ¬±4 days variation is normal</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="bleeding-volume">
                            <label for="bleeding-volume">Volume: Heavy if interferes with quality of life</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="intermenstrual">
                            <label for="intermenstrual">Presence of intermenstrual bleeding</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="chronic-symptoms">
                            <label for="chronic-symptoms">Chronic if symptoms >6 months</label>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üîç</span>
                            Associated Symptoms & Risk Factors
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="fibroid-symptoms">
                            <label for="fibroid-symptoms">Urinary frequency, pelvic pressure, constipation (fibroids)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="adenomyosis-symptoms">
                            <label for="adenomyosis-symptoms">Pelvic pain, dysmenorrhoea, dyspareunia (adenomyosis)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="pcos-features">
                            <label for="pcos-features">Hirsutism, acne (PCOS)</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="hypothyroidism-features">
                            <label for="hypothyroidism-features">Weight gain, cold intolerance, fatigue (hypothyroidism)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="hyperprolactinaemia">
                            <label for="hyperprolactinaemia">Galactorrhoea (hyperprolactinaemia)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="endometrial-cancer-risk">
                            <label for="endometrial-cancer-risk">Early menarche, nulliparity, infertility, tamoxifen use (endometrial cancer risk)</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üíä</span>
                            Medication History
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="anticoagulants">
                            <label for="anticoagulants">Anticoagulants (check P-gp/CYP3A4 interactions)</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="hormonal-therapy">
                            <label for="hormonal-therapy">Hormonal therapies, tamoxifen</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="dopamine-drugs">
                            <label for="dopamine-drugs">Drugs affecting dopamine (antidepressants, phenothiazines)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="herbal-supplements">
                            <label for="herbal-supplements">Herbal supplements (ginseng, ginkgo, motherwort)</label>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>ü©∏</span>
                            Coagulation Disorder Screening
                        </div>
                        <div class="alert" id="coagulation-alert">
                            ‚ö†Ô∏è Positive screening - refer for hematology consultation and testing
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="heavy-menarche">
                            <label for="heavy-menarche">Heavy menstrual bleeding since menarche</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="postpartum-bleeding">
                            <label for="postpartum-bleeding">Postpartum hemorrhage OR surgery-related bleeding OR dental work bleeding</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="bruising">
                            <label for="bruising">Two of: bruising >5cm 1-2x/month, epistaxis 1-2x/month, gum bleeding, family history</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="positive-screen">
                            <label for="positive-screen">Positive screen for coagulation disorder</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>ü©∫</span>
                            Physical Examination
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="pelvic-exam">
                            <label for="pelvic-exam">Pelvic examination (speculum and bimanual)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="bleeding-sites">
                            <label for="bleeding-sites">Examine urethra, perineum, anus for bleeding sites</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="haemodynamic">
                            <label for="haemodynamic">Haemodynamic assessment (pulse, orthostatic BP)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="mass-palpation">
                            <label for="mass-palpation">Palpable firm masses or uterine enlargement</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cervical-polyp">
                            <label for="cervical-polyp">Polyps visible at cervical os</label>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üß™</span>
                            Initial Investigations
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="pregnancy-test">
                            <label for="pregnancy-test">Pregnancy test (urine/serum Œ≤-hCG)</label>
                            <span class="badge badge-green">Green</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="fbc">
                            <label for="fbc">Full blood count (FBC) - check for anemia</label>
                            <span class="badge badge-green">Green</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Diagnosis Card -->
            <div class="card diagnosis-card" id="diagnosis">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-icon">üî¨</div>
                    <h2 class="card-title">Diagnosis</h2>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="subsection">
                        <div class="subsection-header">
                            <span>ü©∏</span>
                            Laboratory Evaluation
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="tsh">
                            <label for="tsh">Thyroid-stimulating hormone (if hypothyroidism suspected)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="prolactin">
                            <label for="prolactin">Serum prolactin (if hyperprolactinaemia suspected)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="pcos-labs">
                            <label for="pcos-labs">PCOS workup: 17-hydroxyprogesterone, testosterone, LH/FSH ratio</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="ovulation-check">
                            <label for="ovulation-check">Luteal phase serum progesterone (if ovulation uncertain)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="coagulation-tests">
                            <label for="coagulation-tests">Coagulation tests (PT, aPTT, platelets, fibrinogen)</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="vwf-testing">
                            <label for="vwf-testing">von Willebrand factor testing (if positive screen)</label>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üì∑</span>
                            Imaging Studies
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="ultrasound-first">
                            <label for="ultrasound-first">Pelvic ultrasound FIRST if: adenomyosis suspected, palpable mass, obese patient</label>
                            <span class="badge badge-green">Green</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="tvus">
                            <label for="tvus">Transvaginal ultrasound (preferred for internal architecture)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="taus">
                            <label for="taus">Transabdominal ultrasound (for enlarged uterus/tumors)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="sonohysterography">
                            <label for="sonohysterography">Sonohysterography (to characterize endometrial abnormalities)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="mri">
                            <label for="mri">MRI (if TVUS declined/inappropriate, or to differentiate fibroids vs adenomyosis)</label>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üî¨</span>
                            Endometrial Biopsy
                        </div>
                        <div class="alert" id="biopsy-alert">
                            ‚ö†Ô∏è Consider endometrial biopsy in high-risk patients
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="biopsy-age">
                            <label for="biopsy-age">Age ‚â•45 years with AUB</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="biopsy-unopposed-estrogen">
                            <label for="biopsy-unopposed-estrogen">Younger women with unopposed estrogen exposure</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="biopsy-persistent">
                            <label for="biopsy-persistent">Persistent unexplained or treatment-resistant AUB</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="biopsy-tamoxifen">
                            <label for="biopsy-tamoxifen">Women taking tamoxifen</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="biopsy-obese-pcos">
                            <label for="biopsy-obese-pcos">Obese women with PCOS</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="biopsy-method">
                            <label for="biopsy-method">Blind biopsy NOT recommended for HMB - perform with hysteroscopy</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üîç</span>
                            Hysteroscopy
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="hysteroscopy-first">
                            <label for="hysteroscopy-first">FIRST if: persistent intermenstrual bleeding or risk factors for endometrial pathology</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="hysteroscopy-benefits">
                            <label for="hysteroscopy-benefits">Direct visualization + enables biopsy</label>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üìä</span>
                            Differential Diagnosis (PALM-COEIN)
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <strong>Common Causes:</strong>
                        </div>
                        
                        <div class="checklist-item">
                            <input type="checkbox" id="pcos-diff">
                            <label for="pcos-diff">Polycystic Ovary Syndrome (PCOS)</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="fibroids-diff">
                            <label for="fibroids-diff">Leiomyomata (uterine fibroids)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="polyp-diff">
                            <label for="polyp-diff">Endometrial polyp</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="endometrial-dysfunction">
                            <label for="endometrial-dysfunction">Endometrial dysfunction</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="iatrogenic-diff">
                            <label for="iatrogenic-diff">Iatrogenic causes</label>
                        </div>

                        <div style="margin: 1rem 0;">
                            <strong>Uncommon Causes:</strong>
                            <span class="badge badge-red">Red</span>
                        </div>
                        
                        <div class="checklist-item">
                            <input type="checkbox" id="endometrial-malignancy">
                            <label for="endometrial-malignancy">Endometrial malignancy/hyperplasia</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="adenomyosis-diff">
                            <label for="adenomyosis-diff">Adenomyosis</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="coagulopathy-diff">
                            <label for="coagulopathy-diff">Coagulopathy (e.g., von Willebrand disease)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cervical-cancer">
                            <label for="cervical-cancer">Cervical cancer</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="ovarian-cancer">
                            <label for="ovarian-cancer">Ovarian cancer (rare)</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Treatment Card -->
            <div class="card treatment-card" id="treatment">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-icon">üíä</div>
                    <h2 class="card-title">Treatment</h2>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üö®</span>
                            Urgent Management of Heavy Bleeding
                        </div>
                        <div class="alert" id="urgent-alert">
                            üö® EMERGENCY: Check for hypovolaemia and haemodynamic instability
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="iv-access">
                            <label for="iv-access">Establish large-bore IV access</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="fluid-resuscitation">
                            <label for="fluid-resuscitation">IV fluid resuscitation and blood transfusion as needed</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="tranexamic-acid">
                            <label for="tranexamic-acid">Tranexamic acid as soon as possible for severe bleeding</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="hormonal-therapy-acute">
                            <label for="hormonal-therapy-acute">Hormonal therapy: IV conjugated equine estrogen, COC, or oral progestins</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="uterine-tamponade">
                            <label for="uterine-tamponade">Uterine tamponade with Foley catheter if needed</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="emergent-surgery">
                            <label for="emergent-surgery">Emergent exploratory surgery for massive hemorrhage with shock</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üíä</span>
                            Medical Management
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="nsaids">
                            <label for="nsaids">NSAIDs for dysmenorrhoea and mild bleeding</label>
                            <span class="badge badge-green">Green</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="tranexamic-acid-chronic">
                            <label for="tranexamic-acid-chronic">Tranexamic acid (non-hormonal option)</label>
                            <span class="badge badge-green">Green</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="hormonal-contraception">
                            <label for="hormonal-contraception">Hormonal contraception (COC, progestin-only)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="levonorgestrel-iud">
                            <label for="levonorgestrel-iud">Levonorgestrel-releasing intrauterine system</label>
                            <span class="badge badge-green">Green</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="progestin-therapy">
                            <label for="progestin-therapy">Cyclic or continuous progestin therapy</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="gonadotropin-analogues">
                            <label for="gonadotropin-analogues">GnRH analogues (short-term, severe cases)</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üè•</span>
                            Surgical Management
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="hysteroscopy-resection">
                            <label for="hysteroscopy-resection">Hysteroscopic resection of polyps/submucosal fibroids</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="myomectomy">
                            <label for="myomectomy">Myomectomy (for fibroids in women desiring fertility)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="endometrial-ablation">
                            <label for="endometrial-ablation">Endometrial ablation (for completed families)</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="hysterectomy">
                            <label for="hysterectomy">Hysterectomy (definitive treatment, severe cases)</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>ü©∏</span>
                            Iron Deficiency Management
                        </div>
                        <div class="alert" id="iron-alert">
                            ‚ö†Ô∏è Check for symptoms: dizziness, syncope, headache, dyspnoea, tachycardia
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="iron-studies">
                            <label for="iron-studies">Check ferritin, iron studies</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="oral-iron">
                            <label for="oral-iron">Oral iron supplementation</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="iv-iron">
                            <label for="iv-iron">IV iron if oral not tolerated or severe deficiency</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="transfusion">
                            <label for="transfusion">Blood transfusion if hemodynamically unstable or Hb <70 g/L</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Follow-up Card -->
            <div class="card followup-card" id="followup">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-icon">üìà</div>
                    <h2 class="card-title">Follow-up</h2>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üìÖ</span>
                            Monitoring Schedule
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="reassess-3months">
                            <label for="reassess-3months">Reassess symptoms at 3 months after initiating treatment</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="fbc-followup">
                            <label for="fbc-followup">Repeat FBC to monitor anemia resolution</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="side-effects">
                            <label for="side-effects">Monitor for medication side effects (especially hormonal therapies)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="treatment-efficacy">
                            <label for="treatment-efficacy">Assess treatment efficacy: bleeding patterns, quality of life</label>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üéØ</span>
                            Referral Criteria
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="refer-suspected-malignancy">
                            <label for="refer-suspected-malignancy">Suspected malignancy (endometrial, cervical, ovarian)</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="refer-coagulopathy">
                            <label for="refer-coagulopathy">Confirmed or suspected coagulopathy</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="refer-treatment-failure">
                            <label for="refer-treatment-failure">Treatment failure after 3-6 months of medical therapy</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="refer-severe-anemia">
                            <label for="refer-severe-anemia">Severe anemia requiring transfusion or IV iron</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="refer-fertility">
                            <label for="refer-fertility">Women desiring fertility with structural lesions</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="refer-complex-cases">
                            <label for="refer-complex-cases">Complex cases requiring multidisciplinary care</label>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>‚ö†Ô∏è</span>
                            Red Flags - Require Immediate Review
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="red-flag-severe">
                            <label for="red-flag-severe">Severe bleeding with hemodynamic instability</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="red-flag-postmenopausal">
                            <label for="red-flag-postmenopausal">Postmenopausal bleeding</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="red-flag-intermenstrual">
                            <label for="red-flag-intermenstrual">Persistent intermenstrual bleeding</label>
                            <span class="badge badge-amber">Amber</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="red-flag-weight-loss">
                            <label for="red-flag-weight-loss">Associated unexplained weight loss</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="red-flag-pelvic-mass">
                            <label for="red-flag-pelvic-mass">Palpable pelvic mass with ascites</label>
                            <span class="badge badge-red">Red</span>
                        </div>
                    </div>

                    <div class="subsection">
                        <div class="subsection-header">
                            <span>üìö</span>
                            Patient Education
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="education-cause">
                            <label for="education-cause">Discuss likely cause of abnormal bleeding</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="education-treatment">
                            <label for="education-treatment">Explain treatment options and expected outcomes</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="education-iron">
                            <label for="education-iron">Provide dietary advice for iron deficiency</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="education-warning">
                            <label for="education-warning">Educate on warning signs requiring immediate medical attention</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="education-menstrual">
                            <label for="education-menstrual">Discuss normal menstrual patterns vs abnormal bleeding</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="progress-card">
                <h3 class="progress-title">Progress</h3>
                <div class="progress-item active" onclick="scrollToSection('assessment')">
                    <div class="progress-icon" style="background: var(--accent-assessment); color: white;">üìã</div>
                    <span>Assessment</span>
                </div>
                <div class="progress-item" onclick="scrollToSection('diagnosis')">
                    <div class="progress-icon" style="background: var(--accent-diagnosis); color: white;">üî¨</div>
                    <span>Diagnosis</span>
                </div>
                <div class="progress-item" onclick="scrollToSection('treatment')">
                    <div class="progress-icon" style="background: var(--accent-treatment); color: white;">üíä</div>
                    <span>Treatment</span>
                </div>
                <div class="progress-item" onclick="scrollToSection('followup')">
                    <div class="progress-icon" style="background: var(--accent-followup); color: white;">üìà</div>
                    <span>Follow-up</span>
                </div>
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <div class="checklist-item">
                        <small>Total Checked: <span id="progress-counter">0</span> / <span id="progress-total">0</span></small>
                    </div>
                    <div style="width: 100%; height: 6px; background: var(--bg-secondary); border-radius: 3px; margin-top: 0.5rem;">
                        <div id="progress-bar" style="width: 0%; height: 100%; background: var(--accent-assessment); border-radius: 3px; transition: var(--transition);"></div>
                    </div>
                </div>
            </div>

            <div class="progress-card" style="margin-top: 1rem;">
                <h3 class="progress-title">Severity Indicators</h3>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <div class="badge badge-red" style="width: fit-content;">Red: Urgent</div>
                    <div class="badge badge-amber" style="width: fit-content;">Amber: Caution</div>
                    <div class="badge badge-green" style="width: fit-content;">Green: Stable</div>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="control-btn" onclick="toggleSearch()" title="Search">üîç</button>
        <button class="control-btn" onclick="toggleTheme()" title="Toggle Theme">üåô</button>
        <button class="control-btn" onclick="window.print()" title="Print">üñ®Ô∏è</button>
        <button class="control-btn" onclick="resetAll()" title="Reset All">üîÑ</button>
    </div>

    <div class="alert" id="floating-alert"></div>

    <div class="search-box" id="search-box">
        <input type="text" placeholder="Search algorithm..." id="search-input" oninput="performSearch()">
        <div class="search-results" id="search-results"></div>
    </div>

    <script>
        // Initialize
        let totalItems = 0;
        let checkedItems = 0;
        let currentAlert = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Count all checkboxes
            totalItems = document.querySelectorAll('input[type="checkbox"]').length;
            document.getElementById('progress-total').textContent = totalItems;
            
            // Load saved state
            loadState();
            updateProgress();
            
            // Add event listeners to all checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateProgress();
                    saveState();
                });
                
                // Coagulation screening alert
                if (checkbox.id === 'positive-screen') {
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            showAlert('‚ö†Ô∏è Positive coagulation screen - Refer to haematology', 'red');
                        }
                    });
                }
                
                // Biopsy alert
                if (checkbox.id === 'biopsy-age' || checkbox.id === 'biopsy-unopposed-estrogen' || 
                    checkbox.id === 'biopsy-persistent' || checkbox.id === 'biopsy-tamoxifen' || 
                    checkbox.id === 'biopsy-obese-pcos') {
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            showAlert('‚ö†Ô∏è Consider endometrial biopsy - Endometrial pathology risk', 'amber');
                        }
                    });
                }
                
                // Urgent management
                if (checkbox.id === 'iv-access' || checkbox.id === 'fluid-resuscitation' || 
                    checkbox.id === 'tranexamic-acid' || checkbox.id === 'hormonal-therapy-acute') {
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            showAlert('üö® ACUTE HEMORRHAGE - Immediate intervention required', 'red');
                        }
                    });
                }
            });
            
            // Initial card states
            document.querySelectorAll('.card').forEach((card, index) => {
                if (index !== 0) {
                    card.classList.add('collapsed');
                }
            });
            
            // Scroll listener for progress tracking
            window.addEventListener('scroll', updateProgressOnScroll);
            updateProgressOnScroll();
        });

        function toggleCard(header) {
            const card = header.parentElement;
            const isCollapsed = card.classList.contains('collapsed');
            
            // Close all cards
            document.querySelectorAll('.card').forEach(c => c.classList.add('collapsed'));
            
            // Open clicked card if it was closed
            if (isCollapsed) {
                card.classList.remove('collapsed');
            }
            
            // Scroll to card
            setTimeout(() => {
                card.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function updateProgress() {
            checkedItems = document.querySelectorAll('input[type="checkbox"]:checked').length;
            document.getElementById('progress-counter').textContent = checkedItems;
            
            const percentage = (checkedItems / totalItems) * 100;
            document.getElementById('progress-bar').style.width = percentage + '%';
        }

        function updateProgressOnScroll() {
            const cards = document.querySelectorAll('.card');
            const progressItems = document.querySelectorAll('.progress-item');
            
            cards.forEach((card, index) => {
                const rect = card.getBoundingClientRect();
                if (rect.top <= 100 && rect.bottom >= 100) {
                    progressItems.forEach(item => item.classList.remove('active'));
                    if (progressItems[index]) {
                        progressItems[index].classList.add('active');
                    }
                }
            });
        }

        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Expand the target card
                document.querySelectorAll('.card').forEach(c => c.classList.add('collapsed'));
                element.classList.remove('collapsed');
            }
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('abn-uterine-bleeding-theme', newTheme);
        }

        function toggleSearch() {
            const searchBox = document.getElementById('search-box');
            const input = document.getElementById('search-input');
            
            if (searchBox.style.display === 'block') {
                searchBox.style.display = 'none';
                clearHighlights();
            } else {
                searchBox.style.display = 'block';
                input.focus();
            }
        }

        function performSearch() {
            const query = document.getElementById('search-input').value.toLowerCase().trim();
            const resultsBox = document.getElementById('search-results');
            
            clearHighlights();
            resultsBox.innerHTML = '';
            
            if (query.length < 2) {
                resultsBox.style.display = 'none';
                return;
            }
            
            const results = [];
            const textNodes = [];
            
            // Find all text content
            document.querySelectorAll('.card-content label, .card-content .subsection-header').forEach(element => {
                const text = element.textContent.toLowerCase();
                if (text.includes(query)) {
                    results.push({
                        element: element,
                        text: element.textContent
                    });
                }
            });
            
            // Display results
            if (results.length > 0) {
                results.forEach(result => {
                    const div = document.createElement('div');
                    div.className = 'search-result';
                    div.textContent = result.text.substring(0, 60) + '...';
                    div.onclick = () => {
                        scrollToElement(result.element);
                        toggleSearch();
                    };
                    resultsBox.appendChild(div);
                });
                resultsBox.style.display = 'block';
                
                // Highlight matches
                highlightText(query);
            } else {
                resultsBox.style.display = 'none';
            }
        }

        function highlightText(query) {
            document.querySelectorAll('.card-content label, .card-content .subsection-header').forEach(element => {
                const text = element.textContent;
                const regex = new RegExp(`(${query})`, 'gi');
                if (text.toLowerCase().includes(query)) {
                    element.innerHTML = text.replace(regex, '<span class="highlight">$1</span>');
                    element.classList.add('highlighted');
                }
            });
        }

        function clearHighlights() {
            document.querySelectorAll('.highlighted').forEach(element => {
                element.innerHTML = element.textContent;
                element.classList.remove('highlighted');
            });
        }

        function scrollToElement(element) {
            const card = element.closest('.card');
            if (card) {
                document.querySelectorAll('.card').forEach(c => c.classList.add('collapsed'));
                card.classList.remove('collapsed');
                setTimeout(() => {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }

        function showAlert(message, type = 'red') {
            const alert = document.getElementById('floating-alert');
            
            // Clear previous alert
            if (currentAlert) {
                clearTimeout(currentAlert);
            }
            
            alert.textContent = message;
            alert.style.background = type === 'red' ? 'var(--red-badge)' : 'var(--amber-badge)';
            alert.style.display = 'block';
            
            currentAlert = setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        function resetAll() {
            if (confirm('Are you sure you want to reset all progress?')) {
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                localStorage.removeItem('abn-uterine-bleeding-state');
                updateProgress();
                showAlert('Progress reset successfully', 'green');
            }
        }

        function saveState() {
            const state = {};
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                state[checkbox.id] = checkbox.checked;
            });
            localStorage.setItem('abn-uterine-bleeding-state', JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem('abn-uterine-bleeding-state');
            if (savedState) {
                const state = JSON.parse(savedState);
                Object.keys(state).forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.checked = state[id];
                    }
                });
            }
            
            const savedTheme = localStorage.getItem('abn-uterine-bleeding-theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
        }

        // Close search on click outside
        document.addEventListener('click', function(e) {
            const searchBox = document.getElementById('search-box');
            if (searchBox.style.display === 'block' && !searchBox.contains(e.target) && !e.target.closest('.control-btn')) {
                searchBox.style.display = 'none';
                clearHighlights();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                toggleSearch();
            }
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                resetAll();
            }
        });
    </script>
</body>
</html>