<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bronchiolitis — Rapid Decision Guide (UK-style)</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1733;
      --panel2:#0d142c;
      --text:#eaf0ff;
      --muted:#b9c4e6;
      --line:rgba(255,255,255,.10);

      --red:#ff3b30;
      --amber:#ffb020;
      --green:#25d366;
      --blue:#4aa3ff;
      --purple:#b388ff;

      --shadow: 0 16px 40px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(74,163,255,.20), transparent 55%),
        radial-gradient(900px 600px at 90% 20%, rgba(179,136,255,.18), transparent 60%),
        radial-gradient(1000px 700px at 60% 100%, rgba(37,211,102,.10), transparent 60%),
        linear-gradient(180deg, #070a14, var(--bg));
      color:var(--text);
    }

    a{color:inherit}
    .wrap{max-width:1200px;margin:0 auto;padding:22px 18px 64px}
    .topbar{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between;
      padding:18px 18px; border:1px solid var(--line); border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.025));
      box-shadow: var(--shadow);
      position:sticky; top:12px; z-index:10; backdrop-filter: blur(10px);
    }
    .title{
      display:flex; gap:12px; align-items:center;
      min-width: 320px;
    }
    .title h1{margin:0;font-size:18px;letter-spacing:.2px}
    .title p{margin:4px 0 0;color:var(--muted);font-size:13px}
    .pillrow{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line);
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .pill strong{color:var(--text);font-weight:700}
    .pill .dot{width:9px;height:9px;border-radius:99px;background:var(--blue); box-shadow:0 0 0 3px rgba(74,163,255,.15)}
    .pill.red .dot{background:var(--red); box-shadow:0 0 0 3px rgba(255,59,48,.18)}
    .pill.green .dot{background:var(--green); box-shadow:0 0 0 3px rgba(37,211,102,.15)}
    .pill.amber .dot{background:var(--amber); box-shadow:0 0 0 3px rgba(255,176,32,.16)}
    .pill.purple .dot{background:var(--purple); box-shadow:0 0 0 3px rgba(179,136,255,.16)}

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:16px;
      margin-top:16px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr; }
      .pillrow{justify-content:flex-start}
      .title{min-width: unset}
      .topbar{position:relative; top:auto}
    }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    }
    .hd .hleft{display:flex; align-items:center; gap:10px}
    .hd h2{
      margin:0; font-size:14px; letter-spacing:.2px
    }
    .sub{margin:0;color:var(--muted); font-size:12px}
    .body{padding:14px 16px}

    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      user-select:none;
    }
    .badge b{color:var(--text)}
    .badge.red{border-color: rgba(255,59,48,.35); background: rgba(255,59,48,.10); color:#ffd6d3}
    .badge.green{border-color: rgba(37,211,102,.35); background: rgba(37,211,102,.10); color:#d8ffe8}
    .badge.amber{border-color: rgba(255,176,32,.35); background: rgba(255,176,32,.10); color:#fff1d2}
    .badge.blue{border-color: rgba(74,163,255,.35); background: rgba(74,163,255,.10); color:#d7ecff}

    .kpis{display:grid; grid-template-columns: repeat(4,1fr); gap:10px}
    @media (max-width: 980px){
      .kpis{grid-template-columns: repeat(2,1fr)}
    }
    .kpi{
      padding:12px 12px;
      border-radius: var(--radius2);
      border:1px solid var(--line);
      background: rgba(0,0,0,.12);
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .kpi:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.18); background: rgba(0,0,0,.16)}
    .kpi .lab{color:var(--muted); font-size:11px}
    .kpi .val{margin-top:6px; font-family: var(--mono); font-size:18px; font-weight:800}
    .kpi .hint{margin-top:4px; color:var(--muted); font-size:11px}

    .formgrid{
      display:grid; grid-template-columns: 1fr 1fr; gap:12px;
    }
    @media (max-width: 540px){
      .formgrid{grid-template-columns: 1fr}
    }
    .field{
      border:1px solid var(--line);
      border-radius: var(--radius2);
      padding:10px 10px;
      background: rgba(0,0,0,.10);
      transition: border-color .12s ease, background .12s ease;
    }
    .field:hover{border-color: rgba(255,255,255,.18); background: rgba(0,0,0,.14)}
    .field label{
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      color:var(--muted); font-size:12px; margin-bottom:8px;
    }
    .field input[type="number"], .field select{
      width:100%;
      padding:10px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: var(--text);
      outline:none;
      font-size:14px;
    }
    .field input[type="range"]{width:100%}
    .minirow{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      user-select:none;
      transition: transform .10s ease, border-color .10s ease, background .10s ease;
      font-size:12px;
      color: var(--muted);
    }
    .chip:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.18)}
    .chip[aria-pressed="true"]{
      color: var(--text);
      border-color: rgba(74,163,255,.45);
      background: rgba(74,163,255,.10);
    }
    .chip.red[aria-pressed="true"]{
      border-color: rgba(255,59,48,.45);
      background: rgba(255,59,48,.12);
    }
    .chip.green[aria-pressed="true"]{
      border-color: rgba(37,211,102,.45);
      background: rgba(37,211,102,.12);
    }
    .chip.amber[aria-pressed="true"]{
      border-color: rgba(255,176,32,.50);
      background: rgba(255,176,32,.12);
    }

    .callout{
      padding:14px 14px;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: rgba(0,0,0,.10);
    }
    .callout.red{border-color: rgba(255,59,48,.40); background: rgba(255,59,48,.10)}
    .callout.green{border-color: rgba(37,211,102,.35); background: rgba(37,211,102,.10)}
    .callout.amber{border-color: rgba(255,176,32,.35); background: rgba(255,176,32,.10)}
    .callout.blue{border-color: rgba(74,163,255,.35); background: rgba(74,163,255,.10)}
    .callout h3{margin:0 0 8px; font-size:13px; display:flex; gap:10px; align-items:center}
    .callout p{margin:0;color:var(--muted); font-size:12px; line-height:1.45}
    .callout ul{margin:10px 0 0; padding-left: 18px; color: var(--text)}
    .callout li{margin:7px 0; color: var(--text)}
    .callout li span{color:var(--muted)}

    details{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(0,0,0,.10);
      overflow:hidden;
      transition: border-color .12s ease, transform .12s ease, background .12s ease;
    }
    details:hover{border-color: rgba(255,255,255,.18); background: rgba(0,0,0,.14)}
    summary{
      list-style:none;
      cursor:pointer;
      padding:14px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      user-select:none;
    }
    summary::-webkit-details-marker{display:none}
    .sumleft{display:flex; gap:10px; align-items:center}
    .sumtitle{font-weight:800; font-size:13px}
    .sumhint{font-size:12px; color:var(--muted); margin-top:2px}
    .sumtext{display:flex; flex-direction:column}
    .chev{
      width:22px;height:22px; border-radius: 8px;
      border:1px solid var(--line);
      display:grid; place-items:center; color: var(--muted);
      background: rgba(255,255,255,.03);
      transition: transform .14s ease;
      flex:0 0 auto;
    }
    details[open] .chev{transform: rotate(90deg)}
    details .content{padding: 0 14px 14px; color: var(--text)}
    .twoCol{
      display:grid; grid-template-columns: 1fr 1fr; gap:12px;
    }
    @media (max-width: 980px){
      .twoCol{grid-template-columns: 1fr}
    }

    .list{
      margin:0; padding-left: 18px;
    }
    .list li{margin:8px 0}
    .muted{color:var(--muted)}
    .sep{height:1px;background:var(--line); margin:14px 0}

    .btnrow{display:flex; gap:10px; flex-wrap:wrap}
    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:800;
      transition: transform .10s ease, border-color .10s ease, background .10s ease;
    }
    button:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.18); background: rgba(255,255,255,.06)}
    button.primary{
      border-color: rgba(74,163,255,.45);
      background: rgba(74,163,255,.12);
    }
    button.danger{
      border-color: rgba(255,59,48,.45);
      background: rgba(255,59,48,.12);
    }

    .footer{
      margin-top:18px;
      color: var(--muted);
      font-size: 12px;
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      opacity:.95;
    }
    .kbd{
      font-family: var(--mono);
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 8px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.12);
      color: var(--muted);
    }

    /* tiny icon system */
    .ico{width:18px;height:18px;display:inline-block;vertical-align:middle}
    .ico svg{width:100%;height:100%}
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar" role="banner">
      <div class="title">
        <span class="ico" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M12 2c4.6 0 8.5 3.4 9.1 8 .6 4.7-2.4 9-7 9.8V22h-4v-2.2c-4.6-.8-7.6-5.1-7-9.8C3.5 5.4 7.4 2 12 2Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8"/>
            <path d="M9.5 13.2c.7 1.1 1.5 1.7 2.5 1.7s1.8-.6 2.5-1.7" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
        </span>
        <div>
          <h1>Bronchiolitis — Rapid Decision Guide</h1>
          <p>Scannable triage + actions (UK thresholds). Built for fast bedside decisions.</p>
        </div>
      </div>

      <div class="pillrow" aria-label="Quick legend">
        <span class="pill red"><span class="dot"></span><strong>Red</strong> emergency / immediate escalation</span>
        <span class="pill amber"><span class="dot"></span><strong>Amber</strong> consider referral / closer observation</span>
        <span class="pill green"><span class="dot"></span><strong>Green</strong> supportive care / safe discharge criteria</span>
        <span class="pill purple"><span class="dot"></span><strong>Purple</strong> avoid / low-value interventions</span>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: INTERACTIVE TRIAGE -->
      <section class="card" aria-label="Interactive triage">
        <div class="hd">
          <div class="hleft">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M4 12h6l2-7 4 14 2-7h2" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
            <div>
              <h2>Decision Engine</h2>
              <p class="sub">Enter vitals/risk → instant disposition + actions.</p>
            </div>
          </div>
          <span id="dispoBadge" class="badge blue" title="Disposition">Awaiting inputs</span>
        </div>

        <div class="body">
          <div class="kpis" aria-label="Key thresholds">
            <div class="kpi" title="Referral threshold example (primary care)">
              <div class="lab">O₂ threshold</div>
              <div class="val"><span id="kpiO2">—</span>%</div>
              <div class="hint"><span class="muted">Key cut-offs: 92% (primary care) / 90–92% (age + comorbidity)</span></div>
            </div>
            <div class="kpi" title="Respiratory rate thresholds used in guidance">
              <div class="lab">RR</div>
              <div class="val"><span id="kpiRR">—</span>/min</div>
              <div class="hint"><span class="muted">&gt;60 consider referral; &gt;70 severe distress</span></div>
            </div>
            <div class="kpi" title="Feeding">
              <div class="lab">Oral intake</div>
              <div class="val"><span id="kpiFeed">—</span>%</div>
              <div class="hint"><span class="muted">50–75% triggers admission/referral consideration</span></div>
            </div>
            <div class="kpi" title="Age in weeks">
              <div class="lab">Age</div>
              <div class="val"><span id="kpiAge">—</span>wk</div>
              <div class="hint"><span class="muted">&lt;6 weeks changes O₂ cut-off; &lt;12 weeks is higher risk</span></div>
            </div>
          </div>

          <div class="sep"></div>

          <div class="formgrid" aria-label="Inputs">
            <div class="field">
              <label>
                <span>Age (weeks)</span>
                <span class="kbd" id="ageReadout">12</span>
              </label>
              <input id="ageWeeks" type="range" min="0" max="104" step="1" value="12" />
              <div class="minirow">
                <span class="badge blue" id="ageBand">≥6 weeks</span>
                <span class="badge amber" id="riskAgeBand">≤12 weeks risk</span>
              </div>
            </div>

            <div class="field">
              <label>
                <span>SpO₂ on room air (%)</span>
                <span class="kbd" id="spo2Readout">96</span>
              </label>
              <input id="spo2" type="range" min="70" max="100" step="1" value="96" />
              <div class="minirow" id="spo2Badges"></div>
            </div>

            <div class="field">
              <label>
                <span>Respiratory rate (/min)</span>
              </label>
              <input id="rr" type="number" min="0" max="120" value="46" inputmode="numeric"/>
              <div class="minirow" id="rrBadges"></div>
            </div>

            <div class="field">
              <label>
                <span>Oral intake (% usual)</span>
              </label>
              <input id="feed" type="number" min="0" max="100" value="85" inputmode="numeric"/>
              <div class="minirow" id="feedBadges"></div>
            </div>
          </div>

          <div class="sep"></div>

          <div class="minirow" aria-label="Toggles">
            <div class="chip red" role="button" tabindex="0" aria-pressed="false" id="apnoeaChip" title="Observed or reported apnoea">
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 21s7-4.6 7-10.5S14.9 2.5 12 6.2 5 5.1 5 10.5 12 21 12 21Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                  <path d="M9.2 12.2h5.6" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
              </span>
              Apnoea
            </div>

            <div class="chip amber" role="button" tabindex="0" aria-pressed="false" id="severeDistressChip" title="Marked recession / grunting / severe distress">
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 2 2.5 20h19L12 2Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                  <path d="M12 8v5" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                  <path d="M12 16.8h.01" stroke="rgba(234,240,255,.9)" stroke-width="2.6" stroke-linecap="round"/>
                </svg>
              </span>
              Severe distress
            </div>

            <div class="chip amber" role="button" tabindex="0" aria-pressed="false" id="cyanosisChip" title="Central cyanosis">
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 20c4.4 0 8-3.6 8-8s-3.6-8-8-8-8 3.6-8 8 3.6 8 8 8Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8"/>
                  <path d="M8.7 12.2c1.3 1.9 2.4 2.8 3.3 2.8s2-.9 3.3-2.8" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
              </span>
              Central cyanosis
            </div>

            <div class="chip amber" role="button" tabindex="0" aria-pressed="false" id="comorbChip" title="Underlying health conditions (esp heart/resp/immune)">
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M7 12h10" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                  <path d="M12 7v10" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                  <path d="M4 4h16v16H4V4Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                </svg>
              </span>
              Comorbidity
            </div>

            <div class="chip amber" role="button" tabindex="0" aria-pressed="false" id="premChip" title="Prematurity (risk factor; lower threshold to refer)">
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M8 3h8v6H8V3Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                  <path d="M7 21v-7a5 5 0 0 1 10 0v7" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
              </span>
              Prematurity
            </div>

            <div class="chip amber" role="button" tabindex="0" aria-pressed="false" id="dehydChip" title="Clinical dehydration features">
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 2s6 7 6 12a6 6 0 0 1-12 0c0-5 6-12 6-12Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                  <path d="M9.2 14.8c.6 1.2 1.6 1.8 2.8 1.8s2.2-.6 2.8-1.8" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
              </span>
              Dehydration signs
            </div>
          </div>

          <div class="sep"></div>

          <div id="dispositionPanel" class="callout blue" aria-live="polite">
            <h3>
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8"/>
                  <path d="M12 8v5l3 2" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
              Suggested disposition
            </h3>
            <p id="dispoText">Adjust inputs to generate disposition and immediate actions.</p>
            <div class="minirow" id="actionBadges"></div>
          </div>

          <div class="sep"></div>

          <div class="btnrow">
            <button class="primary" id="copySummary">Copy one-line handover</button>
            <button id="reset">Reset</button>
            <button class="danger" id="showRedFlags">Jump to RED FLAGS</button>
          </div>

          <div class="footer">
            <div>Hover cards + badges for scannability. Keyboard: <span class="kbd">Tab</span>, <span class="kbd">Enter</span>.</div>
            <div class="muted">Source thresholds aligned to uploaded reference. :contentReference[oaicite:1]{index=1}</div>
          </div>
        </div>
      </section>

      <!-- RIGHT: HIGH-YIELD PANELS -->
      <aside class="card" aria-label="Key guidance panels">
        <div class="hd">
          <div class="hleft">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M4 4h16v16H4V4Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                <path d="M7 8h10M7 12h10M7 16h7" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
              </svg>
            </span>
            <div>
              <h2>High-Yield Actions</h2>
              <p class="sub">Red flags, referral, supportive care, “don’t do”.</p>
            </div>
          </div>
          <span class="badge blue" title="Clinical scope">Infants &lt;2y</span>
        </div>

        <div class="body" style="display:flex; flex-direction:column; gap:12px">

          <div id="redflags" class="callout red">
            <h3>
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 2 2.5 20h19L12 2Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                  <path d="M12 8v5" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                  <path d="M12 16.8h.01" stroke="rgba(234,240,255,.9)" stroke-width="2.6" stroke-linecap="round"/>
                </svg>
              </span>
              RED FLAGS → emergency hospital care
              <span class="badge red" style="margin-left:auto">Act now</span>
            </h3>
            <ul class="list">
              <li><b>Apnoea</b> <span>(observed or reported)</span></li>
              <li><b>Severe respiratory distress</b> <span>(eg grunting / marked recession; RR &gt;70)</span></li>
              <li><b>Persistent hypoxaemia on air</b> <span>(&lt;90% if ≥6w; &lt;92% if &lt;6w or comorbidity)</span></li>
            </ul>
          </div>

          <details>
            <summary>
              <div class="sumleft">
                <span class="ico" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M12 2c4.4 0 8 3.6 8 8 0 6-8 12-8 12S4 16 4 10c0-4.4 3.6-8 8-8Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                    <path d="M12 11.5a2.2 2.2 0 1 0 0-4.4 2.2 2.2 0 0 0 0 4.4Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8"/>
                  </svg>
                </span>
                <div class="sumtext">
                  <div class="sumtitle">Referral thresholds (primary care)</div>
                  <div class="sumhint">“Consider” vs “Immediate” — quick triggers.</div>
                </div>
              </div>
              <span class="chev" aria-hidden="true">›</span>
            </summary>
            <div class="content twoCol">
              <div class="callout amber">
                <h3>Consider hospital referral</h3>
                <ul class="list">
                  <li>Marked recession or grunting</li>
                  <li>RR &gt;70/min</li>
                  <li>Central cyanosis</li>
                  <li>SpO₂ &lt;92% (or persistently &lt;92%)</li>
                  <li>Looks seriously unwell</li>
                  <li>Feeding 50–75% usual</li>
                  <li>Dehydration signs</li>
                </ul>
              </div>
              <div class="callout red">
                <h3>Immediate emergency referral</h3>
                <ul class="list">
                  <li>Apnoea (observed/reported)</li>
                  <li>Severe distress persisting</li>
                  <li>Persistent SpO₂: &lt;90% (≥6w) / &lt;92% (&lt;6w or comorbidity)</li>
                </ul>
              </div>
              <div class="muted" style="grid-column:1/-1">
                Decision threshold adjusts for risk factors and social context (carer confidence, distance to care).
              </div>
            </div>
          </details>

          <details open>
            <summary>
              <div class="sumleft">
                <span class="ico" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M12 21s7-4.6 7-10.5S14.9 2.5 12 6.2 5 5.1 5 10.5 12 21 12 21Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                  </svg>
                </span>
                <div class="sumtext">
                  <div class="sumtitle">Supportive management</div>
                  <div class="sumhint">What actually helps.</div>
                </div>
              </div>
              <span class="chev" aria-hidden="true">›</span>
            </summary>
            <div class="content twoCol">
              <div class="callout green">
                <h3>Recommended actions</h3>
                <ul class="list">
                  <li>Assess severity + trend; anticipate day 3–5 peak</li>
                  <li>Measure SpO₂ in suspected bronchiolitis</li>
                  <li>Hydration/nutrition focus (NG if needed in hospital)</li>
                  <li>Oxygen if persistently low sats (threshold depends on age/comorbidity)</li>
                  <li>Upper airway suction only if feeding difficulty / apnoea history</li>
                </ul>
              </div>
              <div class="callout purple">
                <h3>Generally avoid (routine use)</h3>
                <ul class="list">
                  <li>Bronchodilators</li>
                  <li>Corticosteroids</li>
                  <li>Nebulised racemic adrenaline</li>
                  <li>Antibiotics (unless complication/resp failure suspicion)</li>
                </ul>
              </div>
            </div>
          </details>

          <details>
            <summary>
              <div class="sumleft">
                <span class="ico" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M4 6h16M6 6v14m12-14v14M8 10h8M8 14h8M8 18h6" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                  </svg>
                </span>
                <div class="sumtext">
                  <div class="sumtitle">Investigations</div>
                  <div class="sumhint">Keep it minimal unless atypical.</div>
                </div>
              </div>
              <span class="chev" aria-hidden="true">›</span>
            </summary>
            <div class="content twoCol">
              <div class="callout blue">
                <h3>Usually not needed (routine)</h3>
                <ul class="list">
                  <li>Chest X-ray</li>
                  <li>Blood tests / blood gases</li>
                </ul>
              </div>
              <div class="callout amber">
                <h3>Consider if atypical / deteriorating</h3>
                <ul class="list">
                  <li>Fever &gt;39°C or focal crackles → consider pneumonia pathway</li>
                  <li>Worsening distress / alternative diagnosis suspicion</li>
                </ul>
              </div>
            </div>
          </details>

          <details>
            <summary>
              <div class="sumleft">
                <span class="ico" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M8 3h8v6H8V3Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                    <path d="M6 11h12v10H6V11Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                    <path d="M9 14h6M9 17h6" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                  </svg>
                </span>
                <div class="sumtext">
                  <div class="sumtitle">Discharge (secondary care)</div>
                  <div class="sumhint">Minimum stability criteria.</div>
                </div>
              </div>
              <span class="chev" aria-hidden="true">›</span>
            </summary>
            <div class="content">
              <div class="callout green">
                <h3>Discharge only if</h3>
                <ul class="list">
                  <li>Clinically stable</li>
                  <li>Adequate oral fluids</li>
                  <li>Maintained sats ≥90% (≥6w) or ≥92% (&lt;6w / comorbidity) for 4 hours incl sleep</li>
                </ul>
              </div>
            </div>
          </details>

          <details>
            <summary>
              <div class="sumleft">
                <span class="ico" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M12 2a7 7 0 0 1 7 7c0 5-7 13-7 13S5 14 5 9a7 7 0 0 1 7-7Z" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linejoin="round"/>
                    <path d="M9.2 9.5h5.6" stroke="rgba(234,240,255,.9)" stroke-width="1.8" stroke-linecap="round"/>
                  </svg>
                </span>
                <div class="sumtext">
                  <div class="sumtitle">Risk factors for severe disease</div>
                  <div class="sumhint">Lower threshold to refer.</div>
                </div>
              </div>
              <span class="chev" aria-hidden="true">›</span>
            </summary>
            <div class="content twoCol">
              <div class="callout amber">
                <h3>Higher risk groups</h3>
                <ul class="list">
                  <li>&lt;12 weeks</li>
                  <li>Prematurity (&lt;37w)</li>
                  <li>Chronic lung disease / congenital heart disease</li>
                  <li>Immunocompromise; airway defects</li>
                  <li>Neuromuscular issues affecting airway protection</li>
                  <li>Down syndrome</li>
                </ul>
              </div>
              <div class="callout blue">
                <h3>Social/environment</h3>
                <ul class="list">
                  <li>Older siblings / nursery attendance</li>
                  <li>Passive smoke exposure</li>
                  <li>Overcrowding</li>
                  <li>Breastfeeding protective</li>
                </ul>
              </div>
            </div>
          </details>

        </div>
      </aside>
    </div>
  </div>

  <script>
    // -----------------------
    // Data model (thresholds aligned to uploaded reference)
    // -----------------------
    const state = {
      ageWeeks: 12,
      spo2: 96,
      rr: 46,
      feed: 85,
      apnoea: false,
      severeDistress: false,
      cyanosis: false,
      comorb: false,
      prem: false,
      dehyd: false,
    };

    const el = (id)=>document.getElementById(id);

    function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }

    // Determine oxygen thresholds per guidance logic in the reference:
    // - Admission in secondary care if persistent SpO2 on air:
    //   <90% for age >= 6 weeks; <92% for age < 6 weeks OR any age with underlying conditions.
    // - In primary care: consider referral if SpO2 <92% (and give O2 while awaiting if persistently <92%).
    function o2Cutoffs(){
      const under6w = state.ageWeeks < 6;
      const highRisk = under6w || state.comorb;
      const admitCutoff = highRisk ? 92 : 90; // "less than" this cutoff triggers admission criteria
      const primaryReferralCutoff = 92; // less than 92% triggers referral consideration
      return { under6w, highRisk, admitCutoff, primaryReferralCutoff };
    }

    function setBadge(badgeEl, tone, text){
      badgeEl.className = `badge ${tone}`;
      badgeEl.textContent = text;
    }

    function setCallout(panelEl, tone){
      panelEl.className = `callout ${tone}`;
    }

    function mkBadge(tone, html){
      const span = document.createElement('span');
      span.className = `badge ${tone}`;
      span.innerHTML = html;
      return span;
    }

    function renderChips(){
      const map = [
        ['apnoeaChip','apnoea'],
        ['severeDistressChip','severeDistress'],
        ['cyanosisChip','cyanosis'],
        ['comorbChip','comorb'],
        ['premChip','prem'],
        ['dehydChip','dehyd'],
      ];
      for (const [id,key] of map){
        const c = el(id);
        c.setAttribute('aria-pressed', String(state[key]));
      }
    }

    function interpret(){
      // Severity buckets:
      // 1) Emergency (red flags)
      // 2) Consider referral/admission (amber)
      // 3) Home care + safety-net (green)
      //
      // Red flags from reference: apnoea; severe distress (grunting/marked recession, RR>70);
      // persistent low SpO2 on air: <90% (>=6w), <92% (<6w or comorbidity).
      //
      // Consider referral: RR>60, feeding 50-75% / dehydration, SpO2<92%, central cyanosis, looks unwell,
      // age <3 months / prematurity / comorbidity etc. (risk lowers threshold).

      const { highRisk, admitCutoff, primaryReferralCutoff } = o2Cutoffs();

      const redReasons = [];
      const amberReasons = [];
      const greenReasons = [];
      const actions = [];

      // Oxygen logic
      const spo2LowPrimary = state.spo2 < primaryReferralCutoff;
      const spo2AdmissionCriterion = state.spo2 < admitCutoff;

      // RR logic
      const rrOver60 = state.rr > 60;
      const rrOver70 = state.rr > 70;

      // Feeding logic
      const feed5075 = state.feed >= 50 && state.feed <= 75;
      const feedUnder50 = state.feed < 50;

      // Red flags
      if (state.apnoea) redReasons.push('Apnoea (observed/reported)');
      if (state.severeDistress || rrOver70) redReasons.push('Severe respiratory distress (e.g. grunting/marked recession or RR >70)');
      if (spo2AdmissionCriterion) redReasons.push(`Persistent hypoxaemia on air (<${admitCutoff}%)`);

      // Amber triggers
      if (!redReasons.length){
        if (rrOver60) amberReasons.push('Tachypnoea (RR >60)');
        if (state.cyanosis) amberReasons.push('Central cyanosis');
        if (spo2LowPrimary) amberReasons.push('SpO₂ <92% (primary care referral threshold)');
        if (feedUnder50) amberReasons.push('Markedly reduced oral intake (<50% usual)');
        else if (feed5075) amberReasons.push('Reduced oral intake (50–75% usual)');
        if (state.dehyd) amberReasons.push('Clinical dehydration features');
        if (state.ageWeeks < 12) amberReasons.push('Young infant (≤12 weeks) — higher risk');
        if (state.prem) amberReasons.push('Prematurity — higher risk');
        if (state.comorb) amberReasons.push('Underlying condition — higher risk');
      }

      // Green supportive / home care (only if not red/amber)
      if (!redReasons.length && !amberReasons.length){
        greenReasons.push('Mild disease pattern → supportive care at home');
      }

      // Actions
      if (redReasons.length){
        actions.push({tone:'red', text:'Immediate emergency hospital care'});
        actions.push({tone:'blue', text:`Give O₂ if persistently below 92% while awaiting transfer`});
        actions.push({tone:'green', text:'Supportive care: hydration/nutrition; suction only if feeding difficulty'});
      } else if (amberReasons.length){
        actions.push({tone:'amber', text:'Consider referral / observation / safety-net'});
        if (spo2LowPrimary) actions.push({tone:'blue', text:'If persistent SpO₂ <92%: administer O₂ while awaiting admission'});
        if (feed5075 || feedUnder50 || state.dehyd) actions.push({tone:'green', text:'Prioritise fluids: encourage feeds; consider NG if admitted'});
        actions.push({tone:'purple', text:'Avoid routine bronchodilators/steroids/antibiotics'});
      } else {
        actions.push({tone:'green', text:'Home care: supportive measures + clear deterioration advice'});
        actions.push({tone:'purple', text:'Avoid low-value interventions'});
        actions.push({tone:'blue', text:'Expect peak day 3–5 of symptoms'});
      }

      // Determine disposition label
      let dispositionTone = 'blue';
      let dispositionLabel = 'Assess inputs';
      let dispoNarrative = 'Adjust inputs to generate disposition and immediate actions.';

      if (redReasons.length){
        dispositionTone = 'red';
        dispositionLabel = 'EMERGENCY';
        dispoNarrative = `Escalate now: ${redReasons.join(' • ')}`;
      } else if (amberReasons.length){
        dispositionTone = 'amber';
        dispositionLabel = 'CONSIDER REFERRAL';
        dispoNarrative = `Lower threshold due to: ${amberReasons.join(' • ')}`;
      } else {
        dispositionTone = 'green';
        dispositionLabel = 'HOME SUPPORT';
        dispoNarrative = `Supportive care + safety-net. ${greenReasons.join(' ')}`;
      }

      return { dispositionTone, dispositionLabel, dispoNarrative, redReasons, amberReasons, greenReasons, actions };
    }

    function render(){
      // Update state from inputs
      state.ageWeeks = Number(el('ageWeeks').value);
      state.spo2 = Number(el('spo2').value);
      state.rr = clamp(Number(el('rr').value || 0), 0, 200);
      state.feed = clamp(Number(el('feed').value || 0), 0, 100);

      // Readouts
      el('ageReadout').textContent = state.ageWeeks;
      el('spo2Readout').textContent = state.spo2;
      el('kpiO2').textContent = state.spo2;
      el('kpiRR').textContent = state.rr;
      el('kpiFeed').textContent = state.feed;
      el('kpiAge').textContent = state.ageWeeks;

      // Age bands
      const { under6w, highRisk, admitCutoff } = o2Cutoffs();
      setBadge(el('ageBand'), under6w ? 'amber' : 'blue', under6w ? '<6 weeks' : '≥6 weeks');
      setBadge(el('riskAgeBand'), state.ageWeeks <= 12 ? 'amber' : 'blue', state.ageWeeks <= 12 ? '≤12 weeks risk' : '>12 weeks');

      // Dynamic badges for inputs
      const spo2Badges = el('spo2Badges'); spo2Badges.innerHTML = '';
      spo2Badges.appendChild(mkBadge(highRisk ? 'amber' : 'blue', highRisk ? 'Higher-risk O₂ cut-off applies' : 'Standard O₂ cut-off applies'));
      spo2Badges.appendChild(mkBadge(state.spo2 < 92 ? 'amber' : 'green', state.spo2 < 92 ? 'Below 92%' : '≥92%'));
      spo2Badges.appendChild(mkBadge(state.spo2 < admitCutoff ? 'red' : 'blue', `Admission criterion: <${admitCutoff}%`));

      const rrBadges = el('rrBadges'); rrBadges.innerHTML = '';
      rrBadges.appendChild(mkBadge(state.rr > 70 ? 'red' : state.rr > 60 ? 'amber' : 'green',
        state.rr > 70 ? 'RR >70 (severe)' : state.rr > 60 ? 'RR >60' : 'RR ≤60'));

      const feedBadges = el('feedBadges'); feedBadges.innerHTML = '';
      const feedTone = state.feed < 50 ? 'red' : (state.feed <= 75 ? 'amber' : 'green');
      feedBadges.appendChild(mkBadge(feedTone,
        state.feed < 50 ? '<50% usual' : (state.feed <= 75 ? '50–75% usual' : '>75% usual')));

      // Disposition
      const result = interpret();

      setBadge(el('dispoBadge'), result.dispositionTone, result.dispositionLabel);
      setCallout(el('dispositionPanel'), result.dispositionTone);
      el('dispoText').textContent = result.dispoNarrative;

      const actionBadges = el('actionBadges'); actionBadges.innerHTML = '';
      for (const a of result.actions){
        actionBadges.appendChild(mkBadge(a.tone, a.text));
      }
    }

    function toggleChip(chipId, key){
      const chip = el(chipId);
      const now = !state[key];
      state[key] = now;
      chip.setAttribute('aria-pressed', String(now));
      render();
    }

    // Input listeners
    ['ageWeeks','spo2'].forEach(id=> el(id).addEventListener('input', render));
    ['rr','feed'].forEach(id=> el(id).addEventListener('input', render));

    // Chip interactions (click + keyboard)
    const chipMap = [
      ['apnoeaChip','apnoea'],
      ['severeDistressChip','severeDistress'],
      ['cyanosisChip','cyanosis'],
      ['comorbChip','comorb'],
      ['premChip','prem'],
      ['dehydChip','dehyd'],
    ];
    for (const [id,key] of chipMap){
      const node = el(id);
      node.addEventListener('click', ()=>toggleChip(id,key));
      node.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          toggleChip(id,key);
        }
      });
    }

    // Buttons
    el('reset').addEventListener('click', ()=>{
      el('ageWeeks').value = 12;
      el('spo2').value = 96;
      el('rr').value = 46;
      el('feed').value = 85;
      state.apnoea = state.severeDistress = state.cyanosis = state.comorb = state.prem = state.dehyd = false;
      renderChips();
      render();
    });

    el('showRedFlags').addEventListener('click', ()=>{
      el('redflags').scrollIntoView({behavior:'smooth', block:'start'});
      // subtle highlight pulse
      el('redflags').animate([{transform:'scale(1)'},{transform:'scale(1.01)'},{transform:'scale(1)'}], {duration:420, easing:'ease-out'});
    });

    el('copySummary').addEventListener('click', async ()=>{
      const { admitCutoff } = o2Cutoffs();
      const result = interpret();
      const line =
        `Bronchiolitis triage: age ${state.ageWeeks}w, SpO2 ${state.spo2}% RA (cut-off <${admitCutoff}% for admission), RR ${state.rr}/min, intake ${state.feed}% usual`
        + `; flags: apnoea=${state.apnoea}, severeDistress=${state.severeDistress}, cyanosis=${state.cyanosis}, comorb=${state.comorb}, prem=${state.prem}, dehydration=${state.dehyd}`
        + ` → ${result.dispositionLabel}.`;
      try{
        await navigator.clipboard.writeText(line);
        const btn = el('copySummary');
        const old = btn.textContent;
        btn.textContent = 'Copied ✓';
        setTimeout(()=>btn.textContent = old, 900);
      }catch{
        // fallback
        prompt('Copy this:', line);
      }
    });

    // Initial render
    renderChips();
    render();
  </script>
</body>
</html>
