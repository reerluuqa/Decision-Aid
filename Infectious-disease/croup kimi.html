<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Croup Management Algorithm - NICE CKS Interactive Guide</title>
    <style>
        :root {
            --primary: #005eb8;
            --primary-dark: #003d82;
            --primary-light: #e6f0f7;
            --secondary: #00a499;
            --secondary-light: #e6f5f4;
            --success: #007f3b;
            --success-light: #e6f4ea;
            --warning: #ff9a00;
            --warning-light: #fff2e5;
            --danger: #da291c;
            --danger-light: #fce8e6;
            --info: #00a9ce;
            --info-light: #e6f7fb;
            --dark: #333;
            --gray: #6c757d;
            --light: #f8f9fa;
            --white: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 12px;
            --card-padding: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--light) 0%, #e8f4fd 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
        }

        /* Progress Sidebar */
        .progress-sidebar {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: var(--white);
            padding: 20px;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            box-shadow: var(--shadow);
            z-index: 1000;
            transition: var(--transition);
            width: 240px;
        }

        .progress-sidebar.collapsed {
            transform: translateY(-50%) translateX(-200px);
        }

        .progress-toggle {
            position: absolute;
            right: -40px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary);
            color: var(--white);
            border: none;
            width: 40px;
            height: 60px;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            box-shadow: 4px 0 8px rgba(0, 0, 0, 0.1);
        }

        .progress-toggle:hover {
            background: var(--primary-dark);
        }

        .progress-header {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            font-size: 14px;
        }

        .progress-item:hover {
            background: var(--light);
        }

        .progress-item.active {
            background: var(--primary-light);
            color: var(--primary-dark);
            font-weight: 600;
        }

        .progress-item.completed {
            background: var(--success-light);
            color: var(--success);
        }

        .progress-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            background: var(--light);
            color: var(--gray);
            transition: var(--transition);
        }

        .progress-item.active .progress-icon {
            background: var(--primary);
            color: var(--white);
        }

        .progress-item.completed .progress-icon {
            background: var(--success);
            color: var(--white);
        }

        .progress-line {
            position: absolute;
            left: 23px;
            top: 48px;
            width: 2px;
            height: calc(100% + 8px);
            background: var(--light);
            z-index: -1;
        }

        .progress-item:last-child .progress-line {
            display: none;
        }

        .progress-item.completed .progress-line,
        .progress-item.active .progress-line {
            background: var(--success);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 40px 20px 40px 260px;
            transition: var(--transition);
        }

        .main-content.expanded {
            padding-left: 60px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 0 20px;
        }

        .header h1 {
            font-size: 2.5em;
            color: var(--primary);
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 1.2em;
            color: var(--gray);
            max-width: 600px;
            margin: 0 auto;
        }

        .algorithm-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: var(--card-padding);
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-4px);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            transition: var(--transition);
        }

        .card.active::before {
            transform: scaleY(1);
        }

        .card.assessment::before {
            background: var(--info);
        }

        .card.diagnosis::before {
            background: var(--warning);
        }

        .card.treatment::before {
            background: var(--primary);
        }

        .card.followup::before {
            background: var(--success);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: var(--transition);
            background: var(--light);
            color: var(--gray);
        }

        .card.assessment .card-icon {
            background: var(--info-light);
            color: var(--info);
        }

        .card.diagnosis .card-icon {
            background: var(--warning-light);
            color: var(--warning);
        }

        .card.treatment .card-icon {
            background: var(--primary-light);
            color: var(--primary);
        }

        .card.followup .card-icon {
            background: var(--success-light);
            color: var(--success);
        }

        .card:hover .card-icon {
            transform: scale(1.1);
        }

        .card-main-title {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--dark);
        }

        .card-subtitle {
            font-size: 0.95em;
            color: var(--gray);
            margin-top: 4px;
        }

        .expand-icon {
            font-size: 24px;
            color: var(--gray);
            transition: var(--transition);
        }

        .card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 0;
        }

        .card.expanded .card-content {
            max-height: 2000px;
            margin-top: 24px;
        }

        /* Content Sections */
        .content-section {
            margin-bottom: 32px;
        }

        .content-section h3 {
            font-size: 1.2em;
            margin-bottom: 16px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .content-section h3::before {
            content: '';
            width: 4px;
            height: 20px;
            border-radius: 2px;
            background: var(--primary);
        }

        .severity-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .severity-card {
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
        }

        .severity-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .severity-card.mild {
            background: var(--success-light);
            border-color: var(--success);
        }

        .severity-card.moderate {
            background: var(--warning-light);
            border-color: var(--warning);
        }

        .severity-card.severe {
            background: var(--danger-light);
            border-color: var(--danger);
        }

        .severity-card.impending-failure {
            background: linear-gradient(135deg, var(--danger), #b7150b);
            border-color: var(--danger);
            color: var(--white);
        }

        .severity-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .severity-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 8px;
        }

        .badge-stable {
            background: var(--success);
            color: var(--white);
        }

        .badge-caution {
            background: var(--warning);
            color: var(--white);
        }

        .badge-urgent {
            background: var(--danger);
            color: var(--white);
        }

        .diagnosis-criteria {
            background: var(--light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 16px 0;
            border-left: 4px solid var(--primary);
        }

        .criteria-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px;
            background: var(--white);
            border-radius: 8px;
            transition: var(--transition);
        }

        .criteria-item:hover {
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .criteria-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .criteria-icon.present {
            background: var(--success);
            color: var(--white);
        }

        .criteria-icon.absent {
            background: var(--gray);
            color: var(--white);
        }

        .treatment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .treatment-card {
            background: var(--white);
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 20px;
            transition: var(--transition);
            cursor: pointer;
        }

        .treatment-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
            transform: translateY(-4px);
        }

        .treatment-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .treatment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .treatment-title {
            font-weight: 600;
            color: var(--dark);
        }

        .treatment-dose {
            font-size: 0.9em;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .treatment-indication {
            font-size: 0.85em;
            color: var(--gray);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin: 24px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 94, 184, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--white);
        }

        .btn-secondary:hover {
            background: #00857a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 164, 153, 0.3);
        }

        .btn-outline {
            background: var(--white);
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: var(--white);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #006c2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 127, 59, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #b7150b;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(218, 41, 28, 0.3);
        }

        /* Interactive Elements */
        .symptom-checker {
            background: var(--light);
            padding: 24px;
            border-radius: var(--border-radius);
            margin: 20px 0;
        }

        .symptom-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            margin-bottom: 12px;
            background: var(--white);
            border-radius: var(--border-radius);
            transition: var(--transition);
            border: 1px solid #e0e0e0;
        }

        .symptom-item:hover {
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .symptom-name {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--gray);
            border-radius: 13px;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-switch.active {
            background: var(--success);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: var(--white);
            border-radius: 50%;
            transition: var(--transition);
        }

        .toggle-switch.active::after {
            left: 27px;
        }

        .severity-score {
            text-align: center;
            padding: 24px;
            background: var(--white);
            border-radius: var(--border-radius);
            margin: 20px 0;
            box-shadow: var(--shadow);
        }

        .score-display {
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 8px;
            transition: var(--transition);
        }

        .score-display.mild {
            color: var(--success);
        }

        .score-display.moderate {
            color: var(--warning);
        }

        .score-display.severe {
            color: var(--danger);
        }

        .score-label {
            font-size: 1.1em;
            color: var(--gray);
            margin-bottom: 16px;
        }

        .score-recommendation {
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-weight: 500;
            display: inline-block;
            transition: var(--transition);
        }

        .score-recommendation {
            background: var(--light);
            color: var(--dark);
        }

        .score-recommendation.mild {
            background: var(--success-light);
            color: var(--success);
        }

        .score-recommendation.moderate {
            background: var(--warning-light);
            color: var(--warning);
        }

        .score-recommendation.severe {
            background: var(--danger-light);
            color: var(--danger);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .progress-sidebar {
                transform: translateY(-50%) translateX(-220px);
            }

            .progress-sidebar.visible {
                transform: translateY(-50%) translateX(0);
            }

            .main-content {
                padding-left: 20px;
                padding-right: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .card-main-title {
                font-size: 1.2em;
            }

            .severity-indicators {
                grid-template-columns: 1fr;
            }

            .treatment-options {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .card {
                padding: 20px;
            }

            .card-icon {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .card-title {
                gap: 12px;
            }

            .btn {
                padding: 10px 16px;
                font-size: 0.9em;
            }

            .action-buttons {
                flex-direction: column;
            }
        }

        /* Animations */
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 94, 184, 0.4);
            }
            70% {
                transform: scale(1.01);
                box-shadow: 0 0 0 10px rgba(0, 94, 184, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 94, 184, 0);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        /* Print Styles */
        @media print {
            .progress-sidebar {
                display: none;
            }

            .main-content {
                padding-left: 20px;
            }

            .card {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ccc;
            }

            .card-content {
                max-height: none !important;
            }

            .action-buttons {
                display: none;
            }
        }

        .print-section {
            display: none;
        }

        @media print {
            .print-section {
                display: block;
                background: var(--light);
                padding: 20px;
                border-radius: var(--border-radius);
                margin: 20px 0;
            }
        }

        /* Additional styling for better visual hierarchy */
        .step-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(0, 94, 184, 0.2), transparent);
            margin: 32px 0;
            border: none;
        }

        .important-note {
            background: linear-gradient(to right, #fff9e6, #fff2cc);
            border-left: 4px solid var(--warning);
            padding: 16px 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .important-note::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            opacity: 0.2;
        }

        .info-box {
            background: linear-gradient(to right, #e6f7fb, #ccf0f5);
            border-left: 4px solid var(--info);
            padding: 16px 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .info-box::before {
            content: 'üí°';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            opacity: 0.2;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Progress Sidebar -->
        <aside class="progress-sidebar" id="progressSidebar">
            <button class="progress-toggle" id="progressToggle">
                <span id="toggleIcon">‚óÄ</span>
            </button>
            <div class="progress-header">
                <span>üìä</span>
                <span>Progress</span>
            </div>
            <div class="progress-item active" data-step="assessment">
                <div class="progress-icon">1</div>
                <div>
                    <div>Assessment</div>
                    <small style="color: currentColor;">Initial evaluation</small>
                </div>
                <div class="progress-line"></div>
            </div>
            <div class="progress-item" data-step="diagnosis">
                <div class="progress-icon">2</div>
                <div>
                    <div>Diagnosis</div>
                    <small style="color: currentColor;">Confirm croup</small>
                </div>
                <div class="progress-line"></div>
            </div>
            <div class="progress-item" data-step="treatment">
                <div class="progress-icon">3</div>
                <div>
                    <div>Treatment</div>
                    <small style="color: currentColor;">Management plan</small>
                </div>
                <div class="progress-line"></div>
            </div>
            <div class="progress-item" data-step="followup">
                <div class="progress-icon">4</div>
                <div>
                    <div>Follow-up</div>
                    <small style="color: currentColor;">Monitoring</small>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <div class="header">
                <h1>üè• Croup Management Algorithm</h1>
                <p>Interactive clinical decision support based on NICE CKS guidelines</p>
                <p style="font-size: 0.9em; color: var(--gray); margin-top: 12px;">
                    <strong>Target:</strong> Children 3 months to 6 years | <strong>Last updated:</strong> May 2022
                </p>
            </div>

            <div class="algorithm-container">
                <!-- Assessment Card -->
                <div class="card assessment expanded" id="assessment-card" data-step="assessment">
                    <div class="card-header" onclick="toggleCard('assessment')">
                        <div class="card-title">
                            <div class="card-icon">ü©∫</div>
                            <div>
                                <div class="card-main-title">Initial Assessment</div>
                                <div class="card-subtitle">Evaluate symptoms and severity</div>
                            </div>
                        </div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                    <div class="card-content">
                        <div class="content-section fade-in">
                            <h3>üö® Red Flags - Immediate Hospital Admission</h3>
                            <div class="severity-indicators">
                                <div class="severity-card severe">
                                    <div class="severity-badge badge-urgent">URGENT REFERRAL</div>
                                    <div class="severity-title">Severe Croup</div>
                                    <ul style="margin-left: 20px; margin-top: 8px;">
                                        <li>Stridor at rest with sternal/intercostal recession</li>
                                        <li>Child appears agitated or lethargic</li>
                                        <li>Very ill/toxic appearance</li>
                                        <li>High fever with severe distress</li>
                                        <li>Respiratory rate > 60 breaths/minute</li>
                                    </ul>
                                </div>
                                <div class="severity-card impending-failure">
                                    <div class="severity-badge badge-urgent">üö® IMMEDIATE ACTION</div>
                                    <div class="severity-title">Impending Respiratory Failure</div>
                                    <ul style="margin-left: 20px; margin-top: 8px; color: white;">
                                        <li>Minimal barking cough</li>
                                        <li>Stridor may become less audible</li>
                                        <li>Severe chest wall recession</li>
                                        <li>Asynchronous chest/abdominal movement</li>
                                        <li>Fatigue, pallor, cyanosis</li>
                                        <li>Decreased consciousness or tachycardia</li>
                                        <li>Respiratory rate > 70 breaths/minute</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>üìã Symptom Assessment</h3>
                            <div class="symptom-checker">
                                <div class="symptom-item">
                                    <div class="symptom-name">
                                        <span>üè•</span>
                                        <span>Seal-like barking cough</span>
                                    </div>
                                    <div class="toggle-switch" data-symptom="barking-cough" onclick="toggleSymptom(this)"></div>
                                </div>
                                <div class="symptom-item">
                                    <div class="symptom-name">
                                        <span>üó£Ô∏è</span>
                                        <span>Hoarse voice</span>
                                    </div>
                                    <div class="toggle-switch" data-symptom="hoarse-voice" onclick="toggleSymptom(this)"></div>
                                </div>
                                <div class="symptom-item">
                                    <div class="symptom-name">
                                        <span>üëÇ</span>
                                        <span>Stridor (inspiratory sound)</span>
                                    </div>
                                    <div class="toggle-switch" data-symptom="stridor" onclick="toggleSymptom(this)"></div>
                                </div>
                                <div class="symptom-item">
                                    <div class="symptom-name">
                                        <span>üò§</span>
                                        <span>Respiratory distress/recession</span>
                                    </div>
                                    <div class="toggle-switch" data-symptom="respiratory-distress" onclick="toggleSymptom(this)"></div>
                                </div>
                                <div class="symptom-item">
                                    <div class="symptom-name">
                                        <span>üå°Ô∏è</span>
                                        <span>Fever present</span>
                                    </div>
                                    <div class="toggle-switch" data-symptom="fever" onclick="toggleSymptom(this)"></div>
                                </div>
                                <div class="symptom-item">
                                    <div class="symptom-name">
                                        <span>üò¥</span>
                                        <span>Lethargy or agitation</span>
                                    </div>
                                    <div class="toggle-switch" data-symptom="altered-behavior" onclick="toggleSymptom(this)"></div>
                                </div>
                            </div>

                            <div class="severity-score" id="severityScore">
                                <div class="score-display" id="scoreDisplay">0</div>
                                <div class="score-label">Severity Score</div>
                                <div class="score-recommendation" id="scoreRecommendation">
                                    Continue assessment
                                </div>
                            </div>

                            <div class="info-box">
                                <strong>üí° Clinical Tip:</strong> Symptoms are typically worse at night and increase with agitation. 
                                Prodromal upper respiratory symptoms may have been present for 12-72 hours.
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>‚ö†Ô∏è Risk Factors for Severe Disease</h3>
                            <div class="diagnosis-criteria">
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Age:</strong> Most common 6 months to 3 years (peak at 2 years), uncommon after 6 years
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Sex:</strong> Boys affected more than girls (ratio 1.4:1)
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon absent">‚úó</div>
                                    <div>
                                        <strong>Previous intubation:</strong> Weak association with croup
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Season:</strong> Peak in late autumn (September-December)
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Epidemics:</strong> Parainfluenza virus epidemics every 2 years increase admissions by 50%
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="important-note">
                            <strong>üö® Emergency Warning:</strong> If epiglottitis is suspected, 
                            <strong>DO NOT</strong> examine the oropharynx or manipulate the neck as this may precipitate airway obstruction.
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="nextStep('diagnosis')">
                                <span>Next: Confirm Diagnosis</span>
                                <span>‚Üí</span>
                            </button>
                            <button class="btn btn-outline" onclick="printSummary()">
                                <span>üñ®Ô∏è</span>
                                <span>Print Assessment</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Diagnosis Card -->
                <div class="card diagnosis" id="diagnosis-card" data-step="diagnosis">
                    <div class="card-header" onclick="toggleCard('diagnosis')">
                        <div class="card-title">
                            <div class="card-icon">üî¨</div>
                            <div>
                                <div class="card-main-title">Diagnosis Confirmation</div>
                                <div class="card-subtitle">Clinical diagnosis based on history and examination</div>
                            </div>
                        </div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                    <div class="card-content">
                        <div class="content-section fade-in">
                            <h3>üéØ Diagnostic Criteria</h3>
                            <div class="diagnosis-criteria">
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Sudden onset seal-like barking cough</strong> - hallmark symptom
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Hoarse voice</strong> - common accompanying symptom
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Stridor and respiratory distress</strong> - indicates upper airway obstruction
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Prodromal symptoms</strong> - non-specific URTI symptoms for 12-72 hours
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Age-appropriate</strong> - typically 3 months to 6 years
                                    </div>
                                </div>
                            </div>

                            <div class="info-box">
                                <strong>üí° Important:</strong> Croup is a clinical diagnosis. 
                                Investigations are rarely helpful and may distress the child.
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>üîÑ Differential Diagnoses</h3>
                            <div class="severity-indicators">
                                <div class="severity-card">
                                    <div class="severity-title">Bacterial Tracheitis</div>
                                    <div class="severity-badge badge-urgent">High Fever</div>
                                    <ul style="margin-left: 20px; margin-top: 8px; font-size: 0.9em;">
                                        <li>High fever, sudden stridor</li>
                                        <li>Follows viral illness, then acutely worsens</li>
                                        <li>Toxic appearance</li>
                                    </ul>
                                </div>
                                <div class="severity-card">
                                    <div class="severity-title">Epiglottitis</div>
                                    <div class="severity-badge badge-urgent">EMERGENCY</div>
                                    <ul style="margin-left: 20px; margin-top: 8px; font-size: 0.9em;">
                                        <li>Sudden high fever, dysphagia, drooling</li>
                                        <li>Anxious, sitting upright, neck extended</li>
                                        <li>Non-barking cough</li>
                                    </ul>
                                </div>
                                <div class="severity-card">
                                    <div class="severity-title">Foreign Body</div>
                                    <div class="severity-badge badge-caution">Clear History</div>
                                    <ul style="margin-left: 20px; margin-top: 8px; font-size: 0.9em;">
                                        <li>Sudden onset dyspnea/stridor</li>
                                        <li>Clear history of inhalation</li>
                                        <li>No prodrome/fever initially</li>
                                    </ul>
                                </div>
                                <div class="severity-card">
                                    <div class="severity-title">Retropharyngeal Abscess</div>
                                    <div class="severity-badge badge-caution">Gradual Onset</div>
                                    <ul style="margin-left: 20px; margin-top: 8px; font-size: 0.9em;">
                                        <li>Dysphagia, drooling, neck stiffness</li>
                                        <li>Gradual onset with fever</li>
                                        <li>Unilateral cervical adenopathy</li>
                                    </ul>
                                </div>
                                <div class="severity-card">
                                    <div class="severity-title">Angioneurotic Edema</div>
                                    <div class="severity-badge badge-caution">No Fever</div>
                                    <ul style="margin-left: 20px; margin-top: 8px; font-size: 0.9em;">
                                        <li>Acute airway swelling</li>
                                        <li>No fever</li>
                                        <li>Facial/tongue/pharyngeal swelling</li>
                                    </ul>
                                </div>
                                <div class="severity-card">
                                    <div class="severity-title">Anaphylaxis</div>
                                    <div class="severity-badge badge-urgent">ALLERGY</div>
                                    <ul style="margin-left: 20px; margin-top: 8px; font-size: 0.9em;">
                                        <li>Rapid onset dysphagia/stridor</li>
                                        <li>Urticarial rash</li>
                                        <li>History of allergies</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>üìù Severity Classification</h3>
                            <div class="severity-indicators">
                                <div class="severity-card mild">
                                    <div class="severity-badge badge-stable">MILD</div>
                                    <div class="severity-title">Mild Croup</div>
                                    <ul style="margin-left: 20px; margin-top: 8px;">
                                        <li>Seal-like barking cough</li>
                                        <li><strong>NO</strong> stridor at rest</li>
                                        <li><strong>NO</strong> sternal/intercostal recession at rest</li>
                                        <li>Child comfortable</li>
                                    </ul>
                                </div>
                                <div class="severity-card moderate">
                                    <div class="severity-badge badge-caution">MODERATE</div>
                                    <div class="severity-title">Moderate Croup</div>
                                    <ul style="margin-left: 20px; margin-top: 8px;">
                                        <li>Seal-like barking cough</li>
                                        <li>Stridor at rest</li>
                                        <li>Sternal recession at rest</li>
                                        <li>Minimal/no agitation or lethargy</li>
                                    </ul>
                                </div>
                                <div class="severity-card severe">
                                    <div class="severity-badge badge-urgent">SEVERE</div>
                                    <div class="severity-title">Severe Croup</div>
                                    <ul style="margin-left: 20px; margin-top: 8px;">
                                        <li>Seal-like barking cough</li>
                                        <li>Stridor at rest with marked recession</li>
                                        <li>Child appears agitated or lethargic</li>
                                        <li>Very ill/toxic appearance</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-outline" onclick="previousStep('assessment')">
                                <span>‚Üê</span>
                                <span>Back to Assessment</span>
                            </button>
                            <button class="btn btn-primary" onclick="nextStep('treatment')">
                                <span>Next: Treatment Plan</span>
                                <span>‚Üí</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Treatment Card -->
                <div class="card treatment" id="treatment-card" data-step="treatment">
                    <div class="card-header" onclick="toggleCard('treatment')">
                        <div class="card-title">
                            <div class="card-icon">üíä</div>
                            <div>
                                <div class="card-main-title">Treatment Management</div>
                                <div class="card-subtitle">Evidence-based treatment options by severity</div>
                            </div>
                        </div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                    <div class="card-content">
                        <div class="content-section fade-in">
                            <h3>üè• Hospital Admission Criteria</h3>
                            <div class="diagnosis-criteria">
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Immediate admission:</strong> Features of moderate or severe illness, or impending respiratory failure
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Consider admission:</strong> Respiratory rate > 60 breaths/minute, high fever, or 'toxic' appearance
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Lower threshold for:</strong> Chronic lung disease, congenital heart disease, neuromuscular disorders, immunodeficiency
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚úì</div>
                                    <div>
                                        <strong>Social factors:</strong> Age under 3 months, inadequate fluid intake, carer concerns, distance from healthcare
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>üíä Primary Care Treatment Options</h3>
                            <div class="treatment-options">
                                <div class="treatment-card" onclick="selectTreatment(this, 'dexamethasone')">
                                    <div class="treatment-header">
                                        <div class="treatment-title">Dexamethasone (First Line)</div>
                                        <div class="badge-stable">PREFERRED</div>
                                    </div>
                                    <div class="treatment-dose">
                                        <strong>Oral:</strong> 0.15 mg/kg as single dose<br>
                                        <strong>IM:</strong> 0.6 mg/kg (if unable to take oral)
                                    </div>
                                    <div class="treatment-indication">
                                        All children with mild croup<br>
                                        Works within 30 minutes
                                    </div>
                                </div>
                                <div class="treatment-card" onclick="selectTreatment(this, 'budesonide')">
                                    <div class="treatment-header">
                                        <div class="treatment-title">Budesonide (Alternative)</div>
                                        <div class="badge-caution">NEBULIZED</div>
                                    </div>
                                    <div class="treatment-dose">
                                        <strong>Inhaled:</strong> 2 mg nebulized as single dose
                                    </div>
                                    <div class="treatment-indication">
                                        If oral dexamethasone not tolerated<br>
                                        Similar efficacy to dexamethasone
                                    </div>
                                </div>
                                <div class="treatment-card" onclick="selectTreatment(this, 'prednisolone')">
                                    <div class="treatment-header">
                                        <div class="treatment-title">Prednisolone (Alternative)</div>
                                        <div class="badge-caution">LESS EFFECTIVE</div>
                                    </div>
                                    <div class="treatment-dose">
                                        <strong>Oral:</strong> 1 mg/kg once daily for 2-3 days
                                    </div>
                                    <div class="treatment-indication">
                                        If dexamethasone not available<br>
                                        Longer course required
                                    </div>
                                </div>
                            </div>

                            <div class="info-box">
                                <strong>üí° Clinical Evidence:</strong> Dexamethasone provides faster resolution of symptoms and shorter hospital stays. 
                                All corticosteroids reduce croup scores within 6-8 hours and the need for additional treatments.
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>ü§ß Supportive Care Measures</h3>
                            <div class="diagnosis-criteria">
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üíä</div>
                                    <div>
                                        <strong>Antipyretics:</strong> Paracetamol or ibuprofen for fever/discomfort
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üíß</div>
                                    <div>
                                        <strong>Hydration:</strong> Encourage regular fluid intake, continue breastfeeding for infants
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üòå</div>
                                    <div>
                                        <strong>Calm environment:</strong> Keep child calm and comfortable, avoid agitation
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üëÄ</div>
                                    <div>
                                        <strong>Observation:</strong> Regular monitoring, including through the night
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>üè• Hospital Management</h3>
                            <div class="severity-card severe">
                                <div class="severity-badge badge-urgent">IN HOSPITAL</div>
                                <div class="severity-title">Severe Cases/Impending Failure</div>
                                <ul style="margin-left: 20px; margin-top: 8px;">
                                    <li>Controlled supplementary oxygen</li>
                                    <li>Nebulized epinephrine (adrenaline) - short acting</li>
                                    <li>Dexamethasone 0.15 mg/kg oral/IM or budesonide 2mg nebulized</li>
                                    <li>Continuous monitoring</li>
                                    <li>Intubation required in 1-3% of cases with impending failure</li>
                                </ul>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-outline" onclick="previousStep('diagnosis')">
                                <span>‚Üê</span>
                                <span>Back to Diagnosis</span>
                            </button>
                            <button class="btn btn-primary" onclick="nextStep('followup')">
                                <span>Next: Follow-up</span>
                                <span>‚Üí</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Follow-up Card -->
                <div class="card followup" id="followup-card" data-step="followup">
                    <div class="card-header" onclick="toggleCard('followup')">
                        <div class="card-title">
                            <div class="card-icon">üìä</div>
                            <div>
                                <div class="card-main-title">Follow-up & Safety Netting</div>
                                <div class="card-subtitle">Monitoring and when to seek help</div>
                            </div>
                        </div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                    <div class="card-content">
                        <div class="content-section fade-in">
                            <h3>üìÖ Expected Course</h3>
                            <div class="diagnosis-criteria">
                                <div class="criteria-item">
                                    <div class="criteria-icon present">‚è±Ô∏è</div>
                                    <div>
                                        <strong>Duration:</strong> Symptoms usually resolve within 48 hours, but may last up to 1 week
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üìâ</div>
                                    <div>
                                        <strong>Treatment effect:</strong> Dexamethasone provides faster resolution than no treatment
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üéØ</div>
                                    <div>
                                        <strong>Prognosis:</strong> Mild and moderate cases usually resolve without complications
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üèÜ</div>
                                    <div>
                                        <strong>Severe cases:</strong> Excellent prognosis with dexamethasone + nebulized epinephrine
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>üö® When to Seek Urgent Medical Help</h3>
                            <div class="severity-indicators">
                                <div class="severity-card severe">
                                    <div class="severity-badge badge-urgent">CALL AMBULANCE</div>
                                    <div class="severity-title">Emergency Symptoms</div>
                                    <ul style="margin-left: 20px; margin-top: 8px;">
                                        <li>Very pale, grey, or blue (including blue lips) > few seconds</li>
                                        <li>Unusually sleepy or unresponsive</li>
                                        <li>Trouble breathing (belly sinking in, skin pulling in between ribs)</li>
                                        <li>Agitated/restless while struggling to breathe, cannot be calmed</li>
                                        <li>Unable to talk, drooling, trouble swallowing</li>
                                        <li>Wants to sit instead of lie down</li>
                                    </ul>
                                </div>
                                <div class="severity-card moderate">
                                    <div class="severity-badge badge-caution">GO TO HOSPITAL</div>
                                    <div class="severity-title">Urgent Symptoms</div>
                                    <ul style="margin-left: 20px; margin-top: 8px;">
                                        <li>Stridor heard continually at rest</li>
                                        <li>Skin between ribs pulling in with every breath</li>
                                        <li>Child appears restless or agitated</li>
                                        <li>Worsening symptoms despite treatment</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>üè† Parent/Carer Advice</h3>
                            <div class="diagnosis-criteria">
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üå°Ô∏è</div>
                                    <div>
                                        <strong>Fever management:</strong> Use paracetamol or ibuprofen as needed
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üíß</div>
                                    <div>
                                        <strong>Fluids:</strong> Offer frequent small drinks, continue breastfeeding
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üò¥</div>
                                    <div>
                                        <strong>Rest:</strong> Ensure adequate rest and sleep
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üëÄ</div>
                                    <div>
                                        <strong>Monitoring:</strong> Check on child regularly, including through the night
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üö´</div>
                                    <div>
                                        <strong>Avoid:</strong> Smoking around the child, over-the-counter cough medicines
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>üìû Follow-up Planning</h3>
                            <div class="treatment-options">
                                <div class="treatment-card" onclick="selectFollowup(this, 'gp-review')">
                                    <div class="treatment-header">
                                        <div class="treatment-title">GP Review</div>
                                        <div class="badge-stable">Routine</div>
                                    </div>
                                    <div class="treatment-indication">
                                        Mild cases improving with treatment<br>
                                        Review in 24-48 hours
                                    </div>
                                </div>
                                <div class="treatment-card" onclick="selectFollowup(this, 'phone-followup')">
                                    <div class="treatment-header">
                                        <div class="treatment-title">Phone Follow-up</div>
                                        <div class="badge-caution">Moderate</div>
                                    </div>
                                    <div class="treatment-indication">
                                        Moderate cases with good response<br>
                                        Phone check next day
                                    </div>
                                </div>
                                <div class="treatment-card" onclick="selectFollowup(this, 'hospital-followup')">
                                    <div class="treatment-header">
                                        <div class="treatment-title">Hospital Follow-up</div>
                                        <div class="badge-urgent">Severe</div>
                                    </div>
                                    <div class="treatment-indication">
                                        Hospital admissions<br>
                                        Within 1 week of discharge
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>üìä Prognosis & Complications</h3>
                            <div class="severity-indicators">
                                <div class="severity-card mild">
                                    <div class="severity-badge badge-stable">EXCELLENT</div>
                                    <div class="severity-title">Overall Prognosis</div>
                                    <ul style="margin-left: 20px; margin-top: 8px;">
                                        <li>Symptoms resolve within 48 hours (with treatment)</li>
                                        <li>Self-limited in mild cases</li>
                                        <li>Excellent outcome with severe cases when treated appropriately</li>
                                        <li>Death extremely rare: < 1 in 30,000 cases</li>
                                    </ul>
                                </div>
                                <div class="severity-card moderate">
                                    <div class="severity-badge badge-caution">RARE</div>
                                    <div class="severity-title">Potential Complications</div>
                                    <ul style="margin-left: 20px; margin-top: 8px;">
                                        <li>Severe upper airway obstruction ‚Üí respiratory failure</li>
                                        <li>Intubation required in 1-3% of impending failure cases</li>
                                        <li>Secondary bacterial infection (rare)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="content-section fade-in">
                            <h3>üìö Patient Information Resources</h3>
                            <div class="diagnosis-criteria">
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üîó</div>
                                    <div>
                                        <strong>NHS Website:</strong> <a href="https://www.nhs.uk" target="_blank">www.nhs.uk/croup</a>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üìû</div>
                                    <div>
                                        <strong>NHS 24:</strong> 111 for non-emergency medical advice
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon present">üö®</div>
                                    <div>
                                        <strong>Emergency:</strong> 999 for severe breathing difficulties
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-outline" onclick="previousStep('treatment')">
                                <span>‚Üê</span>
                                <span>Back to Treatment</span>
                            </button>
                            <button class="btn btn-success" onclick="completeAlgorithm()">
                                <span>‚úì</span>
                                <span>Complete & Save Summary</span>
                            </button>
                            <button class="btn btn-outline" onclick="printFullSummary()">
                                <span>üñ®Ô∏è</span>
                                <span>Print Full Summary</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Hidden print section -->
                <div class="print-section" id="printSummary">
                    <h2>Croup Management Summary</h2>
                    <div id="printContent"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global variables
        let currentStep = 'assessment';
        let symptoms = {
            'barking-cough': false,
            'hoarse-voice': false,
            'stridor': false,
            'respiratory-distress': false,
            'fever': false,
            'altered-behavior': false
        };
        let selectedTreatment = null;
        let selectedFollowup = null;
        let severityScore = 0;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeProgress();
            updateSeverityScore();
            
            // Check for hash in URL
            const hash = window.location.hash.substring(1);
            if (hash && ['assessment', 'diagnosis', 'treatment', 'followup'].includes(hash)) {
                setTimeout(() => {
                    scrollToStep(hash);
                    expandCard(hash);
                }, 500);
            }
        });

        // Progress sidebar toggle
        const progressToggle = document.getElementById('progressToggle');
        const progressSidebar = document.getElementById('progressSidebar');
        const mainContent = document.getElementById('mainContent');
        const toggleIcon = document.getElementById('toggleIcon');

        progressToggle.addEventListener('click', function() {
            progressSidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            toggleIcon.textContent = progressSidebar.classList.contains('collapsed') ? '‚ñ∂' : '‚óÄ';
        });

        // Progress sidebar navigation
        function initializeProgress() {
            const progressItems = document.querySelectorAll('.progress-item');
            progressItems.forEach(item => {
                item.addEventListener('click', function() {
                    const step = this.dataset.step;
                    scrollToStep(step);
                    expandCard(step);
                    updateProgress(step);
                });
            });
        }

        function scrollToStep(step) {
            const card = document.getElementById(`${step}-card`);
            if (card) {
                card.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start',
                    inline: 'nearest'
                });
                setTimeout(() => {
                    card.classList.add('pulse');
                    setTimeout(() => card.classList.remove('pulse'), 2000);
                }, 500);
            }
            window.location.hash = step;
        }

        function expandCard(step) {
            // Close all cards first
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('expanded');
            });
            
            // Open the selected card
            const card = document.getElementById(`${step}-card`);
            if (card) {
                card.classList.add('expanded');
                setTimeout(() => {
                    const content = card.querySelector('.card-content');
                    if (content) {
                        content.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'nearest',
                            inline: 'nearest'
                        });
                    }
                }, 400);
            }
        }

        function updateProgress(step) {
            currentStep = step;
            const progressItems = document.querySelectorAll('.progress-item');
            let passedCurrent = false;
            
            progressItems.forEach((item, index) => {
                const itemStep = item.dataset.step;
                
                if (itemStep === step) {
                    item.classList.add('active');
                    item.classList.remove('completed');
                    passedCurrent = true;
                } else if (passedCurrent) {
                    item.classList.remove('active', 'completed');
                } else {
                    item.classList.add('completed');
                    item.classList.remove('active');
                }
            });
        }

        // Card toggle functionality
        function toggleCard(step) {
            const card = document.getElementById(`${step}-card`);
            const isExpanded = card.classList.contains('expanded');
            
            if (isExpanded) {
                card.classList.remove('expanded');
            } else {
                // Close other cards
                document.querySelectorAll('.card').forEach(c => c.classList.remove('expanded'));
                // Open this card
                card.classList.add('expanded');
                updateProgress(step);
                window.location.hash = step;
            }
        }

        // Step navigation
        function nextStep(next) {
            scrollToStep(next);
            expandCard(next);
            updateProgress(next);
        }

        function previousStep(prev) {
            scrollToStep(prev);
            expandCard(prev);
            updateProgress(prev);
        }

        // Symptom checker functionality
        function toggleSymptom(element) {
            const symptom = element.dataset.symptom;
            element.classList.toggle('active');
            symptoms[symptom] = !symptoms[symptom];
            
            // Update symptom icon
            const icon = element.parentElement.querySelector('.criteria-icon');
            if (symptoms[symptom]) {
                icon.classList.add('present');
                icon.classList.remove('absent');
                icon.textContent = '‚úì';
            } else {
                icon.classList.add('absent');
                icon.classList.remove('present');
                icon.textContent = '‚úó';
            }
            
            updateSeverityScore();
            
            // Add visual feedback
            element.style.transform = 'scale(0.95)';
            setTimeout(() => {
                element.style.transform = '';
            }, 150);
        }

        function updateSeverityScore() {
            let score = 0;
            let severity = 'mild';
            let recommendation = 'Continue assessment';
            
            // Calculate score based on symptoms
            if (symptoms['barking-cough']) score += 1;
            if (symptoms['hoarse-voice']) score += 1;
            if (symptoms['stridor']) score += 2;
            if (symptoms['respiratory-distress']) score += 3;
            if (symptoms['fever']) score += 1;
            if (symptoms['altered-behavior']) score += 3;
            
            severityScore = score;
            
            // Determine severity and recommendation
            if (score >= 7) {
                severity = 'severe';
                recommendation = 'üö® URGENT HOSPITAL ADMISSION';
            } else if (score >= 4) {
                severity = 'moderate';
                recommendation = '‚ö†Ô∏è Consider hospital admission';
            } else if (score >= 2) {
                severity = 'mild';
                recommendation = 'üíä Treat with dexamethasone in primary care';
            } else {
                severity = 'mild';
                recommendation = 'üìã Monitor and review';
            }
            
            // Update UI
            const scoreDisplay = document.getElementById('scoreDisplay');
            const scoreRecommendation = document.getElementById('scoreRecommendation');
            
            if (scoreDisplay) {
                scoreDisplay.textContent = score;
                scoreDisplay.className = `score-display ${severity}`;
            }
            
            if (scoreRecommendation) {
                scoreRecommendation.textContent = recommendation;
                scoreRecommendation.className = `score-recommendation ${severity}`;
            }
            
            // Update URL hash with severity
            const card = document.getElementById('assessment-card');
            if (card) {
                card.dataset.severity = severity;
            }
        }

        // Treatment selection
        function selectTreatment(card, treatment) {
            // Remove previous selection
            document.querySelectorAll('.treatment-card').forEach(c => c.classList.remove('selected'));
            
            // Select this treatment
            card.classList.add('selected');
            selectedTreatment = treatment;
            
            // Add visual feedback
            card.style.transform = 'scale(1.02)';
            setTimeout(() => {
                card.style.transform = '';
            }, 200);
            
            // Update print summary
            updatePrintSummary();
        }

        function selectFollowup(card, followup) {
            // Remove previous selection
            document.querySelectorAll('.treatment-card').forEach(c => {
                if (c.onclick && c.onclick.toString().includes('selectFollowup')) {
                    c.classList.remove('selected');
                }
            });
            
            // Select this followup
            card.classList.add('selected');
            selectedFollowup = followup;
            
            // Add visual feedback
            card.style.transform = 'scale(1.02)';
            setTimeout(() => {
                card.style.transform = '';
            }, 200);
            
            // Update print summary
            updatePrintSummary();
        }

        // Utility functions
        function completeAlgorithm() {
            // Mark all steps as completed
            document.querySelectorAll('.progress-item').forEach(item => {
                item.classList.add('completed');
                item.classList.remove('active');
            });
            
            // Show completion message
            const card = document.getElementById('followup-card');
            const content = card.querySelector('.card-content');
            
            const completionMessage = document.createElement('div');
            completionMessage.className = 'severity-card mild fade-in';
            completionMessage.style.marginTop = '24px';
            completionMessage.innerHTML = `
                <div class="severity-badge badge-stable">‚úÖ ALGORITHM COMPLETE</div>
                <div class="severity-title">Croup Management Summary Generated</div>
                <p style="margin: 12px 0;">All steps completed. Use the print function to generate a clinical summary for the patient record.</p>
                <button class="btn btn-success" onclick="printFullSummary()">
                    <span>üñ®Ô∏è</span>
                    <span>Print Clinical Summary</span>
                </button>
            `;
            
            // Remove any existing completion messages
            const existing = card.querySelector('.severity-card.mild');
            if (existing) existing.remove();
            
            content.appendChild(completionMessage);
            
            // Scroll to show completion message
            setTimeout(() => {
                completionMessage.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest',
                    inline: 'nearest'
                });
            }, 300);
            
            updatePrintSummary();
        }

        function updatePrintSummary() {
            const printContent = document.getElementById('printContent');
            if (!printContent) return;
            
            let summary = `
                <h3>Patient Assessment Summary</h3>
                <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                <p><strong>Condition:</strong> Croup (Laryngotracheobronchitis)</p>
                <p><strong>Target Age Group:</strong> 3 months to 6 years</p>
                
                <h4>Symptoms Present:</h4>
                <ul>
            `;
            
            // Add symptoms
            Object.entries(symptoms).forEach(([key, value]) => {
                const symptomName = key.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                summary += `<li>${symptomName}: ${value ? 'Yes' : 'No'}</li>`;
            });
            
            summary += `
                </ul>
                
                <h4>Severity Assessment:</h4>
                <p><strong>Score:</strong> ${severityScore}/10</p>
                <p><strong>Classification:</strong> ${severityScore >= 7 ? 'Severe' : severityScore >= 4 ? 'Moderate' : 'Mild'}</p>
                
                <h4>Management Plan:</h4>
                <p><strong>Treatment:</strong> ${selectedTreatment || 'Not selected'}</p>
                <p><strong>Follow-up:</strong> ${selectedFollowup || 'Not selected'}</p>
                
                <h4>Parent/Carer Advice Given:</h4>
                <ul>
                    <li>Expected course: symptoms resolve within 48 hours (up to 1 week)</li>
                    <li>Use paracetamol or ibuprofen for fever/discomfort</li>
                    <li>Encourage regular fluid intake</li>
                    <li>Monitor child regularly, including through the night</li>
                    <li>Seek urgent medical help if symptoms worsen</li>
                </ul>
                
                <h4>Red Flag Symptoms (Seek Immediate Help):</h4>
                <ul>
                    <li>Continuous stridor at rest</li>
                    <li>Skin pulling in between ribs with every breath</li>
                    <li>Child appears restless or agitated</li>
                    <li>Blue lips or face for more than a few seconds</li>
                    <li>Unusually sleepy or unresponsive</li>
                    <li>Unable to talk, drooling, or trouble swallowing</li>
                </ul>
                
                <p><strong>Guideline Source:</strong> NICE Clinical Knowledge Summaries (CKS) - Croup<br>
                <strong>Last Updated:</strong> May 2022</p>
            `;
            
            printContent.innerHTML = summary;
        }

        function printSummary() {
            updatePrintSummary();
            window.print();
        }

        function printFullSummary() {
            updatePrintSummary();
            const printSection = document.getElementById('printSummary');
            if (printSection) {
                printSection.style.display = 'block';
                window.print();
                setTimeout(() => {
                    printSection.style.display = 'none';
                }, 100);
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                const steps = ['assessment', 'diagnosis', 'treatment', 'followup'];
                const currentIndex = steps.indexOf(currentStep);
                if (currentIndex < steps.length - 1) {
                    const nextStep = steps[currentIndex + 1];
                    nextStep(nextStep);
                }
            } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                const steps = ['assessment', 'diagnosis', 'treatment', 'followup'];
                const currentIndex = steps.indexOf(currentStep);
                if (currentIndex > 0) {
                    const prevStep = steps[currentIndex - 1];
                    previousStep(prevStep);
                }
            } else if (e.key === 'Enter' && e.ctrlKey) {
                printFullSummary();
            }
        });

        // Responsive behavior
        function handleResize() {
            if (window.innerWidth <= 1024) {
                progressSidebar.classList.add('collapsed');
                mainContent.classList.add('expanded');
                toggleIcon.textContent = '‚ñ∂';
            } else {
                progressSidebar.classList.remove('collapsed');
                mainContent.classList.remove('expanded');
                toggleIcon.textContent = '‚óÄ';
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize(); // Call on load

        // Add smooth scrolling for all anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add intersection observer for auto-updating progress
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const card = entry.target.closest('.card');
                    if (card && card.dataset.step) {
                        updateProgress(card.dataset.step);
                    }
                }
            });
        }, {
            threshold: 0.5,
            rootMargin: '-20% 0px -50% 0px'
        });

        // Observe all cards
        document.querySelectorAll('.card').forEach(card => {
            observer.observe(card);
        });

        // Add click outside to close sidebar on mobile
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 1024 && 
                !progressSidebar.contains(e.target) && 
                !progressToggle.contains(e.target) &&
                !progressSidebar.classList.contains('collapsed')) {
                progressSidebar.classList.add('collapsed');
                mainContent.classList.add('expanded');
                toggleIcon.textContent = '‚ñ∂';
            }
        });

        // Add touch gesture for mobile
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            if (window.innerWidth > 1024) return;
            
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // Swipe left - close sidebar
                    progressSidebar.classList.add('collapsed');
                    mainContent.classList.add('expanded');
                    toggleIcon.textContent = '‚ñ∂';
                } else {
                    // Swipe right - open sidebar
                    progressSidebar.classList.remove('collapsed');
                    mainContent.classList.remove('expanded');
                    toggleIcon.textContent = '‚óÄ';
                }
            }
        }

        // Add loading animation
        window.addEventListener('load', function() {
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.5s ease';
                document.body.style.opacity = '1';
            }, 100);
        });
    </script>
</body>
</html>