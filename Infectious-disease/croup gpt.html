<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Croup (3 months‚Äì6 years) ‚Ä¢ Rapid Clinical Guidance</title>
  <style>
    :root{
      --bg: #0b1220;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --line: rgba(255,255,255,.12);
      --shadow: 0 20px 60px rgba(0,0,0,.35);
      --radius: 18px;

      --red: #ff3b30;
      --red2:#ff453a;
      --amber:#ffb020;
      --green:#34c759;
      --blue:#3aa0ff;
      --violet:#8b5cf6;

      --chip: rgba(255,255,255,.08);
      --focus: 0 0 0 4px rgba(58,160,255,.25);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(139,92,246,.18), transparent 60%),
        radial-gradient(1000px 700px at 90% 20%, rgba(58,160,255,.16), transparent 55%),
        radial-gradient(900px 600px at 40% 95%, rgba(52,199,89,.12), transparent 60%),
        linear-gradient(180deg, #070b14, #0b1220 40%, #070b14);
      min-height:100vh;
    }

    .wrap{
      max-width: 1220px;
      margin: 0 auto;
      padding: 28px 18px 56px;
    }

    header{
      display:flex;
      flex-wrap:wrap;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      margin-bottom:18px;
    }

    .title{
      display:flex;
      align-items:flex-start;
      gap:14px;
    }

    .logo{
      width:44px;height:44px;
      border-radius:14px;
      background: linear-gradient(135deg, rgba(58,160,255,.95), rgba(139,92,246,.85));
      box-shadow: 0 14px 40px rgba(58,160,255,.15);
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.15);
    }

    h1{
      margin:0;
      font-size: 22px;
      letter-spacing:.2px;
      line-height:1.2;
    }
    .sub{
      margin-top:6px;
      color:var(--muted);
      font-size: 13px;
      line-height:1.3;
    }

    .toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
    }

    .pill{
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
      color: var(--muted);
      font-size: 12.5px;
    }

    .pill b{ color: var(--text); font-weight:650; }
    .pill .dot{
      width:9px;height:9px;border-radius:50%;
      background: var(--blue);
      box-shadow: 0 0 0 4px rgba(58,160,255,.15);
    }

    .btn{
      cursor:pointer;
      user-select:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      display:flex; align-items:center; gap:8px;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .btn:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.20); }
    .btn:active{ transform: translateY(1px); }
    .btn:focus{ outline:none; box-shadow: var(--focus); }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }

    .card h2{
      margin:0 0 10px 0;
      font-size: 14px;
      letter-spacing:.25px;
      text-transform: uppercase;
      color: rgba(255,255,255,.82);
      display:flex;align-items:center;gap:8px;
    }

    .card .hint{
      color: var(--muted);
      font-size: 12.5px;
      margin:-3px 0 10px 0;
    }

    .kicker{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 8px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      background: var(--chip);
      border:1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.86);
      font-size: 12.5px;
      white-space:nowrap;
    }
    .badge small{ color: var(--muted); font-size: 12px; }
    .badge.red{ background: rgba(255,59,48,.14); border-color: rgba(255,59,48,.35); }
    .badge.green{ background: rgba(52,199,89,.14); border-color: rgba(52,199,89,.35); }
    .badge.amber{ background: rgba(255,176,32,.14); border-color: rgba(255,176,32,.35); }
    .badge.blue{ background: rgba(58,160,255,.14); border-color: rgba(58,160,255,.35); }

    .two{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items:start;
    }
    @media (max-width: 720px){
      .two{ grid-template-columns:1fr; }
    }

    .callout{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding: 12px;
      position:relative;
    }
    .callout:hover{ border-color: rgba(255,255,255,.20); background: rgba(255,255,255,.07); }
    .callout.red{ border-color: rgba(255,59,48,.32); background: rgba(255,59,48,.12); }
    .callout.green{ border-color: rgba(52,199,89,.28); background: rgba(52,199,89,.10); }
    .callout.amber{ border-color: rgba(255,176,32,.28); background: rgba(255,176,32,.10); }

    .callout h3{
      margin:0 0 6px 0;
      font-size: 13.5px;
      display:flex;align-items:center;gap:8px;
    }
    .callout p{ margin:0; color: var(--muted); font-size: 12.5px; line-height:1.4; }
    .callout ul{ margin:8px 0 0 18px; padding:0; color: rgba(255,255,255,.84); font-size: 12.8px; line-height:1.35; }
    .callout li{ margin: 6px 0; }

    .divider{
      height:1px; background: var(--line);
      margin: 12px 0;
    }

    .selectRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      margin-top: 10px;
    }
    .seg{
      display:flex;
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
    }
    .seg button{
      border:0;
      background: transparent;
      color: rgba(255,255,255,.78);
      padding: 10px 12px;
      cursor:pointer;
      font-weight:650;
      font-size: 12.5px;
      display:flex;align-items:center;gap:8px;
      transition: background .12s ease, color .12s ease;
    }
    .seg button:hover{ background: rgba(255,255,255,.07); }
    .seg button[aria-pressed="true"]{
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.95);
    }
    .seg button.mild[aria-pressed="true"]{ box-shadow: inset 0 0 0 999px rgba(52,199,89,.10); }
    .seg button.mod[aria-pressed="true"]{ box-shadow: inset 0 0 0 999px rgba(255,176,32,.11); }
    .seg button.sev[aria-pressed="true"]{ box-shadow: inset 0 0 0 999px rgba(255,59,48,.11); }
    .seg button.fail[aria-pressed="true"]{ box-shadow: inset 0 0 0 999px rgba(255,59,48,.18); }

    .kv{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }
    .kv b{ font-size: 13px; }
    .kv span{ color: var(--muted); font-size: 12.5px; }

    .calc{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 520px){
      .calc{ grid-template-columns: 1fr; }
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:7px;
    }
    label{
      font-size: 12px;
      color: var(--muted);
    }
    input, select{
      width:100%;
      padding: 11px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(8,14,28,.55);
      color: var(--text);
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    input:focus, select:focus{ box-shadow: var(--focus); border-color: rgba(58,160,255,.45); }

    .result{
      margin-top: 10px;
      border-radius: 16px;
      padding: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:flex;
      gap: 10px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .result .big{
      font-size: 18px;
      font-weight: 800;
      letter-spacing:.2px;
      line-height:1.1;
      margin:0;
    }
    .result .small{
      margin: 5px 0 0 0;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.35;
    }
    .copy{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      padding: 9px 10px;
      border-radius: 12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:7px;
      color: rgba(255,255,255,.9);
      white-space:nowrap;
    }
    .copy:hover{ background: rgba(255,255,255,.10); }

    details{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      overflow:hidden;
    }
    details + details{ margin-top: 10px; }
    summary{
      cursor:pointer;
      list-style:none;
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      user-select:none;
    }
    summary::-webkit-details-marker{ display:none; }
    summary .left{
      display:flex; align-items:center; gap:10px;
      font-weight: 800;
      letter-spacing:.2px;
      font-size: 13.5px;
    }
    summary .meta{
      color: var(--muted);
      font-weight:600;
      font-size: 12px;
      margin-left: 8px;
    }
    .chev{
      transition: transform .15s ease;
      opacity:.9;
    }
    details[open] .chev{ transform: rotate(180deg); }
    .content{
      padding: 0 12px 12px 12px;
      color: rgba(255,255,255,.84);
      font-size: 12.8px;
      line-height:1.45;
    }
    .content ul{ margin: 8px 0 0 18px; }
    .content li{ margin: 6px 0; }

    .toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      padding: 11px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(15,24,45,.82);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      opacity:0;
      transform: translateY(8px);
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      font-size: 12.5px;
      color: rgba(255,255,255,.88);
      display:flex; align-items:center; gap:8px;
    }
    .toast.show{ opacity:1; transform: translateY(0); }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 11px;
      color: rgba(255,255,255,.82);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 8px;
      padding: 2px 6px;
    }

    .footer{
      margin-top: 12px;
      color: rgba(255,255,255,.55);
      font-size: 12px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:space-between;
      align-items:center;
    }

    /* Icon primitives */
    .ic{ width:16px;height:16px; display:inline-block; }
    .ic24{ width:18px;height:18px; display:inline-block; }
    .ic30{ width:22px;height:22px; display:inline-block; }
    .muted{ opacity:.9; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="logo" aria-hidden="true">
          <!-- airway icon -->
          <svg class="ic30" viewBox="0 0 24 24" fill="none">
            <path d="M12 2c2.2 0 4 1.8 4 4v2c0 1.2-.8 2.3-2 2.8V13c0 .7.3 1.4.8 1.9l2.5 2.5a3.5 3.5 0 0 1-2.5 6H9.2a3.5 3.5 0 0 1-2.5-6l2.5-2.5c.5-.5.8-1.2.8-1.9v-2.2A3 3 0 0 1 8 8V6c0-2.2 1.8-4 4-4Z" stroke="rgba(255,255,255,.92)" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9.5 7.2h5" stroke="rgba(255,255,255,.75)" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1>Croup (3 months‚Äì6 years) ‚Ä¢ Rapid Decision Guidance</h1>
          <div class="sub">
            Designed for fast triage, immediate actions, and clear escalation thresholds.
          </div>
          <div class="kicker">
            <span class="badge blue">
              <span class="dot" style="background:var(--blue)"></span>
              <b>Clinical diagnosis</b> <small>Investigations rarely helpful</small>
            </span>
            <span class="badge green">
              <svg class="ic" viewBox="0 0 24 24" fill="none"><path d="M20 6 9 17l-5-5" stroke="rgba(255,255,255,.92)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <b>Single-dose dexamethasone</b> <small>key intervention</small>
            </span>
            <span class="badge red">
              <svg class="ic" viewBox="0 0 24 24" fill="none"><path d="M12 9v4m0 4h.01M10.3 3.6 2.5 18a2 2 0 0 0 1.7 3h15.6a2 2 0 0 0 1.7-3L13.7 3.6a2 2 0 0 0-3.4 0Z" stroke="rgba(255,255,255,.92)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <b>Escalate early</b> <small>severe / failing</small>
            </span>
          </div>
        </div>
      </div>

      <div class="toolbar">
        <div class="pill" title="Keyboard shortcuts">
          <span class="dot"></span>
          <span><b>Tips:</b> <span class="kbd">/</span> focus search ‚Ä¢ <span class="kbd">C</span> copy plan</span>
        </div>
        <button class="btn" id="btnCopyPlan" title="Copy current action plan (C)">
          <svg class="ic24" viewBox="0 0 24 24" fill="none">
            <path d="M9 9h10v12H9z" stroke="rgba(255,255,255,.9)" stroke-width="1.7" stroke-linejoin="round"/>
            <path d="M5 15H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1" stroke="rgba(255,255,255,.7)" stroke-width="1.7" stroke-linecap="round"/>
          </svg>
          Copy plan
        </button>
        <button class="btn" id="btnReset" title="Reset">
          <svg class="ic24" viewBox="0 0 24 24" fill="none">
            <path d="M21 12a9 9 0 1 1-2.6-6.4" stroke="rgba(255,255,255,.9)" stroke-width="1.7" stroke-linecap="round"/>
            <path d="M21 3v6h-6" stroke="rgba(255,255,255,.7)" stroke-width="1.7" stroke-linecap="round"/>
          </svg>
          Reset
        </button>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: rapid triage + actions -->
      <section class="card" id="triageCard">
        <h2>
          <svg class="ic24" viewBox="0 0 24 24" fill="none">
            <path d="M3 12h7l2-7 2 14 2-7h5" stroke="rgba(255,255,255,.92)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Rapid triage ‚Üí action
        </h2>
        <div class="hint">Pick severity; the page highlights <span style="color:var(--green);font-weight:800">recommended actions</span> and <span style="color:var(--red);font-weight:800">red flags</span>.</div>

        <div class="selectRow">
          <div class="seg" role="group" aria-label="Severity selector">
            <button class="mild"  data-sev="mild"  aria-pressed="true">
              <span aria-hidden="true">üü¢</span> Mild
            </button>
            <button class="mod"   data-sev="moderate" aria-pressed="false">
              <span aria-hidden="true">üü†</span> Moderate
            </button>
            <button class="sev"   data-sev="severe" aria-pressed="false">
              <span aria-hidden="true">üî¥</span> Severe
            </button>
            <button class="fail"  data-sev="failure" aria-pressed="false">
              <span aria-hidden="true">üö®</span> Impending failure
            </button>
          </div>

          <div class="field" style="min-width:260px; flex:1;">
            <label for="qSearch">Quick find (symptom / criterion / dose)</label>
            <input id="qSearch" type="text" placeholder="e.g. stridor, RR >60, dexamethasone, drooling‚Ä¶" autocomplete="off" />
          </div>
        </div>

        <div class="divider"></div>

        <div class="two">
          <div class="callout green" id="actionNow">
            <h3>
              <svg class="ic24" viewBox="0 0 24 24" fill="none">
                <path d="M12 2l3 7 7 3-7 3-3 7-3-7-7-3 7-3 3-7Z" stroke="rgba(255,255,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
              </svg>
              Immediate actions (do now)
            </h3>
            <ul id="actionsList"></ul>
          </div>

          <div class="callout red" id="redFlags">
            <h3>
              <svg class="ic24" viewBox="0 0 24 24" fill="none">
                <path d="M12 9v4m0 4h.01M10.3 3.6 2.5 18a2 2 0 0 0 1.7 3h15.6a2 2 0 0 0 1.7-3L13.7 3.6a2 2 0 0 0-3.4 0Z" stroke="rgba(255,255,255,.92)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Red flags / escalation triggers
            </h3>
            <ul id="flagsList"></ul>
          </div>
        </div>

        <div class="divider"></div>

        <div class="two">
          <div class="callout amber" id="admitCard">
            <h3>
              <svg class="ic24" viewBox="0 0 24 24" fill="none">
                <path d="M4 21V7a2 2 0 0 1 2-2h9l5 5v11a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z" stroke="rgba(255,255,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
                <path d="M14 5v5h5" stroke="rgba(255,255,255,.7)" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Admission threshold (primary care decision)
            </h3>
            <p>Admit <b>all</b> moderate/severe/impending failure. Consider admission for additional risk factors.</p>
            <ul>
              <li><b>Always admit</b>: moderate, severe, impending respiratory failure.</li>
              <li><b>Consider admission</b>: RR &gt; <b>60</b>/min; <b>high fever</b> or ‚Äútoxic‚Äù appearance.</li>
              <li><b>Lower threshold</b> even if mild: chronic lung disease, significant CHD, neuromuscular disorders, immunodeficiency, age &lt;3 months, poor oral intake (50‚Äì75% usual) or no wet nappy 12h, carer/social concerns, long distance to care.</li>
            </ul>
          </div>

          <div class="callout green" id="homeCareCard">
            <h3>
              <svg class="ic24" viewBox="0 0 24 24" fill="none">
                <path d="M3 11 12 3l9 8v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V11Z" stroke="rgba(255,255,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
                <path d="M9 22V12h6v10" stroke="rgba(255,255,255,.7)" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Suitable for home management (when mild)
            </h3>
            <ul>
              <li>Single dose <b>oral dexamethasone 0.15 mg/kg</b> immediately.</li>
              <li>Antipyretic/analgesia: paracetamol or ibuprofen if needed.</li>
              <li>Encourage fluids; continue breastfeeding.</li>
              <li>Check regularly (including overnight).</li>
              <li>Safety-net: return if <b>continuous stridor</b>, marked recession, or agitation/restlessness.</li>
            </ul>
          </div>
        </div>

        <div class="divider"></div>

        <details open>
          <summary>
            <div class="left">
              <span aria-hidden="true">üß≠</span> Severity definitions
              <span class="meta">click to collapse/expand</span>
            </div>
            <svg class="chev ic24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M6 9l6 6 6-6" stroke="rgba(255,255,255,.86)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </summary>
          <div class="content" id="defs">
            <div class="two">
              <div class="kv">
                <div>
                  <b>üü¢ Mild</b><br><span>Barking cough; <b>no</b> stridor or recession at rest.</span>
                </div>
                <span class="badge green">Home if safe</span>
              </div>
              <div class="kv">
                <div>
                  <b>üü† Moderate</b><br><span>Barking cough + <b>stridor and sternal recession at rest</b>; little/no agitation or lethargy.</span>
                </div>
                <span class="badge amber">Admit</span>
              </div>
              <div class="kv">
                <div>
                  <b>üî¥ Severe</b><br><span>Barking cough + <b>stridor and recession</b> with <b>agitation or lethargy</b>.</span>
                </div>
                <span class="badge red">Admit + oxygen</span>
              </div>
              <div class="kv">
                <div>
                  <b>üö® Impending respiratory failure</b><br><span>Minimal barking cough; stridor may be quieter; worsening obstruction, marked recession/asynchronous movements, fatigue, pallor/cyanosis, ‚ÜìLOC or tachycardia; recession may lessen as tiring; RR &gt;70 suggests severe distress.</span>
                </div>
                <span class="badge red">Resus pathway</span>
              </div>
            </div>
          </div>
        </details>

        <details>
          <summary>
            <div class="left">
              <span aria-hidden="true">üß™</span> Differential diagnoses (don‚Äôt miss)
              <span class="meta">high-risk mimics</span>
            </div>
            <svg class="chev ic24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M6 9l6 6 6-6" stroke="rgba(255,255,255,.86)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </summary>
          <div class="content">
            <ul>
              <li><b>Bacterial tracheitis</b>: fever + sudden stridor/distress after viral-like illness with apparent recovery then acute deterioration.</li>
              <li><b>Epiglottitis</b>: sudden high fever, dysphagia/drooling, anxiety, non-barking cough, sits upright/head extended. If suspected: <b>avoid oropharyngeal exam/neck manipulation</b>.</li>
              <li><b>Upper airway foreign body</b>: sudden dyspnoea/stridor, clear aspiration history, no viral prodrome; usually afebrile.</li>
              <li><b>Retropharyngeal/peritonsillar abscess</b>: gradual onset + fever, dysphagia, drooling, neck stiffness, unilateral cervical LAD.</li>
              <li><b>Angio-oedema / allergic reaction</b>: acute swelling ¬± urticaria; fever uncommon.</li>
            </ul>
          </div>
        </details>
      </section>

      <!-- RIGHT: dosing + quick safety net + snippets -->
      <aside class="card" id="doseCard">
        <h2>
          <svg class="ic24" viewBox="0 0 24 24" fill="none">
            <path d="M10 2h4l1 6H9l1-6Z" stroke="rgba(255,255,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
            <path d="M7 8h10v5a5 5 0 0 1-10 0V8Z" stroke="rgba(255,255,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
            <path d="M9.5 20h5" stroke="rgba(255,255,255,.7)" stroke-width="1.7" stroke-linecap="round"/>
          </svg>
          Steroid dose + discharge safety-net
        </h2>
        <div class="hint">Calculator uses NICE CKS dosing options for primary care decisions.</div>

        <div class="calc">
          <div class="field">
            <label for="wt">Weight (kg)</label>
            <input id="wt" type="number" inputmode="decimal" min="1" step="0.1" placeholder="e.g. 14" />
          </div>
          <div class="field">
            <label for="route">Steroid option</label>
            <select id="route">
              <option value="po0_15">Oral dexamethasone 0.15 mg/kg (single dose)</option>
              <option value="im0_6">IM dexamethasone 0.6 mg/kg (single dose)</option>
              <option value="nebBude2">Nebulised budesonide 2 mg (single dose)</option>
            </select>
          </div>
        </div>

        <div class="result" id="doseResult" aria-live="polite">
          <div>
            <p class="big" id="doseBig">Enter weight ‚Üí dose</p>
            <p class="small" id="doseSmall">For oral dexamethasone: 0.15 mg/kg, single dose. Alternatives available if too unwell to take PO.</p>
          </div>
          <button class="copy" id="btnCopyDose" title="Copy dose">
            <svg class="ic" viewBox="0 0 24 24" fill="none">
              <path d="M9 9h10v12H9z" stroke="rgba(255,255,255,.9)" stroke-width="1.7" stroke-linejoin="round"/>
              <path d="M5 15H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1" stroke="rgba(255,255,255,.7)" stroke-width="1.7" stroke-linecap="round"/>
            </svg>
            Copy
          </button>
        </div>

        <div class="divider"></div>

        <div class="callout red" id="ambulanceCard">
          <h3>üöë Call ambulance if any of the following</h3>
          <ul>
            <li>Very pale/grey/blue (incl. blue lips) for &gt; a few seconds.</li>
            <li>Unusually sleepy or unresponsive.</li>
            <li>Trouble breathing (e.g., marked recession; ‚Äúbelly sinking in‚Äù; nostril flaring).</li>
            <li>Agitated/restless while struggling to breathe and cannot be calmed quickly.</li>
            <li>Unable to talk, drooling, trouble swallowing, or prefers sitting rather than lying.</li>
          </ul>
        </div>

        <details>
          <summary>
            <div class="left">
              <span aria-hidden="true">üß©</span> Exam technique that avoids deterioration
              <span class="meta">keep calm / reduce agitation</span>
            </div>
            <svg class="chev ic24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M6 9l6 6 6-6" stroke="rgba(255,255,255,.86)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </summary>
          <div class="content">
            <ul>
              <li>Minimise distress: allow child to sit comfortably on parent/carer‚Äôs lap.</li>
              <li>Do not force repositioning‚Äîchild‚Äôs posture is usually optimal for airway patency.</li>
              <li>If epiglottitis is suspected: avoid oropharyngeal examination/neck manipulation.</li>
            </ul>
          </div>
        </details>

        <details>
          <summary>
            <div class="left">
              <span aria-hidden="true">üìå</span> What to document (fast)
              <span class="meta">copy into notes</span>
            </div>
            <svg class="chev ic24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M6 9l6 6 6-6" stroke="rgba(255,255,255,.86)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </summary>
          <div class="content">
            <ul>
              <li>Severity category (mild/moderate/severe/impending failure).</li>
              <li>Stridor at rest? recession? agitation/lethargy? cyanosis/pallor? tachycardia?</li>
              <li>RR (highlight RR &gt;60; RR &gt;70 suggests severe distress).</li>
              <li>Risk modifiers for admission threshold (comorbidity, age &lt;3 months, feeding/urine, social factors, distance).</li>
              <li>Steroid given (drug/route/dose/time) + safety-net advice.</li>
            </ul>
          </div>
        </details>

        <div class="footer">
          <span>Source: NICE CKS Croup (primary care; May 2022 revision). :contentReference[oaicite:1]{index=1}</span>
          <span>Built for rapid scanning ‚Ä¢ Offline ‚Ä¢ No external assets</span>
        </div>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <span aria-hidden="true">‚úÖ</span>
    <span id="toastText">Copied.</span>
  </div>

  <script>
    // --- Data (derived from NICE CKS Croup: diagnosis, severity, management + safety-net) ---
    const SEVERITY = {
      mild: {
        label: "Mild",
        color: "var(--green)",
        actions: [
          "Keep child calm; minimise agitation.",
          "Single dose: oral dexamethasone 0.15 mg/kg immediately (see calculator).",
          "Analgesia/antipyretic if needed (paracetamol/ibuprofen).",
          "Encourage regular fluids; continue breastfeeding.",
          "Safety-net + follow-up interval using clinical judgement."
        ],
        flags: [
          "Stridor at rest (continuous).",
          "Sternal/intercostal recession at rest.",
          "Restlessness/agitation with increased work of breathing.",
          "High fever or ‚Äòtoxic‚Äô appearance.",
          "Poor intake (50‚Äì75% usual) or no wet nappy 12h.",
          "High-risk comorbidity or age <3 months."
        ],
        plan: () => [
          "Severity: Mild croup.",
          "Action: PO dexamethasone 0.15 mg/kg single dose now (if able).",
          "Home care if safe + safety-net; arrange follow-up as clinically indicated.",
          "Return/transfer if stridor at rest, worsening recession, agitation/lethargy, cyanosis, poor intake/urine, or concern for alternative diagnosis."
        ].join("\n")
      },

      moderate: {
        label: "Moderate",
        color: "var(--amber)",
        actions: [
          "Admit / refer for hospital assessment (moderate croup).",
          "While awaiting admission: give oral dexamethasone 0.15 mg/kg (or alternative if too unwell).",
          "Maintain calm environment; avoid upsetting child.",
          "Consider controlled supplemental oxygen if deterioration or hypoxia."
        ],
        flags: [
          "Stridor + sternal recession at rest.",
          "Any agitation/lethargy or fatigue.",
          "RR >60/min or rising.",
          "High fever / ‚Äòtoxic‚Äô appearance (consider bacterial tracheitis/other).",
          "Features suggesting alternative diagnosis (drooling/dysphagia, foreign body, etc.)."
        ],
        plan: () => [
          "Severity: Moderate croup (stridor + sternal recession at rest).",
          "Disposition: Admit / refer for secondary care assessment.",
          "While awaiting transfer: dexamethasone (PO 0.15 mg/kg if able; alternative route if too unwell).",
          "Monitor for escalation: agitation/lethargy, cyanosis, rising RR, tiring, reduced stridor with worsening WOB."
        ].join("\n")
      },

      severe: {
        label: "Severe",
        color: "var(--red)",
        actions: [
          "Admit urgently / emergency transfer.",
          "Controlled supplemental oxygen.",
          "Dexamethasone: PO 0.15 mg/kg if possible; if too unwell: nebulised budesonide 2 mg single dose OR IM dexamethasone 0.6 mg/kg single dose.",
          "Minimise handling; keep child in position of comfort."
        ],
        flags: [
          "Stridor + recession with agitation or lethargy.",
          "Cyanosis/pallor, marked fatigue, ‚ÜìLOC.",
          "Tachycardia as a sign of impending failure.",
          "RR >70/min suggests severe distress; recession may lessen as the child tires."
        ],
        plan: () => [
          "Severity: Severe croup.",
          "Disposition: Urgent transfer/admission.",
          "Immediate: controlled O2; minimise agitation/handling.",
          "Steroid: dexamethasone (PO 0.15 mg/kg if able; otherwise IM 0.6 mg/kg or nebulised budesonide 2 mg single dose).",
          "Watch for impending respiratory failure (tiring, ‚ÜìLOC, cyanosis, tachycardia, quieter stridor with worsening effort)."
        ].join("\n")
      },

      failure: {
        label: "Impending respiratory failure",
        color: "var(--red2)",
        actions: [
          "Activate emergency pathway; urgent transfer / resuscitation.",
          "Controlled supplemental oxygen.",
          "Minimise interventions that provoke distress; keep position of comfort.",
          "Give steroid via feasible route (IM dexamethasone 0.6 mg/kg or nebulised budesonide 2 mg if unable to take PO)."
        ],
        flags: [
          "Minimal barking cough; stridor may become harder to hear (quietening).",
          "Asynchronous chest/abdominal movements; fatigue; pallor/cyanosis.",
          "Decreased level of consciousness.",
          "Tachycardia; recession may lessen as child tires.",
          "RR >70/min suggests severe distress."
        ],
        plan: () => [
          "Severity: Impending respiratory failure.",
          "Disposition: Resuscitation + urgent transfer.",
          "Immediate: controlled O2; minimise handling/keep calm; anticipate deterioration (quiet stridor, tiring, ‚ÜìLOC, cyanosis).",
          "Steroid: IM dexamethasone 0.6 mg/kg (or nebulised budesonide 2 mg) if PO not feasible."
        ].join("\n")
      }
    };

    let currentSeverity = "mild";

    // --- Elements ---
    const segButtons = [...document.querySelectorAll(".seg button")];
    const actionsList = document.getElementById("actionsList");
    const flagsList = document.getElementById("flagsList");
    const btnCopyPlan = document.getElementById("btnCopyPlan");
    const btnReset = document.getElementById("btnReset");
    const qSearch = document.getElementById("qSearch");

    const wt = document.getElementById("wt");
    const route = document.getElementById("route");
    const doseBig = document.getElementById("doseBig");
    const doseSmall = document.getElementById("doseSmall");
    const btnCopyDose = document.getElementById("btnCopyDose");

    const toast = document.getElementById("toast");
    const toastText = document.getElementById("toastText");

    function showToast(text){
      toastText.textContent = text;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 1300);
    }

    function setSeverity(sev){
      currentSeverity = sev;
      segButtons.forEach(b=>{
        const on = b.dataset.sev === sev;
        b.setAttribute("aria-pressed", on ? "true" : "false");
      });

      // render lists
      const s = SEVERITY[sev];

      actionsList.innerHTML = s.actions.map(x => `<li>${highlight(x)}</li>`).join("");
      flagsList.innerHTML = s.flags.map(x => `<li>${highlight(x)}</li>`).join("");

      // subtle accent on triage card header via CSS variables
      document.getElementById("triageCard").style.borderColor = "rgba(255,255,255,.12)";
      document.getElementById("actionNow").style.boxShadow = "none";
      document.getElementById("redFlags").style.boxShadow = "none";

      // context-aware hint in dose panel
      updateDose();
    }

    function highlight(text){
      const q = (qSearch.value || "").trim();
      if(!q) return escapeHtml(text);
      const re = new RegExp("(" + q.replace(/[.*+?^${}()|[\]\\]/g, "\\$&") + ")", "ig");
      return escapeHtml(text).replace(re, `<mark style="background:rgba(58,160,255,.22);border:1px solid rgba(58,160,255,.25);color:rgba(255,255,255,.95);padding:0 4px;border-radius:8px;">$1</mark>`);
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // --- Dose calculator ---
    function round2(n){ return Math.round(n*100)/100; }

    function updateDose(){
      const w = parseFloat(wt.value);
      const opt = route.value;

      if(opt === "nebBude2"){
        doseBig.textContent = "Budesonide 2 mg nebulised ‚Äî single dose";
        doseSmall.textContent = "Option if too unwell to take oral medication (e.g., severe illness / transfer awaiting).";
        return;
      }

      if(!Number.isFinite(w) || w <= 0){
        const label = opt === "po0_15"
          ? "Oral dexamethasone 0.15 mg/kg ‚Äî single dose"
          : "IM dexamethasone 0.6 mg/kg ‚Äî single dose";
        doseBig.textContent = "Enter weight ‚Üí dose";
        doseSmall.textContent = label + ".";
        return;
      }

      let mgPerKg = (opt === "po0_15") ? 0.15 : 0.6;
      const mg = round2(w * mgPerKg);

      const routeLabel = (opt === "po0_15") ? "Oral dexamethasone" : "IM dexamethasone";
      doseBig.textContent = `${routeLabel}: ${mg} mg (single dose)`;
      doseSmall.textContent = `Calculated as ${mgPerKg} mg/kg √ó ${w} kg. Use alternative route if oral dosing not feasible.`;
    }

    // --- Copy helpers ---
    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        showToast("Copied to clipboard.");
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showToast("Copied.");
      }
    }

    function buildPlanText(){
      const s = SEVERITY[currentSeverity];
      const lines = [];
      lines.push("CROUP ‚Äì RAPID PLAN");
      lines.push("------------------");
      lines.push(s.plan());
      lines.push("");
      // include calculated dose snippet
      const opt = route.value;
      const w = parseFloat(wt.value);
      if(opt === "nebBude2"){
        lines.push("Steroid: Budesonide 2 mg nebulised single dose (if PO not possible).");
      }else if(Number.isFinite(w) && w > 0){
        const mgPerKg = (opt === "po0_15") ? 0.15 : 0.6;
        const mg = round2(w * mgPerKg);
        const label = (opt === "po0_15") ? "Dexamethasone PO" : "Dexamethasone IM";
        lines.push(`Steroid (calculated): ${label} ${mg} mg single dose (${mgPerKg} mg/kg √ó ${w} kg).`);
      }else{
        lines.push("Steroid: Dexamethasone PO 0.15 mg/kg single dose (or IM 0.6 mg/kg / nebulised budesonide 2 mg if too unwell).");
      }
      return lines.join("\n");
    }

    // --- Event wiring ---
    segButtons.forEach(b=>{
      b.addEventListener("click", ()=> setSeverity(b.dataset.sev));
    });

    qSearch.addEventListener("input", ()=>{
      // re-render highlighted lists
      setSeverity(currentSeverity);
    });

    [wt, route].forEach(el => el.addEventListener("input", updateDose));
    route.addEventListener("change", updateDose);

    btnCopyPlan.addEventListener("click", ()=> copyText(buildPlanText()));
    btnCopyDose.addEventListener("click", ()=>{
      const opt = route.value;
      const w = parseFloat(wt.value);
      let text = "";
      if(opt === "nebBude2"){
        text = "Budesonide 2 mg nebulised ‚Äî single dose.";
      }else if(Number.isFinite(w) && w > 0){
        const mgPerKg = (opt === "po0_15") ? 0.15 : 0.6;
        const mg = round2(w * mgPerKg);
        text = (opt === "po0_15")
          ? `Dexamethasone PO: ${mg} mg single dose (0.15 mg/kg √ó ${w} kg).`
          : `Dexamethasone IM: ${mg} mg single dose (0.6 mg/kg √ó ${w} kg).`;
      }else{
        text = "Enter weight to calculate dose (PO 0.15 mg/kg; IM 0.6 mg/kg).";
      }
      copyText(text);
    });

    btnReset.addEventListener("click", ()=>{
      wt.value = "";
      route.value = "po0_15";
      qSearch.value = "";
      setSeverity("mild");
      updateDose();
      showToast("Reset.");
    });

    // Keyboard shortcuts
    window.addEventListener("keydown", (e)=>{
      if(e.key === "/" && document.activeElement !== qSearch){
        e.preventDefault();
        qSearch.focus();
      }
      if((e.key === "c" || e.key === "C") && !(e.ctrlKey || e.metaKey || e.altKey)){
        // avoid interfering with browser shortcuts
        e.preventDefault();
        copyText(buildPlanText());
      }
      if(e.key === "Escape"){
        if(document.activeElement === qSearch){
          qSearch.blur();
        } else {
          qSearch.value = "";
          setSeverity(currentSeverity);
          showToast("Search cleared.");
        }
      }
    });

    // Init
    setSeverity("mild");
    updateDose();
  </script>
</body>
</html>
