
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seasonal Influenza - Interactive Algorithm</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f0f7ff 0%, #e6f0ff 100%);
            color: #2c3e50;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
            padding: 20px;
        }

        .main-content {
            flex: 1;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #0d47a1 0%, #1976d2 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(25, 118, 210, 0.2);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 6s infinite linear;
        }

        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            position: relative;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.85;
            max-width: 800px;
            position: relative;
        }

        /* CARD ANIMATION FIX: Removed opacity: 0 from here to prevent vanishing if animation fails */
        /* Animation is now handled exclusively by the specific animation class */
        .algorithm-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-left: 6px solid;
            position: relative;
            overflow: hidden;
            /* Animation Setup */
            opacity: 0; 
            transform: translateY(30px);
            animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        /* Keyframes for the card entry */
        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .algorithm-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.12);
        }

        .algorithm-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #1976d2, #42a5f5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .algorithm-card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            position: relative;
            z-index: 1;
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 20px;
            transition: all 0.3s ease;
            background: rgba(25, 118, 210, 0.1);
            border: 2px solid rgba(25, 118, 210, 0.2);
        }

        .assessment .card-icon {
            background: rgba(41, 182, 246, 0.1);
            border-color: rgba(41, 182, 246, 0.2);
            color: #0288d1;
        }

        .diagnosis .card-icon {
            background: rgba(77, 182, 172, 0.1);
            border-color: rgba(77, 182, 172, 0.2);
            color: #00796b;
        }

        .treatment .card-icon {
            background: rgba(255, 167, 38, 0.1);
            border-color: rgba(255, 167, 38, 0.2);
            color: #f57c00;
        }

        .followup .card-icon {
            background: rgba(236, 64, 122, 0.1);
            border-color: rgba(236, 64, 122, 0.2);
            color: #c2185b;
        }

        .card-title {
            flex: 1;
        }

        .card-title h2 {
            font-size: 1.8em;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .card-title p {
            color: #546e7a;
            font-size: 0.95em;
        }

        .expand-icon {
            font-size: 1.5em;
            transition: transform 0.3s ease;
            color: #78909c;
            background: rgba(0,0,0,0.03);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.6s cubic-bezier(0.215, 0.61, 0.355, 1);
            margin-top: 0;
            padding: 0 10px;
            opacity: 0;
        }

        .card-content.expanded {
            max-height: 2500px; /* Increased to fit chart */
            margin-top: 20px;
            opacity: 1;
            transition: max-height 0.8s ease-in-out, opacity 0.4s ease-in 0.2s;
        }

        .assessment { border-left-color: #29b6f6; animation-delay: 0.1s; }
        .diagnosis { border-left-color: #4db6ac; animation-delay: 0.2s; }
        .treatment { border-left-color: #ffa726; animation-delay: 0.3s; }
        .followup { border-left-color: #ec407a; animation-delay: 0.4s; }

        .severity-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 8px 5px;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
            cursor: pointer;
        }

        .severity-badge:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

        .badge-urgent { background: linear-gradient(135deg, #ff5252 0%, #d32f2f 100%); color: white; }
        .badge-caution { background: linear-gradient(135deg, #ffb142 0%, #ff9800 100%); color: white; }
        .badge-stable { background: linear-gradient(135deg, #66bb6a 0%, #388e3c 100%); color: white; }
        .badge-info { background: linear-gradient(135deg, #42a5f5 0%, #1976d2 100%); color: white; }

        .checklist {
            background: rgba(236, 239, 241, 0.4);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(255,255,255,0.7);
        }

        .checklist-item:hover {
            background: rgba(255,255,255,0.9);
            transform: translateX(5px);
        }

        .checklist-item input[type="checkbox"] {
            margin-right: 12px;
            margin-top: 3px;
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #1976d2;
        }

        .risk-factors {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .risk-category {
            background: rgba(255,255,255,0.7);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .risk-category:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }

        .treatment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .treatment-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(245,249,255,0.9) 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .treatment-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(25, 118, 210, 0.15);
        }

        .progress-sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            margin-left: 20px;
            position: sticky;
            top: 20px;
            height: fit-content;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
            transition: top 0.3s;
        }

        .progress-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0.6;
            background: rgba(236, 239, 241, 0.5);
        }

        .progress-item:hover {
            background: rgba(236, 239, 241, 0.8);
            transform: translateX(8px);
        }

        .progress-item.active {
            opacity: 1;
            background: linear-gradient(135deg, rgba(25, 118, 210, 0.1) 0%, rgba(66, 165, 245, 0.1) 100%);
            border-left: 4px solid #1976d2;
            transform: translateX(5px);
        }

        .progress-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 14px;
            background: rgba(236, 239, 241, 0.8);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .progress-item.active .progress-icon {
            background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
            color: white;
            border-color: transparent;
            transform: scale(1.1);
        }

        .progress-indicator {
            width: 100%;
            height: 6px;
            background: rgba(236, 239, 241, 0.8);
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #29b6f6, #4db6ac, #ffa726, #ec407a);
            width: 0%;
            transition: width 0.7s cubic-bezier(0.22, 0.61, 0.36, 1);
            border-radius: 3px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 30px 0;
            background: rgba(255,255,255,0.7);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .flowchart {
            background: rgba(255,255,255,0.7);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .flowchart:hover { box-shadow: 0 10px 20px rgba(0,0,0,0.08); }

        .flow-node {
            display: inline-block;
            padding: 14px 24px;
            margin: 12px;
            border-radius: 50px;
            font-weight: 500;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .flow-node:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.12); }

        .flow-start { background: linear-gradient(135deg, #42a5f5 0%, #1976d2 100%); color: white; }
        .flow-decision { background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%); color: white; }
        .flow-action { background: linear-gradient(135deg, #66bb6a 0%, #388e3c 100%); color: white; }
        .flow-end { background: linear-gradient(135deg, #78909c 0%, #546e7a 100%); color: white; }

        .flow-arrow { font-size: 1.5em; color: #78909c; margin: 10px; opacity: 0.7; }
        .flow-branch { display: flex; justify-content: space-around; align-items: flex-start; margin: 20px 0; flex-wrap: wrap; }
        
        .flow-branch-item {
            flex: 1;
            min-width: 200px;
            margin: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.7);
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .interactive-demo {
            background: rgba(255,255,255,0.7);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .demo-controls { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }

        .demo-button {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }

        .demo-button:hover { transform: translateY(-3px); box-shadow: 0 7px 15px rgba(0,0,0,0.12); }
        .demo-button.primary { background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%); color: white; }
        .demo-button.success { background: linear-gradient(135deg, #388e3c 0%, #66bb6a 100%); color: white; }
        .demo-button.warning { background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%); color: white; }
        .demo-button.danger { background: linear-gradient(135deg, #d32f2f 0%, #ff5252 100%); color: white; }

        .demo-output {
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            padding: 15px;
            min-height: 100px;
            border: 1px solid rgba(0,0,0,0.05);
            font-family: 'Courier New', monospace;
            color: #37474f;
        }

        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(25, 118, 210, 0.2); }
            70% { box-shadow: 0 0 0 15px rgba(25, 118, 210, 0); }
            100% { box-shadow: 0 0 0 0 rgba(25, 118, 210, 0); }
        }

        /* Generic fade-in for other elements, ensuring it persists */
        .fade-in {
            animation: fadeIn 0.6s ease-in forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .container { flex-direction: column; }
            .progress-sidebar { width: 100%; position: relative; margin-left: 0; margin-bottom: 20px; top: 0; }
            .main-content { padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <div class="header">
                <h1>ü©∫ Seasonal Influenza Management Algorithm</h1>
                <p>Clinical decision support tool for healthcare professionals</p>
            </div>

            <!-- Assessment Card -->
            <!-- Removed explicit 'fade-in' class because 'algorithm-card' handles it better -->
            <div class="algorithm-card assessment" data-step="assessment">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-icon pulse">üìã</div>
                    <div class="card-title">
                        <h2>Patient Assessment</h2>
                        <p>Initial evaluation and risk assessment</p>
                    </div>
                    <div class="expand-icon">‚ñº</div>
                </div>
                <div class="card-content">
                    <p>Comprehensive assessment of patient presenting with influenza-like symptoms</p>
                    
                    <div class="checklist">
                        <h4>üìù Primary Assessment Checklist</h4>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="assess1">
                            <label for="assess1">Assess onset and duration of symptoms</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="assess2">
                            <label for="assess2">Check vaccination status</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="assess3">
                            <label for="assess3">Evaluate exposure history</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="assess4">
                            <label for="assess4">Measure vital signs (temperature, heart rate, respiratory rate)</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="assess5">
                            <label for="assess5">Assess oxygen saturation</label>
                        </div>
                    </div>

                    <div class="risk-factors">
                        <div class="risk-category">
                            <h5>‚ö†Ô∏è High-Risk Groups</h5>
                            <ul style="list-style-type: none; padding-left: 0;">
                                <li>Age > 65 years</li>
                                <li>Children < 6 months</li>
                                <li>Pregnant women</li>
                                <li>BMI ‚â• 40</li>
                            </ul>
                        </div>
                        <div class="risk-category">
                            <h5>üè• Medical Conditions</h5>
                            <ul style="list-style-type: none; padding-left: 0;">
                                <li>Chronic respiratory disease</li>
                                <li>Chronic heart disease</li>
                                <li>Chronic kidney disease</li>
                                <li>Immunosuppression</li>
                                <li>Diabetes mellitus</li>
                            </ul>
                        </div>
                        <div class="risk-category">
                            <h5>üö® Red Flags</h5>
                            <ul style="list-style-type: none; padding-left: 0;">
                                <li>Shortness of breath</li>
                                <li>Chest pain</li>
                                <li>Confusion</li>
                                <li>Severe dehydration</li>
                                <li>Persistent high fever</li>
                            </ul>
                        </div>
                    </div>

                    <div class="interactive-demo">
                        <h4>üéØ Risk Assessment Tool</h4>
                        <div class="demo-controls">
                            <button class="demo-button primary" onclick="simulatePatient(1)">Low Risk Patient</button>
                            <button class="demo-button warning" onclick="simulatePatient(2)">Medium Risk Patient</button>
                            <button class="demo-button danger" onclick="simulatePatient(3)">High Risk Patient</button>
                            <button class="demo-button success" onclick="clearDemo()">Clear</button>
                        </div>
                        <div class="demo-output" id="assessment-output">
                            <p style="color: #999;">Click buttons above to simulate patient scenarios...</p>
                        </div>
                    </div>

                    <div class="chart-container">
                        <canvas id="riskChart"></canvas>
                    </div>

                    <div class="flowchart">
                        <h4>üîç Assessment Flow</h4>
                        <div class="flow-node flow-start">Patient presents with ILI symptoms</div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-node flow-decision">Check symptom onset & severity</div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-node flow-decision">Assess risk factors</div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-branch">
                            <div class="flow-branch-item">
                                <div class="flow-node flow-action">Low risk ‚Üí Home care</div>
                            </div>
                            <div class="flow-branch-item">
                                <div class="flow-node flow-action">High risk ‚Üí Consider antivirals</div>
                            </div>
                            <div class="flow-branch-item">
                                <div class="flow-node flow-action">Severe ‚Üí Urgent referral</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Diagnosis Card -->
            <div class="algorithm-card diagnosis" data-step="diagnosis">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-icon pulse">üî¨</div>
                    <div class="card-title">
                        <h2>Diagnosis & Testing</h2>
                        <p>Confirm influenza and rule out other conditions</p>
                    </div>
                    <div class="expand-icon">‚ñº</div>
                </div>
                <div class="card-content">
                    <p>Diagnostic approach for suspected influenza infection</p>
                    
                    <div class="checklist">
                        <h4>üß™ Diagnostic Checklist</h4>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="diag1">
                            <label for="diag1">Check if influenza is circulating in community</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="diag2">
                            <label for="diag2">Perform rapid influenza diagnostic test if available</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="diag3">
                            <label for="diag3">Consider COVID-19 testing</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="diag4">
                            <label for="diag4">Assess for alternative diagnoses</label>
                        </div>
                    </div>

                    <div class="severity-badge badge-urgent">üö® PCR Test Recommended</div>
                    <div class="severity-badge badge-caution">‚ö†Ô∏è Rapid Test May Have Lower Sensitivity</div>
                    <div class="severity-badge badge-info">‚ÑπÔ∏è Clinical Diagnosis Acceptable During Peak Season</div>

                    <div class="flowchart">
                        <h4>üîÑ Diagnostic Algorithm</h4>
                        <div class="flow-node flow-start">Suspected Influenza</div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-node flow-decision">Is influenza circulating?</div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-branch">
                            <div class="flow-branch-item">
                                <div class="flow-condition">Yes (Peak season)</div>
                                <div class="flow-node flow-action">Clinical diagnosis</div>
                            </div>
                            <div class="flow-branch-item">
                                <div class="flow-condition">No/Low activity</div>
                                <div class="flow-node flow-action">Lab confirmation needed</div>
                            </div>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-node flow-decision">Severity?</div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-node flow-action">Initiate treatment if indicated</div>
                    </div>

                    <div class="interactive-demo">
                        <h4>üé≤ Differential Diagnosis Tool</h4>
                        <div class="demo-controls">
                            <button class="demo-button primary" onclick="showDifferential('influenza')">Influenza</button>
                            <button class="demo-button warning" onclick="showDifferential('covid')">COVID-19</button>
                            <button class="demo-button warning" onclick="showDifferential('rsv')">RSV</button>
                            <button class="demo-button success" onclick="showDifferential('cold')">Common Cold</button>
                            <button class="demo-button danger" onclick="showDifferential('sepsis')">Sepsis</button>
                        </div>
                        <div class="demo-output" id="differential-output">
                            <p style="color: #999;">Select a condition to see key differentiators...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Treatment Card -->
            <div class="algorithm-card treatment" data-step="treatment">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-icon pulse">üíä</div>
                    <div class="card-title">
                        <h2>Treatment & Management</h2>
                        <p>Antiviral therapy and supportive care</p>
                    </div>
                    <div class="expand-icon">‚ñº</div>
                </div>
                <div class="card-content">
                    <p>Evidence-based treatment recommendations for seasonal influenza</p>
                    
                    <div class="treatment-grid">
                        <div class="treatment-card">
                            <h5>üéØ Oseltamivir (Tamiflu)</h5>
                            <p><strong>Adults:</strong> 75mg twice daily for 5 days</p>
                            <p><strong>Children:</strong> Weight-based dosing</p>
                            <p><strong>Prophylaxis:</strong> 75mg once daily for 10 days</p>
                            <div class="severity-badge badge-stable">Preferred for most patients</div>
                        </div>
                        <div class="treatment-card">
                            <h5>ü´Å Zanamivir (Relenza)</h5>
                            <p><strong>Adults & Children >5y:</strong> 10mg twice daily for 5 days</p>
                            <p><strong>Prophylaxis:</strong> 10mg once daily for 10 days</p>
                            <div class="severity-badge badge-caution">Inhaled route only</div>
                        </div>
                        <div class="treatment-card">
                            <h5>üíä Baloxavir (Xofluza)</h5>
                            <p><strong>Single dose:</strong> 40mg or 80mg based on weight</p>
                            <p><strong>Children:</strong> 2mg/kg (max 80mg)</p>
                            <div class="severity-badge badge-info">Single-dose convenience</div>
                        </div>
                    </div>

                    <div class="checklist">
                        <h4>üìù Treatment Checklist</h4>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="treat1">
                            <label for="treat1">Assess eligibility for antivirals (within 48h)</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="treat2">
                            <label for="treat2">Check for contraindications</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="treat3">
                            <label for="treat3">Consider pregnancy status</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="treat4">
                            <label for="treat4">Provide supportive care advice</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="treat5">
                            <label for="treat5">Arrange follow-up if needed</label>
                        </div>
                    </div>

                    <div class="severity-badge badge-urgent">‚è∞ Start within 48 hours of symptom onset</div>
                    <div class="severity-badge badge-caution">‚ö†Ô∏è Consider even after 48h if severe</div>
                    <div class="severity-badge badge-stable">‚úÖ Supportive care for low-risk patients</div>

                    <div class="chart-container">
                        <canvas id="treatmentChart"></canvas>
                    </div>

                    <div class="interactive-demo">
                        <h4>üéÆ Treatment Simulator</h4>
                        <div class="demo-controls">
                            <button class="demo-button primary" onclick="simulateTreatment('healthy')">Healthy Adult</button>
                            <button class="demo-button warning" onclick="simulateTreatment('elderly')">Elderly Patient</button>
                            <button class="demo-button warning" onclick="simulateTreatment('pregnant')">Pregnant Woman</button>
                            <button class="demo-button danger" onclick="simulateTreatment('immunocompromised')">Immunocompromised</button>
                            <button class="demo-button success" onclick="clearTreatment()">Clear</button>
                        </div>
                        <div class="demo-output" id="treatment-output">
                            <p style="color: #999;">Select patient type to see treatment recommendations...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Follow-up Card -->
            <div class="algorithm-card followup" data-step="followup">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-icon pulse">üìà</div>
                    <div class="card-title">
                        <h2>Follow-up & Monitoring</h2>
                        <p>Post-treatment care and complications</p>
                    </div>
                    <div class="expand-icon">‚ñº</div>
                </div>
                <div class="card-content">
                    <p>Guidance on monitoring patients and identifying complications</p>
                    
                    <div class="checklist">
                        <h4>üîç Follow-up Checklist</h4>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="follow1">
                            <label for="follow1">Schedule follow-up within 1 week for high-risk patients</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="follow2">
                            <label for="follow2">Monitor for symptom improvement</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="follow3">
                            <label for="follow3">Educate on warning signs of complications</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="follow4">
                            <label for="follow4">Assess treatment adherence</label>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklistItem(this)">
                            <input type="checkbox" id="follow5">
                            <label for="follow5">Consider post-influenza vaccination</label>
                        </div>
                    </div>

                    <div class="risk-factors">
                        <div class="risk-category">
                            <h5>üö® Complications to Monitor</h5>
                            <ul style="list-style-type: none; padding-left: 0;">
                                <li>Pneumonia (primary or secondary)</li>
                                <li>Exacerbation of chronic conditions</li>
                                <li>Myocarditis/pericarditis</li>
                                <li>Neurological complications</li>
                                <li>Sepsis</li>
                            </ul>
                        </div>
                        <div class="risk-category">
                            <h5>üè† When to Seek Care</h5>
                            <ul style="list-style-type: none; padding-left: 0;">
                                <li>Worsening shortness of breath</li>
                                <li>Chest pain</li>
                                <li>Confusion or altered mental status</li>
                                <li>Persistent fever >3 days</li>
                                <li>Inability to maintain hydration</li>
                            </ul>
                        </div>
                        <div class="risk-category">
                            <h5>üìä Recovery Timeline</h5>
                            <ul style="list-style-type: none; padding-left: 0;">
                                <li>Fever: 1-3 days</li>
                                <li>Cough/fatigue: 1-2 weeks</li>
                                <li>Return to work: 5-7 days</li>
                                <li>Full recovery: 2-4 weeks</li>
                            </ul>
                        </div>
                    </div>

                    <div class="flowchart">
                        <h4>üìÖ Follow-up Pathway</h4>
                        <div class="flow-node flow-start">Complete treatment</div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-node flow-decision">Symptoms improving?</div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-branch">
                            <div class="flow-branch-item">
                                <div class="flow-condition">Yes</div>
                                <div class="flow-node flow-action">Routine follow-up</div>
                            </div>
                            <div class="flow-branch-item">
                                <div class="flow-condition">No</div>
                                <div class="flow-node flow-action">Investigate complications</div>
                            </div>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-node flow-end">Recovery or further management</div>
                    </div>

                    <div class="interactive-demo">
                        <h4>üé¨ Complication Scenarios</h4>
                        <div class="demo-controls">
                            <button class="demo-button success" onclick="simulateFollowup('normal')">Normal Recovery</button>
                            <button class="demo-button warning" onclick="simulateFollowup('slow')">Slow Recovery</button>
                            <button class="demo-button danger" onclick="simulateFollowup('complication')">Complication</button>
                            <button class="demo-button primary" onclick="simulateFollowup('readmission')">Readmission</button>
                            <button class="demo-button" onclick="clearFollowup()">Clear</button>
                        </div>
                        <div class="demo-output" id="followup-output">
                            <p style="color: #999;">Select a scenario to see management recommendations...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Card -->
            <div class="algorithm-card" style="border-left-color: #9c27b0;">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-icon pulse" style="background: #f3e5f5; color: #9c27b0;">üìä</div>
                    <div class="card-title">
                        <h2>Key Takeaways</h2>
                        <p>Summary of main recommendations</p>
                    </div>
                    <div class="expand-icon">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="treatment-grid">
                        <div class="treatment-card">
                            <h5>üéØ Key Points</h5>
                            <ul>
                                <li>Antivirals most effective within 48h</li>
                                <li>Assess risk factors early</li>
                                <li>Monitor for complications</li>
                                <li>Supportive care is mainstay</li>
                            </ul>
                        </div>
                        <div class="treatment-card">
                            <h5>‚ö†Ô∏è When to Refer</h5>
                            <ul>
                                <li>Signs of pneumonia</li>
                                <li>Severe dehydration</li>
                                <li>Altered mental status</li>
                                <li>Worsening symptoms</li>
                            </ul>
                        </div>
                        <div class="treatment-card">
                            <h5>üìû Contact Information</h5>
                            <ul>
                                <li>Public Health: 0300 123 1234</li>
                                <li>ID Consultant: [Local contact]</li>
                                <li>UKHSA: www.gov.uk</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Sidebar -->
        <div class="progress-sidebar">
            <h3>üìç Progress Tracker</h3>
            <div class="progress-indicator">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-item active" onclick="scrollToCard('assessment')">
                <div class="progress-icon">üìã</div>
                <div class="progress-text">Assessment</div>
            </div>
            <div class="progress-item" onclick="scrollToCard('diagnosis')">
                <div class="progress-icon">üî¨</div>
                <div class="progress-text">Diagnosis</div>
            </div>
            <div class="progress-item" onclick="scrollToCard('treatment')">
                <div class="progress-icon">üíä</div>
                <div class="progress-text">Treatment</div>
            </div>
            <div class="progress-item" onclick="scrollToCard('followup')">
                <div class="progress-icon">üìà</div>
                <div class="progress-text">Follow-up</div>
            </div>
            
            <div style="margin-top: 30px;">
                <h4 style="margin-bottom: 15px;">üìä Quick Stats</h4>
                <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; font-size: 0.9em;">
                    <p>Treatment window: <strong>48 hours</strong></p>
                    <p>Prophylaxis duration: <strong>10 days</strong></p>
                    <p>Recovery time: <strong>1-2 weeks</strong></p>
                    <p>Contagious period: <strong>5-7 days</strong></p>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <h4 style="margin-bottom: 15px;">üî• Alerts</h4>
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; font-size: 0.9em; border-left: 4px solid #ffa726;">
                    <p style="margin-bottom: 5px;"><strong>Seasonal Alert:</strong></p>
                    <p>High influenza activity in your region</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentStep = 'assessment';
        let progressPercentage = 0;
        let riskChart, treatmentChart;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            updateProgress('assessment');
            
            // Add scroll listener for progress tracking
            window.addEventListener('scroll', trackScroll);
        });

        // Initialize charts
        function initializeCharts() {
            try {
                // Risk Chart
                const riskCtx = document.getElementById('riskChart');
                if (riskCtx) {
                    riskChart = new Chart(riskCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Low Risk', 'Moderate Risk', 'High Risk', 'Very High Risk'],
                            datasets: [{
                                data: [30, 35, 25, 10],
                                backgroundColor: ['#66bb6a', '#ffa726', '#ff7043', '#ef5350'],
                                borderWidth: 2,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                },
                                title: {
                                    display: true,
                                    text: 'Patient Risk Distribution'
                                }
                            }
                        }
                    });
                }

                // Treatment Chart
                const treatmentCtx = document.getElementById('treatmentChart');
                if (treatmentCtx) {
                    treatmentChart = new Chart(treatmentCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Oseltamivir', 'Zanamivir', 'Baloxavir', 'Supportive Care'],
                            datasets: [{
                                label: 'Effectiveness (%)',
                                data: [85, 80, 90, 60],
                                backgroundColor: ['#42a5f5', '#4db6ac', '#ffa726', '#66bb6a'],
                                borderWidth: 1,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'Treatment Options Effectiveness'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    });
                }
            } catch (e) {
                console.error("Chart.js failed to load", e);
            }
        }

        // Toggle card expansion
        function toggleCard(header) {
            const card = header.parentElement;
            const content = card.querySelector('.card-content');
            const icon = header.querySelector('.expand-icon');
            
            content.classList.toggle('expanded');
            icon.style.transform = content.classList.contains('expanded') ? 'rotate(180deg)' : 'rotate(0deg)';
            
            // Update progress when card is opened
            if (content.classList.contains('expanded')) {
                const step = card.dataset.step;
                if (step) {
                    updateProgress(step);
                }
            }
        }

        // Toggle checklist items
        function toggleChecklistItem(item) {
            const checkbox = item.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            
            // Add visual feedback
            if (checkbox.checked) {
                item.style.background = '#e8f5e8';
                item.style.textDecoration = 'line-through';
                item.style.opacity = '0.8';
            } else {
                item.style.background = '#f8f9fa';
                item.style.textDecoration = 'none';
                item.style.opacity = '1';
            }
            
            // Check if all items are completed
            const checklist = item.parentElement;
            const allItems = checklist.querySelectorAll('.checklist-item input[type="checkbox"]');
            const checkedItems = checklist.querySelectorAll('.checklist-item input[type="checkbox"]:checked');
            
            if (allItems.length === checkedItems.length && allItems.length > 0) {
                showNotification('‚úÖ Checklist completed!', 'success');
            }
        }

        // Update progress bar
        function updateProgress(step) {
            if (!step) return;
            const steps = ['assessment', 'diagnosis', 'treatment', 'followup'];
            const stepIndex = steps.indexOf(step);
            const newProgress = ((stepIndex + 1) / steps.length) * 100;
            
            // Smooth transition
            const progressBar = document.getElementById('progressBar');
            if (progressBar) progressBar.style.width = newProgress + '%';
            
            // Update active progress item
            document.querySelectorAll('.progress-item').forEach((item, index) => {
                if (index <= stepIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            progressPercentage = newProgress;
            currentStep = step;
        }

        // Scroll to specific card
        function scrollToCard(step) {
            const card = document.querySelector(`[data-step="${step}"]`);
            if (card) {
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Expand the card
                const content = card.querySelector('.card-content');
                const icon = card.querySelector('.expand-icon');
                if (content && !content.classList.contains('expanded')) {
                    content.classList.add('expanded');
                    if(icon) icon.style.transform = 'rotate(180deg)';
                }
                
                // Update progress
                updateProgress(step);
            }
        }

        // Track scroll position
        function trackScroll() {
            const cards = document.querySelectorAll('.algorithm-card');
            const scrollPosition = window.scrollY + 200;
            
            cards.forEach(card => {
                const cardTop = card.offsetTop;
                const cardHeight = card.offsetHeight;
                const step = card.dataset.step;
                
                if (scrollPosition >= cardTop && scrollPosition < cardTop + cardHeight && step) {
                    updateProgress(step);
                }
            });
        }

        // Patient simulation
        function simulatePatient(riskLevel) {
            const output = document.getElementById('assessment-output');
            let riskAssessment = '';
            let badges = '';
            
            switch(riskLevel) {
                case 1: // Low risk
                    riskAssessment = `
                        <p class="stable"><strong>‚úÖ Low Risk Patient:</strong></p>
                        <p class="stable">‚Ä¢ Age: 25 years, healthy</p>
                        <p class="stable">‚Ä¢ Symptoms: Mild fever, cough</p>
                        <p class="stable">‚Ä¢ No chronic conditions</p>
                        <p class="stable">‚Ä¢ Assessment: Supportive care only</p>
                        <p class="stable">‚Ä¢ Advice: Rest, fluids, OTC analgesics</p>
                    `;
                    badges = '<span class="severity-badge badge-stable">Low Risk - Home Care</span>';
                    break;
                    
                case 2: // Medium risk
                    riskAssessment = `
                        <p class="caution"><strong>‚ö†Ô∏è Medium Risk Patient:</strong></p>
                        <p class="caution">‚Ä¢ Age: 45 years, asthma</p>
                        <p class="caution">‚Ä¢ Symptoms: Moderate fever, cough, wheeze</p>
                        <p class="caution">‚Ä¢ Risk factor: Chronic respiratory disease</p>
                        <p class="caution">‚Ä¢ Assessment: Consider antivirals</p>
                        <p class="caution">‚Ä¢ Treatment: Oseltamivir 75mg BD x 5 days</p>
                        <p class="caution">‚Ä¢ Monitor closely</p>
                    `;
                    badges = '<span class="severity-badge badge-caution">Medium Risk - Consider Antivirals</span>';
                    break;
                    
                case 3: // High risk
                    riskAssessment = `
                        <p class="urgent"><strong>üö® High Risk Patient:</strong></p>
                        <p class="urgent">‚Ä¢ Age: 72 years, diabetes, heart failure</p>
                        <p class="urgent">‚Ä¢ Symptoms: High fever, dyspnea, fatigue</p>
                        <p class="urgent">‚Ä¢ Risk factors: Age >65, diabetes, heart disease</p>
                        <p class="urgent">‚Ä¢ Assessment: URGENT antiviral treatment</p>
                        <p class="urgent">‚Ä¢ Treatment: Oseltamivir 75mg BD x 5 days</p>
                        <p class="urgent">‚Ä¢ Follow-up: Within 3 days</p>
                        <p class="urgent">‚Ä¢ Consider hospital referral if deteriorates</p>
                    `;
                    badges = '<span class="severity-badge badge-urgent">High Risk - Urgent Treatment</span>';
                    break;
            }
            
            output.innerHTML = riskAssessment + '<div style="margin-top: 15px;">' + badges + '</div>';
            
            // Update risk chart
            if (riskChart) {
                const newData = riskLevel === 1 ? [60, 30, 8, 2] : 
                               riskLevel === 2 ? [25, 50, 20, 5] : 
                               [10, 20, 40, 30];
                riskChart.data.datasets[0].data = newData;
                riskChart.update();
            }
        }

        // Differential diagnosis
        function showDifferential(condition) {
            const output = document.getElementById('differential-output');
            const differentials = {
                influenza: `
                    <p class="caution"><strong>ü¶† Influenza:</strong></p>
                    <p class="caution">‚Ä¢ Abrupt onset, high fever</p>
                    <p class="caution">‚Ä¢ Severe myalgia, fatigue</p>
                    <p class="caution">‚Ä¢ Seasonal pattern</p>
                    <p class="caution">‚Ä¢ Test: Rapid antigen or PCR</p>
                `,
                covid: `
                    <p class="urgent"><strong>ü¶† COVID-19:</strong></p>
                    <p class="urgent">‚Ä¢ Gradual onset</p>
                    <p class="urgent">‚Ä¢ Loss of taste/smell</p>
                    <p class="urgent">‚Ä¢ PCR test required</p>
                    <p class="urgent">‚Ä¢ Isolate immediately</p>
                `,
                rsv: `
                    <p class="caution"><strong>ü´Å RSV:</strong></p>
                    <p class="caution">‚Ä¢ More common in children</p>
                    <p class="caution">‚Ä¢ Bronchiolitis symptoms</p>
                    <p class="caution">‚Ä¢ PCR test available</p>
                    <p class="caution">‚Ä¢ Supportive care</p>
                `,
                cold: `
                    <p class="stable"><strong>ü§ß Common Cold:</strong></p>
                    <p class="stable">‚Ä¢ Gradual onset</p>
                    <p class="stable">‚Ä¢ Mild symptoms</p>
                    <p class="stable">‚Ä¢ No fever or mild fever</p>
                    <p class="stable">‚Ä¢ Self-limiting</p>
                `,
                sepsis: `
                    <p class="urgent"><strong>üö® Sepsis:</strong></p>
                    <p class="urgent">‚Ä¢ High fever, tachycardia</p>
                    <p class="urgent">‚Ä¢ Confusion, hypotension</p>
                    <p class="urgent">‚Ä¢ URGENT referral needed</p>
                    <p class="urgent">‚Ä¢ Blood cultures</p>
                `
            };
            
            output.innerHTML = differentials[condition] || '<p>Information not available</p>';
        }

        // Treatment simulation
        function simulateTreatment(patientType) {
            const output = document.getElementById('treatment-output');
            let treatment = '';
            
            switch(patientType) {
                case 'healthy':
                    treatment = `
                        <p class="stable"><strong>üòä Healthy Adult (35 years):</strong></p>
                        <p class="stable">‚Ä¢ Symptoms: Mild fever, cough</p>
                        <p class="stable">‚Ä¢ Treatment: Supportive care</p>
                        <p class="stable">‚Ä¢ Rest, fluids, paracetamol</p>
                        <p class="stable">‚Ä¢ No antivirals needed</p>
                        <p class="stable">‚Ä¢ Expected recovery: 5-7 days</p>
                        <span class="severity-badge badge-stable">Supportive Care Only</span>
                    `;
                    break;
                    
                case 'elderly':
                    treatment = `
                        <p class="caution"><strong>üë¥ Elderly Patient (78 years):</strong></p>
                        <p class="caution">‚Ä¢ Risk factors: Age >65</p>
                        <p class="caution">‚Ä¢ Treatment: Oseltamivir 75mg BD x 5 days</p>
                        <p class="caution">‚Ä¢ Supportive care</p>
                        <p class="caution">‚Ä¢ Monitor for complications</p>
                        <p class="caution">‚Ä¢ Follow-up in 3 days</p>
                        <span class="severity-badge badge-caution">Antiviral Recommended</span>
                    `;
                    break;
                    
                case 'pregnant':
                    treatment = `
                        <p class="caution"><strong>ü§∞ Pregnant Woman (28 weeks):</strong></p>
                        <p class="caution">‚Ä¢ Risk factors: Pregnancy</p>
                        <p class="caution">‚Ä¢ Treatment: Oseltamivir 75mg BD x 5 days</p>
                        <p class="caution">‚Ä¢ First-line in pregnancy</p>
                        <p class="caution">‚Ä¢ Monitor fetal movements</p>
                        <p class="caution">‚Ä¢ F/U with obstetrics</p>
                        <span class="severity-badge badge-caution">Antiviral Essential</span>
                    `;
                    break;
                    
                case 'immunocompromised':
                    treatment = `
                        <p class="urgent"><strong>‚ö†Ô∏è Immunocompromised Patient:</strong></p>
                        <p class="urgent">‚Ä¢ Risk factors: Chemotherapy</p>
                        <p class="urgent">‚Ä¢ Treatment: Oseltamivir 75mg BD x 10 days</p>
                        <p class="urgent">‚Ä¢ Consider higher dose</p>
                        <p class="urgent">‚Ä¢ Monitor for resistance</p>
                        <p class="urgent">‚Ä¢ F/U daily until stable</p>
                        <span class="severity-badge badge-urgent">High-Dose Antiviral</span>
                    `;
                    break;
            }
            
            output.innerHTML = treatment;
            
            // Update treatment chart
            if (treatmentChart) {
                const effectiveness = patientType === 'healthy' ? [20, 10, 15, 100] :
                                     patientType === 'elderly' ? [90, 85, 80, 40] :
                                     patientType === 'pregnant' ? [95, 70, 60, 30] :
                                     [100, 90, 85, 20];
                treatmentChart.data.datasets[0].data = effectiveness;
                treatmentChart.update();
            }
        }

        // Follow-up simulation
        function simulateFollowup(scenario) {
            const output = document.getElementById('followup-output');
            let followup = '';
            
            switch(scenario) {
                case 'normal':
                    followup = `
                        <p class="stable"><strong>‚úÖ Normal Recovery:</strong></p>
                        <p class="stable">‚Ä¢ Fever resolved after 3 days</p>
                        <p class="stable">‚Ä¢ Cough improving</p>
                        <p class="stable">‚Ä¢ Energy levels returning</p>
                        <p class="stable">‚Ä¢ Plan: Continue supportive care</p>
                        <p class="stable">‚Ä¢ Return to work in 2-3 days</p>
                        <span class="severity-badge badge-stable">On Track</span>
                    `;
                    break;
                    
                case 'slow':
                    followup = `
                        <p class="caution"><strong>‚ö†Ô∏è Slow Recovery:</strong></p>
                        <p class="caution">‚Ä¢ Persistent fatigue</p>
                        <p class="caution">‚Ä¢ Ongoing cough</p>
                        <p class="caution">‚Ä¢ No fever</p>
                        <p class="caution">‚Ä¢ Plan: Extended rest</p>
                        <p class="caution">‚Ä¢ F/U in 1 week</p>
                        <span class="severity-badge badge-caution">Monitor Closely</span>
                    `;
                    break;
                    
                case 'complication':
                    followup = `
                        <p class="urgent"><strong>üö® Complication:</strong></p>
                        <p class="urgent">‚Ä¢ Worsening shortness of breath</p>
                        <p class="urgent">‚Ä¢ Chest pain on breathing</p>
                        <p class="urgent">‚Ä¢ Focal chest signs</p>
                        <p class="urgent">‚Ä¢ Plan: Urgent chest X-ray</p>
                        <p class="urgent">‚Ä¢ Consider hospital referral</p>
                        <span class="severity-badge badge-urgent">Urgent Assessment</span>
                    `;
                    break;
                    
                case 'readmission':
                    followup = `
                        <p class="urgent"><strong>üè• Hospital Readmission:</strong></p>
                        <p class="urgent">‚Ä¢ Severe respiratory distress</p>
                        <p class="urgent">‚Ä¢ Oxygen saturation < 92%</p>
                        <p class="urgent">‚Ä¢ Confusion</p>
                        <p class="urgent">‚Ä¢ Plan: Immediate A&E referral</p>
                        <span class="severity-badge badge-urgent">EMERGENCY</span>
                    `;
                    break;
            }
            
            output.innerHTML = followup;
        }

        // Clear functions
        function clearDemo() {
            document.getElementById('assessment-output').innerHTML = '<p style="color: #999;">Click buttons above to simulate patient scenarios...</p>';
            if (riskChart) {
                riskChart.data.datasets[0].data = [30, 35, 25, 10];
                riskChart.update();
            }
        }

        function clearTreatment() {
            document.getElementById('treatment-output').innerHTML = '<p style="color: #999;">Select patient type to see treatment recommendations...</p>';
            if (treatmentChart) {
                treatmentChart.data.datasets[0].data = [85, 80, 90, 60];
                treatmentChart.update();
            }
        }

        function clearFollowup() {
            document.getElementById('followup-output').innerHTML = '<p style="color: #999;">Select a scenario to see management recommendations...</p>';
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1000;
                animation: slideIn 0.3s ease;
                background: ${type === 'success' ? '#66bb6a' : type === 'warning' ? '#ffa726' : type === 'error' ? '#ef5350' : '#42a5f5'};
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add CSS animations to document
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Auto-save and restore
        function saveProgress() {
            const progress = {
                currentStep: currentStep,
                checklistItems: Array.from(document.querySelectorAll('.checklist-item input[type="checkbox"]:checked')).map(cb => cb.id),
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('influenzaAlgorithmProgress', JSON.stringify(progress));
        }

        function restoreProgress() {
            const saved = localStorage.getItem('influenzaAlgorithmProgress');
            if (saved) {
                try {
                    const progress = JSON.parse(saved);
                    if(progress.checklistItems) {
                        progress.checklistItems.forEach(id => {
                            const checkbox = document.getElementById(id);
                            if (checkbox) {
                                checkbox.checked = true;
                                const item = checkbox.closest('.checklist-item');
                                if(item) {
                                    item.style.background = '#e8f5e8';
                                    item.style.textDecoration = 'line-through';
                                    item.style.opacity = '0.8';
                                }
                            }
                        });
                    }
                    showNotification('üìä Progress restored from last session', 'info');
                } catch(e) {
                    console.error("Error restoring progress", e);
                }
            }
        }

        // Auto-save when user leaves page
        window.addEventListener('beforeunload', saveProgress);

        // Restore progress on page load
        window.addEventListener('load', restoreProgress);

        // Add welcome message
        setTimeout(() => {
            showNotification('ü©∫ Welcome! Use the interactive features to explore the algorithm', 'info');
        }, 1000);
    </script>
</body>
</html>
