<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Male Factor Infertility - Interactive Algorithm</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 250px;
            gap: 30px;
        }

        .header {
            grid-column: 1 / -1;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            padding: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .card-header:hover {
            filter: brightness(1.05);
        }

        .card-header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: rgba(255, 255, 255, 0.2);
        }

        .card-title {
            color: white;
            font-size: 1.5em;
            font-weight: 600;
        }

        .expand-icon {
            color: white;
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card.expanded .card-content {
            max-height: 3000px;
        }

        .card-body {
            padding: 0 25px 25px;
        }

        /* Card-specific colors */
        .assessment .card-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .diagnosis .card-header {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .treatment .card-header {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .followup .card-header {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }

        /* Badge styles */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .badge-urgent {
            background: #e74c3c;
            color: white;
        }

        .badge-caution {
            background: #f39c12;
            color: white;
        }

        .badge-stable {
            background: #27ae60;
            color: white;
        }

        .badge-info {
            background: #3498db;
            color: white;
        }

        /* Content sections */
        .section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ecf0f1;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .subsection {
            margin-bottom: 15px;
        }

        .subsection-title {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }

        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .criteria-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .pathway-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 15px;
        }

        .pathway-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid #2ecc71;
            transition: all 0.3s ease;
        }

        .pathway-card:hover {
            background: #e8f6f3;
            transform: translateX(5px);
        }

        .pathway-card.urgent {
            border-left-color: #e74c3c;
        }

        .pathway-card.caution {
            border-left-color: #f39c12;
        }

        .algorithm-step {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .algorithm-step::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: #3498db;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 10px;
        }

        .decision-point {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .decision-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .outcome-box {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .outcome-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        ul {
            padding-left: 20px;
        }

        li {
            margin-bottom: 8px;
        }

        .reference {
            font-size: 0.9em;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 10px;
        }

        /* Sidebar styles */
        .sidebar {
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .progress-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .progress-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .progress-step:hover {
            background: #e3f2fd;
        }

        .progress-step.active {
            background: #3498db;
            color: white;
        }

        .progress-step.completed {
            background: #2ecc71;
            color: white;
        }

        .progress-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #bdc3c7;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            transition: all 0.3s ease;
        }

        .progress-step.active .progress-icon,
        .progress-step.completed .progress-icon {
            background: white;
            color: #2ecc71;
        }

        .progress-text {
            font-weight: 500;
        }

        .sticky-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9em;
            color: #856404;
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
                margin-top: 30px;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .card-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .card-title {
                font-size: 1.2em;
            }

            .criteria-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: fadeIn 0.5s ease forwards;
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }

        /* Print styles */
        @media print {
            body {
                background: white;
            }

            .sidebar,
            .expand-icon {
                display: none;
            }

            .card-content {
                max-height: none !important;
            }

            .card {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
        }

        /* Info tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #2c3e50;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9em;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <i class="fas fa-dna"></i>
                Male Factor Infertility
            </h1>
            <p>Interactive Clinical Algorithm | BMJ Best Practice Guidelines</p>
        </div>

        <div class="main-content">
            <!-- Assessment Card -->
            <div class="card assessment" data-step="assessment">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-header-left">
                        <div class="card-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div class="card-title">Assessment & Initial Evaluation</div>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-history"></i>
                                Comprehensive History
                            </div>
                            <div class="subsection">
                                <div class="subsection-title">Key Questions:</div>
                                <ul>
                                    <li>Duration of infertility and previous pregnancies</li>
                                    <li>Frequency and timing of intercourse</li>
                                    <li>Previous fertility treatments</li>
                                    <li>Medical and surgical history (cryptorchidism, torsion, trauma)</li>
                                    <li>Current medications (testosterone, anabolic steroids, chemotherapy)</li>
                                    <li>Lifestyle factors (smoking, alcohol, cannabis, hot tub use)</li>
                                    <li>Occupational/environmental toxin exposure</li>
                                </ul>
                            </div>
                            <div class="subsection">
                                <div class="subsection-title">Risk Factors to Identify:</div>
                                <div class="criteria-grid">
                                    <div class="criteria-item">
                                        <span class="badge badge-urgent">Strong Risk</span>
                                        <strong>Varicocele</strong> - Most common identifiable abnormality
                                    </div>
                                    <div class="criteria-item">
                                        <span class="badge badge-urgent">Strong Risk</span>
                                        <strong>Cryptorchidism</strong> - Associated with oligozoospermia
                                    </div>
                                    <div class="criteria-item">
                                        <span class="badge badge-urgent">Strong Risk</span>
                                        <strong>Chemotherapy/Radiotherapy</strong> - Can cause permanent azoospermia
                                    </div>
                                    <div class="criteria-item">
                                        <span class="badge badge-urgent">Strong Risk</span>
                                        <strong>Cystic Fibrosis / CBAVD</strong> - 80% have CFTR mutations
                                    </div>
                                    <div class="criteria-item">
                                        <span class="badge badge-caution">Moderate Risk</span>
                                        <strong>Endocrinopathy</strong> - Affects 2% of infertile men
                                    </div>
                                    <div class="criteria-item">
                                        <span class="badge badge-caution">Moderate Risk</span>
                                        <strong>Obesity</strong> - Reduces testosterone levels
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-user-md"></i>
                                Physical Examination
                            </div>
                            <ul>
                                <li><strong>Secondary sexual characteristics:</strong> Body habitus, hair distribution, gynecomastia</li>
                                <li><strong>Genital examination:</strong> Testicular volume (≥20cm³ normal), consistency, irregularities</li>
                                <li><strong>Varicocele detection:</strong> Graded 1+ (Valsalva) to 3+ (visible)</li>
                                <li><strong>Vas deferens:</strong> Check for congenital bilateral absence (CBAVD)</li>
                                <li><strong>Rectal exam:</strong> Prostatic abnormalities if indicated</li>
                            </ul>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-flask"></i>
                                Initial Investigations
                            </div>
                            <div class="subsection">
                                <div class="subsection-title">Semen Analysis (Two samples, 1 month apart):</div>
                                <div class="criteria-grid">
                                    <div class="criteria-item">
                                        <strong>Volume:</strong> >1.4 mL
                                        <span class="badge badge-stable">WHO Normal</span>
                                    </div>
                                    <div class="criteria-item">
                                        <strong>Concentration:</strong> >16 million/mL
                                        <span class="badge badge-stable">WHO Normal</span>
                                    </div>
                                    <div class="criteria-item">
                                        <strong>Motility:</strong> >42% total motility
                                        <span class="badge badge-stable">WHO Normal</span>
                                    </div>
                                    <div class="criteria-item">
                                        <strong>Morphology:</strong> >4% normal forms
                                        <span class="badge badge-stable">WHO Normal</span>
                                    </div>
                                </div>
                            </div>
                            <div class="reference">
                                Collection: After 2-7 days abstinence, by masturbation without lubricants
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-exclamation-triangle"></i>
                                Red Flags Requiring Immediate Referral
                            </div>
                            <div class="decision-point">
                                <div class="decision-title">
                                    <i class="fas fa-flag"></i>
                                    Urgent Endocrine Referral Indicated
                                </div>
                                <ul>
                                    <li>Severe oligozoospermia (≤5 million/mL) <span class="badge badge-urgent">Urgent</span></li>
                                    <li>Azoospermia <span class="badge badge-urgent">Urgent</span></li>
                                    <li>Signs of hypogonadism (low testosterone, elevated FSH)</li>
                                    <li>Atrophic testes (<4.6 cm longitudinal axis)</li>
                                    <li>Gynecomastia or abnormal hair distribution</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Diagnosis Card -->
            <div class="card diagnosis" data-step="diagnosis">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-header-left">
                        <div class="card-icon">
                            <i class="fas fa-microscope"></i>
                        </div>
                        <div class="card-title">Diagnostic Criteria & Classification</div>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-chart-line"></i>
                                Semen Analysis Interpretation
                            </div>
                            <div class="pathway-container">
                                <div class="pathway-card urgent">
                                    <div class="outcome-title">
                                        <i class="fas fa-exclamation-circle"></i>
                                        Azoospermia
                                        <span class="badge badge-urgent">Critical</span>
                                    </div>
                                    <p><strong>Definition:</strong> No sperm after centrifugation and pellet analysis</p>
                                    <div class="decision-point">
                                        <div class="decision-title">Differentiate Causes:</div>
                                        <div class="outcome-box">
                                            <div class="outcome-title">Obstructive Azoospermia:</div>
                                            <ul>
                                                <li>Normal testicular size & hormones</li>
                                                <li>Low/normal semen volume</li>
                                                <li>CBAVD, ejaculatory duct obstruction, post-infection/surgery</li>
                                            </ul>
                                        </div>
                                        <div class="outcome-box">
                                            <div class="outcome-title">Non-obstructive Azoospermia:</div>
                                            <ul>
                                                <li>Small testes (TLA <4.6 cm)</li>
                                                <li>↑FSH (>7.6 mIU/mL)</li>
                                                <li>Impaired spermatogenesis</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <span class="badge badge-urgent">Genetic testing indicated</span>
                                </div>

                                <div class="pathway-card caution">
                                    <div class="outcome-title">
                                        <i class="fas fa-tint"></i>
                                        Oligozoospermia
                                        <span class="badge badge-caution">Moderate</span>
                                    </div>
                                    <p><strong>Definition:</strong> <16 million sperm/mL</p>
                                    <ul>
                                        <li><strong>Mild-Moderate:</strong> 5-16 million/mL</li>
                                        <li><strong>Severe:</strong> ≤5 million/mL <span class="badge badge-urgent">Urgent</span></li>
                                    </ul>
                                    <div class="reference">Indicates disruption of spermatogenesis at various levels</div>
                                </div>

                                <div class="pathway-card caution">
                                    <div class="outcome-title">
                                        <i class="fas fa-swimmer"></i>
                                        Asthenozoospermia
                                        <span class="badge badge-caution">Moderate</span>
                                    </div>
                                    <p><strong>Definition:</strong> <42% total motility or <30% progressive motility</p>
                                    <p>Consider: Anti-sperm antibodies, flagellar defects, toxic exposure, Kartagener syndrome</p>
                                </div>

                                <div class="pathway-card caution">
                                    <div class="outcome-title">
                                        <i class="fas fa-shapes"></i>
                                        Teratozoospermia
                                        <span class="badge badge-caution">Moderate</span>
                                    </div>
                                    <p><strong>Definition:</strong> <4% normal forms (Kruger strict morphology)</p>
                                    <p>Indicates incomplete spermiogenesis</p>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-dna"></i>
                                Genetic Testing Indications
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">1</span>
                                <strong>Severe oligozoospermia (≤5 million/mL)</strong> or azoospermia
                                <div class="reference">5-15% have chromosomal abnormalities</div>
                                <span class="badge badge-urgent">Karyotype analysis</span>
                                <span class="badge badge-urgent">Y chromosome microdeletions</span>
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">2</span>
                                <strong>Congenital Bilateral Absence of Vas Deferens (CBAVD)</strong>
                                <div class="reference">80% have CFTR mutations</div>
                                <span class="badge badge-urgent">CFTR gene testing</span>
                                <span class="badge badge-caution">Screen female partner</span>
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">3</span>
                                <strong>Recurrent pregnancy loss</strong>
                                <span class="badge badge-caution">Sperm DNA damage assays</span>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-chart-bar"></i>
                                Endocrine Evaluation
                            </div>
                            <p><strong>Indicated for:</strong> Impaired libido, erectile dysfunction, oligozoospermia/azoospermia, atrophic testes, hormonal abnormalities</p>
                            <div class="criteria-grid">
                                <div class="criteria-item">
                                    <strong>FSH:</strong> >7.6 mIU/mL indicates testicular failure
                                    <span class="badge badge-urgent">Elevated</span>
                                </div>
                                <div class="criteria-item">
                                    <strong>Testosterone:</strong> Low levels indicate hypogonadism
                                    <span class="badge badge-caution">Check free & total</span>
                                </div>
                                <div class="criteria-item">
                                    <strong>Prolactin:</strong> Elevated suggests pituitary adenoma
                                    <span class="badge badge-urgent">MRI indicated</span>
                                </div>
                                <div class="criteria-item">
                                    <strong>TSH:</strong> Consider if >40 years or erectile dysfunction
                                    <span class="badge badge-info">Selective</span>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-search"></i>
                                Specialized Tests
                            </div>
                            <ul>
                                <li><strong>Sperm viability:</strong> >46% necrosis suggests anti-sperm antibodies</li>
                                <li><strong>Post-ejaculatory urine:</strong> Detects retrograde ejaculation</li>
                                <li><strong>Colour Doppler:</strong> Confirms varicocele</li>
                                <li><strong>Anti-sperm antibodies:</strong> Only if results affect management <span class="badge badge-info">Not initial test</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Treatment Card -->
            <div class="card treatment" data-step="treatment">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-header-left">
                        <div class="card-icon">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="card-title">Treatment Algorithm & Management</div>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-project-diagram"></i>
                                Treatment Pathways Overview
                            </div>
                            <p>Treatment should be targeted to aetiological factors when possible. ART is often the fastest and most effective method.</p>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-syringe"></i>
                                Obstructive Azoospermia
                            </div>
                            <div class="pathway-container">
                                <div class="pathway-card urgent">
                                    <div class="outcome-title">
                                        <i class="fas fa-cut"></i>
                                        Surgical Options
                                        <span class="badge badge-urgent">Specialist Referral</span>
                                    </div>
                                    <div class="outcome-box">
                                        <div class="outcome-title">Ejaculatory Duct Obstruction:</div>
                                        <ul>
                                            <li>Transrectal ultrasound confirms dilation</li>
                                            <li><strong>Transurethral resection of ejaculatory ducts</strong></li>
                                        </ul>
                                    </div>
                                    <div class="outcome-box">
                                        <div class="outcome-title">Vasal/Epididymal Obstruction:</div>
                                        <ul>
                                            <li>Microsurgical vasovasostomy or epididymovasostomy</li>
                                            <li>Post-vasectomy, iatrogenic injury, infection</li>
                                        </ul>
                                    </div>
                                    <div class="outcome-box">
                                        <div class="outcome-title">Sperm Retrieval:</div>
                                        <ul>
                                            <li>Percutaneous or open techniques</li>
                                            <li>Followed by IVF/ICSI <span class="badge badge-info">Alternative to reconstruction</span></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-hormone"></i>
                                Endocrine/Hormonal Treatment
                            </div>
                            
                            <div class="algorithm-step">
                                <span class="step-number">1</span>
                                <strong>Gonadotrophin Deficiencies (Secondary Hypogonadism)</strong>
                                <span class="badge badge-urgent">Effective treatment</span>
                                <div class="pathway-card">
                                    <div class="outcome-title">Primary Option:</div>
                                    <ul>
                                        <li><strong>hCG:</strong> 500-4000 IU IM/SC 2-3× weekly × 6 months</li>
                                        <li>If no sperm after 6 months → Add FSH (follitropin alfa 150 IU 3× weekly)</li>
                                    </ul>
                                </div>
                                <div class="pathway-card">
                                    <div class="outcome-title">Alternative:</div>
                                    <ul>
                                        <li>Pulsatile GnRH (rarely used due to cost/administration issues)</li>
                                        <li><strong>Kallmann syndrome:</strong> Gonadotrophins or pulsatile GnRH</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="algorithm-step">
                                <span class="step-number">2</span>
                                <strong>Primary Hypogonadism</strong>
                                <div class="pathway-card">
                                    <div class="outcome-title">Clomifene (Off-label):</div>
                                    <ul>
                                        <li>Inhibits estradiol negative feedback → ↑LH, ↑FSH</li>
                                        <li>Minimal adverse effects, doesn't interfere with spermatogenesis</li>
                                        <li>Check testosterone at 3 weeks for dose titration</li>
                                        <li>May improve micro-TESE success (57.7% vs 33.6%)</li>
                                    </ul>
                                </div>
                                <div class="pathway-card">
                                    <div class="outcome-title">hCG:</div>
                                    <ul>
                                        <li>Effective for hypogonadotrophic hypogonadism</li>
                                        <li>Less evidence for low testosterone with normal gonadotrophins</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="algorithm-step">
                                <span class="step-number">3</span>
                                <strong>High Estrogen/Low Testosterone (T/E ratio <10:1)</strong>
                                <span class="badge badge-caution">Aromatase Inhibitors</span>
                                <div class="pathway-card">
                                    <div class="outcome-title">Anastrozole:</div>
                                    <ul>
                                        <li>Blocks testosterone → estradiol conversion</li>
                                        <li>↑ GnRH → ↑ FSH, ↑ LH</li>
                                        <li>Improves hormonal profile & semen parameters</li>
                                        <li>Rare adverse effects</li>
                                        <li>95.3% improvement in hyperandrogenic men</li>
                                    </ul>
                                </div>
                                <div class="pathway-card">
                                    <div class="outcome-title">Combination Therapy:</div>
                                    <ul>
                                        <li>Aromatase inhibitor + Clomifene</li>
                                        <li>When SERM causes disproportionate estradiol elevation</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="algorithm-step">
                                <span class="step-number">4</span>
                                <strong>Hyperprolactinaemia (Pituitary Adenoma)</strong>
                                <span class="badge badge-urgent">Medical Therapy</span>
                                <div class="pathway-card">
                                    <ul>
                                        <li><strong>Bromocriptine:</strong> 2.5-10 mg/day</li>
                                        <li><strong>Cabergoline:</strong> 0.25 mg twice weekly (titrate up to 1 mg twice weekly)</li>
                                        <li>Normalizes prolactin, restores gonadal function</li>
                                        <li>MRI follow-up for tumor monitoring</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-heart"></i>
                                Varicocele Management
                            </div>
                            <div class="decision-point">
                                <div class="decision-title">
                                    <i class="fas fa-balance-scale"></i>
                                    Controversial Benefit - Individualize Decision
                                </div>
                                <div class="pathway-card caution">
                                    <ul>
                                        <li>Only treat after full discussion of limited evidence</li>
                                        <li>Rule out other male/female factors first</li>
                                        <li>May "upgrade" semen parameters to reduce need for IVF/IUI</li>
                                        <li>Microsurgical repair has best outcomes</li>
                                        <li><strong>Uncertain benefit on live birth rates</strong></li>
                                    </ul>
                                </div>
                                <span class="badge badge-caution">Grade 1-3 varicocele</span>
                                <span class="badge badge-info">Not recommended for subclinical (ultrasound only)</span>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-question"></i>
                                Idiopathic Male Infertility
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">1</span>
                                <strong>FSH Therapy</strong>
                                <span class="badge badge-caution">Consider</span>
                                <div class="reference">Meta-analyses suggest improved pregnancy rates, but evidence quality is low</div>
                                <ul>
                                    <li>Follitropin alfa: 150 IU SC 3× weekly × 6 months</li>
                                    <li>AUA guidelines recommend consideration</li>
                                </ul>
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">2</span>
                                <strong>Antioxidant Therapy</strong>
                                <span class="badge badge-stable">Adjunct</span>
                                <div class="reference">Low-quality evidence suggests improved pregnancy/live birth rates</div>
                                <div class="criteria-grid">
                                    <div class="criteria-item">
                                        <strong>Vitamins C & E</strong>
                                        <span class="badge badge-stable">Reduce ROS</span>
                                    </div>
                                    <div class="criteria-item">
                                        <strong>L-carnitine</strong>
                                        <span class="badge badge-stable">Energy metabolism</span>
                                    </div>
                                    <div class="criteria-item">
                                        <strong>Coenzyme Q-10</strong>
                                        <span class="badge badge-stable">Improves motility</span>
                                    </div>
                                    <div class="criteria-item">
                                        <strong>Selenium + NAC</strong>
                                        <span class="badge badge-stable">Improves quality</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-baby"></i>
                                Assisted Reproductive Techniques (ART)
                            </div>
                            <div class="pathway-container">
                                <div class="pathway-card urgent">
                                    <div class="outcome-title">
                                        <i class="fas fa-sperms"></i>
                                        Intracytoplasmic Sperm Injection (ICSI)
                                        <span class="badge badge-urgent">Azoospermia/Severe Oligozoospermia</span>
                                    </div>
                                    <ul>
                                        <li><strong>Indication:</strong> Azoospermia or ≤5 million/mL</li>
                                        <li><strong>Sperm retrieval:</strong> Micro-TESE (non-obstructive), MESA (obstructive)</li>
                                        <li><strong>Success:</strong> Fertilization rate ~60%, live birth rate ~50% (AZFc deletions)</li>
                                        <li><strong>Risks:</strong> Beckwith-Wiedemann/Angelman syndromes (rare, uncertain)</li>
                                    </ul>
                                </div>

                                <div class="pathway-card caution">
                                    <div class="outcome-title">
                                        <i class="fas fa-syringe"></i>
                                        Intrauterine Insemination (IUI)
                                        <span class="badge badge-caution">Mild-Moderate Male Factor</span>
                                    </div>
                                    <ul>
                                        <li><strong>Optimal:</strong> Post-wash TMSC >9 million</li>
                                        <li><strong>Procedure:</strong> Sperm wash removes antibodies, concentrates motile sperm</li>
                                        <li><strong>Retrograde ejaculation:</strong> Retrieve sperm from alkalinized urine</li>
                                        <li><strong>Double insemination:</strong> May increase rates (inconsistent evidence)</li>
                                    </ul>
                                </div>

                                <div class="pathway-card">
                                    <div class="outcome-title">
                                        <i class="fas fa-handshake"></i>
                                        Donor Insemination
                                        <span class="badge badge-stable">Alternative Option</span>
                                    </div>
                                    <ul>
                                        <li>For severe oligozoospermia/azoospermia declining ART</li>
                                        <li>After genetic counseling (chromosomal defects may transmit via ICSI)</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="decision-point">
                                <div class="decision-title">
                                    <i class="fas fa-route"></i>
                                    ART Selection Algorithm
                                </div>
                                <div class="algorithm-step">
                                    <span class="step-number">1</span>
                                    <strong>IUI First-line:</strong> Mild-moderate male factor, TMSC >9 million
                                </div>
                                <div class="algorithm-step">
                                    <span class="step-number">2</span>
                                    <strong>IVF/ICSI:</strong> Failed IUI, severe male factor, antisperm antibodies
                                </div>
                                <div class="algorithm-step">
                                    <span class="step-number">3</span>
                                    <strong>Single embryo transfer:</strong> Young patients with good prognosis to reduce multiple pregnancy risk
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-times-circle"></i>
                                Anti-sperm Antibodies
                            </div>
                            <div class="pathway-card urgent">
                                <div class="outcome-title">
                                    <i class="fas fa-robot"></i>
                                    ART Superior to Immunosuppression
                                </div>
                                <ul>
                                    <li><strong>Corticosteroids:</strong> Effectiveness uncertain, methodological concerns</li>
                                    <li><strong>Recommended:</strong> IUI with sperm wash or IVF/ICSI</li>
                                    <li>Collect ejaculate directly into sperm wash media to dilute antibodies</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Follow-up Card -->
            <div class="card followup" data-step="followup">
                <div class="card-header" onclick="toggleCard(this)">
                    <div class="card-header-left">
                        <div class="card-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-title">Follow-up & Prognosis</div>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="card-content">
                    <div class="card-body">
                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-calendar-alt"></i>
                                Monitoring Schedule
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">1</span>
                                <strong>Semen Analysis:</strong> Repeat at <strong>3 months</strong> and <strong>6 months</strong> after treatment initiation
                                <div class="reference">Spermatogenesis cycle is ~74 days - early changes seen by 3 months</div>
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">2</span>
                                <strong>Hormonal Monitoring:</strong> Testosterone at 3 weeks after clomifene initiation
                                <div class="reference">Allows dose titration</div>
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">3</span>
                                <strong>Treatment Adjustment:</strong> If no improvement by 6 months, consider alternative or ART
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-exclamation-triangle"></i>
                                Complications & Associated Risks
                            </div>
                            <div class="pathway-card urgent">
                                <div class="outcome-title">
                                    <i class="fas fa-shield-virus"></i>
                                    Testicular Cancer Risk
                                    <span class="badge badge-urgent">20-fold increased risk</span>
                                </div>
                                <p>Men with abnormal semen analysis have significantly higher risk of testicular cancer</p>
                                <div class="reference">Raman JD et al. J Urol 2005; Peng X et al. PLoS One 2009</div>
                                <ul>
                                    <li>Consider testicular ultrasound screening</li>
                                    <li>Patient education on self-examination</li>
                                </ul>
                            </div>

                            <div class="pathway-card caution">
                                <div class="outcome-title">
                                    <i class="fas fa-dna"></i>
                                    Genetic Transmission Risk
                                    <span class="badge badge-caution">ICSI-related</span>
                                </div>
                                <p>Chromosomal defects may be passed to offspring via ICSI</p>
                                <ul>
                                    <li><strong>Klinefelter syndrome:</strong> 47,XXY may transmit</li>
                                    <li><strong>Y microdeletions:</strong> Vertical transmission to male offspring</li>
                                    <li><strong>CFTR mutations:</strong> Risk of CF in offspring</li>
                                </ul>
                                <div class="reference">Offer karyotyping to men with severe oligospermia before ICSI</div>
                            </div>

                            <div class="pathway-card caution">
                                <div class="outcome-title">
                                    <i class="fas fa-baby"></i>
                                    ART Pregnancy Outcomes
                                    <span class="badge badge-caution">Small increased risk</span>
                                </div>
                                <p>ART linked to slightly increased risk of:</p>
                                <ul>
                                    <li>Birth defects (confounded by infertility itself)</li>
                                    <li>Beckwith-Wiedemann/Angelman syndromes (ICSI)</li>
                                    <li>Multiple pregnancies (if multiple embryo transfer)</li>
                                </ul>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-crystal-ball"></i>
                                Prognosis & Counseling
                            </div>
                            <div class="pathway-container">
                                <div class="pathway-card">
                                    <div class="outcome-title">
                                        <i class="fas fa-check-circle"></i>
                                        Good Prognosis
                                        <span class="badge badge-stable">Reversible Causes</span>
                                    </div>
                                    <ul>
                                        <li>Gonadotrophin deficiencies (respond to hormone therapy)</li>
                                        <li>Obstructive azoospermia (surgical correction possible)</li>
                                        <li>Varicocele (may improve after repair)</li>
                                        <li>Normal female partner fertility</li>
                                    </ul>
                                </div>

                                <div class="pathway-card caution">
                                    <div class="outcome-title">
                                        <i class="fas fa-question-circle"></i>
                                        Uncertain Prognosis
                                        <span class="badge badge-caution">Idiopathic Infertility</span>
                                    </div>
                                    <ul>
                                        <li>Medical/surgical treatments of unproven benefit</li>
                                        <li>ART is most effective option</li>
                                        <li>Antioxidants may help (low-quality evidence)</li>
                                    </ul>
                                </div>

                                <div class="pathway-card urgent">
                                    <div class="outcome-title">
                                        <i class="fas fa-times-circle"></i>
                                        Poor Prognosis
                                        <span class="badge badge-urgent">Severe Spermatogenic Failure</span>
                                    </div>
                                    <ul>
                                        <li>Non-obstructive azoospermia with Sertoli-cell only</li>
                                        <li>Klinefelter syndrome (most have severe oligo/azoospermia)</li>
                                        <li>Prior chemotherapy/radiotherapy (may be permanent)</li>
                                        <li>Donor sperm may be only option</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-user-edit"></i>
                                Patient Discussions & Lifestyle Modifications
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">1</span>
                                <strong>Weight Management:</strong> Obesity reduces testosterone
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">2</span>
                                <strong>Smoking Cessation:</strong> Deleterious effect on semen parameters
                                <span class="badge badge-stable">Varenicline/Bupropion/NRT</span>
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">3</span>
                                <strong>Alcohol Reduction:</strong> Dose-dependent adverse effects
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">4</span>
                                <strong>Avoid Anabolic Steroids:</strong> Inhibit spermatogenesis
                            </div>
                            <div class="algorithm-step">
                                <span class="step-number">5</span>
                                <strong>Testicular Heat Avoidance:</strong> Hot tubs, saunas, tight clothing
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-user-friends"></i>
                                Partner Considerations
                            </div>
                            <div class="decision-point">
                                <div class="decision-title">
                                    <i class="fas fa-female"></i>
                                    Female Fertility Decline
                                </div>
                                <p><strong>Critical factor:</strong> Natural fertility decline accelerates after age 35</p>
                                <ul>
                                    <li>Don't delay treatment while optimizing male factors</li>
                                    <li>Consider female partner age in treatment selection</li>
                                    <li>ART may be fastest option if female partner >35 years</li>
                                </ul>
                            </div>
                            <div class="decision-point">
                                <div class="decision-title">
                                    <i class="fas dna-share"></i>
                                    Genetic Counseling
                                </div>
                                <ul>
                                    <li>CFTR screening if CBAVD (female partner)</li>
                                    <li>Karyotyping if severe oligospermia</li>
                                    <li>Y microdeletion counseling if positive</li>
                                </ul>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-clock"></i>
                                Timeline Expectations
                            </div>
                            <div class="reference">
                                <strong>Important:</strong> 
                                <ul>
                                    <li>Minimum 3-6 months to see treatment effect</li>
                                    <li>Avoid pregnancy for 12 months post-chemotherapy/radiotherapy</li>
                                    <li>Sperm banking before gonadotoxic therapies</li>
                                    <li>Don't delay ART for female age >35</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sticky Sidebar -->
        <div class="sidebar">
            <div class="progress-card">
                <div class="progress-title">
                    <i class="fas fa-map-marked-alt"></i>
                    Algorithm Progress
                </div>
                <div class="progress-steps">
                    <div class="progress-step" onclick="scrollToCard('assessment')">
                        <div class="progress-icon">1</div>
                        <div class="progress-text">Assessment</div>
                    </div>
                    <div class="progress-step" onclick="scrollToCard('diagnosis')">
                        <div class="progress-icon">2</div>
                        <div class="progress-text">Diagnosis</div>
                    </div>
                    <div class="progress-step" onclick="scrollToCard('treatment')">
                        <div class="progress-icon">3</div>
                        <div class="progress-text">Treatment</div>
                    </div>
                    <div class="progress-step" onclick="scrollToCard('followup')">
                        <div class="progress-icon">4</div>
                        <div class="progress-text">Follow-up</div>
                    </div>
                </div>
            </div>

            <div class="sticky-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Critical Action:</strong> Always offer sperm banking before gonadotoxic therapies. Severe oligospermia/azoospermia requires urgent urology/reproductive specialist referral.
            </div>

            <div class="sticky-warning">
                <i class="fas fa-info-circle"></i>
                <strong>WHO Criteria:</strong> Ejaculate volume >1.4 mL, Concentration >16 million/mL, Motility >42%, Morphology >4% normal forms. Two samples required, collected 1 month apart.
            </div>
        </div>
    </div>

    <script>
        // Card toggle functionality
        function toggleCard(header) {
            const card = header.parentElement;
            card.classList.toggle('expanded');
            
            // Update progress tracking
            updateProgress();
            
            // Smooth scroll to card if expanding
            if (card.classList.contains('expanded')) {
                setTimeout(() => {
                    card.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        }

        // Scroll to specific card
        function scrollToCard(step) {
            const card = document.querySelector(`.card[data-step="${step}"]`);
            if (card) {
                card.scrollIntoView({ behavior: 'smooth', block: 'start' });
                if (!card.classList.contains('expanded')) {
                    card.classList.add('expanded');
                    updateProgress();
                }
            }
        }

        // Progress tracking
        function updateProgress() {
            const cards = document.querySelectorAll('.card');
            const progressSteps = document.querySelectorAll('.progress-step');
            
            cards.forEach((card, index) => {
                const step = card.dataset.step;
                const progressStep = document.querySelector(`.progress-step[onclick="scrollToCard('${step}')"]`);
                
                if (progressStep) {
                    if (card.classList.contains('expanded')) {
                        progressStep.classList.add('active');
                        progressStep.classList.remove('completed');
                    } else if (isCardCompleted(card)) {
                        progressStep.classList.add('completed');
                        progressStep.classList.remove('active');
                    } else {
                        progressStep.classList.remove('active', 'completed');
                    }
                }
            });
        }

        // Check if card content has been viewed
        function isCardCompleted(card) {
            const rect = card.getBoundingClientRect();
            return rect.top < window.innerHeight && rect.bottom > 0;
        }

        // Auto-expand first card on load
        window.addEventListener('load', () => {
            const firstCard = document.querySelector('.card');
            if (firstCard) {
                setTimeout(() => {
                    firstCard.classList.add('expanded');
                    updateProgress();
                }, 500);
            }
        });

        // Update progress on scroll
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(updateProgress, 100);
        });

        // Print function
        function printAlgorithm() {
            window.print();
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            const cards = Array.from(document.querySelectorAll('.card'));
            const expandedCard = document.querySelector('.card.expanded');
            const currentIndex = cards.indexOf(expandedCard);
            
            if (e.key === 'ArrowDown' && currentIndex < cards.length - 1) {
                e.preventDefault();
                if (expandedCard) expandedCard.classList.remove('expanded');
                cards[currentIndex + 1].classList.add('expanded');
                cards[currentIndex + 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
                updateProgress();
            } else if (e.key === 'ArrowUp' && currentIndex > 0) {
                e.preventDefault();
                if (expandedCard) expandedCard.classList.remove('expanded');
                cards[currentIndex - 1].classList.add('expanded');
                cards[currentIndex - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
                updateProgress();
            }
        });

        // Add hover effects to badges
        document.querySelectorAll('.badge').forEach(badge => {
            badge.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.1)';
            });
            badge.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        });

        // Smooth transitions for all interactive elements
        document.querySelectorAll('.pathway-card, .algorithm-step, .criteria-item').forEach(el => {
            el.addEventListener('click', function() {
                this.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });

        // Add tooltips for abbreviations
        const abbreviations = {
            'ART': 'Assisted Reproductive Techniques',
            'ICSI': 'Intracytoplasmic Sperm Injection',
            'IUI': 'Intrauterine Insemination',
            'IVF': 'In Vitro Fertilization',
            'CBAVD': 'Congenital Bilateral Absence of Vas Deferens',
            'CFTR': 'Cystic Fibrosis Transmembrane Regulator',
            'FSH': 'Follicle-Stimulating Hormone',
            'LH': 'Luteinising Hormone',
            'hCG': 'Human Chorionic Gonadotrophin',
            'TMSC': 'Total Motile Sperm Count',
            'TESE': 'Testicular Sperm Extraction'
        };

        // Add click handlers for expandable definitions
        document.querySelectorAll('.tooltip').forEach(tooltip => {
            tooltip.addEventListener('click', function(e) {
                e.stopPropagation();
                const tooltipText = this.querySelector('.tooltiptext');
                if (tooltipText) {
                    tooltipText.style.visibility = 'visible';
                    tooltipText.style.opacity = '1';
                    setTimeout(() => {
                        tooltipText.style.visibility = '';
                        tooltipText.style.opacity = '';
                    }, 3000);
                }
            });
        });
    </script>
</body>
</html>