<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Medical Reference Library</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 2rem auto;
      line-height: 1.5;
    }
    h1 {
      margin-bottom: 0.25rem;
    }
    h2 {
      margin-top: 2rem;
      margin-bottom: 0.25rem;
      font-size: 1.25rem;
    }
    ul {
      margin-top: 0.25rem;
      margin-bottom: 0.5rem;
      padding-left: 1.25rem;
    }
    li {
      margin: 0.1rem 0;
    }
    a {
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .meta {
      color: #555;
      margin-bottom: 1.5rem;
    }
    .status {
      font-size: 0.85rem;
      color: #777;
    }
    .error {
      font-size: 0.85rem;
      color: #b00020;
    }
  </style>
</head>
<body>
  <h1>My Medical Reference Library</h1>
  <p class="meta">General practice / primary care topics organised by system.</p>

  <div id="library"></div>

  <script>
    // Only list folders you are actually using right now.
    // Add more entries here as you create more folders.
    const categories = [
      { dir: "Endocrine-metabolic",            title: "Endocrine metabolic" },
      { dir: "GI-gastroenterology-hepatology", title: "GI Gastroenterology hepatology" },
      { dir: "Skin-and-Nail",                  title: "Skin & Nail" },   // <-- you already have this
      { dir: "ENT-and-Oral-health",            title: "ENT & Oral health" },
      { dir: "MSK-and-Rheumatology",           title: "MSK & Rheumatology" },
      { dir: "Pregnancy",                      title: "Pregnancy" },
      { dir: "Renal-Urology",                  title: "Renal Urology" },
      { dir: "Haematology",                    title: "Haematology" },
      { dir: "Allergy",                        title: "Allergy" },
      { dir: "Palliative",                     title: "Palliative" },
      { dir: "Geriatrics",                     title: "Geriatrics" },
      { dir: "Neurology",                      title: "Neurology" },
      { dir: "Cancer",                         title: "Cancer" },
      { dir: "Eyes-ophthalmology",             title: "Eyes ophthalmology" },
      { dir: "Infectious-disease",             title: "Infectious disease" },
      { dir: "Paeds",                          title: "Paeds" },
      { dir: "Mental-health",                  title: "Mental health" },
      { dir: "Cardio-respiratory",             title: "Cardio respiratory" },
      { dir: "General",                        title: "General" },
      { dir: "Womens-Health",                  title: "Women's Health" },
      { dir: "Mens-Health",                    title: "Men's Health" }
    ];

    const username = "reerluuqa";
    const repoName = "Decision-Aid";
    const baseApi = `https://api.github.com/repos/${username}/${repoName}/contents/`;

    const container = document.getElementById("library");

    categories.forEach(cat => {
      const section = document.createElement("section");
      const heading = document.createElement("h2");
      heading.textContent = cat.title;
      section.appendChild(heading);

      const list = document.createElement("ul");
      const status = document.createElement("span");
      status.className = "status";
      status.textContent = "Loading topicsâ€¦";
      list.appendChild(status);
      section.appendChild(list);
      container.appendChild(section);

      fetch(baseApi + encodeURIComponent(cat.dir))
        .then(response => {
          if (!response.ok) {
            // Folder not found or API error (rate limit etc.)
            list.innerHTML = "";
            const msg = document.createElement("span");
            msg.className = response.status === 404 ? "status" : "error";

            if (response.status === 404) {
              msg.textContent = "(folder not created yet)";
            } else {
              msg.textContent = `(error ${response.status} loading topics)`;
            }
            list.appendChild(msg);
            return null;
          }
          return response.json();
        })
        .then(files => {
          if (!files) return; // handled above

          if (!Array.isArray(files) || files.length === 0) {
            list.innerHTML = "";
            const msg = document.createElement("span");
            msg.className = "status";
            msg.textContent = "(no topics yet)";
            list.appendChild(msg);
            return;
          }

          const htmlFiles = files.filter(file =>
            file.type === "file" && file.name.toLowerCase().endsWith(".html")
          );

          list.innerHTML = "";

          if (htmlFiles.length === 0) {
            const msg = document.createElement("span");
            msg.className = "status";
            msg.textContent = "(no topics yet)";
            list.appendChild(msg);
            return;
          }

          htmlFiles.forEach(file => {
            const li = document.createElement("li");
            const a = document.createElement("a");

            // Construct link to the HTML file under the folder
            a.href = `${cat.dir}/${encodeURIComponent(file.name)}`;

            // Nicer label: strip extension, replace _ and - with spaces
            a.textContent = file.name
              .replace(/\.html$/i, "")
              .replace(/_/g, " ")
              .replace(/-/g, " ");

            li.appendChild(a);
            list.appendChild(li);
          });
        })
        .catch(err => {
          console.error("Error loading category", cat.dir, err);
          list.innerHTML = "";
          const msg = document.createElement("span");
          msg.className = "error";
          msg.textContent = "(error loading topics)";
          list.appendChild(msg);
        });
    });
  </script>
</body>
</html>
