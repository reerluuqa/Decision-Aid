<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronic Pruritus - GP Quick Reference</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c5aa0;
            --secondary: #4a90a4;
            --success: #5cb85c;
            --warning: #f0ad4e;
            --danger: #d9534f;
            --dark: #1a1a1a;
            --light: #f8f9fa;
            --card-bg: #ffffff;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #e6f0ff 0%, #f0f7ff 100%);
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .stats-bar {
            display: flex;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat {
            background: rgba(255,255,255,0.15);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
        }

        .stat-number {
            font-size: 1.5em;
            color: #ffd700;
        }

        .search-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        #searchBox {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: border-color 0.3s;
        }

        #searchBox:focus {
            outline: none;
            border-color: var(--primary);
        }

        .tabs-nav {
            display: flex;
            gap: 5px;
            margin-bottom: 25px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .tab-btn {
            padding: 15px 25px;
            background: var(--card-bg);
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .tab-btn:hover {
            background: var(--secondary);
            color: white;
        }

        .tab-content {
            display: none;
            background: var(--card-bg);
            border-radius: 0 12px 12px 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .key-points-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left: 6px solid var(--warning);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .key-points-box h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .key-points-list {
            list-style: none;
        }

        .key-points-list li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
        }

        .key-points-list li:before {
            content: "‚ö°";
            position: absolute;
            left: 0;
            font-size: 1.2em;
        }

        .expandable-section {
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 18px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 1.1em;
        }

        .section-toggle {
            font-size: 1.5em;
            transition: transform 0.3s;
        }

        .expandable-section.expanded .section-toggle {
            transform: rotate(180deg);
        }

        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0 25px;
        }

        .expandable-section.expanded .section-content {
            max-height: 2000px;
            padding: 25px;
        }

        .cause-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .cause-card {
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid;
        }

        .cause-card.inflammatory {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border-color: var(--danger);
        }

        .cause-card.neuropathic {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-color: var(--primary);
        }

        .cause-card.systemic {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            border-color: #9c27b0;
        }

        .cause-card h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .cause-card ul {
            list-style-position: inside;
        }

        .scratch-mnemonic {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid var(--success);
        }

        .scratch-mnemonic h4 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .mnemonic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .mnemonic-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .mnemonic-letter {
            font-weight: bold;
            color: var(--success);
            font-size: 1.1em;
        }

        .treatment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .treatment-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
        }

        .treatment-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .treatment-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 3px;
        }

        .badge-recommend {
            background: var(--success);
            color: white;
        }

        .badge-avoid {
            background: var(--danger);
            color: white;
        }

        .badge-caution {
            background: var(--warning);
            color: #333;
        }

        .action-buttons {
            position: fixed;
            bottom: 25px;
            right: 25px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
            min-width: 120px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .print-btn {
            background: var(--success);
            color: white;
        }

        .reset-btn {
            background: var(--secondary);
            color: white;
        }

        .highlight {
            background: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header h1 {
                font-size: 1.6em;
            }
            
            .stats-bar {
                gap: 15px;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .tabs-nav {
                flex-wrap: nowrap;
            }
            
            .action-buttons {
                bottom: 15px;
                right: 15px;
            }
        }

        @media print {
            header, .search-container, .tabs-nav, .action-buttons {
                display: none;
            }
            
            .tab-content {
                display: block !important;
                box-shadow: none;
                border: none;
            }
            
            .expandable-section .section-content {
                max-height: none !important;
                padding: 25px !important;
            }
        }
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <header>
            <h1>Chronic Pruritus Quick Reference</h1>
            <p style="margin-top: 8px; opacity: 0.9;">GP Practice Guide | Updated Dec 2024</p>
            <div class="stats-bar">
                <div class="stat">
                    <span class="stat-number">‚â•6</span> weeks = chronic
                </div>
                <div class="stat">
                    <span class="stat-number">22%</span> lifetime prevalence
                </div>
                <div class="stat">
                    <span class="stat-number">50%</span> in >65y
                </div>
                <div class="stat">
                    <span class="stat-number">25%</span> iron deficiency
                </div>
            </div>
        </header>

        <div class="search-container">
            <input type="text" id="searchBox" placeholder="üîç Quick search: e.g., 'elderly', 'topical', 'investigations'...">
        </div>

        <nav class="tabs-nav">
            <button class="tab-btn active" data-tab="summary">Quick Summary</button>
            <button class="tab-btn" data-tab="causes">Causes</button>
            <button class="tab-btn" data-tab="history">History & Exam</button>
            <button class="tab-btn" data-tab="investigations">Investigations</button>
            <button class="tab-btn" data-tab="treatment">Treatment</button>
            <button class="tab-btn" data-tab="referral">Referral</button>
            <button class="tab-btn" data-tab="elderly">Elderly Focus</button>
        </nav>

        <div id="summary" class="tab-content active">
            <div class="key-points-box">
                <h3>‚ö° Key Headlines</h3>
                <ul class="key-points-list">
                    <li>Chronic pruritus = itch ‚â•6 weeks; affects 22% population, 50% of >65y</li>
                    <li>Causes: 60% inflammatory, 25% neuropathic, 15% systemic</li>
                    <li>Investigate if <1 year duration or no clear cause: <strong>FBC, ferritin, U&E, LFT, ESR/CRP, CXR</strong></li>
                    <li>First-line: <strong>Emollients + low-moderate potency steroids or menthol cream</strong></li>
                    <li>Systemic: <strong>Non-sedating antihistamines</strong> (can use up to 4x standard dose off-licence)</li>
                    <li>Avoid sedating antihistamines in elderly (dementia risk)</li>
                    <li>Refer if diagnosis uncertain or distressing symptoms persist</li>
                </ul>
            </div>

            <h3>Clinical Approach</h3>
            <p style="font-size: 1.1em; background: #e3f2fd; padding: 15px; border-radius: 8px;">
                <strong>Initial Management:</strong> Emollients to wash & moisturise, avoid soap, short nails, avoid wool clothing
            </p>
        </div>

        <div id="causes" class="tab-content">
            <h3>Aetiology Categories</h3>
            <div class="cause-grid">
                <div class="cause-card inflammatory">
                    <h4>üî¥ Inflammatory (60%)</h4>
                    <ul>
                        <li>Eczema, Contact dermatitis</li>
                        <li>Psoriasis, Seborrhoeic dermatitis</li>
                        <li>Lichen planus, Chronic urticaria</li>
                        <li>Bullous pemphigoid</li>
                        <li>Immunologic eruption of ageing</li>
                    </ul>
                </div>
                <div class="cause-card neuropathic">
                    <h4>üîµ Neuropathic (25%)</h4>
                    <ul>
                        <li>Post-herpetic neuralgia</li>
                        <li>Meralgia paraesthetica</li>
                        <li>Brachioradial pruritus</li>
                        <li>Scalp/scrotal pruritus</li>
                    </ul>
                </div>
                <div class="cause-card systemic">
                    <h4>üü£ Systemic (15%)</h4>
                    <ul>
                        <li>Kidney/liver disease</li>
                        <li>Malignancy (lymphoma, carcinoid)</li>
                        <li>Diabetes, PRV, hyperthyroid</li>
                        <li>Paraproteinaemias</li>
                        <li>Cholestasis of pregnancy</li>
                    </ul>
                </div>
            </div>

            <div style="margin-top: 25px;">
                <h4>Other Causes</h4>
                <p><strong>Infectious:</strong> Bed bugs, scabies, fungal, HIV, lice, varicella</p>
                <p><strong>Medication:</strong> Opioids, systemic immunotherapy, stimulants (e.g., ADHD meds)</p>
                <p><strong>Idiopathic:</strong> Chronic pruritus of unknown origin, Nodular prurigo</p>
            </div>
        </div>

        <div id="history" class="tab-content">
            <h3>History Taking</h3>
            <p>Define the sensation: pure itch vs burning/prickling/stinging/crawling</p>
            
            <div class="scratch-mnemonic">
                <h4>üìã SCRATCH Mnemonic</h4>
                <div class="mnemonic-grid">
                    <div class="mnemonic-item">
                        <span class="mnemonic-letter">S - Severity:</span> Impact on QoL & emotional wellbeing
                    </div>
                    <div class="mnemonic-item">
                        <span class="mnemonic-letter">C - Chronicity:</span> <1 year ‚Üí investigate further
                    </div>
                    <div class="mnemonic-item">
                        <span class="mnemonic-letter">R - Region:</span> Localised vs generalised; evolution?
                    </div>
                    <div class="mnemonic-item">
                        <span class="mnemonic-letter">A - Associated symptoms:</span> Systemic disease clues
                    </div>
                    <div class="mnemonic-item">
                        <span class="mnemonic-letter">T - Triggers:</span> Heat, cold, water, stress, touch
                    </div>
                    <div class="mnemonic-item">
                        <span class="mnemonic-letter">C - Cutaneous change:</span> Rash? Which came first?
                    </div>
                    <div class="mnemonic-item">
                        <span class="mnemonic-letter">H - History:</span> Comorbidities, drugs, pattern (seasonal/timing)
                    </div>
                </div>
            </div>

            <h3>Examination</h3>
            <div class="expandable-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <span>Primary Skin Changes</span>
                    <span class="section-toggle">‚ñº</span>
                </div>
                <div class="section-content">
                    <p>Erythema, oedema, papules, plaques, scaling, vesicles, pustules/bullae, wheals, burrows, dry skin</p>
                </div>
            </div>
            <div class="expandable-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <span>Secondary Skin Changes</span>
                    <span class="section-toggle">‚ñº</span>
                </div>
                <div class="section-content">
                    <p>Excoriations, erosions, ulcers, fissures, lichenification, scarred nodules, pigment changes</p>
                    <p style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 4px;">
                        <strong>Itch/scratch cycle:</strong> Prolonged pruritus sensitises itch-sensory nerves, perpetuating symptoms
                    </p>
                </div>
            </div>
        </div>

        <div id="investigations" class="tab-content">
            <h3>Initial Investigation Panel</h3>
            <p style="background: #d1ecf1; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                <strong>Indicated if:</strong> Cause unclear OR symptoms <1 year (higher yield for systemic disease)
            </p>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <h4>Core Bloods</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                    <div class="badge badge-recommend">FBC</div>
                    <div class="badge badge-recommend">Ferritin</div>
                    <div class="badge badge-recommend">U&E</div>
                    <div class="badge badge-recommend">LFT</div>
                    <div class="badge badge-recommend">ESR/CRP</div>
                    <div class="badge badge-recommend">CXR</div>
                </div>
            </div>

            <div class="expandable-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <span>Additional Tests (as indicated)</span>
                    <span class="section-toggle">‚ñº</span>
                </div>
                <div class="section-content">
                    <ul>
                        <li>Thyroid function (if suggestive symptoms)</li>
                        <li>HIV screen</li>
                        <li>Serum/urine protein electrophoresis</li>
                        <li>Wider iron studies, LDH, glucose, bone profile</li>
                        <li>Autoantibodies, immunoglobulins</li>
                        <li>Skin biopsy</li>
                    </ul>
                    <p style="margin-top: 10px; padding: 10px; background: #ffebee; border-radius: 4px;">
                        <strong>Key finding:</strong> Iron deficiency found in 25% of itch associated with systemic disease
                    </p>
                </div>
            </div>
        </div>

        <div id="treatment" class="tab-content">
            <h3>Treatment Strategy</h3>
            <p style="padding: 15px; background: #e8f5e9; border-radius: 8px; border-left: 4px solid var(--success);">
                <strong>Duration:</strong> Most treatments need 6-12 months before tapering to reduce relapse risk. Many are off-label use.
            </p>

            <h4>First-Line Practical Advice</h4>
            <ul style="margin: 15px 0; padding-left: 20px;">
                <li>Emollients to wash AND moisturise</li>
                <li>Avoid soap</li>
                <li>Keep nails short</li>
                <li>Avoid wool clothing</li>
            </ul>

            <h4>Topical Treatments</h4>
            <table class="treatment-table">
                <thead>
                    <tr>
                        <th>Treatment</th>
                        <th>Recommendation</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Emollients</strong></td>
                        <td><span class="badge badge-recommend">FOR</span></td>
                        <td>First-line for all patients</td>
                    </tr>
                    <tr>
                        <td><strong>Menthol cream 1-5%</strong></td>
                        <td><span class="badge badge-recommend">FOR</span></td>
                        <td>Dermacool (2%) OTC. Cooling counter-irritant effect</td>
                    </tr>
                    <tr>
                        <td><strong>Moderate-potency steroids</strong></td>
                        <td><span class="badge badge-recommend">FOR</span></td>
                        <td>Clobetasone butyrate (Eumovate), hydrocortisone butyrate (Locoid) - OTC in UK</td>
                    </tr>
                    <tr>
                        <td><strong>Doxepin 5% cream</strong></td>
                        <td><span class="badge badge-caution">CAUTION</span></td>
                        <td>Max 8 days, max 10% BSA (12g daily). Risk of contact dermatitis & toxicity</td>
                    </tr>
                    <tr>
                        <td><strong>Crotamiton, Calamine, Capsaicin</strong></td>
                        <td><span class="badge badge-avoid">AVOID</span></td>
                        <td>No evidence of benefit; calamine may irritate</td>
                    </tr>
                </tbody>
            </table>

            <div style="margin: 20px 0; padding: 15px; background: #fff3cd; border-radius: 8px;">
                <strong>Steroid warning:</strong> Prolonged use ‚Üí atrophic skin thinning. Avoid face/flexures. Take 2-week breaks each month.
            </div>

            <h4>Systemic Treatments</h4>
            <table class="treatment-table">
                <thead>
                    <tr>
                        <th>Drug Class</th>
                        <th>Examples & Dosing</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Non-sedating antihistamines</strong></td>
                        <td>Fexofenadine 180mg, Loratadine 10mg, Cetirizine 10mg</td>
                        <td>First-line. Can use up to 4x daily off-licence</td>
                    </tr>
                    <tr>
                        <td><strong>Antidepressants</strong></td>
                        <td>Paroxetine, Mirtazapine</td>
                        <td>Evidence from case series. Tricyclics, SSRIs may help</td>
                    </tr>
                    <tr>
                        <td><strong>Neuropathic agents</strong></td>
                        <td>Gabapentin, Pregabalin</td>
                        <td>For neuropathic itch. Significant risk of harms</td>
                    </tr>
                    <tr>
                        <td><strong>Sedating antihistamines</strong></td>
                        <td>Hydroxyzine (palliative only)</td>
                        <td>Short-term use only. Avoid in elderly</td>
                    </tr>
                    <tr>
                        <td><strong>Stress-reduction</strong></td>
                        <td>CBT, Habit reversal, TENS, Acupuncture</td>
                        <td>Holistic biopsychosocial approach recommended</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="referral" class="tab-content">
            <h3>When to Refer</h3>
            <div style="background: #d1ecf1; padding: 25px; border-radius: 8px; border-left: 5px solid var(--secondary);">
                <h4>Refer to Dermatology/Secondary Care:</h4>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>Diagnostic uncertainty</li>
                    <li>Symptoms remain distressing despite primary care management</li>
                </ul>
            </div>

            <div style="margin-top: 20px;">
                <h4>Secondary Care Options</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                    <span class="badge badge-recommend">Systemic immunosuppressants</span>
                    <span class="badge badge-recommend">Phototherapy</span>
                    <span class="badge badge-recommend">Opioid antagonists (Naltrexone)</span>
                </div>
            </div>
        </div>

        <div id="elderly" class="tab-content">
            <h3>Pruritus in the Elderly (>65y)</h3>
            <div class="key-points-box" style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);">
                <h3 style="color: #856404;">‚ö° Elderly-Specific Considerations</h3>
                <ul class="key-points-list">
                    <li>Very common, often multifactorial (dry skin, ageing nerves, medication side-effects)</li>
                    <li>Higher malignancy & bullous pemphigoid risk</li>
                    <li>Initial: 2-week emollient (high lipid content) + topical steroids</li>
                    <li><strong>AVOID sedating antihistamines</strong> (dementia risk)</li>
                    <li>Lower threshold for skin biopsy & indirect immunofluorescence</li>
                </ul>
            </div>

            <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-top: 20px;">
                <h4 style="color: #856404;">Investigation Priority</h4>
                <p>After 2-week topical trial, investigate for systemic causes & immunologic eruption of ageing</p>
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <button class="action-btn print-btn" onclick="window.print()">üñ®Ô∏è Print</button>
        <button class="action-btn reset-btn" onclick="resetView()">‚ü≤ Reset</button>
    </div>

    <script>
        // Tab Navigation
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Update active button
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Update active content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Expandable Sections
        function toggleSection(header) {
            const section = header.closest('.expandable-section');
            section.classList.toggle('expanded');
        }

        // Search Functionality
        document.getElementById('searchBox').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const activeTab = document.querySelector('.tab-content.active');
            
            if (!searchTerm) {
                // Clear highlights
                activeTab.innerHTML = activeTab.innerHTML.replace(/<span class="highlight">(.*?)<\/span>/g, '$1');
                return;
            }
            
            // Clear previous highlights
            activeTab.innerHTML = activeTab.innerHTML.replace(/<span class="highlight">(.*?)<\/span>/g, '$1');
            
            // Find and highlight matches
            const walker = document.createTreeWalker(
                activeTab,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            const textNodes = [];
            let node;
            while (node = walker.nextNode()) {
                if (node.textContent.toLowerCase().includes(searchTerm)) {
                    textNodes.push(node);
                }
            }
            
            textNodes.forEach(node => {
                const parent = node.parentNode;
                const text = node.textContent;
                const regex = new RegExp(`(${searchTerm})`, 'gi');
                const highlightedHTML = text.replace(regex, '<span class="highlight">$1</span>');
                
                if (parent.nodeName !== 'SCRIPT' && parent.nodeName !== 'STYLE') {
                    const wrapper = document.createElement('span');
                    wrapper.innerHTML = highlightedHTML;
                    parent.replaceChild(wrapper, node);
                }
            });
        });

        // Reset View
        function resetView() {
            // Clear search
            document.getElementById('searchBox').value = '';
            
            // Go to summary tab
            document.querySelector('[data-tab="summary"]').click();
            
            // Collapse all sections
            document.querySelectorAll('.expandable-section.expanded').forEach(section => {
                section.classList.remove('expanded');
            });
            
            // Clear highlights
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.innerHTML = activeTab.innerHTML.replace(/<span class="highlight">(.*?)<\/span>/g, '$1');
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Auto-expand sections with keywords on search
        document.getElementById('searchBox').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const searchTerm = this.value.toLowerCase();
                if (searchTerm.includes('elderly') || searchTerm.includes('65')) {
                    document.querySelector('[data-tab="elderly"]').click();
                } else if (searchTerm.includes('treatment') || searchTerm.includes('drug')) {
                    document.querySelector('[data-tab="treatment"]').click();
                } else if (searchTerm.includes('investigation') || searchTerm.includes('blood')) {
                    document.querySelector('[data-tab="investigations"]').click();
                }
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + P for print
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
            // Ctrl/Cmd + F to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                document.getElementById('searchBox').focus();
            }
        });

        // Initialize all expandable sections as collapsed
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.expandable-section').forEach(section => {
                section.classList.remove('expanded');
            });
        });
    </script>
</body>
</html>