<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pediatric Acute Headache Assessment Algorithm</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            overflow: hidden;
            display: flex;
            min-height: calc(100vh - 40px);
        }

        .sidebar {
            width: 280px;
            background: #34495e;
            color: white;
            padding: 30px 20px;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .sidebar.closed {
            transform: translateX(-100%);
        }

        .toggle-sidebar {
            position: fixed;
            left: 280px;
            top: 20px;
            background: #34495e;
            color: white;
            border: none;
            padding: 12px;
            cursor: pointer;
            border-radius: 0 8px 8px 0;
            z-index: 1000;
            transition: left 0.3s ease;
        }

        .toggle-sidebar.closed {
            left: 0;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #4a5f7a;
        }

        .logo i {
            font-size: 3em;
            color: #3498db;
            margin-bottom: 10px;
        }

        .logo h1 {
            font-size: 1.4em;
            margin-bottom: 5px;
        }

        .logo .subtitle {
            font-size: 0.85em;
            color: #95a5a6;
        }

        .progress-section {
            margin-bottom: 25px;
        }

        .progress-section h3 {
            font-size: 1em;
            margin-bottom: 15px;
            color: #bdc3c7;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-bar {
            background: #4a5f7a;
            border-radius: 10px;
            height: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #3498db, #2ecc71);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .step-nav {
            list-style: none;
        }

        .step-nav li {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.05);
            border-left: 4px solid transparent;
        }

        .step-nav li:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .step-nav li.active {
            background: rgba(255,255,255,0.15);
            border-left-color: #3498db;
        }

        .step-nav li.completed {
            border-left-color: #2ecc71;
        }

        .step-nav i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .step-title {
            font-weight: 600;
            font-size: 0.95em;
        }

        .step-status {
            font-size: 0.75em;
            color: #95a5a6;
            margin-top: 3px;
        }

        .controls {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #4a5f7a;
        }

        .controls h3 {
            font-size: 1em;
            margin-bottom: 15px;
            color: #bdc3c7;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #4a5f7a;
            color: white;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .search-box::placeholder {
            color: #95a5a6;
        }

        .filter-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .filter-btn.active {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .badge-filter {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            max-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 3px solid #eee;
        }

        .header h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header .subtitle {
            font-size: 1.2em;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .guideline-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #2196f3;
            margin-bottom: 30px;
        }

        .guideline-info h3 {
            color: #1976d2;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-section {
            margin-bottom: 50px;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.6s ease forwards;
        }

        .step-section:nth-child(1) { animation-delay: 0.1s; }
        .step-section:nth-child(2) { animation-delay: 0.2s; }
        .step-section:nth-child(3) { animation-delay: 0.3s; }
        .step-section:nth-child(4) { animation-delay: 0.4s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: all 0.4s ease;
            border-left: 6px solid;
        }

        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .step-card.assessment {
            border-left-color: #3498db;
        }

        .step-card.diagnosis {
            border-left-color: #9b59b6;
        }

        .step-card.treatment {
            border-left-color: #27ae60;
        }

        .step-card.followup {
            border-left-color: #e67e22;
        }

        .step-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, #f8f9fa, #eef2f7);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .step-header:hover {
            background: linear-gradient(135deg, #eef2f7, #e9ecef);
        }

        .step-title-main {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .step-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: white;
            transition: all 0.3s ease;
        }

        .assessment .step-icon { background: #3498db; }
        .diagnosis .step-icon { background: #9b59b6; }
        .treatment .step-icon { background: #27ae60; }
        .followup .step-icon { background: #e67e22; }

        .step-card:hover .step-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .step-title-text h2 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .step-title-text p {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .expand-icon {
            font-size: 1.5em;
            color: #95a5a6;
            transition: all 0.3s ease;
        }

        .step-card.expanded .expand-icon {
            transform: rotate(180deg);
            color: #3498db;
        }

        .step-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .step-card.expanded .step-content {
            max-height: 3000px;
        }

        .content-inner {
            padding: 30px;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .info-card.urgent { border-left-color: #e74c3c; }
        .info-card.caution { border-left-color: #f39c12; }
        .info-card.stable { border-left-color: #27ae60; }

        .severity-badges {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .severity-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .severity-badge:hover {
            transform: scale(1.1);
        }

        .severity-badge.red { background: #e74c3c; }
        .severity-badge.amber { background: #f39c12; }
        .severity-badge.green { background: #27ae60; }

        .subsection {
            margin-bottom: 25px;
        }

        .subsection h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eee;
        }

        .subsection h3 i {
            color: #3498db;
        }

        .checklist {
            list-style: none;
            padding-left: 0;
        }

        .checklist li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            transition: all 0.3s ease;
        }

        .checklist li:hover {
            background: rgba(52, 152, 219, 0.05);
            border-radius: 5px;
            padding-left: 35px;
        }

        .checklist li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(39, 174, 96, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
        }

        .differential-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .differential-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .differential-item:hover {
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .differential-item.common {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.05);
        }

        .differential-item.uncommon {
            border-color: #9b59b6;
            background: rgba(155, 89, 182, 0.05);
        }

        .criteria-box {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .criteria-box h4 {
            color: #27ae60;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .criteria-list {
            list-style: none;
            padding-left: 0;
        }

        .criteria-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .criteria-list li::before {
            content: '→';
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }

        .highlight-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .highlight-box i {
            color: #f39c12;
            font-size: 1.2em;
            margin-top: 3px;
        }

        .emergency-alert {
            background: #fee;
            border: 1px solid #fcc;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .emergency-alert i {
            color: #e74c3c;
            font-size: 1.2em;
            margin-top: 3px;
        }

        .investigation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .investigation-item {
            background: white;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .investigation-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .investigation-item i {
            font-size: 2em;
            color: #3498db;
            margin-bottom: 10px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .print-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.5em;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 999;
        }

        .print-btn:hover {
            transform: scale(1.1) rotate(10deg);
            background: #2980b9;
        }

        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                z-index: 998;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .toggle-sidebar {
                display: block;
            }

            .main-content {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: 1fr;
            }

            .differential-grid {
                grid-template-columns: 1fr;
            }

            .investigation-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
                flex-direction: column;
            }

            .step-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                max-width: 100%;
            }

            .sidebar, .print-btn, .toggle-sidebar {
                display: none;
            }

            .main-content {
                max-height: none;
                overflow: visible;
            }

            .step-content {
                max-height: none !important;
            }

            .step-card {
                page-break-inside: avoid;
                margin-bottom: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <i class="fas fa-brain"></i>
                <h1>Headache Algorithm</h1>
                <p class="subtitle">BMJ Best Practice</p>
                <p class="subtitle">Nov 2025</p>
            </div>

            <div class="progress-section">
                <h3>Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div style="text-align: center; font-size: 0.9em; color: #95a5a6;">
                    <span id="progressText">0% Complete</span>
                </div>
            </div>

            <nav>
                <ul class="step-nav" id="stepNav">
                    <li data-step="assessment" class="active">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-stethoscope"></i>
                            <div>
                                <div class="step-title">Assessment</div>
                                <div class="step-status">Current Step</div>
                            </div>
                        </div>
                    </li>
                    <li data-step="diagnosis">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-search"></i>
                            <div>
                                <div class="step-title">Diagnosis</div>
                                <div class="step-status">Pending</div>
                            </div>
                        </div>
                    </li>
                    <li data-step="treatment">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-pills"></i>
                            <div>
                                <div class="step-title">Treatment</div>
                                <div class="step-status">Pending</div>
                            </div>
                        </div>
                    </li>
                    <li data-step="followup">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-clipboard-check"></i>
                            <div>
                                <div class="step-title">Follow-up</div>
                                <div class="step-status">Pending</div>
                            </div>
                        </div>
                    </li>
                </ul>
            </nav>

            <div class="controls">
                <h3>Filters</h3>
                <input type="text" class="search-box" id="searchBox" placeholder="Search content...">
                <div class="filter-buttons">
                    <button class="filter-btn" data-filter="all" class="active">
                        <span class="badge-filter" style="background: #3498db;">ALL</span>
                        Show All Content
                    </button>
                    <button class="filter-btn" data-filter="urgent">
                        <span class="badge-filter" style="background: #e74c3c;">URGENT</span>
                        Emergency Only
                    </button>
                    <button class="filter-btn" data-filter="caution">
                        <span class="badge-filter" style="background: #f39c12;">CAUTION</span>
                        Warning Signs
                    </button>
                    <button class="filter-btn" data-filter="stable">
                        <span class="badge-filter" style="background: #27ae60;">STABLE</span>
                        Primary Headaches
                    </button>
                </div>
            </div>
        </aside>

        <button class="toggle-sidebar" id="toggleSidebar">
            <i class="fas fa-bars"></i>
        </button>

        <main class="main-content" id="mainContent">
            <div class="header">
                <h1><i class="fas fa-brain"></i> Pediatric Acute Headache Assessment</h1>
                <p class="subtitle">Interactive Clinical Decision Support Algorithm</p>
                <p style="color: #7f8c8d; font-size: 0.9em;">Based on BMJ Best Practice Guidelines (Last updated: Nov 13, 2025)</p>
                
                <div class="guideline-info">
                    <h3><i class="fas fa-info-circle"></i> Clinical Overview</h3>
                    <p>Headaches in children account for 0.7-1.3% of pediatric ED visits. Primary headaches (migraine, tension-type) are most common, but secondary causes must be excluded. All children require thorough history, examination, and judicious neuroimaging.</p>
                </div>
            </div>

            <!-- Assessment Section -->
            <section class="step-section" id="assessment">
                <div class="step-card assessment" data-step="assessment">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-title-main">
                            <div class="step-icon">
                                <i class="fas fa-stethoscope"></i>
                            </div>
                            <div class="step-title-text">
                                <h2>Assessment & Initial Evaluation</h2>
                                <p>Comprehensive clinical assessment to identify red flags and classify headache type</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="step-content">
                        <div class="content-inner">
                            <div class="severity-badges">
                                <div class="severity-badge red">
                                    <i class="fas fa-exclamation-triangle"></i> Thunderclap Headache
                                </div>
                                <div class="severity-badge red">
                                    <i class="fas fa-ambulance"></i> Acute Herniation
                                </div>
                                <div class="severity-badge amber">
                                    <i class="fas fa-radiation"></i> Imaging Indicated
                                </div>
                                <div class="severity-badge amber">
                                    <i class="fas fa-flask"></i> LP Consider
                                </div>
                                <div class="severity-badge green">
                                    <i class="fas fa-check-circle"></i> Primary Headache
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-clock"></i> Clinical Classification</h3>
                                <div class="card-grid">
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-bolt"></i> Acute Headache</h4>
                                        <ul class="checklist">
                                            <li>Single episode without prior headaches</li>
                                            <li>May represent first/sever primary headache</li>
                                            <li><strong>Suggests new acute secondary cause requiring evaluation</strong></li>
                                        </ul>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-sync"></i> Acute Recurrent Headache</h4>
                                        <ul class="checklist">
                                            <li>Stereotyped headaches separated by headache-free periods</li>
                                            <li><strong>Suggests primary headache disorder</strong></li>
                                            <li>May occur in secondary headache with intermittent ICP elevation</li>
                                        </ul>
                                    </div>
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-chart-line"></i> Chronic Progressive Headache</h4>
                                        <ul class="checklist">
                                            <li>Gradual increase in headache frequency/severity</li>
                                            <li><strong>Strongly suggestive of expanding intracranial lesion</strong></li>
                                            <li>62% of children with brain tumors have headache prior to diagnosis</li>
                                            <li>98% have ≥1 neurological symptom/sign on examination</li>
                                        </ul>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-equals"></i> Chronic Non-Progressive Headache</h4>
                                        <ul class="checklist">
                                            <li>Constant steady headache</li>
                                            <li>May be chronic primary headache or similar secondary etiologies</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-clipboard-list"></i> History Taking</h3>
                                <div class="highlight-box">
                                    <i class="fas fa-lightbulb"></i>
                                    <div>
                                        <strong>Key Historical Features:</strong> Time course, onset, pattern, associated symptoms, trauma history, medication use, and family history are critical for distinguishing primary vs secondary headaches.
                                    </div>
                                </div>
                                
                                <div class="card-grid">
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-question-circle"></i> Critical Questions</h4>
                                        <ul class="checklist">
                                            <li><strong>Onset:</strong> Abrupt (thunderclap) vs gradual?</li>
                                            <li><strong>Pattern:</strong> First, worst, or different from usual?</li>
                                            <li><strong>Trauma:</strong> Recent head/neck injury?</li>
                                            <li><strong>Position:</strong> Worse lying down (↑ICP) or standing (↑hypotension)?</li>
                                            <li><strong>Valsalva:</strong> Worse with coughing/straining?</li>
                                            <li><strong>Neurological symptoms:</strong> Seizures, weakness, visual changes?</li>
                                            <li><strong>Fever:</strong> Suggests infectious etiology</li>
                                            <li><strong>Medication overuse:</strong> Ergotamine, triptans, analgesics, opioids?</li>
                                        </ul>
                                    </div>
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-child"></i> Age-Specific Considerations</h4>
                                        <ul class="checklist">
                                            <li>Young children may not localize pain well</li>
                                            <li>Photophobia/phonophobia may be inferred from behavior</li>
                                            <li>Migraine often bilateral in children <18 years</li>
                                            <li>Occipital headache in children is rare—requires caution</li>
                                            <li> Consider non-accidental injury in infants</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-heartbeat"></i> Initial Survey</h3>
                                <div class="card-grid">
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-exclamation-circle"></i> Vital Signs - Red Flags</h4>
                                        <ul class="checklist">
                                            <li><strong>↑ Blood Pressure:</strong> Possible ↑ICP or hypertensive encephalopathy</li>
                                            <li><strong>↑ Temperature:</strong> Intracranial or extracranial infection</li>
                                            <li><strong>Cushing's Triad:</strong> Hypertension + bradycardia + irregular breathing = ↑ICP</li>
                                        </ul>
                                    </div>
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-eye"></i> General Examination</h4>
                                        <ul class="checklist">
                                            <li><strong>Mental status:</strong> Any abnormality suggests encephalopathy</li>
                                            <li><strong>Skin:</strong> Neurocutaneous lesions (NF, TS) suggest intracranial lesions</li>
                                            <li><strong>Head circumference:</strong> Abnormal rate suggests intracranial lesion</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-head-side-cough"></i> Head & Neck Examination</h3>
                                <div class="card-grid">
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-head-side-mask"></i> Key Components</h4>
                                        <ul class="checklist">
                                            <li><strong>Cranial/neck auscultation:</strong> Bruits suggest vascular malformation/dissection</li>
                                            <li><strong>Sinuses:</strong> Tenderness, inflamed mucosa, purulent discharge → sinusitis</li>
                                            <li><strong>TMJ dysfunction:</strong> Tenderness, clicks, reduced jaw movement (<35mm)</li>
                                            <li><strong>Oral/dental:</strong> Caries, abscess, gingival disease</li>
                                            <li><strong>Meningeal signs:</strong> Meningismus, photophobia</li>
                                            <li><strong>Head circumference:</strong> Measure in ALL children</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-brain"></i> Neurological Examination</h3>
                                <div class="emergency-alert">
                                    <i class="fas fa-ambulance"></i>
                                    <div>
                                        <strong>CRITICAL:</strong> Any abnormal neurological sign suggests underlying brain lesion and secondary headache etiology requiring urgent neuroimaging.
                                    </div>
                                </div>
                                
                                <div class="card-grid">
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-eye"></i> Cranial Nerve II (Optic)</h4>
                                        <ul class="checklist">
                                            <li><strong>Optic nerve edema:</strong> Suggests ↑ICP</li>
                                            <li><strong>Visual field reduction:</strong> Consider ↑ICP</li>
                                        </ul>
                                    </div>
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-low-vision"></i> Pupillary Function</h4>
                                        <ul class="checklist">
                                            <li><strong>Dilated pupil in bright room:</strong> Suggests herniation syndrome</li>
                                            <li><strong>Constricted pupil in dark room:</strong> Horner's syndrome → carotid dissection</li>
                                            <li><strong>Dilated pupil + CN III palsy:</strong> Compressive lesion/acute herniation</li>
                                        </ul>
                                    </div>
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-arrows-alt"></i> Extra-ocular Movements</h4>
                                        <ul class="checklist">
                                            <li><strong>Lateralizing nystagmus:</strong> Brainstem lesion</li>
                                            <li><strong>CN VI palsy:</strong> Horizontal diplopia → ↑ICP or brainstem lesion</li>
                                            <li><strong>CN IV palsy:</strong> Head tilt/chin tuck → trauma or brainstem lesion</li>
                                        </ul>
                                    </div>
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-walking"></i> Motor & Cerebellar</h4>
                                        <ul class="checklist">
                                            <li><strong>Strength/tone/reflex asymmetries:</strong> Focal lesions</li>
                                            <li><strong>Babinski sign:</strong> Upper motor neuron lesion</li>
                                            <li><strong>Cerebellar signs:</strong> Posterior fossa lesion (tumor, cerebellitis)</li>
                                            <li><strong>Gait abnormalities:</strong> Ataxia, wide-based → intracranial pathology</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-imaging"></i> Indications for Urgent Neuroimaging</h3>
                                <div class="emergency-alert">
                                    <i class="fas fa-radiation"></i>
                                    <div>
                                        <strong>Immediate CT Head Indicated If:</strong> Thunderclap headache, new focal neuro signs, meningismus, optic nerve edema, ↓GCS, suspected shunt malfunction, known cancer, immunocompromised.
                                    </div>
                                </div>
                                
                                <div class="investigation-grid">
                                    <div class="investigation-item">
                                        <i class="fas fa-brain"></i>
                                        <h4>Emergency CT</h4>
                                        <p>Non-contrast head CT within 1 hour for trauma with GCS <14 or concerning symptoms</p>
                                        <div class="severity-badge red">URGENT</div>
                                    </div>
                                    <div class="investigation-item">
                                        <i class="fas fa-magnet"></i>
                                        <h4>Preferred MRI</h4>
                                        <p>For ↑ICP/hypotension suspected - superior for small tumors, posterior fossa, vascular malformations</p>
                                        <div class="severity-badge amber">IF AVAILABLE</div>
                                    </div>
                                    <div class="investigation-item">
                                        <i class="fas fa-flask"></i>
                                        <h4>Lumbar Puncture</h4>
                                        <p>For suspected infection or ↑ICP. Measure opening pressure, analyze CSF composition</p>
                                        <div class="severity-badge amber">CONTRAINDICATED IF MASS LESION</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Diagnosis Section -->
            <section class="step-section" id="diagnosis">
                <div class="step-card diagnosis" data-step="diagnosis">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-title-main">
                            <div class="step-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="step-title-text">
                                <h2>Diagnosis & Classification</h2>
                                <p>Migraine criteria, differential diagnosis, and investigation interpretation</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="step-content">
                        <div class="content-inner">
                            <div class="severity-badges">
                                <div class="severity-badge green">
                                    <i class="fas fa-brain"></i> Migraine (Primary)
                                </div>
                                <div class="severity-badge green">
                                    <i class="fas fa-sinus"></i> Sinusitis (Secondary)
                                </div>
                                <div class="severity-badge red">
                                    <i class="fas fa-ambulance"></i> SAH/Stroke/Tumor
                                </div>
                                <div class="severity-badge amber">
                                    <i class="fas fa-bacterium"></i> Meningitis
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-brain"></i> Migraine Diagnostic Criteria (ICHD-3)</h3>
                                <div class="criteria-box">
                                    <h4><i class="fas fa-aura"></i> Migraine Without Aura</h4>
                                    <ul class="criteria-list">
                                        <li><strong>A:</strong> ≥5 attacks fulfilling B-D</li>
                                        <li><strong>B:</strong> Headache lasts 2-72 hours in children <18y (untreated)</li>
                                        <li><strong>C:</strong> ≥2 characteristics: unilateral/bilateral, pulsating, moderate-severe intensity, aggravated by routine activity</li>
                                        <li><strong>D:</strong> During headache: nausea/vomiting AND/OR photophobia + phonophobia</li>
                                        <li><strong>E:</strong> Not attributable to another disorder</li>
                                    </ul>
                                    <p style="margin-top: 10px; font-style: italic; color: #7f8c8d;">
                                        *In children, migraine is more often bilateral and frontotemporal. Occipital headache is rare and requires caution.
                                    </p>
                                </div>

                                <div class="criteria-box">
                                    <h4><i class="fas fa-eye"></i> Migraine With Aura</h4>
                                    <ul class="criteria-list">
                                        <li><strong>A:</strong> ≥2 attacks fulfilling B and C</li>
                                        <li><strong>B:</strong> ≥1 fully reversible aura symptom: visual, sensory, speech/language, motor, brainstem, retinal</li>
                                        <li><strong>C:</strong> ≥3 characteristics: gradual spread over ≥5 min, ≥2 symptoms in succession, each lasts 5-60 min, ≥1 unilateral, ≥1 positive symptom, followed by headache within 60 min</li>
                                        <li><strong>D:</strong> Not attributable to another disorder</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-diagnoses"></i> Differential Diagnosis</h3>
                                <div class="highlight-box">
                                    <i class="fas fa-chart-pie"></i>
                                    <div>
                                        <strong>Prevalence in ED:</strong> Most common etiologies are primary headache (migraine > tension-type) and sinusitis-related headache. Significant intracranial pathology is rare but must be identified.
                                    </div>
                                </div>

                                <h4 style="margin: 20px 0 15px 0; color: #2c3e50;">Common Diagnoses</h4>
                                <div class="differential-grid">
                                    <div class="differential-item common">
                                        <div class="severity-badge green" style="margin-bottom: 10px;">STABLE</div>
                                        <h4><i class="fas fa-brain"></i> Migraine Headache</h4>
                                        <p>Clinical diagnosis. Imaging not routinely recommended if no red flags. Positive family history, pulsating pain, nausea, photophobia typical.</p>
                                    </div>
                                    <div class="differential-item common">
                                        <div class="severity-badge amber" style="margin-bottom: 10px;">CAUTION</div>
                                        <h4><i class="fas fa-head-side-cough"></i> Acute Sinusitis</h4>
                                        <p>Nasal obstruction, facial tenderness, purulent discharge. Diagnosis clinical. CT sinus if complicated or not responding to treatment.</p>
                                    </div>
                                </div>

                                <h4 style="margin: 20px 0 15px 0; color: #2c3e50;">Uncommon/Emergent Diagnoses</h4>
                                <div class="differential-grid">
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge red" style="margin-bottom: 10px;">URGENT</div>
                                        <h4><i class="fas fa-ambulance"></i> Subarachnoid Hemorrhage</h4>
                                        <p>"Worst headache of life," rapid onset. CT shows hyperdense blood in sulci/cisterns. LP if CT negative.</p>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge red" style="margin-bottom: 10px;">URGENT</div>
                                        <h4><i class="fas fa-bolt"></i> Ischemic Stroke</h4>
                                        <p>Acute onset headache with focal seizures, ↑ICP symptoms. MRI DWI is gold standard.</p>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge red" style="margin-bottom: 10px;">URGENT</div>
                                        <h4><i class="fas fa-tint"></i> Parenchymal Hemorrhage</h4>
                                        <p>Abrupt severe headache, altered mental status, focal signs. CT shows hyperdense bleed. Urgent neurosurgical consult.</p>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge red" style="margin-bottom: 10px;">URGENT</div>
                                        <h4><i class="fas fa-car"></i> Vascular Dissection</h4>
                                        <p>History of head/neck trauma (even mild), delayed onset. Neck pain + headache ± focal neuro signs.</p>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge red" style="margin-bottom: 10px;">URGENT</div>
                                        <h4><i class="fas fa-clot"></i> Cerebral Venous Sinus Thrombosis</h4>
                                        <p>Gradual onset worse with Valsalva, vision changes common. Risk factors: infection, hypercoagulable state.</p>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge amber" style="margin-bottom: 10px;">CAUTION</div>
                                        <h4><i class="fas fa-brain"></i> Brain Tumor</h4>
                                        <p>Progressive headache worse supine/morning. 62% have headache, 98% have neuro signs. MRI with contrast is optimal.</p>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge red" style="margin-bottom: 10px;">URGENT</div>
                                        <h4><i class="fas fa-bacterium"></i> Meningitis</h4>
                                        <p>Acute headache with fever, neck stiffness. LP shows elevated WBCs/protein. Don't delay antibiotics for LP if critically ill.</p>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge amber" style="margin-bottom: 10px;">CAUTION</div>
                                        <h4><i class="fas fa-virus"></i> Encephalitis</h4>
                                        <p>Altered mental status, seizures, focal neuro signs. MRI and CSF PCR for diagnosis. Often viral (HSV, arboviruses).</p>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge green" style="margin-bottom: 10px;">STABLE</div>
                                        <h4><i class="fas fa-pills"></i> Medication Overuse Headache</h4>
                                        <p>Chronic headache from overuse of ergotamine, triptans, analgesics, opioids. Improves after 2 months of discontinuation.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-microscope"></i> Investigation Guidelines</h3>
                                
                                <h4 style="margin-bottom: 15px; color: #2c3e50;">Urgent Neuroimaging Indications</h4>
                                <div class="card-grid">
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-exclamation-triangle"></i> Immediate CT</h4>
                                        <ul class="checklist">
                                            <li>Thunderclap headache or acute severe onset</li>
                                            <li>New focal neurological signs</li>
                                            <li>Meningismus</li>
                                            <li>Optic nerve edema</li>
                                            <li>Suspected shunt malfunction</li>
                                            <li>Known cancer or immunocompromised</li>
                                        </ul>
                                        <div class="severity-badge red">WITHIN 1 HOUR</div>
                                    </div>
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-magnet"></i> MRI Preferred</h4>
                                        <ul class="checklist">
                                            <li>Suspected ↑ICP or hypotension</li>
                                            <li>Small tumors, posterior fossa lesions</li>
                                            <li>Vascular malformations</li>
                                            <li>Inflammatory changes</li>
                                            <li>Cervical cord abnormalities</li>
                                        </ul>
                                        <div class="severity-badge amber">IF AVAILABLE</div>
                                    </div>
                                </div>

                                <h4 style="margin: 20px 0 15px 0; color: #2c3e50;">Lumbar Puncture Indications</h4>
                                <div class="card-grid">
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-flask"></i> When to Perform LP</h4>
                                        <ul class="checklist">
                                            <li>Headache with fever and/or meningismus</li>
                                            <li>Altered mental status or seizure</li>
                                            <li>Suspected idiopathic intracranial hypertension</li>
                                            <li>Subarachnoid hemorrhage suspected with negative CT</li>
                                        </ul>
                                    </div>
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-ban"></i> Contraindications</h4>
                                        <ul class="checklist">
                                            <li>Suspected mass lesion or ↑ICP</li>
                                            <li>Neuroimaging must precede LP if mass suspected</li>
                                            <li>Risk of herniation if large lesion present</li>
                                            <li>If LP delayed, start antibiotics/antivirals empirically</li>
                                        </ul>
                                        <div class="severity-badge red">DON'T DELAY TREATMENT</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Treatment Section -->
            <section class="step-section" id="treatment">
                <div class="step-card treatment" data-step="treatment">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-title-main">
                            <div class="step-icon">
                                <i class="fas fa-pills"></i>
                            </div>
                            <div class="step-title-text">
                                <h2>Treatment & Management</h2>
                                <p>Emergency interventions, condition-specific treatments, and medication strategies</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="step-content">
                        <div class="content-inner">
                            <div class="severity-badges">
                                <div class="severity-badge red">
                                    <i class="fas fa-ambulance"></i> Emergency Care
                                </div>
                                <div class="severity-badge amber">
                                    <i class="fas fa-prescription"></i> Pharmacologic
                                </div>
                                <div class="severity-badge green">
                                    <i class="fas fa-home"></i> Outpatient
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-exclamation-triangle"></i> Emergency Management</h3>
                                
                                <h4 style="margin-bottom: 15px; color: #2c3e50;">Thunderclap Headache</h4>
                                <div class="emergency-alert">
                                    <i class="fas fa-ambulance"></i>
                                    <div>
                                        <strong>EMERGENCY:</strong> Thunderclap headache often associated with serious brain disorder requiring specific and urgent therapy. Immediate neuroimaging and neurosurgical consultation.
                                    </div>
                                </div>
                                <div class="card-grid">
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-imaging"></i> Initial Workup</h4>
                                        <ul class="checklist">
                                            <li><strong>Non-contrast CT head:</strong> Speed and sensitivity for bleed detection</li>
                                            <li><strong>MRI:</strong> If ↑ICP/hypotension suspected; preferred over CT if available</li>
                                            <li><strong>CTA/MRA:</strong> If arterial dissection, aneurysm, or vasospasm suspected</li>
                                            <li><strong>Lumbar puncture:</strong> For suspected SAH if CT non-diagnostic</li>
                                            <li><strong>Examine CSF for xanthochromia:</strong> Most sensitive for SAH; persists for weeks</li>
                                        </ul>
                                    </div>
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-procedures"></i> Management</h4>
                                        <ul class="checklist">
                                            <li><strong>Neurosurgical consult:</strong> Required for most cases</li>
                                            <li><strong>ICU admission:</strong> For SAH, large hemorrhage, or ↑ICP</li>
                                            <li><strong>Specific therapy:</strong> Directed at underlying etiology</li>
                                            <li><strong>Only after evaluation:</strong> Consider benign etiologies (migraine, tension, cluster)</li>
                                        </ul>
                                    </div>
                                </div>

                                <h4 style="margin: 20px 0 15px 0; color: #2c3e50;">Acute Herniation from ↑ICP</h4>
                                <div class="emergency-alert">
                                    <i class="fas fa-heartbeat"></i>
                                    <div>
                                        <strong>Cushing's Triad:</strong> Hypertension + Bradycardia + Irregular breathing = LIFE-THREATENING ↑ICP. Requires immediate intervention.
                                    </div>
                                </div>
                                <div class="card-grid">
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-bed"></i> Initial Measures</h4>
                                        <ul class="checklist">
                                            <li><strong>Neutral neck position:</strong> Avoid kinking jugular veins</li>
                                            <li><strong>Elevate head of bed:</strong> 20-30 degrees to improve venous drainage</li>
                                            <li><strong>Hypertonic saline:</strong> IV bolus for rapid ↓ICP</li>
                                            <li><strong>Hyperventilation:</strong> Target pCO2 35 mmHg (temporary measure)</li>
                                            <li><strong>Urgent neurosurgery:</strong> For space-occupying lesion</li>
                                        </ul>
                                    </div>
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-lungs"></i> Cautions</h4>
                                        <ul class="checklist">
                                            <li>Avoid excessive/prolonged hyperventilation (risk of cerebral ischemia)</li>
                                            <li>Only temporary reduction in cerebral blood flow</li>
                                            <li>Further reduction in pCO2 may be needed for rapid but temporary ↓ICP</li>
                                        </ul>
                                    </div>
                                </div>

                                <h4 style="margin: 20px 0 15px 0; color: #2c3e50;">Traumatic Brain Injury</h4>
                                <div class="card-grid">
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-ambulance"></i> NICE CT Head Criteria (≤16 years)</h4>
                                        <ul class="checklist">
                                            <li><strong>Within 1 hour if:</strong></li>
                                            <li>GCS <14 (≥1 year) or <15 (<1 year)</li>
                                            <li>Post-traumatic seizure</li>
                                            <li>Suspected non-accidental injury</li>
                                            <li>Open/depressed skull fracture</li>
                                            <li>Signs of basal skull fracture (Battle's sign, "panda" eyes, CSF leak)</li>
                                            <li>Focal neurological deficit</li>
                                            <li>Large scalp hematoma (>5cm in <1 year)</li>
                                            <li>2+ of: LOC >5min, abnormal drowsiness, vomiting ≥3 episodes, amnesia >5min, dangerous mechanism, bleeding/clotting disorder</li>
                                        </ul>
                                    </div>
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-exclamation-circle"></i> Key Management Points</h4>
                                        <ul class="checklist">
                                            <li><strong>Detailed Hx:</strong> Mechanism, associated symptoms</li>
                                            <li><strong>Full neuro exam:</strong> Including signs of basal skull fracture</li>
                                            <li><strong>Imaging:</strong> Non-contrast MRI preferred; CT if MRI unavailable/contraindicated</li>
                                            <li><strong>C-spine:</strong> Immobilize and image if indicated</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-disease"></i> Condition-Specific Management</h3>
                                <div class="differential-grid">
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge amber" style="margin-bottom: 10px;">NEUROSURGICAL REFERRAL</div>
                                        <h4><i class="fas fa-brain"></i> Brain Tumor</h4>
                                        <ul class="checklist" style="font-size: 0.9em;">
                                            <li>Urgent neurosurgical consultation</li>
                                            <li>MRI with contrast for diagnosis and staging</li>
                                            <li>Stereotactic biopsy for definitive diagnosis</li>
                                            <li>Treatment: Surgery ± radiation ± chemotherapy based on tumor type</li>
                                        </ul>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge red" style="margin-bottom: 10px;">IMMEDIATE ANTIBIOTICS</div>
                                        <h4><i class="fas fa-bacterium"></i> Meningitis</h4>
                                        <ul class="checklist" style="font-size: 0.9em;">
                                            <li>Empiric broad-spectrum antibiotics within 1 hour</li>
                                            <li>Add acyclovir if HSV encephalitis suspected</li>
                                            <li>Dexamethasone adjunct for bacterial meningitis</li>
                                            <li>Isolation precautions until organism identified</li>
                                        </ul>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge red" style="margin-bottom: 10px;">ANTIVIRAL THERAPY</div>
                                        <h4><i class="fas fa-virus"></i> Encephalitis</h4>
                                        <ul class="checklist" style="font-size: 0.9em;">
                                            <li>Empiric IV acyclovir for HSV encephalitis</li>
                                            <li>Supportive care: fluids, antipyretics, seizure control</li>
                                            <li>ICU admission for severe cases</li>
                                            <li>Consider infectious disease consultation</li>
                                        </ul>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge amber" style="margin-bottom: 10px;">SHUNT EVALUATION</div>
                                        <h4><i class="fas fa-tube"></i> VP Shunt Dysfunction</h4>
                                        <ul class="checklist" style="font-size: 0.9em;">
                                            <li>Urgent neurosurgical evaluation</li>
                                            <li>Shunt series x-rays to check integrity</li>
                                            <li>CT head to assess ventricular size</li>
                                            <li>Shunt tap to measure pressure if reservoir present</li>
                                        </ul>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge amber" style="margin-bottom: 10px;">LUMBAR PUNCTURE</div>
                                        <h4><i class="fas fa-weight"></i> Idiopathic Intracranial HTN</h4>
                                        <ul class="checklist" style="font-size: 0.9em;">
                                            <li>Confirm with LP: opening pressure >250 mm H2O</li>
                                            <li>Rule out secondary causes (MR venogram)</li>
                                            <li>Acetazolamide first-line treatment</li>
                                            <li>Weight loss if overweight, serial LPs</li>
                                            <li>Optic nerve sheath fenestration or shunting if vision threatens</li>
                                        </ul>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge green" style="margin-bottom: 10px;">RESPONSIVE TO INDOMETHACIN</div>
                                        <h4><i class="fas fa-pills"></i> Indomethacin-Responsive Headaches</h4>
                                        <ul class="checklist" style="font-size: 0.9em;">
                                            <li><strong>Paroxysmal hemicrania:</strong> Trial indomethacin 25mg TID, titrate up to 150mg/day</li>
                                            <li><strong>Hemicrania continua:</strong> Complete response confirms diagnosis</li>
                                            <li><strong>Ice-pick headaches:</strong> May respond dramatically</li>
                                        </ul>
                                    </div>
                                    <div class="differential-item uncommon">
                                        <div class="severity-badge green" style="margin-bottom: 10px;">OXYGEN THERAPY</div>
                                        <h4><i class="fas fa-wind"></i> Cluster Headache</h4>
                                        <ul class="checklist" style="font-size: 0.9em;">
                                            <li><strong>Acute:</strong> 100% oxygen 7-15 L/min via non-rebreather</li>
                                            <li><strong>Prophylaxis:</strong> Verapamil, lithium, topiramate</li>
                                            <li><strong>Note:</strong> Rare in children—perform MRI to rule out secondary cause</li>
                                        </ul>
                                    </div>
                                    <div class="differential-item common">
                                        <div class="severity-badge green" style="margin-bottom: 10px;">SUPPORTIVE CARE</div>
                                        <h4><i class="fas fa-pills"></i> Medication Overuse Headache</h4>
                                        <ul class="checklist" style="font-size: 0.9em;">
                                            <li><strong>Withdrawal:</strong> Stop offending medication abruptly</li>
                                            <li><strong>May worsen initially:</strong> Bridge therapy with naproxen or prednisone</li>
                                            <li><strong>Preventive therapy:</strong> Start before withdrawal</li>
                                            <li><strong>Counseling:</strong> Limit acute meds to ≤2 days/week</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-brain"></i> Primary Headache Management</h3>
                                <div class="card-grid">
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-migraine"></i> Acute Migraine Treatment</h4>
                                        <ul class="checklist">
                                            <li><strong>First-line:</strong> Acetaminophen 15mg/kg or Ibuprofen 10mg/kg</li>
                                            <li><strong>Second-line:</strong> Triptans (sumatriptan nasal spray 10-20mg)</li>
                                            <li><strong>Anti-emetics:</strong> Prochlorperazine, metoclopramide</li>
                                            <li><strong>Fluids:</strong> IV hydration if vomiting</li>
                                            <li><strong>Dark quiet room:</strong> Sleep often terminates attack</li>
                                        </ul>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-shield-alt"></i> Migraine Prophylaxis</h4>
                                        <ul class="checklist">
                                            <li><strong>Indications:</strong> ≥4 attacks/month, disabling attacks, poor response to acute treatment</li>
                                            <li><strong>Options:</strong> Topiramate, propranolol, amitriptyline, cyproheptadine</li>
                                            <li><strong>Lifestyle:</strong> Regular sleep, meals, hydration, exercise</li>
                                            <li><strong>Avoid triggers:</strong> Caffeine, certain foods, screen time</li>
                                        </ul>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-head-side-cough"></i> Tension-Type Headache</h4>
                                        <ul class="checklist">
                                            <li><strong>Treatment:</strong> Simple analgesics (acetaminophen, ibuprofen)</li>
                                            <li><strong>Limit acute meds:</strong> ≤2 days/week to avoid overuse</li>
                                            <li><strong>Stress management:</strong> Relaxation techniques, biofeedback</li>
                                            <li><strong>Physical therapy:</strong> For neck muscle tension</li>
                                        </ul>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-sinus"></i> Sinusitis Headache</h4>
                                        <ul class="checklist">
                                            <li><strong>Antibiotics:</strong> Amoxicillin ± clavulanate if bacterial</li>
                                            <li><strong>Symptomatic:</strong> Saline irrigation, decongestants, analgesics</li>
                                            <li><strong>Duration:</strong> Acute <4 weeks, subacute 4-12 weeks, chronic >12 weeks</li>
                                            <li><strong>ENT referral:</strong> If recurrent, chronic, or complications</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="action-btn btn-primary" onclick="toggleStep(document.querySelector('#treatment .step-header'))">
                                    <i class="fas fa-arrow-down"></i> Collapse Treatment
                                </button>
                                <button class="action-btn btn-success" onclick="showStep('followup')">
                                    <i class="fas fa-arrow-right"></i> Proceed to Follow-up
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Follow-up Section -->
            <section class="step-section" id="followup">
                <div class="step-card followup" data-step="followup">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-title-main">
                            <div class="step-icon">
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                            <div class="step-title-text">
                                <h2>Follow-up & Monitoring</h2>
                                <p>Outpatient management, headache diary, and long-term follow-up strategies</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="step-content">
                        <div class="content-inner">
                            <div class="subsection">
                                <h3><i class="fas fa-calendar-alt"></i> Headache Diary</h3>
                                <div class="highlight-box">
                                    <i class="fas fa-pencil-alt"></i>
                                    <div>
                                        <strong>Essential Tool:</strong> Headache diary/calendar is crucial for accurate diagnosis, management, and monitoring treatment response. Helps quantify headache frequency, identify triggers, and assess impact.
                                    </div>
                                </div>
                                
                                <div class="card-grid">
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-book"></i> Diary Components</h4>
                                        <ul class="checklist">
                                            <li><strong>Date/time:</strong> Start, duration, end of headache</li>
                                            <li><strong>Severity:</strong> 0-10 scale or mild/moderate/severe</li>
                                            <li><strong>Location:</strong> Bilateral, unilateral, frontotemporal, occipital</li>
                                            <li><strong>Quality:</strong> Throbbing, pressure, stabbing</li>
                                            <li><strong>Associated symptoms:</strong> Nausea, vomiting, photophobia, phonophobia, aura</li>
                                            <li><strong>Triggers:</strong> Foods, stress, sleep changes, menses, dehydration</li>
                                            <li><strong>Medications:</strong> What was taken, dose, response</li>
                                            <li><strong>Impact:</strong> School/work absence, activity limitations</li>
                                        </ul>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-mobile-alt"></i> Digital Tools</h4>
                                        <ul class="checklist">
                                            <li>Smartphone apps (Migraine Buddy, N1-Headache)</li>
                                            <li>Online headache calendars</li>
                                            <li>Automated trigger analysis</li>
                                            <li>Easy sharing with healthcare provider</li>
                                            <li>Can track medication timing and response</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-chart-line"></i> Monitoring & Follow-up Schedule</h3>
                                <div class="card-grid">
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-user-md"></i> Primary Headache Disorders</h4>
                                        <ul class="checklist">
                                            <li><strong>Initial follow-up:</strong> 4-6 weeks after diagnosis/treatment start</li>
                                            <li><strong>Stable patients:</strong> Every 3-6 months</li>
                                            <li><strong>Prophylaxis start:</strong> Reassess efficacy and side effects at 6-8 weeks</li>
                                            <li><strong>Medication overuse:</strong> Monthly during withdrawal phase</li>
                                            <li><strong>Annual review:</strong> Even if well-controlled</li>
                                        </ul>
                                    </div>
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-exclamation-circle"></i> Secondary Headache Follow-up</h4>
                                        <ul class="checklist">
                                            <li><strong>Post-neurosurgery:</strong> Per neurosurgical protocol</li>
                                            <li><strong>Shunt patients:</strong> PRN for symptoms; annual shunt series</li>
                                            <li><strong>IIH:</strong> Monthly until stable, then every 3 months (vision checks)</li>
                                            <li><strong>Infection:</strong> After completion of therapy to confirm resolution</li>
                                            <li><strong>Vascular events:</strong> Neurology follow-up for secondary prevention</li>
                                        </ul>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-child"></i> School & Psychosocial</h4>
                                        <ul class="checklist">
                                            <li><strong>School accommodation:</strong> 504 plan/IEP if needed</li>
                                            <li><strong>Mental health screening:</strong> Anxiety, depression common comorbidities</li>
                                            <li><strong>Sleep hygiene:</strong> Regular schedule, screen time limits</li>
                                            <li><strong>Stress management:</strong> Counseling if needed</li>
                                            <li><strong>Family education:</strong> Ensure understanding of condition</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-exclamation-triangle"></i> Red Flags Requiring Re-evaluation</h3>
                                <div class="emergency-alert">
                                    <i class="fas fa-ambulance"></i>
                                    <div>
                                        <strong>Return to ED Immediately If:</strong> New neurological deficit, seizure, persistent vomiting, worsening headache pattern, change in headache character, or new onset in previously stable patient.
                                    </div>
                                </div>
                                
                                <div class="card-grid">
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-inspection"></i> Worsening Features</h4>
                                        <ul class="checklist">
                                            <li><strong>Progressive worsening:</strong> Frequency, severity, or duration increasing</li>
                                            <li><strong>New neurological signs:</strong> Weakness, vision changes, imbalance</li>
                                            <li><strong>Change in pattern:</strong> Different quality, location, or triggers</li>
                                            <li><strong>Medication failure:</strong> Acute meds no longer effective</li>
                                            <li><strong>School absence:</strong> Missing >10 days/year due to headache</li>
                                            <li><strong>Psychosocial impact:</strong> Depression, anxiety developing</li>
                                        </ul>
                                    </div>
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-redo"></i> Re-evaluation Triggers</h4>
                                        <ul class="checklist">
                                            <li><strong>Prophylaxis failure:</strong> No improvement after 3 months at therapeutic dose</li>
                                            <li><strong>Side effects:</strong> Intolerable adverse effects from medications</li>
                                            <li><strong>New red flags:</strong> Any feature suggesting secondary headache</li>
                                            <li><strong>Transition:</strong> Children approaching adolescence may develop new patterns</li>
                                            <li><strong>Comorbidities:</strong> New medical conditions affecting management</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-users"></i> Referral Criteria</h3>
                                <div class="card-grid">
                                    <div class="info-card caution">
                                        <h4><i class="fas fa-hospital"></i> Neurology Referral</h4>
                                        <ul class="checklist">
                                            <li><strong>Diagnostic uncertainty:</strong> Atypical features or unclear classification</li>
                                            <li><strong>Treatment resistance:</strong> Failed ≥2 appropriate preventive therapies</li>
                                            <li><strong>Complex migraines:</strong> Hemiplegic, basilar, status migrainosus</li>
                                            <li><strong>Comorbidities:</strong> Epilepsy, movement disorders, learning difficulties</li>
                                            <li><strong>Behavioral issues:</strong> Significant impact on functioning</li>
                                            <li><strong>Parental request:</strong> High parental anxiety or need for specialist input</li>
                                        </ul>
                                    </div>
                                    <div class="info-card urgent">
                                        <h4><i class="fas fa-ambulance"></i> Emergency/Neurosurgical Referral</h4>
                                        <ul class="checklist">
                                            <li><strong>Suspected tumor:</strong> Progressive headache with neuro signs</li>
                                            <li><strong>Shunt dysfunction:</strong> Any VP shunt patient with headache</li>
                                            <li><strong>Acute hydrocephalus:</strong> Thunderclap or rapidly worsening</li>
                                            <li><strong>Vascular lesion:</strong> SAH, stroke, venous sinus thrombosis</li>
                                            <li><strong>Space-occupying lesion:</strong> Abscess, hematoma, cyst</li>
                                        </ul>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-tooth"></i> Other Specialist Referrals</h4>
                                        <ul class="checklist">
                                            <li><strong>ENT:</strong> Chronic sinusitis, unresponsive to treatment</li>
                                            <li><strong>Dental:</strong> TMJ disorders, bruxism-related headache</li>
                                            <li><strong>Psychology:</strong> Anxiety, depression, coping difficulties</li>
                                            <li><strong>Genetics:</strong> Familial hemiplegic migraine or other inherited disorders</li>
                                            <li><strong>Ophthalmology:</strong> Vision changes, papilledema, IIH</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-graduation-cap"></i> Patient & Family Education</h3>
                                <div class="card-grid">
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-book"></i> Key Educational Points</h4>
                                        <ul class="checklist">
                                            <li><strong>Headache is common:</strong> Reassurance that most are benign</li>
                                            <li><strong>Red flag recognition:</strong> When to seek urgent care</li>
                                            <li><strong>Medication use:</strong> Proper dosing, limits to avoid overuse</li>
                                            <li><strong>Lifestyle factors:</strong> Sleep, hydration, meals, stress, triggers</li>
                                            <li><strong>Trigger management:</strong> Identification and avoidance strategies</li>
                                            <li><strong>Return to activities:</strong> Gradual return after severe headaches</li>
                                            <li><strong>School planning:</strong> 504 accommodations, communication with staff</li>
                                        </ul>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-resources"></i> Resources</h4>
                                        <ul class="checklist">
                                            <li><strong>Headache diary templates:</strong> Paper or digital apps</li>
                                            <li><strong>Support groups:</strong> Online communities for pediatric headache</li>
                                            <li><strong>Educational websites:</strong> American Migraine Foundation, NHF</li>
                                            <li><strong>Books:</strong> Age-appropriate materials about headache</li>
                                            <li><strong>School nurse:</strong> Coordinate care and medication administration</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="action-btn btn-primary" onclick="window.print()">
                                    <i class="fas fa-print"></i> Print Algorithm
                                </button>
                                <button class="action-btn btn-success" onclick="resetAlgorithm()">
                                    <i class="fas fa-redo"></i> Start Over
                                </button>
                                <button class="action-btn btn-warning" onclick="showReferences()">
                                    <i class="fas fa-book"></i> View References
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Hidden References Section -->
            <section class="step-section" id="references" style="display: none;">
                <div class="step-card">
                    <div class="step-header" style="background: #34495e; color: white;">
                        <div class="step-title-main">
                            <div class="step-icon" style="background: #34495e;">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="step-title-text">
                                <h2>References & Guidelines</h2>
                                <p>Key sources and clinical practice guidelines</p>
                            </div>
                        </div>
                    </div>
                    <div class="step-content" style="max-height: 2000px;">
                        <div class="content-inner">
                            <div class="subsection">
                                <h3><i class="fas fa-globe"></i> International Guidelines</h3>
                                <div class="card-grid">
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-brain"></i> ICHD-3 Classification</h4>
                                        <p><strong>Headache Classification Committee of IHS:</strong> The International Classification of Headache Disorders, 3rd edition. Cephalalgia. 2018 Jan;38(1):1-211.</p>
                                        <p><a href="https://www.ichd-3.org" target="_blank" style="color: #3498db;">www.ichd-3.org</a></p>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-imaging"></i> ACR Appropriateness Criteria</h4>
                                        <p><strong>American College of Radiology:</strong> ACR Appropriateness Criteria: Headache-Child. 2017.</p>
                                        <p><a href="https://acsearch.acr.org/docs/69439/Narrative" target="_blank" style="color: #3498db;">ACR Guidelines</a></p>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-flag-usa"></i> UK Guidelines</h3>
                                <div class="card-grid">
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-head-side-cough"></i> NICE Headache Guideline</h4>
                                        <p><strong>Headaches in over 12s: diagnosis and management.</strong> National Institute for Health and Care Excellence. Jun 2025.</p>
                                        <p><a href="https://www.nice.org.uk/guidance/cg150" target="_blank" style="color: #3498db;">NICE CG150</a></p>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-head-injury"></i> NICE Head Injury</h4>
                                        <p><strong>Head injury: assessment and early management.</strong> National Institute for Health and Care Excellence. May 2023.</p>
                                        <p><a href="https://www.nice.org.uk/guidance/ng232" target="_blank" style="color: #3498db;">NICE NG232</a></p>
                                    </div>
                                    <div class="info-card stable">
                                        <h4><i class="fas fa-bacterium"></i> NICE Meningitis</h4>
                                        <p><strong>Meningitis (bacterial) and meningococcal disease: recognition, diagnosis and management.</strong> Mar 2024.</p>
                                        <p><a href="https://www.nice.org.uk/guidance/ng240" target="_blank" style="color: #3498db;">NICE NG240</a></p>
                                    </div>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-stethoscope"></i> Key Evidence</h3>
                                <div class="info-card stable">
                                    <h4><i class="fas fa-flask"></i> Selected References</h4>
                                    <ul class="checklist">
                                        <li>Kan L, et al. Headaches in a pediatric emergency department: etiology, imaging, and treatment. Headache. 2000;40(1):25-29.</li>
                                        <li>Lewis DW, et al. Practice parameter: evaluation of children and adolescents with recurrent headaches. Neurology. 2002;59(4):490-498.</li>
                                        <li>Abu-Arafeh I, Macleod S. Serious neurological disorders in children with chronic headache. Arch Dis Child. 2005;90(9):937-940.</li>
                                        <li>Detsky ME, et al. Does this patient with headache have a migraine or need neuroimaging? JAMA. 2006;296(10):1274-1283.</li>
                                        <li>American College of Radiology. ACR Appropriateness Criteria: Headache-Child. 2017.</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="subsection">
                                <h3><i class="fas fa-star"></i> Key Clinical Pearls</h3>
                                <div class="highlight-box">
                                    <i class="fas fa-lightbulb"></i>
                                    <div>
                                        <strong>Critical Points from Evidence:</strong> Imaging yield is low in primary headache. 98% of children with brain tumors have neurological signs. Normal neuro exam and CT within 6 hours effectively rules out SAH. Early antibiotics are critical in meningitis—don't delay for LP.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <button class="print-btn" onclick="window.print()" title="Print Algorithm">
                <i class="fas fa-print"></i>
            </button>
        </main>
    </div>

    <script>
        // State management
        const state = {
            currentStep: 'assessment',
            progress: 0,
            expandedSteps: new Set(['assessment']),
            searchTerm: '',
            activeFilter: 'all',
            sidebarOpen: window.innerWidth > 1024
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeEventListeners();
            updateProgress();
            updateSidebar();
            highlightAndScroll();
        });

        function initializeEventListeners() {
            // Toggle sidebar
            document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);

            // Step navigation
            document.querySelectorAll('.step-nav li').forEach(item => {
                item.addEventListener('click', () => showStep(item.dataset.step));
            });

            // Search functionality
            document.getElementById('searchBox').addEventListener('input', (e) => {
                state.searchTerm = e.target.value.toLowerCase();
                filterContent();
            });

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.activeFilter = btn.dataset.filter;
                    filterContent();
                });
            });

            // Window resize
            window.addEventListener('resize', () => {
                if (window.innerWidth > 1024) {
                    state.sidebarOpen = true;
                    document.getElementById('sidebar').classList.remove('closed');
                    document.getElementById('toggleSidebar').classList.remove('closed');
                }
            });
        }

        function toggleSidebar() {
            state.sidebarOpen = !state.sidebarOpen;
            document.getElementById('sidebar').classList.toggle('closed');
            document.getElementById('toggleSidebar').classList.toggle('closed');
        }

        function toggleStep(header) {
            const card = header.parentElement;
            const stepName = card.dataset.step;
            
            card.classList.toggle('expanded');
            
            if (card.classList.contains('expanded')) {
                state.expandedSteps.add(stepName);
                // Scroll to card
                setTimeout(() => {
                    card.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 300);
            } else {
                state.expandedSteps.delete(stepName);
            }
            
            updateProgress();
        }

        function showStep(stepName) {
            const stepElement = document.getElementById(stepName);
            if (!stepElement) return;
            
            state.currentStep = stepName;
            state.expandedSteps.add(stepName);
            
            // Update navigation
            document.querySelectorAll('.step-nav li').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.step === stepName) {
                    item.classList.add('active');
                    item.querySelector('.step-status').textContent = 'Current Step';
                }
            });
            
            // Expand the step
            const card = stepElement.querySelector('.step-card');
            card.classList.add('expanded');
            
            // Scroll to step
            setTimeout(() => {
                stepElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
            
            // Mark previous steps as completed
            const navOrder = ['assessment', 'diagnosis', 'treatment', 'followup'];
            const currentIndex = navOrder.indexOf(stepName);
            navOrder.forEach((step, index) => {
                const navItem = document.querySelector(`[data-step="${step}"]`);
                if (index < currentIndex) {
                    navItem.classList.add('completed');
                    navItem.querySelector('.step-status').textContent = 'Completed';
                } else if (index > currentIndex) {
                    navItem.classList.remove('completed');
                    navItem.querySelector('.step-status').textContent = 'Pending';
                }
            });
            
            updateProgress();
        }

        function updateProgress() {
            const navOrder = ['assessment', 'diagnosis', 'treatment', 'followup'];
            const currentIndex = navOrder.indexOf(state.currentStep);
            state.progress = ((currentIndex + 1) / navOrder.length) * 100;
            
            document.getElementById('progressFill').style.width = `${state.progress}%`;
            document.getElementById('progressText').textContent = `${Math.round(state.progress)}% Complete`;
            
            // Update navigation progress indicators
            navOrder.forEach((step, index) => {
                const navItem = document.querySelector(`[data-step="${step}"]`);
                if (index < currentIndex || state.expandedSteps.has(step)) {
                    navItem.classList.add('completed');
                }
            });
        }

        function updateSidebar() {
            // Update sidebar based on current state
            document.querySelectorAll('.step-nav li').forEach(item => {
                if (item.dataset.step === state.currentStep) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        function filterContent() {
            const allElements = document.querySelectorAll('.info-card, .differential-item, .investigation-item, .checklist li');
            
            allElements.forEach(element => {
                let shouldShow = true;
                
                // Search filter
                if (state.searchTerm) {
                    const text = element.textContent.toLowerCase();
                    shouldShow = shouldShow && text.includes(state.searchTerm);
                    
                    // Highlight matching text
                    if (shouldShow) {
                        highlightText(element);
                    } else {
                        removeHighlight(element);
                    }
                } else {
                    removeHighlight(element);
                }
                
                // Severity filter
                if (state.activeFilter !== 'all') {
                    const badge = element.querySelector('.severity-badge');
                    if (badge) {
                        const badgeClass = badge.className.split(' ').find(c => ['red', 'amber', 'green'].includes(c));
                        shouldShow = shouldShow && 
                            ((state.activeFilter === 'urgent' && badgeClass === 'red') ||
                             (state.activeFilter === 'caution' && badgeClass === 'amber') ||
                             (state.activeFilter === 'stable' && badgeClass === 'green'));
                    }
                }
                
                element.style.display = shouldShow ? 'block' : 'none';
                element.style.opacity = shouldShow ? '1' : '0';
                element.style.transform = shouldShow ? 'scale(1)' : 'scale(0.95)';
            });
            
            // Show/hide entire sections based on content
            document.querySelectorAll('.subsection').forEach(subsection => {
                const visibleCards = subsection.querySelectorAll('.info-card, .differential-item, .investigation-item, .checklist li[style*="display: block"]');
                subsection.style.display = visibleCards.length > 0 || !state.searchTerm ? 'block' : 'none';
            });
        }

        function highlightText(element) {
            // Simple highlight implementation
            const walker = document.createTreeWalker(
                element,
                NodeWalker.SHOW_TEXT,
                null,
                false
            );
            
            const textNodes = [];
            let node;
            while (node = walker.nextNode()) {
                if (node.nodeValue.toLowerCase().includes(state.searchTerm)) {
                    textNodes.push(node);
                }
            }
            
            textNodes.forEach(node => {
                const parent = node.parentNode;
                const text = node.nodeValue;
                const regex = new RegExp(`(${state.searchTerm})`, 'gi');
                const highlighted = text.replace(regex, '<mark style="background: yellow; padding: 2px; border-radius: 3px;">$1</mark>');
                
                if (parent.innerHTML) {
                    parent.innerHTML = parent.innerHTML.replace(text, highlighted);
                }
            });
        }

        function removeHighlight(element) {
            const marks = element.querySelectorAll('mark');
            marks.forEach(mark => {
                mark.outerHTML = mark.innerHTML;
            });
        }

        function highlightAndScroll() {
            // Check for URL hash and scroll to element
            if (window.location.hash) {
                const element = document.querySelector(window.location.hash);
                if (element) {
                    setTimeout(() => {
                        element.scrollIntoView({ behavior: 'smooth' });
                        element.classList.add('pulse');
                        setTimeout(() => element.classList.remove('pulse'), 2000);
                    }, 500);
                }
            }
        }

        function resetAlgorithm() {
            if (confirm('Reset to beginning? This will clear all progress.')) {
                state.currentStep = 'assessment';
                state.expandedSteps.clear();
                state.expandedSteps.add('assessment');
                state.searchTerm = '';
                state.activeFilter = 'all';
                
                // Reset UI
                document.getElementById('searchBox').value = '';
                document.querySelectorAll('.filter-btn[data-filter="all"]').forEach(btn => btn.click());
                
                // Show assessment section
                showStep('assessment');
                
                // Collapse all other steps
                document.querySelectorAll('.step-card').forEach(card => {
                    if (card.dataset.step !== 'assessment') {
                        card.classList.remove('expanded');
                    }
                });
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function showReferences() {
            document.getElementById('references').style.display = 'block';
            document.getElementById('references').scrollIntoView({ behavior: 'smooth' });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'f':
                        e.preventDefault();
                        document.getElementById('searchBox').focus();
                        break;
                    case 'p':
                        e.preventDefault();
                        window.print();
                        break;
                    case 'r':
                        e.preventDefault();
                        resetAlgorithm();
                        break;
                }
            }
            
            // Arrow key navigation
            if (!e.ctrlKey && !e.metaKey) {
                const navOrder = ['assessment', 'diagnosis', 'treatment', 'followup'];
                const currentIndex = navOrder.indexOf(state.currentStep);
                
                switch(e.key) {
                    case 'ArrowRight':
                    case 'ArrowDown':
                        e.preventDefault();
                        if (currentIndex < navOrder.length - 1) {
                            showStep(navOrder[currentIndex + 1]);
                        }
                        break;
                    case 'ArrowLeft':
                    case 'ArrowUp':
                        e.preventDefault();
                        if (currentIndex > 0) {
                            showStep(navOrder[currentIndex - 1]);
                        }
                        break;
                }
            }
        });

        // Print functionality enhancements
        window.addEventListener('beforeprint', () => {
            // Expand all sections for printing
            document.querySelectorAll('.step-card').forEach(card => {
                card.classList.add('expanded');
            });
            
            // Remove any filters
            filterContent();
        });

        // Save/Load state to localStorage
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('headacheAlgorithmState', JSON.stringify(state));
        });

        // Load state on page load
        window.addEventListener('load', () => {
            const savedState = localStorage.getItem('headacheAlgorithmState');
            if (savedState) {
                try {
                    const loadedState = JSON.parse(savedState);
                    Object.assign(state, loadedState);
                    
                    // Restore UI state
                    if (state.currentStep) {
                        showStep(state.currentStep);
                    }
                    
                    if (state.searchTerm) {
                        document.getElementById('searchBox').value = state.searchTerm;
                        filterContent();
                    }
                    
                    // Restore expanded steps
                    state.expandedSteps.forEach(step => {
                        const card = document.querySelector(`[data-step="${step}"]`);
                        if (card) card.classList.add('expanded');
                    });
                } catch (e) {
                    console.log('Could not load saved state:', e);
                }
            }
        });

        // Add smooth scrolling for all internal links
        document.querySelectorAll('a[href^="#"]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = document.querySelector(link.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Add animation to cards on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, { threshold: 0.1 });

        // Observe all cards
        document.querySelectorAll('.card-grid > *').forEach(card => {
            observer.observe(card);
        });
    </script>
</body>
</html>